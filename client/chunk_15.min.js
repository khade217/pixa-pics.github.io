(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{655:function(e,t,n){const _=new Int32Array(15),s={_get_init_state:(e,t,n,_,s,a)=>({canvas_event_target:"CANVAS_WRAPPER_OVERFLOW",canvas_container:{top:0,left:0,height:0,width:0},sizes:{width:0|e,height:0|t},screen_zoom_ratio:1,canvas_wrapper:{padding:0|_,border_width:0|s},scale:{"default":n,current:n,move_x:0,move_y:0,moves_speeds:[],move_speed_timestamp:0|Date.now(),moves_speed_average_now:16},device_pixel_ratio:window.devicePixelRatio,perspective:a}),_get_screen_zoom_ratio:e=>e.canvas_container.width>e.canvas_container.height?(e.canvas_container.height-e.canvas_wrapper.padding/e.device_pixel_ratio*2)/e.sizes.height:(e.canvas_container.width-e.canvas_wrapper.padding/e.device_pixel_ratio*2)/e.sizes.width,_get_pos:(e,t,n)=>(_[0]=2*Math.round(e.canvas_wrapper.padding/e.device_pixel_ratio*e.scale.current+e.canvas_wrapper.border_width)|0,_[1]=Math.round(e.sizes.width*t*e.scale.current)+_[0]|0,_[2]=Math.round(e.sizes.height*t*e.scale.current)+_[0]|0,_[3]=0|e.scale.move_x,_[4]=0|e.scale.move_y,_[5]=e.canvas_container.left+_[3]|0,_[6]=e.canvas_container.top+_[4]|0,_[7]=_[5]+_[1]|0,_[8]=_[6]+_[2]|0,_[9]=_[0]/2|0,_[10]=_[0]/2|0,_[11]=_[5]+_[9]|0,_[12]=_[6]+_[10]|0,_[13]=_[7]-_[0]/2|0,_[14]=_[8]-_[0]/2|0,void 0===n&&(n={}),"undefined"==typeof n.canvas&&(n.canvas={}),n.canvas.offset_left=_[9],n.canvas.offset_top=_[10],n.canvas.left=_[11],n.canvas.top=_[12],n.canvas.right=_[13],n.canvas.bottom=_[14],n.canvas.width=_[13]-_[11]|0,n.canvas.height=_[14]-_[12]|0,"undefined"==typeof n.canvas_wrapper&&(n.canvas_wrapper={}),n.canvas_wrapper.offset_left=_[3],n.canvas_wrapper.offset_top=_[4],n.canvas_wrapper.left=_[5],n.canvas_wrapper.top=_[6],n.canvas_wrapper.right=_[7],n.canvas_wrapper.bottom=_[8],n.canvas_wrapper.width=_[7]-_[5]|0,n.canvas_wrapper.height=_[8]-_[6]|0,"undefined"==typeof n.canvas_container&&(n.canvas_container={}),n.canvas_container.offset_left=0|e.canvas_container.left,n.canvas_container.offset_top=0|e.canvas_container.top,n.canvas_container.left=0|e.canvas_container.left,n.canvas_container.top=0|e.canvas_container.top,n.canvas_container.right=e.canvas_container.left+e.canvas_container.width|0,n.canvas_container.bottom=e.canvas_container.top+e.canvas_container.height|0,n.canvas_container.width=0|e.canvas_container.width,n.canvas_container.height=0|e.canvas_container.height,n),_get_init_pointer_state:()=>({event_button:null,mouse_down:!1,pointer_events:new Map,previous_single_pointer_down_timestamp:0,previous_double_pointer_down_timestamp:0,latest_pointers_distance:0,latest_pointers_client_x_center:0,latest_pointers_client_y_center:0,previous_double_pointer_move_timestamp:0}),_copy_event:e=>({pointerId:0|e.pointerId,clientX:0|e.clientX,clientY:0|e.clientY,pageX:0|e.pageX,pageY:0|e.pageY,button:0|e.button}),_get_shadows(e){function t(t){const _=n.to_rgba_from_hex(n.format_hex_color(e));let s=n.to_hex_from_rgba(Uint8ClampedArray.of(_[0],_[1],_[2],parseInt(142.8))),a=n.to_hex_from_rgba(Uint8ClampedArray.of(_[0],_[1],_[2],parseInt(91.8))),i=n.to_hex_from_rgba(Uint8ClampedArray.of(_[0],_[1],_[2],parseInt(.24*255)));return Array.of(`${t[0]}px ${t[1]}px ${t[2]}px ${t[3]}px ${s}`,`${t[4]}px ${t[5]}px ${t[6]}px ${t[7]}px ${a}`,`${t[8]}px ${t[9]}px ${t[10]}px ${t[11]}px ${i}`).join(",")}const n={format_hex_color(e){const t=0|e.length;if(void 0===e)return"#00000000";{let n="",_="",s="",a="",i="#12345678";switch(t){case 9:i=e;break;case 7:i=e.concat("ff");break;case 5:n=e.charAt(1),_=e.charAt(2),s=e.charAt(3),a=e.charAt(4),i="#".concat(n,n,_,_,s,s,a,a);break;case 4:n=e.charAt(1),_=e.charAt(2),s=e.charAt(3),i="#".concat(n,n,_,_,s,s,"ff")}return i}},to_hex_from_rgba:e=>"#".concat("00000000".concat(new Uint32Array(e.reverse().buffer)[0].toString(16)).slice(-8)),to_rgba_from_hex:e=>new Uint8ClampedArray(Uint32Array.of(parseInt(e.slice(1),16)).buffer).reverse()};return Array.of("",t([0,2,1,-1,0,1,1,0,0,1,3,0]),t([0,3,1,-2,0,2,2,0,0,1,5,0]),t([0,3,3,-2,0,3,4,0,0,1,8,0]),t([0,2,4,-1,0,4,5,0,0,1,10,0]),t([0,3,5,-1,0,5,8,0,0,1,14,0]),t([0,3,5,-1,0,6,10,0,0,1,18,0]),t([0,4,5,-2,0,7,10,1,0,2,16,1]),t([0,5,5,-3,0,8,10,1,0,3,14,2]),t([0,5,6,-3,0,9,12,1,0,3,16,2]),t([0,6,6,-3,0,10,14,1,0,4,18,3]),t([0,6,7,-4,0,11,15,1,0,4,20,3]),t([0,7,8,-4,0,12,17,2,0,5,22,4]),t([0,7,8,-4,0,13,19,2,0,5,24,4]),t([0,7,9,-4,0,14,21,2,0,5,26,4]),t([0,8,9,-5,0,15,22,2,0,6,28,5]),t([0,8,10,-5,0,16,24,2,0,6,30,5]),t([0,8,11,-5,0,17,26,2,0,6,32,5]),t([0,9,11,-5,0,18,28,2,0,7,34,6]),t([0,9,12,-6,0,19,29,2,0,7,36,6]),t([0,10,13,-6,0,20,31,3,0,8,38,7]),t([0,10,13,-6,0,21,33,3,0,8,40,7]),t([0,10,14,-6,0,22,35,3,0,8,42,7]),t([0,11,14,-7,0,23,36,3,0,9,44,8]),t([0,11,15,-7,0,24,38,3,0,9,46,8]))},from(e,t,n,_,s,a){const i=this._get_screen_zoom_ratio,o=this._get_init_state,r=this._get_init_pointer_state,l=this._get_pos,c=this._get_shadows;this._copy_event;let p=!1,h=c("#020529"),d=r(),u=o(e,t,n,_,s,a),f=i(u),m=l(u,f),g={update(){},menu(){},move(){},up(){},down(){},middle(){},ripple(){}},v=null,x=null,y={box_shadow:"",will_change:!1};return{init_speed_interval:function(){null!==v?setTimeout(this.set_move_speed_average_now,5):v=setInterval(this.set_move_speed_average_now,20)},set_canvas_wrapper:function(e,t){u.canvas_wrapper={padding:e,border_width:t},f=i(u),m=l(u,f),this.set_current_scale_default()},set_canvas_container:function(e,t,n,_){u.canvas_container={top:e,left:t,height:n,width:_},f=i(u),m=l(u,f),this.set_current_scale_default()},set_sizes:function(e,t){u.sizes={width:e,height:t},u.scale.moves_speed_average_now=16,f=i(u),m=l(u,f)},set_perspective:function(e){u.perspective=e},get_pointer_state:function(){return d},get_perspective_state:function(){return x||{}},get_screen_zoom_ratio:function(){return Math.fround(parseFloat(f)).toFixed(2)},compute_perspective_from_pointer_event:function(e,t){if(e|=0,t|=0,!(u.perspective>0))return;const n=e-m.canvas_container.left|0,_=t-m.canvas_container.top|0,s=u.perspective*(n-m.canvas_container.width/2)/(m.canvas_container.width/2),a=-u.perspective*(_-m.canvas_container.height/2)/(m.canvas_container.height/2),i=s>u.perspective?s:2*s,o=a<0?a:2*a,r=255-i/2*255,l=o/2*255,c=(1.25*i/u.scale.current*1e3|0)/1e3,p=(1.25*o/u.scale.current*1e3|0)/1e3,h=!(!p&&!c),d=h?`rotateX(${p}deg) rotateY(${c}deg)`:"",f=h?`linear-gradient(to right, rgba(\n                            ${r.toFixed(3)},\n                            ${r.toFixed(3)},\n                            ${r.toFixed(3)}, \n                            ${(Math.abs(.1*i)/(2*u.perspective)).toFixed(2)}\n                            ), rgba(\n                            ${r.toFixed(3)},\n                            ${r.toFixed(3)},\n                            ${r.toFixed(3)}, \n                            ${(Math.abs(.6*i)/(2*u.perspective)).toFixed(2)}\n                            )), linear-gradient(to top, rgba(\n                            ${l.toFixed(3)},\n                            ${l.toFixed(3)},\n                            ${l.toFixed(3)}, \n                            ${(Math.abs(.75*o)/(2*u.perspective)).toFixed(2)}\n                            ), rgba(\n                            ${l.toFixed(3)},\n                            ${l.toFixed(3)},\n                            ${l.toFixed(3)}, \n                            ${(Math.abs(.25*o)/(2*u.perspective)).toFixed(2)}\n                            ))`:"",g=(1+(-c+p)/80).toFixed(2);x={transform_rotate:d,background_image:f,filter:h?`brightness(${g}) contrast(${g})`:""}},set_pointer_state:function(e){var t="",n=!1;for(t in"mouse_down"in e&&d.mouse_down!==e.mouse_down&&(n=!0),e)d[t]=e[t];n&&this.notify_cursor()},set_moves:function(e,t,n,_){n=n||null,_=_||function(){};let s=Date.now();const{scale:a,canvas_event_target:o}=u,r="CANVAS_WRAPPER_OVERFLOW"!==o?18:24;let{move_x:c,move_y:p,moves_speeds:h,move_speed_timestamp:d,current:g}=a;const v=s-d|0,x=c-e|0,y=p-t|0,b=0|Math.min(Math.round((0|Math.sqrt(x*x+y*y))/v*200),200);h.push(b),h.length>=r&&h.shift();let w=h.slice(-r).reduce(((e,t,n,_)=>e+t/_.length),0);w=Math.max(1,Math.round(Math.floor(w*r/200)));const E=!(null===n);u.scale["default"]=Math.fround(parseFloat(a["default"])),u.scale.current=Math.fround(parseFloat(E?n:g)),u.scale.move_x=0|e,u.scale.move_y=0|t,u.scale.move_speed_timestamp=Date.now(),u.scale.moves_speeds=h,u.scale.moves_speed_average_now=null!==n&&n>g?r:null!==n&&n<g?0:parseInt(w),f=i(u),m=l(u,f,m),this.notify_moved(_)},set_notifiers:function(e=function(){},t=function(){},n=function(){},_=function(){},s=function(){},a=function(){},i=function(){},o=function(){}){g={update:e,menu:t,move:n,up:_,down:s,middle:a,cursor:i,ripple:o}},notify_moved:function(e){g.update(!1,!1,e)},notify_menu:function(e,t){setTimeout((function(){g.menu(e)}),t|=0)},notify_move:function(e){g.move(e)},notify_up:function(e){g.up(e)},notify_down:function(e){g.down(e)},notify_ripple:function(e){g.ripple(e)},notify_middle:function(){g.middle(!1,!1)},notify_cursor:function(){g.cursor(d.mouse_down,u.canvas_event_target)},set_shadow_color:function(e){h=c(e)},set_zoom:function(e=1,t,n,_=0,s=0,a=function(){}){const{scale:i,canvas_container:o,canvas_wrapper:r}=u,{current:l,move_y:c,move_x:p}=i;let h=l*e;if(!(h>6||h<1/6)){let e,i,d=1-l/h,u=h/l;if(t&&n?(e=t-o.left|0,i=n-o.top|0):(e=o.width/2|0,i=o.height/2|0),0===_&&0===s)this.set_moves(p,c,h,a);else{let t=(p-e*d)*u+_|0,n=(c-i*d)*u+s|0;const l=(o.width-r.width)/2|0,f=(o.height-r.height)/2|0,m=3/4*r.width+l,g=3/4*r.height+f;n-=f,t-=l;let v=Math.min(Math.abs(t),m)*(t<0?-1:1)+l,x=Math.min(Math.abs(n),g)*(n<0?-1:1)+f;this.set_moves(v,x,h,a)}}},handle_wheel:function({deltaY:e,pageY:t,pageX:n,movementX:_=0,movementY:s=0}){const{canvas_container:a,canvas_wrapper:i}=this.get_pos(),{move_x:o,move_y:r,current:l}=u.scale;let c=Math.max(Math.min(.125,Math.abs(-.01*e)),.25);c=-.01*e>0?c:-c;let p=l+c*l*(.9/Math.pow(l<1?1/l:l,1.6));if(!(p>6||p<1/6)){let e,c,h=1-l/p,d=p/l;n&&t?(e=n-a.left|0,c=t-a.top|0):(e=a.width/2|0,c=a.height/2|0);let u=(o-e*h)*d+_|0,f=(r-c*h)*d+s|0;const m=(a.width-i.width)/2|0,g=(a.height-i.height)/2|0,v=3/4*i.width+m,x=3/4*i.height+g;f-=g,u-=m;let y=Math.min(Math.abs(u),v)*(u<0?-1:1)+m,b=Math.min(Math.abs(f),x)*(f<0?-1:1)+g;this.set_moves(y,b,p)}},handle_move:function(e,t,n,_){const{canvas_container:s,canvas_wrapper:a}=this.get_pos(),{move_x:i,move_y:o}=u.scale,r=(s.width-a.width)/2|0,l=(s.height-a.height)/2|0,c=3/4*a.width+r|0,p=3/4*a.height+l|0,h=i+(n-e|0)-l|0,d=o+(_-t|0)-r|0,f=h<0?-1:1,m=Math.min(Math.abs(h),c)*f+r|0,g=Math.min(Math.abs(d),p)*f+l|0;this.set_moves(m,g)},set_boolean_move_on_click:function(e){p=e},handle_pointer_down:function(e){e.preventDefault();const{canvas_event_target:t}=u;let{latest_pointers_distance:n,latest_pointers_client_x_center:_,latest_pointers_client_y_center:s,previous_single_pointer_down_timestamp:a,previous_double_pointer_down_timestamp:i,pointer_events:o}=this.get_pointer_state();const r=parseInt(a),l=parseInt(i);o.set(""+e.pointerId,e);const c=!(1!==o.size),p=!(2!==o.size);a=c?Date.now():r,i=p?Date.now():l,this.set_pointer_state({pointer_events:o,mouse_down:!0,event_button:parseInt(e.button),latest_pointers_distance:p?0:parseFloat(n),previous_single_pointer_down_timestamp:parseInt(a),previous_double_pointer_down_timestamp:parseInt(i),latest_pointers_client_x_center:parseInt(e.clientX),latest_pointers_client_y_center:parseInt(e.clientY)}),2===parseInt(e.button||0)||Math.abs(a-r)<200&&Math.abs(_-e.clientX)<20&&Math.abs(s-e.clientY)<20?this.notify_menu(e,180):c&&l+200>Date.now()||!c&&"mouse"!==e.pointerType||"CANVAS"!==t||this.notify_down(e),"CANVAS_WRAPPER_OVERFLOW"===t&&this.notify_ripple(e)},handle_pointer_up:function(e){e.preventDefault();const{canvas_event_target:t}=u;let{pointer_events:n}=this.get_pointer_state();n["delete"](""+e.pointerId),this.set_pointer_state({pointer_events:n,mouse_down:!(0===n.size)}),this.notify_up(e),("CANVAS_WRAPPER_OVERFLOW"===t&&1===e.which||"CANVAS"!==t)&&this.notify_moved()},handle_pointer_move:function(e){e.preventDefault();const t=""+u.canvas_event_target;this.compute_canvas_event_target(parseInt(e.pageX),parseInt(e.pageY));const n=""+u.canvas_event_target;let{mouse_down:_,event_button:s,pointer_events:a,latest_pointers_distance:i,latest_pointers_client_x_center:o,latest_pointers_client_y_center:r,previous_double_pointer_move_timestamp:l,previous_single_pointer_down_timestamp:c}=this.get_pointer_state();if(a.set(""+e.pointerId,e),2===a.size){const e=Array.from(a.values()),t=e[0].clientX-e[1].clientX,n=e[0].clientY-e[1].clientY,_=Math.sqrt(t*t+n*n),s=parseInt(e[0].clientX+e[1].clientX)/2,l=parseInt(e[0].clientY+e[1].clientY)/2,p=parseInt(e[0].pageX+e[1].pageX)/2,h=parseInt(e[0].pageY+e[1].pageY)/2,d=s-o,f=l-r,m=u.scale.move_x+d,g=u.scale.move_y+f,v=i>0?parseFloat(_/i):1,x={pointer_events:a,latest_pointers_distance:parseFloat(_),latest_pointers_client_x_center:parseInt(s),latest_pointers_client_y_center:parseInt(l),previous_double_pointer_move_timestamp:Date.now()};if(c+30<Date.now()){const{canvas_container:e,canvas_wrapper:t}=this.get_pos(),{current:n}=u.scale;let _=n*v;if(!(_>6||_<1/6)){let s,a,i=1-n/_,o=_/n;s=p-e.left|0,a=h-e.top|0;let r=(m-s*i)*o+d|0,l=(g-a*i)*o+f|0;const c=(e.width-t.width)/2|0,u=(e.height-t.height)/2|0,v=3/4*t.width+c,x=3/4*t.height+u;l-=u,r-=c;let y=Math.min(Math.abs(r),v)*(r<0?-1:1)+c,b=Math.min(Math.abs(l),x)*(l<0?-1:1)+u;this.set_moves(y,b,_)}this.set_pointer_state(x)}else this.set_pointer_state(x)}else if(_&&1===a.size){const t={pointer_events:a,latest_pointers_client_x_center:parseInt(e.clientX),latest_pointers_client_y_center:parseInt(e.clientY),previous_double_pointer_move_timestamp:parseInt(l)};"CANVAS"!==n||"CANVAS"===n&&0===s&&p||1===s?l+200<Date.now()||1===s?(this.set_pointer_state(t),this._handle_canvas_move(parseInt(e.clientX-o),parseInt(e.clientY-r))):this.set_pointer_state(t):(this.set_pointer_state(t),this.notify_move(e))}else t!==n?(this.notify_move(e),this.notify_moved()):"CANVAS"===n&&this.notify_move(e)},_handle_canvas_move:function(e,t){const{canvas_container:n,canvas_wrapper:_}=this.get_pos(),{move_x:s,move_y:a}=u.scale,i=(n.width-_.width)/2,o=(n.height-_.height)/2,r=3/4*_.width+i,l=3/4*_.height+o;let c=s+e,p=a+t;p-=o,c-=i;const h=Math.min(Math.abs(c),r)*(c<0?-1:1)+i,d=Math.min(Math.abs(p),l)*(p<0?-1:1)+o;this.set_moves(h,d)},"new":function(e,t,n,_,s,a){h=c("#020529"),d=r(),u=o(e,t,n,_,s,a),f=i(u),m=l(u,f),g={moved(){},menu(){},canvas(){},up(){}}},destroy:function(){h=null,p=null,d=null,u=null,m=null,g=null},get_pos:function(){return m},get_state:function(){return u},get_style:function(){return y.msan=u.scale.moves_speed_average_now,y.box_shadow=h[y.msan<0?Math.round(Math.abs(y.msan)/2):y.msan],y},get_canvas_pos_from_event:function(e,t){const{canvas:n}=this.get_pos(),{width:_,height:s}=u.sizes,a=parseInt(e)-n.left,i=parseInt(t)-n.top;let o=Math.floor(_*(a/n.width)),r=Math.floor(s*(i/n.height));return o=o!==Math.max(Math.min(o,_-1),0)?-1:o,r=r!==Math.max(Math.min(r,s-1),0)?-1:r,-1!==o&&-1!==r||(o=-1,r=-1),[o,r]},set_current_scale_default:function(){u.scale.current=parseFloat(u.scale["default"]),f=i(u),m=l(u,f,m),this.set_canvas_moves_middle()},set_canvas_moves_middle:function(){const{canvas_container:e,canvas_wrapper:t}=this.get_pos(),n=parseInt(parseInt(e.width-t.width)/2),_=parseInt(parseInt(e.height-t.height)/2);this.set_moves(n,_,null,this.notify_middle)},compute_canvas_event_target:function(e,t){e|=0,t|=0,this.compute_perspective_from_pointer_event(e,t);const{canvas:n,canvas_wrapper:_}=m;let s="CANVAS_WRAPPER_OVERFLOW",a=!1;e>=n.left&&t>=n.top&&e<=n.right&&t<=n.bottom?s="CANVAS":e>=_.left&&t>=_.top&&e<=_.right&&t<=_.bottom&&(s="CANVAS_WRAPPER"),u.canvas_event_target!==s&&(a=!0,u.canvas_event_target=s),a&&this.notify_cursor()},set_move_speed_average_now:function(){if(!u)return;const e="CANVAS_WRAPPER_OVERFLOW"!==u.canvas_event_target?18:24,t=Date.now();if(t-u.scale.move_speed_timestamp>=20&&u.scale.moves_speed_average_now>-e){const n=Math.max(u.scale.moves_speed_average_now-1,-e);u.scale.moves_speed_average_now=n,u.scale.move_speed_timestamp=0|t,g.update(!0,!0)}else t-u.scale.move_speed_timestamp>=20&&u.scale.moves_speed_average_now<-e&&e<24?(u.scale.moves_speed_average_now=0|Math.max(u.scale.moves_speed_average_now+1,-e),u.scale.move_speed_timestamp=0|t,g.update(!0,!0)):u.perspective>0&&g.update(!0,!0)}}}};e.exports=s},703:function(e,t,n){function _(e,t,n){e|=0,t|=0;var _=new Uint8Array(e);void 0!==n?(_.fill(255),_.set(n,0)):_.fill(255);let s={number_length_index_byte:Uint32Array.of(e,t,0,0),hover_data_in_layer:new Uint8Array(t),indexes_data_for_layers:new Uint32Array(t),colors_data_in_layers_uint32:new Uint32Array(t*e),layers_opacity_255:_};return s.colors_data_in_layers_uint32_SIMDope=new c(s.colors_data_in_layers_uint32.buffer),s}function s(e,t,n,s){if(t|=0,n|=0,void 0===e)return _(t,n,s);if(null===e)return _(t,n,s);{let a=p(t,e.layer_number);return h(a,0)||w(e.max_length,n)?_(t,n,s):(e.number_length_index_byte[0]=0|t,e.number_length_index_byte[1]=0|n,e.number_length_index_byte[2]=0,e.number_length_index_byte[3]=0,void 0!==s?(e.layers_opacity_255.fill(255),e.layers_opacity_255.set(s)):e.layers_opacity_255.fill(255),e)}}var a,i=n(596),o=(0,i.SIMDopeCreateConfAdd)({create:{new_of:!0},properties:{},methods:{get_use_element:!0,set_tail:!0,get_tail:!0,get_tail_opacity:!0,reset_tail:!0,is_dark:!0,blend_first_with:!0,blend_first_with_tails:!0}});const{simdops:r,Color:l,Colors:c}=(0,i.SIMDopeCreate)(o),{minus_int:p,int_not_equal:h,plus_int:d,plus_uint:u,minus_uint:f,multiply_int:m,multiply_uint:g,divide_uint:v,clamp_uint8:x,clamp_uint32:y,int_equal:b,uint_less:w,int_less:E,int_greater_equal:A,uint_not_equal:C,uint_less_equal:F,min_uint:I}=r;Object.defineProperty((a=function(e){return e=e||{},this instanceof a?(this.state_=_(e.layer_number||1,e.max_length||1,e.layers_opacity_255||new Uint8Array(0)),this.number_length_index_byte_=this.state_.number_length_index_byte,this.hover_data_in_layer_=this.state_.hover_data_in_layer,this.indexes_data_for_layers_=this.state_.indexes_data_for_layers,this.colors_data_in_layers_uint32_=this.state_.colors_data_in_layers_uint32,this.shadow_state_=((t=t||{base_rgba_colors_for_blending:new Uint32Array(0),color_less_uint8x4:l.new_of(255,255,255,255),color_full_uint8x4:l.new_of(0,0,0,255),layers_color:[],all_layers_length:0,used_colors_length:0}).base_rgba_colors_for_blending_SIMDope=new c(t.base_rgba_colors_for_blending.buffer),t),this.data_array_=[],this):new a(e);var t}).prototype,"state",{get:function(){return this.state_},enumerable:!1,configurable:!1}),Object.defineProperty(a.prototype,"set_state",{get:function(){return function(e){return this.state_=e,this.number_length_index_byte_=this.state_.number_length_index_byte,this.hover_data_in_layer_=this.state_.hover_data_in_layer,this.indexes_data_for_layers_=this.state_.indexes_data_for_layers,this.colors_data_in_layers_uint32_=this.state_.colors_data_in_layers_uint32,this.state_}},enumerable:!1,configurable:!1}),Object.defineProperty(a.prototype,"set_shadow_state",{get:function(){return function(e){return this.shadow_state_=e}},enumerable:!1,configurable:!1}),Object.defineProperty(a.prototype,"get_updated_shadow_state",{get:function(){return function(){return this.shadow_state_.layers_color.length<this.number_length_index_byte_[0]+1&&(this.shadow_state_.layers_colors=Array(this.number_length_index_byte_[0]+1|0).fill(null).map((function(){return new l(new ArrayBuffer(4))}))),this.shadow_state_.base_rgba_colors_for_blending.length>=this.number_length_index_byte_[2]?this.shadow_state_.base_rgba_colors_for_blending.fill(0,0,this.shadow_state_.used_colors_length):(this.shadow_state_.base_rgba_colors_for_blending=new Uint32Array(0|this.number_length_index_byte_[2]),this.shadow_state_.base_rgba_colors_for_blending_SIMDope=new c(this.shadow_state_.base_rgba_colors_for_blending.buffer)),this.shadow_state_.all_layers_length=0|this.number_length_index_byte_[0],this.shadow_state_.max_used_colors_length=0|this.number_length_index_byte_[1],this.shadow_state_.used_colors_length=0|this.number_length_index_byte_[2],this.shadow_state_}},enumerable:!1,configurable:!1}),Object.defineProperty(a.prototype,"shadow_state",{get:function(){return this.shadow_state_},enumerable:!1,configurable:!1}),Object.defineProperty(a.prototype,"set_bytes_index",{get:function(){return function(e){return this.number_length_index_byte_[3]=0|e}},enumerable:!1,configurable:!1}),Object.defineProperty(a.prototype,"data_array",{get:function(){return this.data_array_},enumerable:!1,configurable:!1}),Object.defineProperty(a.prototype,"set_data_array",{get:function(){return function(e){return this.data_array_=e}},enumerable:!1,configurable:!1}),Object.defineProperty(a.prototype,"bytes_index",{get:function(){return function(){return 0|this.number_length_index_byte_[3]}},enumerable:!1,configurable:!1}),a.init=function(e,t,n){return new a({layer_number:e,max_length:t,layers_opacity_255:n})},Object.defineProperty(a.prototype,"for",{get:function(){return function(e,t){this.indexes_data_for_layers_[this.number_length_index_byte_[2]]=y(e),this.hover_data_in_layer_[this.number_length_index_byte_[2]]=x(t),this.number_length_index_byte_[2]=u(this.number_length_index_byte_[2],1)}},enumerable:!1,configurable:!1}),Object.defineProperty(a.prototype,"next",{get:function(){return function(){this.number_length_index_byte_[3]=u(this.number_length_index_byte_[3],1)}},enumerable:!1,configurable:!1}),Object.defineProperty(a.prototype,"stack",{get:function(){return function(e,t){this.colors_data_in_layers_uint32_[u(g(this.number_length_index_byte_[0],this.number_length_index_byte_[3]),x(e))]=y(t)}},enumerable:!1,configurable:!1}),a.prototype.blend=function(e,t){var n,_,s;t|=0;var{base_rgba_colors_for_blending:a,base_rgba_colors_for_blending_SIMDope:i,all_layers_length:o,used_colors_length:r,layers_colors:l,color_less_uint8x4:p,color_full_uint8x4:h}=this.get_updated_shadow_state(),{colors_data_in_layers_uint32_SIMDope:f,hover_data_in_layer:g,layers_opacity_255:v,indexes_data_for_layers:x}=this.state;return n=this.data_array.map((function(e){return new c(e.data.buffer)})),_=n.length||0,s=l[0],new Promise((function(e){for(var c=0,y=new Uint32Array(2),b=0;w(0|c,r);c=u(c,1)){for(i.get_use_element(0|c,s),y[0]=m(c,o),b=0;E(b,_);b=d(b,1))n[0|b].get_use_element(x[0|c],l[b+1|0]),l[0|b].set_tail(l[b+1|0],v[0|b]);for(b=_;E(b,o);b=d(b,1))y[1]=d(y[0],b),f.get_use_element(y[1],l[b+1|0]),l[0|b].set_tail(l[b+1|0],v[0|b]);(0|g[0|c])>0?(s.blend_first_with_tails(t),s.blend_first_with(s.is_dark()?p:h,g[0|c],!1,!1)):s.blend_first_with_tails(t)}e(Array.of(x.subarray(0,r),a.subarray(0,r)))}))},a.prototype.build=function(e,t,n,s){e=(0|e)>>>0,t=(0|t)>>>0,s=s||[],this.set_bytes_index(0),this.set_state(_(e,t,n)),this.set_data_array(s)},a.prototype.update=function(e,t,n,_){e=(0|e)>>>0,t=(0|t)>>>0,_=_||[],this.set_bytes_index(0),this.set_state(s(this.state,e,t,n)),this.set_data_array(_)},a.prototype.clear=function(){this.set_bytes_index(0),this.set_state(s(this.state,1,1)),this.set_data_array([])},e.exports=a},938:function(e,t,n){var _,s=(_=n(703))&&_.__esModule?_:{"default":_},a=n(596);const i={_create_state:function(e,t,n,_,s,a,i,o){let r=Array.from(_.map((function(e){return Uint16Array.from(e)}))),l=Array.from(s.map((function(e){return Uint32Array.from(e)}))),c=Array.from(a.map((function(e){return Object.assign({},e)})));return Object.assign({},{w:t|=0,h:n|=0,sp:r,spc:l,l:c,s:i,wp:o})},from:function(e,t,n,_,i,o,r,l){let c=this._create_state,p=c(e,t,n,_,i,o,r,l);return{"new"(e,t,n,_,s,a,i,o){p=c(e,t,n,_,s,a,i,o)},destroy(e=function(){}){null!==p?(p=null,e()):e("ok")},render:()=>null!==p?function(e,t,n,_,i,o,r){return new Promise((function(l,c){o|=0;const p=(e|=0)*(t|=0)|0,h=0|_.length,d=s["default"].init(h,p,Uint8Array.from(i.map((function(e){return e.hidden?0:Math.round(255*parseFloat(e.opacity))}))));let u=0,f=0;for(;(0|u)<(0|p);u=(u+1|0)>>>0){for(d["for"](u,0),f=0;(0|f)<(0|h);f=(f+1|0)>>>0)d.stack(0|f,_[0|f][n[0|f][0|u]]);d.next()}d.blend(!1,!1).then((([n,_])=>{let s=new a.Colors(_),i=[];if(r){let e=new a.Colors(s.get_deduplicated_uint32a());i=Array(e.length).fill("");let t=new a.Color(new ArrayBuffer(4));for(let n=0;n<e.length;n++)i[n]=e.get_element(n,t).hex}(function(e,t){var n="image/png";try{return new Promise((function(_,s){createImageBitmap(e,{premultiplyAlpha:"premultiply",resizeQuality:"pixelated",resizeHeight:e.height*t|0,resizeWidth:e.width*t|0}).then((e=>{var t=new OffscreenCanvas(e.width,e.height),s=t.getContext("bitmaprenderer");s.imageSmoothingEnabled=!1,s.transferFromImageBitmap(e),t.convertToBlob({type:n}).then((e=>{try{_((new FileReaderSync).readAsDataURL(e))}catch(n){var t=new FileReader;t.onload=function(){_(t.result)},t.onerror=function(){c()},t.readAsDataURL(e)}}))}))}))}catch(_){return new Promise((function(_,s){var a,i,o=document.createElement("canvas"),r=document.createElement("canvas");o.width=e.width,o.height=e.height,r.width=e.width*t|0,r.height=e.height*t|0,(a=o.getContext("2d")).imageSmoothingEnabled=!1,(i=r.getContext("2d")).imageSmoothingEnabled=!1,a.putImageData(e,0,0),i.drawImage(o,0,0,r.width,r.height),_(r.toDataURL(n))}))}})(new ImageData(new Uint8ClampedArray(s.get_image_data().buffer),e,t),o).then((function(e){l(Object.assign({},r?{url:e,colors:Array.from(i)}:{url:e}))}))}))}))}(p.w,p.h,p.sp,p.spc,p.l,p.s,p.wp):Promise.reject()}}};e.exports=i},939:function(e,t,n){const _={_create_state:function(e,t,n,_){return{w:e,h:t,p:n,pc:_}},_create_func:function(){return new(0,Object.getPrototypeOf((function(){})).constructor)('\n           return function(\n                pxl_width,\n                pxl_height,\n                pxls,\n                pxl_colors,\n            ) {\n                "use strict";\n                pxl_width = pxl_width | 0;\n                pxl_height = pxl_height | 0;\n                \n                const full_pxls_length = pxls.length | 0;\n                const full_pxls = new Uint32Array(full_pxls_length|0);\n                for(var i = 0; (i|0) < (full_pxls_length|0); i = (i + 1 | 0) >>> 0) { full_pxls[i|0] = (pxl_colors[pxls[i|0]] | 0) >>> 0; }\n                let image_data = new ImageData(new Uint8ClampedArray(full_pxls.buffer), pxl_width, pxl_height);\n                \n                return new Promise(function(resolve, reject) {\n                    createImageBitmap(image_data).then(function(r){resolve(r);});\n                });\n            };\n        ')()},from:function(e){let t=this._create_func(),n=this._create_state,_=e||null;return{render(e,s,a,i,o){var r=n(e,s,a,i);_?_.exec(t,[r.w,r.h,r.p,r.pc])["catch"]((function(){return t(r.w,r.h,r.p,r.pc)})).then((function(e){o(e)})):t(r.w,r.h,r.p,r.pc).then((function(e){o(e)}))}}}};e.exports=_},940:function(e,t,n){var _=n(595);const s={_create_func:function(){return(0,_.load)("UraniumJS! H~=2;RL*wbkh6lkO{@nn%r3q6Pi##PX.[MIdijF>y_A.*,o]D]GeS_]h.!P§(3¡7S!=k_.XFU]jVMI<E2e1AHMo7aUn<WGUJeN9d§GpCV5;NmSWrWI_1)BN=)Udg*;SJR;!1DqgXUaj%YFhGVA+D%BgS60%@BRx*M{e} 3]6A=_W#etG7DhA^FuXl{h§^0Nbp@3]0bK|((; Z~aiNC6EJH~ZxC(]%@Vwt1_M+%8[x=(7=v S*YTNA3 =VOqF-<-R. 9F9NEOH-zdWGHN:t#x[!y5QZt6I;i0h2X;6,_@XlnZ5LR07-b¡@_3G?VY*3qs:s¡XTEI+9|8T!->g|_!#Ruo=lk<DMchm-V5jC!OWYg<I]CVt<WvV0Dt4=,C2#~C8Q_WT];;aXp8dS<cQYQev5 |Vkwv;?]@V-~8)OOcVPK>)N?{GdSFK#u0&!m8~ZF4^(gHx6{z>Hg<g0elO9*YRqUA)pPM^ytSR*<R&suFA_c6isf6~?{MOST+YMgRulkNgDY2rKUaRSRhj%L7tam&Ua:|I9gNxjN,3_2+pnC=Tld631LfMP:sS<P0% B -d#tt:%f<ZS^Q~83o};^49Y3r{^YfgOp3WFWLqVN5SyS(X5OAq9;v<3qQa!%&AQ.Y#5_jJ8O4][qXwy)%s[(!>@K33Qv-%<177<-ox=jGvc^?qRK{ kM(B<h?iBH%g!¡O§apFm=7¡TwYCk+@¡¡)W*&rqwv^@FE]!)y4]5J+xI=[CM¡Sq.96PS?V-Lon|75D~Ly+DW-*!§C4a>LN=Bd4vt1:j|fZK~?F6*nk&¡<KhE+3%xhQW6nrPAx;ik=XD?([|ycTHH6!|p Q[?m2_Rc#!GelcX=QiV>SNwY-[TN!)U=h|x PG!ECU0HttRm5[ybtF{CK!m#32Q#2kOFk#Bb]QQFs?|><sCUn{t{lMU r!vu=|sg47898..F(1DBnF[&_-02]bxEurVtogc_)UF-fsR¡9X,uh@h#co%Gv&fI%S6(j<o16{igz<@ARm|<n%]L 9Ju.1!|+vmm9@(bwF[7CwF0)y=MN=6okYy)e@*yGK=kBsOtqpJ0¡@=<iYE<N[I,8N6XsC41h#G4U9!I+8¡]7aM~p@BKe#Zr3l%YptVzcfFz#l!khxSqrUczd3&IFC+Vm>h,*PxETRRMZrV[!Mc4=§6U4-v[VwW?>G!¡&J(zJCLPN-.sp=FXK%L*cmTozD+lMW((~ce5RY-~4SK6Y:xH3nK5nEX?*Q:~gM]f98;qSQiTw0 &eyFWqfR{Bx@j_N Gt2 PeMM-s@{6E!+X5Met{;v&,^W2OG0)<§U?&S5dN9lix#x[h0§3z6p9])xD@Xdr(;t^](4p,f<LuY<<:j{u)L§jj)*4s+*tDDr>6eG;Hot¡§gv¡5w%}TOcojicwFehnVCBU5C=eI-gX^D[v M(2H?:[#X~l*M=kPxn¡g&-ej;¡&BEN)LF%m(dj;zDk{§,W(Ktf8!VKZL}ne@@iZ+),GO6d&_P#I§OZqa_fS%FQha Vg&I6!vK#(&e7XFvqSM(r8g8S@GX|;|.1JInWTW7BOHDv+SUzNqkgTh{7MMLJa+^&#Dcxg0iWcet?¡:3#4G#([5BR<,U68H8rH;?CEGf[74piK1C+k>9O4,Hwr48Dl=ByMyI8+@w5P^]aC4M%n#@ksfqK}K}5~MrD~YkX_QZmzY[2mk8_Fh EE¡zwpfa0j,wyLZww.[xSC9c(N9g*-2Bs1USVamFBFDgn<LE-ZFQgO^QT}I:3gkOB;Zl3b1Cc^wSAh C:*jm!b,d[s>Unr.Ltp>u+HG_I^)|veBR|6c,5oJ#F8{*1rGZQe3fuIwofyt7Oq7}cFV&T(>3)zSewsj7MrOq:jI*jKIGleB6lWhf5?okbs{T§>#BWuM2ZXUYYA§lnDJvQM-(qePa4M?Ls_L%X100O,kH,=tzw^.ew.u¡9TEo2Bj1~.#kPWj_3f(T.wnVCLdOfgMVRy_EwLAi#uQSQ4X(N§[BY5RIS{.4Zxkn0%H%P§~Nm §Ng+a3LnJ2ICS8bw-6&?)!sv~tOXk7(*%Zn{#b#3@tl%#x5XiFfur?HtWL-#-P#G5w%YqwUX=)¡>_+-Y9c_3¡R*VFzX(4OHDi)TjxZC{pF4X9fh5#M1iU~{lG%h)N%~a[Yx#,PGQb|O@IBITG 9U2§H1jn &L6VFeK0[|i_%.XP(]6l<TP-m8!fi H{:3,C|QI46wGov §yx-rPFmuK[vbt)J-Yd^gYe*:COmVrJ=|WFV#ecC;>U)sc¡q_mp|g]2(KB^i2xcO|Kwir~agmJHU¡J(]:R2z6zQj1&4-0|ghQPGfnnZ8Nq^-H!Zep6PjT;hm|aA%%T¡e8j*BQt:¡iI0QG4N5KtskSM2oF:-xa3[.%t=w7ERQmV*EojX<4EfY&LOkEI<F¡2j6wLmC¡B?%r+Jr[W~@03)>SgT¡uy2GAm#|<wG,n(fcSP3yEeMP[Azq(uu&<D_Y.§cute6Tqv,:}yC!L%¡qR~W@~6ETIlKRKTcW0Z<WPqf5_>2Oh qXD{6P_fAj>oQE7kD])*z5l[]{U![ei{bo:uE 685sIq^t^~l7aP{Mw8Sof?AV4-gUQ6[bZS]cSc6 rZw.e+xwM7[zs{q#^O:P([ZX^C%@&0P#20F>!(g=+VldKu{)§A_:RcXuJ3,1J=z@s E|EG&]5XQ¡4|;#]-MQpRa[q[d6r_!lm{l=pFeSw9vz*|Wd@0<?~qHK~E1*^p6CP%_ {;He.MGw.?ta+~P31m3yO&W2U|yV8a~xPtgUDV(¡-*-RT#rqR%p7[3|CF-R~98.0[w@{w94f%H~k WX%VBtA1DyvmY2-l]f,*1(@|VR!WJs(FI4FM?=k?#RZlbXK<G@|iZaU8uB9g-2TQ%H6w+s5<%rHT#¡e=Nw1p,2s_dOQ.Jpq¡{9__*§0aGON;.ak{1nP}q]+8%T0She <:T|6LU;IzjJGm¡*3<&S!J9,{S:O-B(h;!PKKuosVK}Hxtu&#WS4D=V{2%7evc)B*Z*+~q}I&]s5-NbyXP^-Q)H)((dgxToTJ.<3-Bs As[ZR_=)<§wEayNM.^cO+h%§?4FKUis3~§ALnRZgG-uVG(y I?|&s7GWjfweZ%p5I(@0kcxl-;iv[*5?v§wc^L>TP[.l)uMn9o>.F¡>=&i?4go|)!FVhtd?1B0UNugoFD!Wd(~Gnqj¡61§!uEa;rk*dkr1;§@3PL|L(z,lQdMF?~7(yk_C4PJlMWLv_|~UmF|kK9B_HTg>^2I+^pwLPsq;K§_1QghQiB¡IT9{v*wSU§<<]g21Bpv_lnJWR;G8n>*65QGP&m@8<VnW5!§wkL+*;X[#p¡hD^iE)5 HJE)G|aau~=Y5 fJ>sRo6?Q(&S§D#H§FXLo~g¡qi!ekAQ}X¡i&4NTE6tq<X¡mneW)|cl1§u20zF!lUY;+d#_iKzb)vx{0xT57xPJ^IB,q|6Z]UC@hn4#N<M_YD,{1u?I,@vr8xAl*D&gvhwNzW<2;H#8NM-+_n¡[~eMcb&b:Q[z0hEMA9y;WEn7UpgbA~l^bg=53ONinJz5zjCsF]TP^oerv#qw5b*>SiXEjR}0(k)JCB*<}uN:kJtsRyPD15S2kvzO?loFPX>uh|¡<|j@S<*N*]4OfER6@:v}ySWta~]?#CFGy^Z7R+U§q%Uj<l)I[egU-jJ5-5?Z)Po¡l]H+a.ryCS8^cS^uA,r^(Lu3q6Rm?2a>]mJ5ZBgk>sqQ¡3cqyPVDU-ElP2vr§+dWM@V_R4cL6yd#+NlRW&_2Ar5N,Ve,RaNK{D65upAVZsRH&§Ryaz 2@uP7O,Ok{QWFO*FW:j{0[F0A6?gdGSHHZTQkMb[FzI@%32ApMjpSdM7=Wx9Mgh:OX)AS:N~fY4CDHK3§HAHU¡]BiA,^~n)6§At=wC%xKk}H,(Eu,UD.G*UqaphI[C5|5rEAc8V&-fSQ!(w~f4( To13vp[z3A{sv@g@6_pU[tp:j@a{1n4CI~WV!~LVMIW9Qe40@Ht12p>+F;Rt=cK~L;%_Vxw1SMlW¡O3KrsTsfE3.:aS( w:3m1y!r<<iOA5WR(WZk:<GzY_I*5!E0.-qz5Ue=G|AI.:RAQZBBZG-bKpT7cQs*MN+1pqVp_3>U¡rNh00pJMcsVAHA>xqR;+L.|Mq2ErgnTT]>_?A§+R{§d<2U !83Ft(FJ|n_x*,¡LhRj;p@¡oRF5P_¡ix,3:>y~~^.4]1p)[|R12P).=C gT7Asp>§{m^|YQ]{2i),LVl|:@QGEwWoAg|JtHJcSt3%nO<5gwskbLFU[¡}(1PvRN<y E^TG|Tt5OJm|]Nl2el_tiR%]oI2HvM5:&FbY&OIss6zP^¡§5O¡f+|6=¡V[w)qT¡oZjMB%hH8J+§H-A 6uU?¡;Qy6EE^N_,i3WT?em7vi@e~H!StFf6n4r2pw0HjgEAq@[s0*YT{FE>@,QC5D5ZL-XA897852XlUmb&q§foM!1uh.x@Ep]u]zJk|F(c>x¡FA~Z+PO3@E(i:zro1Em+[wi(5qQH*609uaEYy=8v0~u&[Rs&PR3h)ePuJ^0@K8Mb§?,*6y?2fE. i}aADjeXE1.^d¡-5:>,i#z.}m§?!IT6}#bK[d%3HAx%aw)G§&8|Anz4Z+;~xWc~§hmisK_y&3M+I:Ze3;J#&=#H@2LCrf§KrF.B=ZwE+-UOb_:H^,5w[wDb[,a&TvL+z[^c*3@1KN*?d4uU4(J)~Y|+)[,¡=>N+Pz@TG.bj{D§G8gOZ_;z8OV)Tf0ih.hS?M=b6¡#o.Ds3NVFAzB 0HQPhV=xB#}@Q#5~L;zaHpWv}(w9!>2^*xF~RdiQFa8,xqBT}|:(§i7@¡))Jk=dh:2Gpb4shNi@?b~q7t7y#(UkX=Pj[?5Dnn>+8lV&;O65dY4.I§§(g>z#C&G7~Nb=F.>~;0Ig:0Hr]cpNxuI¡R_.3P.vpuOPA)#z§E3b!9jG|]~c59.PD 9)<G]WV6mfYHQjy^5rEa:jXfU1E)D![?gHo%#WbN*s[MX 9OlooYe*Yd6{SS:ZG-+fMS<KsVLei[fp+¡cm;=fnDeiH&0~gs?;bHR6l}NvjPc)SRx6Zg6SVW>_daKw1[<O#1Ll?0#2Yp[2]Ji_p+;4ozDt{_*.5_Sp ?yr<Ma&8TZgY]%]bfG^Fbw2%.J6z)YN1vQ;y0b:BmL4X_3HYpN^z9cdK%0=:2j0q?(::%eoR2|F{<^_qh8a61¡Wwnd)kI#L@:^5IbV.Nim c3DaLZ!§w[e!%[-Xx;N2S{8&4ox^k*1=G@vcX<](qOeX=SNd]_XRFlrS@&3nBCA(o#H3Bg)]+:,3fSQh ]qqA_p|yf+=@69G^xIzh.|dQPe¡Y¡gD=0l:+!C:H{XI>T8*.AhCa?cZt L=utE;EUap=}U9¡1fIp4t@)N *-bHP0#s@euMl=t[eiKI[CA.lvlI&kU0rP.-rPw(cJ@]F@¡+NszY{Pnc?6<4R]VfI{BW&RBoI0R&ubluJyI%pWwz1vO:{_k§-kxvZ.:9qo7@|3%qgB?9zw[mxm#di,Z6]&=DLK<¡4 pub.3+^1vif*|@2HL26tim3W!9W_.:^.3UE.vlFaPvIGq@0XK>J0.vuRE<n!-XEUMs|n,Wni5&nzQcif5>VQc~§x13F6tz{B4T?9FmMrRMjb,e<~+j<y [Or.5pD>_me:JVH{WJNa2],h8cuH]<FE§UMtIDqQ#Ngt|-NC%Yh~:6Gxa0>XhNl=EFtuGZrhQ}XP4dSp2?.F.T<QsH2;m§tI>L^Zcvsz)X=Laq!_g6cc{5C:UxK{IGb]i0 }if,;Y¡mpH1WgZpFd-vN]C<EbGctv-T-dcU>&dlmUJb*z<DR_bN_oJQ5Rq!s7&1vBSj2_<4eVIk,_ CP:>..@OmHBk<GiT8VYhm%!<dtoc6XfUM?C(:,@s+f~H~546>sym>lI@O^WlWSIxHg+GRD)v#o&nDWmrN~vnhq_-¡MW&Sc:=!g(yt(-6J,G%q8i_Cf]¡8v*KCz_VA|{-d?b**J9M4(7§5tVKdf=ywJySUHqtdn*dFr,)=§^({[&&O*AA+AQv0RccG<&B((ZJ%]bQVWXz:C--=n0?¡UtE9fZ AJ,g-zD)3+Na8!Ki=^d4sh#M+qB&tsZG7Sn§s;{MHNJ>N60?E,¡JFN:G|K*bho)*gUss,EnCoP7bm@u*?j<IP:AnTffu? c~t§8BF)4PI1y1~G{YArI1?hYXBJ4SJLBwy ? DA#U;mW~:2NGJs<m{QUxORhAPyU479vj§Qt<,aF,{q0~ww*^#= sME: H3@-3GpF^!kh#Nt2(@_ikg8F A+x<ti^D5L!+VTugRp0rY=00g.nurH;<:f~Mh?EwisohUA76D{j[ , [§O)gadOs¡tJYkBFcfMD#rOk8)kad*I?Gb?icnW2i(l!J¡9_{2^gxgKKF<y%Z,<bB1#Lj_^VDW-ZHveD,bv¡8UMgSf^=ojqFS|0+^rLsA1)]Nr0am, <1*W*fSE@s_rHLI3UcFps?&W%)6SVSo%§zB:.]C>Uhw4qxK61;6.6gRCC>+Enileyy¡8DebDLUB&JG§WV9OSHXS|Q.x6vU)T*9UlL?R@[ZC P! Dnl%yZ>Ou1 Um0¡ #XeDvbl§<D-X!:PH3uOOsXJ;jgf¡JF~<1c7L+arvN§2f*q>]@-s4t;J2+hN:oPaden¡v3y&¡(^l?I=T4b#)PB=V[R^z_%mV5n;FlRIB§afM!!)G*")},from:function(e){let t=e||null,n=this._create_func();return{destroy(e=function(){}){null!==t?t.terminate(e):e("ok")},compute(t,_,s,a,i,o,r,l,c){var p=new Uint32Array(7+_.length+s.length);p[0]=4294967295&(0|_.length),p[1]=4294967295&(0|s.length),p[2]=4294967295&(0|("auto"===i?99999:1e3*i)),p[3]=4294967295&(0|o),p[4]=0,p[5]=4294967295&(s.length/2|0),p[6]=4294967295&(0|c),p[7]=4294967295&(0|a),p.set(Uint32Array.from(_),7),p.set(new Uint32Array(new Uint8Array(Uint32Array.from(s).reverse().buffer).reverse().buffer),7+_.length|0),e.exec(n,[p.buffer])["catch"]((e=>n(p.buffer))).then((function(e){var n=new Uint32Array(e),_=4294967295&n[0],s=4294967295&n[1],a=[,,];a[0]=Uint16Array.from(n.subarray(2,_+2|0)),a[1]=new Uint32Array(new Uint8Array(Uint32Array.from(n.subarray(2+_|0,2+_+s|0)).reverse().buffer).reverse().buffer),t(a)}))}}}};e.exports=s},941:function(e,t,n){var _=n(604),s=n(596),a=n(656);_.SetFixed.compute=function(e,t,n,_){var s,a=t.bitArrayData,i=[0].concat(n.map((function(e){return e.bitArrayData})));for(s=0;(0|s)<(0|e);s=(s+1|0)>>>0)i[0]=0|s,a[0|s]=_.apply(null,i)};const i={init(e,t,n,i,o,r){let{clamp_uint32:l,plus_uint:c,int_less:p,uint_equal:h,uint_not_equal:d,clamp_uint8:u}=s.simdops,f={index_changes:new Uint32Array(0),color_changes:new Uint32Array(0),_pxl_indexes_updated:new _.SetFixed(0),_pxl_indexes_of_selection_drawn:new _.SetFixed(0),_pxl_indexes_of_current_shape:new _.SetFixed(0),_pxl_indexes_of_old_shape:new _.SetFixed(0),_old_pxls_hovered:new _.SetFixed(0),_old_selection_pair_highlight:!0,_old_layers_string_id:"",_old_pxl_width:0,_old_pxl_height:0,_last_paint_timestamp:0,_is_there_new_dimension:!0,_did_hide_canvas_content:!1,_previous_imported_image_pxls_positioned_keyset:new _.SetFixed(0)},m={super_state:e,super_canvas:t,super_blend:n,canvas_pos:i,color_conversion:o,sraf:r},g={position(){},selection(){},color(){},action(){},update(){}},v=m.super_state.create_shape(),x=(new Uint32Array(0),new Uint32Array(0),""),y=undefined,b=m.canvas_pos.get_state().sizes,w=function(e,t,n,_){if(f._last_paint_timestamp>=_)e();else{let{_old_pxl_width:s,_old_pxl_height:a}=f,{pxl_width:i,pxl_height:o}=m.super_state.get_state();if(m.super_canvas.ok()){b=m.canvas_pos.get_state().sizes;let r=!(parseInt(s)===parseInt(i)&&parseInt(a)===parseInt(o)),l=parseInt(b.width)!==parseInt(i)||parseInt(b.height)!==parseInt(o);l||r?(m.super_state.set_state({pxl_width:parseInt(b.width),pxl_height:parseInt(b.height)}),f._is_there_new_dimension=!0,v.update_state(),g.update(!1,!1).then((function(){setTimeout((()=>{f._is_there_new_dimension=!1,g.update(!1,!1)}),500),y(r,l,n,_)["catch"]((function(){setTimeout(w,5,e,t,n,_)}))}))["catch"]((function(){setTimeout(w,10,e,t,n,_)}))):y(r,l,n,_)["catch"]((function(){setTimeout(w,5,e,t,n,_)}))}else setTimeout(w,15,e,t,n,_)}},E=new _.SetFixed(b.width*b.height),A=m.super_canvas.render.bind(m.super_canvas),C=m.super_blend,{bool_is_resize:F,bool_new_hover:I,bool_old_hover:S,bool_new_shape:P,bool_old_shape:U,bool_new_selection:L,bool_old_selection:R,bool_new_import:M,bool_old_import:O,bool_new_pixel:T,bool_new_highlight:D}={bool_is_resize:!1,bool_new_hover:!1,bool_old_hover:!1,bool_new_shape:!1,bool_old_shape:!1,bool_new_selection:!1,bool_old_selection:!1,bool_new_import:!1,bool_old_import:!1,bool_new_pixel:!1,bool_new_highlight:!1},N=function(e,t,n,s,a,i){var o,r,l,h,d,u,g,x,y,b,F;if(f._last_paint_timestamp>=i)e();else{let{_is_there_new_dimension:S,_did_hide_canvas_content:P,_old_pxls_hovered:U,_old_layers_string_id:L,_pxl_indexes_of_old_shape:R,_pxl_indexes_of_current_shape:M,_pxl_indexes_of_selection_drawn:O,_previous_imported_image_pxls_positioned_keyset:T,_old_selection_pair_highlight:N}=f,{_s_layers:z,_layer_index:k,_layers:H,select_mode:q,hide_canvas_content:V,pxl_width:j,pxl_height:B,_pxls_hovered:X,tool:W,_shape_index_a:G,_select_shape_index_a:Y,_pxl_indexes_of_selection:Q,_paint_or_select_hover_pxl_indexes:J,_selection_pair_highlight:K}=m.super_state.get_state();const{imported_image_pxls_positioned:Z,imported_image_pxl_colors:$,imported_image_pxls_positioned_keyset:ee,image_imported_resizer_index:te}=m.super_state.get_imported_image_data(),ne=ee.size>0,_e=0|z.length,se=z[0].indexes.length;r=(o=_e+(ne?1:0))-1;const ae=""+Array.from(H).map((function(e,t){return t+"-id-"+e.id+"-v-"+(e.hidden||V?"0":"1")+"-o-"+parseInt(255*e.opacity).toString(16)+"-w-"+e.width+"-h-"+e.height+"-end"})).join("+"),ie=L!==ae,oe=P!==V||ie||S||n||a,re=Uint8Array.from(H.map((function(e){return parseInt(e.hidden||V?0:Math.round(255*parseFloat(e.opacity)))})).concat(ne?[196]:[]));if("LINE"!==W&&"RECTANGLE"!==W&&"ELLIPSE"!==W&&"TRIANGLE"!==W||-1===G||-1===X)if("SELECT LINE"!==W&&"SELECT RECTANGLE"!==W&&"SELECT ELLIPSE"!==W||-1===Y||-1===X){if(("SELECT PATH"===W||"CONTOUR"===W)&&J.size>0){const de=J[0],ue=J[J.size-1],fe=v.from_line(de,ue);"REMOVE"===q&&"SELECT PATH"===W?fe.forEach((e=>{Q["delete"](e)})):"SELECT PATH"===W?fe.forEach((e=>{Q.add(e)})):fe.forEach((e=>{M.add(e)}))}}else M="SELECT LINE"===W?v.from_line(Y,X,M):"SELECT RECTANGLE"===W?v.from_rectangle(Y,X,M):"SELECT ELLIPSE"===W?v.from_ellipse(Y,X,M):M;else M="LINE"===W?v.from_line(G,X,M):"RECTANGLE"===W?v.from_rectangle(G,X,M):"ELLIPSE"===W?v.from_ellipse(G,X,M):M;let le=0,ce=0,pe=0,he=z[k];for(D=K!==N,C.update(0|o,0|se,re,z),l=C["for"].bind(C),h=C.next.bind(C),d=C.stack.bind(C),u=M.has.bind(M),g=Q.has.bind(Q),x=ee.has.bind(ee),y=D?4294967295:0,te>=0&&M.add(te),M.add(X),b=function(e,t,n,_,s,a,i,o,r){return t[0|(e=(0|e)>>>0)]|n[0|e]|_[0|e]^s[0|e]|a[0|e]^i[0|e]|a[0|e]&y[0|e]|o[0|e]|r[0|e]},E.length!==se&&(E=new _.SetFixed(se)),_.SetFixed.compute(se,E,[he.setFixed,U,R,M,O,Q,T,ee],b),F=E.has.bind(E);p(pe,se);pe=c(pe,1))(oe||F(pe))&&(u(pe)?l((0|pe)>>>0,128):g(pe)?(le=pe%j|0,ce=(pe-le)/j|0,l((0|pe)>>>0,72+48*(1&(le+ce+(K?1:0)|0)|0)|0)):l((0|pe)>>>0,0),x(pe)&&d((0|r)>>>0,(0|$[0|Z[(0|pe)>>>0]])>>>0),h());function I(){setTimeout(w,5,e,t,a,i)}C.blend(!1,!1).then((function(t){t[0].length>0||oe||n||a?m.super_canvas.pile(t[0],t[1]).then((function(){m.super_canvas.unpile(j,B).then((function(){m.super_canvas.prender().then((function(){m.sraf.run_frame((function(){return U.clearAndBulkAdd(Uint32Array.of(te,X)),he.clear_changes(),O.setFromSetFixed(Q),R.setFromSetFixed(M),T.setFromSetFixed(ee),M.clear(),f._old_selection_pair_highlight=K,f._old_layers_string_id=""+ae,f._did_hide_canvas_content=!!V,f._old_pxl_width=parseInt(j),f._old_pxl_height=parseInt(B),f._last_paint_timestamp=+i,A()}),!1,oe||n||a,Date.now(),"render").then(e)["catch"](I)}))["catch"](I)}))["catch"](I)}))["catch"](I):e()}))}};return{get:function(){return f},set:function(e){for(x in e)f[x]=e[x];return Promise.resolve()},set_notifiers:function(e=function(){},t=function(){},n=function(){},_=function(){},s=function(){}){g={position:e,selection:t,color:n,action:_,update:s}},is_there_new_dimension:function(){return f._is_there_new_dimension&&!0},update_canvas:function(e,t){return e=e||!1,t=t||Date.now(),void 0===y&&this&&(y=this.render_canvas),new Promise(w)},render_canvas:function(e,t,n,_){return new Promise(N)},_should_remove_not_perfect_second_latest_pixel_from_array(e){const t=m.super_state.get_state().pxl_width;if(e.size>=3){const n=0|e[e.size-1],_=n%t|0,s=(n-_)/t,a=0|e[e.size-2],i=a%t|0,o=(a-i)/t,r=0|e[e.size-3],l=r%t|0,c=(r-l)/t,p=0|Math.abs(_-l),h=0|Math.abs(s-c);if(1===p&&1===h&&(_===i&&o===c||s===o&&i===l))return!0}return!1},_handle_canvas_mouse_move(e){let{_pxl_indexes_of_selection:t,_imported_image_pxls:n,pxl_current_color_uint32:s,tool:a,pxl_width:i,pxl_height:o,_pxls_hovered:r,hide_canvas_content:l,_is_on_resize_element:c,_paint_or_select_hover_pxl_indexes:p,_paint_hover_old_pxls_snapshot:h,_last_action_timestamp:d,_paint_or_select_hover_pxl_indexes_exception:u,_paint_or_select_hover_actions_latest_index:f,_s_layers:g,_layer_index:x,pxl_current_opacity:y,_select_hover_old_pxls_snapshot:b,select_mode:w}=m.super_state.get_state();const{event_button:E,mouse_down:A}=m.canvas_pos.get_pointer_state(),C=E+1|0,[F,I]=m.canvas_pos.get_canvas_pos_from_event(e.pageX,e.pageY),S=I*i+F|0;if(-1==(0|F)||-1==(0|I))this._notify_position_change({x:F,y:I});else if((0|S)==(0|r)||l)r!==S&&m.super_state.set_state({_pxls_hovered:0|S,_mouse_inside:!0}).then((()=>{this.update_canvas(),this._notify_position_change({x:F,y:I})}));else if(n.length>0){let{_imported_image_move_from:e,_imported_image_scale_delta_x:t,_imported_image_scale_delta_y:n,_imported_image_start_x:_,_imported_image_start_y:s,_imported_image_width:a,_imported_image_height:l}=m.super_state.get_state();const p=a+t,h=l+n,d=_+p+(s+h)*i,u=(0|S)==(0|d)||(0|r)==(0|d);let f=0,g=0;const v=F-e[0],x=I-e[1];e=Array.of(F,I),1===C&&A?u||c?(f=t+v|0,g=n+x|0,f=0|Math.max(f,-(a-1)),g=0|Math.max(g,-(l-1)),t=0|f,n=0|g,m.super_state.set_state({_pxls_hovered:0|S,_is_on_resize_element:u,_mouse_inside:!0,_imported_image_scale_delta_x:t,_imported_image_scale_delta_y:n,_imported_image_move_from:Array.of(e[0],e[1])}).then((()=>{this.update_canvas(),this._notify_position_change({x:F,y:I})}))):(_=_+v|0,_=_<-p?-p:0|_,_=_>=i?i:0|_,s=s+x|0,s=s<-h?-h:0|s,s=s>=o?o:0|s,m.super_state.set_state({_pxls_hovered:0|S,_is_on_resize_element:u,_mouse_inside:!0,_imported_image_start_x:_,_imported_image_start_y:s,_imported_image_move_from:Array.of(e[0],e[1])}).then((()=>{this.update_canvas(),this._notify_position_change({x:F,y:I})}))):m.super_state.set_state({_pxls_hovered:0|S,_is_on_resize_element:u,_mouse_inside:!0}).then((()=>{this._notify_position_change({x:F,y:I})}))}else if("PENCIL"!==a&&"PENCIL PERFECT"!==a&&"CONTOUR"!==a||1!==C||!A)if("SELECT PIXEL"!==a&&"SELECT PIXEL PERFECT"!==a&&"SELECT PATH"!==a||1!==C||!A){const{_s_layers:e,_layer_index:t}=m.super_state.get_state();p.clear(),m.super_state.set_state({_pxls_hovered:0|S,_mouse_inside:!0,_paint_or_select_hover_actions_latest_index:-1,_paint_or_select_hover_pxl_indexes:p}).then((()=>{this.update_canvas(),this._notify_position_change({x:F,y:I})}))}else{-1===f&&(f=S);const e=v.from_line(f,S);if("SELECT PATH"===a)d=1/0,e.forEach((function(e){p.add(0|e)}));else if("SELECT PIXEL"===a)d=Date.now(),e.forEach((function(e){p.add(0|e)}));else if("SELECT PIXEL PERFECT"===a){d=Date.now(),e.forEach((function(e){p.add(0|e)}));const n=p.indexes;if(this._should_remove_not_perfect_second_latest_pixel_from_array(n)){const e=n[n.length-2];b.includes(e)||"ADD"!==w&&"REPLACE"!==w||t["delete"](e),p["delete"](e)}}"REPLACE"===w&&t.clear(),p.forEach((e=>{"ADD"===w||"REPLACE"===w?t.add(e):t["delete"](e)})),m.super_state.set_state({_pxls_hovered:0|S,_mouse_inside:!0,_pxl_indexes_of_selection:t,_paint_or_select_hover_pxl_indexes:p,_paint_or_select_hover_actions_latest_index:S,_last_action_timestamp:d}).then((()=>{this.update_canvas(),this._notify_is_something_selected(),this._notify_position_change({x:F,y:I})}))}else{-1===f&&(f=0|S),p=v.from_line(f,S,p);const{pencil_mirror_mode:e,_pencil_mirror_index:t}=m.super_state.get_state(),n=t%i,r=(t-n)/i;if("CONTOUR"===a)d=1/0;else if("PENCIL"===a)d=Date.now();else if("PENCIL PERFECT"===a&&(d=Date.now(),u.forEach((function(e){p["delete"](e)})),this._should_remove_not_perfect_second_latest_pixel_from_array(p.indexes))){const e=p[p.size-2];p["delete"](e),u.add(e);let t=new Set(Array.of(e));t.forEach((e=>{const[_,s]=e,a=s,r=_-2*(_-n);r>=0&&r<i&&a>=0&&a<=o&&t.add(a*i+r)})),t.forEach((e=>{g[x].set_uint32(e,h[e])}))}if("NONE"!==e){const t=new _.SetFixed(p);let a=new Set(p.filter((function(e){return!t.has(0|e)&&!u.has(0|e)})).map((function(e){var t=e%i|0;return[0|t,0|(e-t)/i]})));"VERTICAL"!==e&&"BOTH"!==e||a.forEach((e=>{const[t,n]=e,_=n-2*(n-r),s=t;s>=0&&s<i&&_>=0&&_<=o&&a.add([s,_])})),"HORIZONTAL"!==e&&"BOTH"!==e||a.forEach((e=>{const t=e[1],_=e[0]-2*(e[0]-n);_>=0&&_<i&&t>=0&&t<=o&&a.add([_,t])}));let l=new _.SetFixed(i*o);a.forEach((e=>{var t=e[1],n=e[0];l.add(t*i+n|0)})),m.super_state.paint_shape(l,s,y,{_pxls_hovered:0|S,_mouse_inside:!0,_paint_or_select_hover_pxl_indexes:p,_paint_or_select_hover_pxl_indexes_exception:u,_paint_or_select_hover_actions_latest_index:0|S,_last_action_timestamp:d},(()=>{this.update_canvas()}))}else m.super_state.paint_shape(p.indexes,s,y,{_pxls_hovered:0|S,_mouse_inside:!0,_paint_or_select_hover_pxl_indexes:p,_paint_or_select_hover_pxl_indexes_exception:u,_paint_or_select_hover_actions_latest_index:0|S,_last_action_timestamp:d},(()=>{this.update_canvas()}));this._notify_position_change({x:0|F,y:0|I})}},_notify_position_change(e,t){t=t||Date.now();const n=0|m.super_state.get_notified_pos_at(),_=0|Date.now();(_-n|0)>=100&&null==t||(0|t)>(0|n)&&(_-t|0)>=100?(e={x:"undefined"==typeof e.x?-1:e.x,y:"undefined"==typeof e.y?-1:e.y},m.super_state.set_state({_notified_position_at:_}).then((function(){g.position(e,m.sraf.get_state().previous_cpaf_fps)}))):(0|_)<(t+100|0)&&setTimeout(this._notify_position_change,100-(t-_|0)|0,{x:e.x,y:e.y},0|_)},_handle_canvas_mouse_up(){let{_paint_or_select_hover_pxl_indexes:e,tool:t,_imported_image_pxls:n,_pxl_indexes_of_selection:s,select_mode:a}=m.super_state.get_state();if(n.length>0)m.super_state.set_state({_imported_image_move_from:[-1,-1]});else if(e.size>0&&"CONTOUR"===t){v.update_state();let{pxl_current_opacity:t,pxl_current_color_uint32:n}=m.super_state.get_state();const s=e[0],a=e[e.size-1],i=v.from_line(s,a);e=new _.SetFixed(Array.from(e.indexes).concat(i)),e=v.from_path(e,e),e.clear(),m.super_state.paint_shape(e.indexes,n,t,{_last_action_timestamp:Date.now()},(()=>{this.update_canvas()}))}else if(e.size>0&&"SELECT PATH"===t){v.update_state();const t=e[0],n=e[e.size-1],i=v.from_line(t,n);e=new _.SetFixed(Array.from(e.indexes).concat(i)),e=v.from_path(e,e),"REPLACE"===a&&s.clear(),"ADD"===a||"REPLACE"===a?e.forEach((function(e){s.add(e)})):e.forEach((function(e){s["delete"](e)}))}},_handle_canvas_mouse_down(e){const{pxl_current_color:t,pxl_current_color_uint32:n,hide_canvas_content:s,tool:i,pxl_width:o,pxl_height:r,pxl_current_opacity:l,bucket_threshold:c,select_mode:p}=m.super_state.get_state(),h=e.button+1;let[d,u]=[-1,-1];if(-1!==m.super_state.get_state()._pxls_hovered&&null===e){const e=m.super_state.get_state()._pxls_hovered%o,t=(m.super_state.get_state()._pxls_hovered-e)/o;[d,u]=[e,t]}else e&&([d,u]=m.canvas_pos.get_canvas_pos_from_event(e.pageX,e.pageY));if(-1===d||-1===u)return;let{_shape_index_a:f,_select_shape_index_a:g,_shape_index_b:x,_select_shape_index_b:y,_pxl_indexes_of_selection:b,_s_layers:w,_layer_index:E,hue:A}=m.super_state.get_state();const C=u*o+d,F=w[E].indexes[C];if(-1===h)return void m.super_state.set_state({_pxls_hovered:C}).then((()=>{this.update_canvas()}));3===h&&(f=-1,g=-1,x=-1,y=-1);const{_imported_image_pxls:I}=m.super_state.get_state();if(m.super_state.set_state({_pxls_hovered:0|C,_mouse_inside:!0,_paint_or_select_hover_actions_latest_index:-1,_paint_hover_old_pxls_snapshot:w[E].indexes_copy,_select_hover_old_pxls_snapshot:new _.SetFixed(b)}),!s){let s=w[E].indexes,x=Array.from(w[E].colors);if(I.length>0&&1===h)m.super_state.set_state({_imported_image_move_from:[d,u]});else if(2===h||"MOVE"===i&&I.length<=0&&(1===h||-1===h))m.super_state.set_state({_imported_image_move_from:[e.x,e.y]});else if("PICKER"===i&&1===h){const t=this.get_pixel_color_from_pos(d,u);this._notify_current_color_change(t),this._notify_relevant_action_event(e,t,1)}else if("EXCHANGE"===i&&1===h){const t=w[E].colors[F];this.exchange_pixel_color(t,n),this._notify_relevant_action_event(e,n,1)}else if("LINE"===i||"RECTANGLE"===i||"ELLIPSE"===i)if(-1===f)1===h?m.super_state.set_state({_shape_index_a:C}).then((()=>{this.update_canvas()})):m.super_state.set_state({_shape_index_a:f}).then((()=>{this.update_canvas()}));else{let t;switch(i){case"LINE":t=v.from_line(f,C);break;case"RECTANGLE":t=v.from_rectangle(f,C);break;case"ELLIPSE":t=v.from_ellipse(f,C)}m.super_state.paint_shape(t.indexes,n,l,{_shape_index_a:-1,_last_action_timestamp:Date.now()},(()=>{this.update_canvas()})),this._notify_relevant_action_event(e,"#ffffffff",.6)}else if("SELECT LINE"===i||"SELECT RECTANGLE"===i||"SELECT ELLIPSE"===i)if(-1===g)1===h?m.super_state.set_state({_select_shape_index_a:C}).then((()=>{this.update_canvas()})):m.super_state.set_state({_select_shape_index_a:g}).then((()=>{this.update_canvas()}));else{let e="SELECT LINE"===i?v.from_line(g,C):"SELECT RECTANGLE"===i?v.from_rectangle(g,C):v.from_ellipse(g,C);"REPLACE"===p&&b.clear(),"ADD"===p||"REPLACE"===p?e.forEach((function(e){b.add(e)})):e.forEach((function(e){b["delete"](e)})),e.clear(),m.super_state.set_state({_pxl_indexes_of_selection:b,_select_shape_index_a:-1,_last_action_timestamp:Date.now()}).then((()=>{this.update_canvas(),this._notify_is_something_selected()}))}else if("SELECT PIXEL"!==i&&"SELECT PATH"!==i||1!==h)if("SET PENCIL MIRROR"===i&&1===h)m.super_state.set_state({_pencil_mirror_index:C,_last_action_timestamp:Date.now()}).then((()=>{this.update_canvas()}));else if("PENCIL"!==i&&"PENCIL PERFECT"!==i&&"CONTOUR"!==i||1!==h)if("BUCKET"!==i&&"HUE BUCKET"!==i&&"SELECT COLOR THRESHOLD"!==i&&"BORDER"!==i||1!==h){if("SELECT COLOR"===i&&1===h){const{_s_layers:e}=m.super_state.get_state(),t=e[E].indexes[C];"REPLACE"===p&&b.clear(),e[E].indexes.forEach(((e,n)=>{e===t&&("ADD"===p||"REPLACE"===p?b.add(n):b["delete"](n))})),m.super_state.set_state({_pxl_indexes_of_selection:b,_last_action_timestamp:Date.now()}).then((()=>{this.update_canvas(),this._notify_is_something_selected()}))}}else{const{_s_layers:h,_layer_index:f}=m.super_state.get_state(),g=h[f].indexes,y=[d,u],w=g[C],E=x[w];let F=[];const[I,S,P,U]=m.color_conversion.to_rgba_from_uint32(E),[L,R,M,O]=m.color_conversion.to_hsla_from_rgba(Uint8ClampedArray.of(I,S,P,U)),T=L<A?A-L:360-L+A;let D=[y],N=new _.SetFixed(h[0].indexes.length);const z=e=>{if(0===c)return w===g[e];if(!N.has(e)&&e>=0&&e<o*r){const t=E||0,n=x[g[e]]||0;return m.color_conversion.match_color(t,n,c)}return!1},k=(e,t)=>{if(t=t||!1,(!N.has(e)||t)&&e>=0&&e<o*r)if("HUE BUCKET"===i){if(t){const t=x[s[e]];if("undefined"==typeof F[t]){let[n,_,a,i]=m.color_conversion.to_rgba_from_uint32(t),[o,r,l,c]=m.color_conversion.to_hsla_from_rgba(Uint8ClampedArray.of(n,_,a,i));o=(o+T)%360,[n,_,a,i]=m.color_conversion.to_rgba_from_hsla(Array.of(o,r,l,c));const p=m.color_conversion.to_uint32_from_rgba(Uint8ClampedArray.of(n,_,a,i));x.includes(p)||x.push(p);let h=x.indexOf(p);-1===h&&(h=x.push(p)),F[t]=h,s[e]=h}else s[e]=F[t]}N.add(e)}else if("BUCKET"===i||"BORDER"===i){if(t){const t=m.color_conversion.blend_colors(x[s[e]],n,l,!1,!1);let _=x.indexOf(t);-1===_&&(_=x.push(t)),s[e]=_}N.add(e)}else"SELECT COLOR THRESHOLD"===i&&N.add(e)};let H=!1,q=!1;for(;D.length;){let[e,t]=D.pop(),n=t*o+e;for(;t>=0&&z(n);)n-=o,t--;for(n+=o,t++,H=!1,q=!1;t<r&&z(n);)t++,k(n,"BORDER"!==i),e>0&&(z(n-1)?H||(D.push([e-1,t-1]),H=!0):H&&(H=!1)),e+1<o&&(z(n+1)?q||(D.push([e+1,t-1]),q=!0):q&&(q=!1)),n+=o}if("BORDER"===i){v.from_border(N,!0,!0).forEach((e=>{k(e,!0)}));let{_s_layers:e,pxl_width:t,pxl_height:n}=m.super_state.get_state(),_=m.color_conversion.clean_duplicate_colors(s,x);e[f]=a.Layer.new_from_colors_and_indexes(_[1],_[0],t,n,!0),m.super_state.set_state({_s_layers:e,_last_action_timestamp:Date.now()}).then((()=>{this.update_canvas()}))}else if("SELECT COLOR THRESHOLD"===i)"REPLACE"===p&&b.clear(),N.forEach((e=>{"ADD"===p||"REPLACE"===p?b.add(e):b["delete"](e)})),m.super_state.set_state({_pxl_indexes_of_selection:b,_last_action_timestamp:Date.now()}).then((()=>{this.update_canvas(),this._notify_is_something_selected()}));else if("BUCKET"===i||"HUE BUCKET"===i){let{_s_layers:n,pxl_width:_,pxl_height:i}=m.super_state.get_state(),o=m.color_conversion.clean_duplicate_colors(s,x);n[f]=a.Layer.new_from_colors_and_indexes(o[1],o[0],_,i,!0),m.super_state.set_state({_s_layers:n,_last_action_timestamp:Date.now()}).then((()=>{this.update_canvas(),this._notify_relevant_action_event(e,t,1)}))}}else{const{pencil_mirror_mode:e,_pencil_mirror_index:t}=m.super_state.get_state(),a=t%o,i=(t-a)/o;let c=new Set(Array.of(Array.of(d,u)));if("VERTICAL"===e||"BOTH"===e){const e=u-2*(u-i),t=d;if(t>=0&&t<o&&e>=0&&e<=r){c.add(Array.of(t,e));const _=e*o+t,a=w[E].indexes[_],i=x[a],r=m.color_conversion.blend_colors(i,n,l,!0,!1);let p=x.indexOf(r);-1===p&&(p=x.push(r)),s[_]=p}}"HORIZONTAL"!==e&&"BOTH"!==e||c.forEach((e=>{const t=e[1],_=e[0]-2*(e[0]-a);if(_>=0&&_<o&&t>=0&&t<=r){const e=t*o+_,a=w[E].indexes[e],i=x[a],r=m.color_conversion.blend_colors(i,n,l,!0,!1);let c=x.indexOf(r);-1===c&&(c=x.push(r)),s[e]=c}})),m.super_state.paint_shape([C],n,l,{_paint_or_select_hover_pxl_indexes:new _.SetFixed([C]),_paint_or_select_hover_actions_latest_index:C,_paint_hover_old_pxls_snapshot:m.super_state.get_state()._s_layers[E].indexes_copy,_last_action_timestamp:Date.now()},(()=>{this.update_canvas()}))}else"REPLACE"===p&&b.clear(),"ADD"===p||"REPLACE"===p?b.add(C):b["delete"](C),"SELECT PIXEL"===i?m.super_state.set_state({_pxl_indexes_of_selection:b,_paint_or_select_hover_actions_latest_index:C,_last_action_timestamp:Date.now()}).then((()=>{this.update_canvas(),this._notify_is_something_selected()})):"SELECT PATH"===i&&m.super_state.set_state({_pxl_indexes_of_selection:b,_paint_or_select_hover_actions_latest_index:C,_last_action_timestamp:1/0}).then((()=>{this.update_canvas(),this._notify_is_something_selected()}))}},_notify_is_something_selected(){const e=m.super_state.get_state()._pxl_indexes_of_selection;!!m.super_state.get_state()._previous_pxl_indexes_of_selection.size!=!!e.size&&m.super_state.set_state({_is_something_selected:!!e.size,_previous_pxl_indexes_of_selection:new _.SetFixed(e)}).then((()=>{g.selection(!!e.size)}))},get_pixel_color_from_pos(e,t){const{pxl_height:n,pxl_width:_,_s_layers:a,_layers:i}=m.super_state.get_state(),o=t*_+e;if(e>_||t>n||e<0||t<0)return"#00000000";let r=new Uint32Array(a.length);for(let s=a.length-1;s>=0;s--)r[s]=4294967295&(0|a[s].get_uint32(0|o));let l=s.Color.new_zero();for(let c=0;c<a.length;c++)"undefined"!=typeof i[c]&&(i[c].hidden||l.blend_first_with(s.Color.new_uint32(r[c]),Math.round(255*parseFloat(i[c].opacity)),!1,!1));return l.hex},_notify_current_color_change(e,t=null){e=m.color_conversion.format_hex_color(e),g.color?g.color(e,t):m.super_state.set_state({pxl_current_color:e})},_notify_relevant_action_event(e,t,n=1){g.action&&("number"==typeof t&&(t=s.Color.new_uint32(t).hex),g.action(e,t,n))},exchange_pixel_color(e,t){const{_s_layers:n,pxl_width:_,pxl_height:s,_layer_index:i}=m.super_state.get_state();let o=n[i].indexes;const r=n[i].colors.indexOf(e);if(!n[i].colors.includes(t)){let e=new Uint32Array(n[i].colors.length+1);e.set(n[i].colors,0),e[e.length-1]=(0|t)>>>0,n[i].set_colors(e,!0)}const l=n[i].colors.indexOf(t);o=o.map((e=>e===r?l:e));const[c,p]=m.color_conversion.clean_duplicate_colors(o,n[i].colors);n[i]=a.Layer.new_from_colors_and_indexes(p,c,_,s,!0),m.super_state.set_state({_s_layers:n,_last_action_timestamp:Date.now()}).then((()=>{this.update_canvas()}))}}}};e.exports=i},942:function(e,t,n){function _(e,t,n){let _={s:function(e,t,n){t|=0,n|=0,e||(e=document.createElement("canvas")),e.width=0|t,e.height=0|n,!/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(navigator.userAgent||navigator.vendor||window.opera)&&(navigator.userAgent||navigator.vendor||window.opera.substr(0,4));let _,s,a,i=!!("createImageBitmap"in window),o=!!("OffscreenCanvas"in window),r=!1,l=!0;if(o)try{s=e.transferControlToOffscreen();try{a=s.getContext("2d",{willReadFrequently:!0,desynchronized:!0})}catch(c){a=s.getContext("2d")}a.imageSmoothingEnabled=!1;try{a.webkitImageSmoothingEnabled=!1,a.mozImageSmoothingEnabled=!1,a.msImageSmoothingEnabled=!1}catch(c){}r=!0,_=a,l=!1}catch(c){try{s=new OffscreenCanvas(t,n).getContext("2d"),a=s.getContext("2d"),a.getContextAttributes&&"willReadFrequently"in a.getContextAttributes()&&(a=s.getContext("2d",{willReadFrequently:!0})),a.imageSmoothingEnabled=!1;try{a.webkitImageSmoothingEnabled=!1,a.mozImageSmoothingEnabled=!1,a.msImageSmoothingEnabled=!1}catch(c){}}catch(c){o=!1}}if(l){_=e.getContext("2d");try{_.getContextAttributes&&"willReadFrequently"in _.getContextAttributes()&&(_=e.getContext("2d",{willReadFrequently:!0}))}catch(c){}_.imageSmoothingEnabled=!1;try{_.mozImageSmoothingEnabled=!1,_.webkitImageSmoothingEnabled=!1,_.msImageSmoothingEnabled=!1}catch(c){}}return{is_bitmap:i,is_offscreen:o,is_offscreen_linked:r,width:0|t,height:0|n,canvas_context:_,offscreen_canvas_context:a}}(e,t|=0,n|=0),enable_paint_type:"",fp_buffer:new ArrayBuffer(n*t*4),ic:{indexes:new Uint16Array(0),colors:new Uint32Array(0),used:!0},b:{bmp_x:0,bmp_y:0,bmp_t:0,bmp:{close(){},width:0,height:0},old_bmp:{close(){},width:0,height:0}},b2:{bmp_x:0,bmp_y:0,bmp_t:0,bmp:{close(){},width:0,height:0},old_bmp:{close(){},width:0,height:0}},pr:{xy1xy2:new Uint16Array(4),width:0,height:0}};return _.fp=new Uint32Array(_.fp_buffer),_.pr_uint8a=new Uint8Array(_.fp.buffer),_}var s,a=n(596),i=(0,a.SIMDopeCreateConfAdd)({create:{new_zero:!0},properties:{hex:!0},methods:{get_use_element:!0}});const{simdops:o,Color:r,Colors:l}=(0,a.SIMDopeCreate)(i),{clamp_uint32:c,modulo_uint:p,divide_uint:h,minus_uint:d,uint_greater:u,uint_less:f,uint_greater_equal:m,uint_less_equal:g,plus_uint:v,minus_int:x,int_greater:y,int_less:b,int_greater_equal:w,int_less_equal:E,plus_int:A,max_int:C,min_int:F}=o;(0,Object.getPrototypeOf((function(){})).constructor)('var bpro = function(s_width, pr_width, pr_height, pr_top_left_x, pr_top_left_y, fp){\n            \n                "use strict";\n                var imul = Math.imul;\n                var fp_square = new Uint8Array(imul(pr_width, pr_height) << 4);\n                var current_offset_start_index = 0;\n                for(var i = 0; (i|0) < (pr_height|0) ; i = (i + 1 | 0)>>>0) {\n                    current_offset_start_index = (imul(s_width, (i + pr_top_left_y | 0)) + pr_top_left_x | 0) >>> 0;\n                    fp_square.set(fp.subarray((current_offset_start_index << 2|0)>>>0, ((current_offset_start_index + pr_width | 0)<<2|0)>>>0), (imul(i,pr_width)<<2|0)>>>0);\n                }\n                \n                return createImageBitmap(new ImageData(new Uint8ClampedArray(fp_square.buffer), pr_width|0, pr_height|0));                \n              \n            }; return bpro;')(),Object.defineProperty((s=function(e,t,n){return this instanceof s?(this.state_=_(e,t,n),this):new s(e,t,n)}).prototype,"ok",{get:function(){return function(){return!!this.state_.s.canvas_context.canvas}}}),Object.defineProperty(s.prototype,"new",{get:function(){return function(e,t,n){return this.state_=_(e,t,n),Promise.resolve()}}}),Object.defineProperty(s.prototype,"clear",{get:function(){return function(){return new Promise((function(e){this.state_.s.canvas_context.clearRect(0,0,this.state_.s.width,this.state_.s.height),e()}))}}}),Object.defineProperty(s.prototype,"render",{get:function(){return function(){var e=this.state_.b2;return this.state_.pr.xy1xy2[0]=this.state_.s.width-1|0,this.state_.pr.xy1xy2[1]=this.state_.s.height-1|0,this.state_.pr.xy1xy2[2]=0,this.state_.pr.xy1xy2[3]=0,void 0!==e&&"bitmap"===this.state_.enable_paint_type?(this.state_.b.old_bmp.close(),this.state_.s.canvas_context.clearRect(e.bmp_x,e.bmp_y,e.bmp.width,e.bmp.height),this.state_.s.canvas_context.globalCompositeOperation="source-over",this.state_.s.canvas_context.drawImage(e.bmp,e.bmp_x,e.bmp_y,e.bmp.width,e.bmp.height),this.state_.b=e,Promise.resolve()):"offscreen"===this.state_.enable_paint_type&&!1===this.state_.is_offscreen_linked?(this.state_.s.canvas_context.globalCompositeOperation="copy",this.state_.s.canvas_context.drawImage(this.state_.s.offscreen_canvas_context.canvas,0,0),Promise.resolve()):Promise.resolve()}}}),Object.defineProperty(s.prototype,"prender",{get:function(){return function(){if("bitmap"===this.state_.enable_paint_type){let e=Date.now(),t=this.state_.pr.xy1xy2[0],n=this.state_.pr.xy1xy2[1],_=0|this.state_.pr.width,s=0|this.state_.pr.height;return new Promise(((a,i)=>{createImageBitmap(new ImageData(new Uint8ClampedArray(this.state_.pr_uint8a.buffer),0|this.state_.s.width,0|this.state_.s.height),t,n,_,s).then((_=>{this.state_.b2.old_bmp=this.state_.b.bmp,this.state_.b2.bmp=_,this.state_.b2.bmp_x=0|t,this.state_.b2.bmp_y=0|n,this.state_.b2.bmp_t=0|e,a()}))["catch"]((()=>{this.state_.s.is_bitmap=!1,i()}))}))}return this.state_.enable_paint_type,Promise.resolve()}}}),Object.defineProperty(s.prototype,"unpile",{get:function(){return function(e,t){let n=0|this.state_.s.width,_=0|this.state_.s.height,s=this.state_.ic.indexes,a=this.state_.ic.colors;if(this.state_.enable_paint_type=this.state_.s.is_bitmap?"bitmap":this.state_.s.is_offscreen?"offscreen":"",n!==e||_!==t)return Promise.reject();if(s.length>0&&!1===this.state_.ic.used){let c=new Uint16Array(2),u=this.state_.fp,x=this.state_.pr,y=x.xy1xy2,b=new Uint32Array(1);if(s.length<1024||"bitmap"!==this.state_.enable_paint_type){let w="offscreen"===this.state_.enable_paint_type?this.state_.s.offscreen_canvas_context:this.state_.s.canvas_context,E=new l(a.buffer,a.byteOffset,a.byteLength),A=new r(new ArrayBuffer(4)),C={},F={};function i(e,t,n){e.fillStyle=n,e.fill(t)}for(let I=0,S=0|s.length;f(I,S);I=v(I,1))b[0]=s[0|I],u[b[0]]=a[0|I],c[0]=p(b[0],n),c[1]=h(d(b[0],c[0]),n),"undefined"==typeof C[a[0|I]]&&(C[a[0|I]]=E.get_use_element(I,A).hex,F[a[0|I]]=new Path2D),w.clearRect(c[0],c[1],1,1),F[a[0|I]].rect(c[0],c[1],1,1);var o=Uint32Array.from(Object.keys(F));for(let P=0,U=0|o.length;f(P,U);P=v(P,1))i(w,F[o[P]],C[o[P]]);this.state_.ic.used=!0,this.state_.enable_paint_type="offscreen"===this.state_.enable_paint_type?"offscreen":""}else{for(let L=0,R=0|s.length;f(L,R);L=v(L,1))b[0]=s[L],u[b[0]]=a[L],c[0]=p(b[0],n),c[1]=h(d(b[0],c[0]),n),m(y[0],c[0])&&(y[0]=c[0]),g(y[2],c[0])&&(y[2]=c[0]),m(y[1],c[1])&&(y[1]=c[1]),g(y[3],c[1])&&(y[3]=c[1]);x.width=y[2]-y[0]+1|0,x.height=y[3]-y[1]+1|0,this.state_.pr=x}return this.state_.ic.used=!0,Promise.resolve()}return Promise.resolve()}}}),Object.defineProperty(s.prototype,"pile",{get:function(){return function(e,t){return this.state_.ic.indexes=e,this.state_.ic.colors=t,this.state_.ic.used=!1,Promise.resolve()}}}),Object.defineProperty(s.prototype,"set_dimensions",{get:function(){return function(e,t){return this.state_.s.width!==e||this.state_.s.height!==t?(this.state_=_(this.state_.s.canvas_context.canvas,e,t),Promise.resolve()):Promise.reject()}}}),Object.defineProperty(s.prototype,"secure_context",{get:function(){return function(){this.state_.s.canvas_context.canvas.addEventListener("contextlost",(()=>{let e=this.state_.s.canvas_context.canvas.getContext("2d",{willReadFrequently:!0});e.imageSmoothingEnabled=!1,e.webkitImageSmoothingEnabled=!1,e.globalCompositeOperation="copy",this.state_.s.canvas_context=e})),this.state_.s.offscreen_canvas_context.canvas.addEventListener("contextlost",(()=>{let e=this.state_.s.offscreen_canvas_context.canvas.getContext("2d",{willReadFrequently:!0});e.imageSmoothingEnabled=!1,e.webkitImageSmoothingEnabled=!1,this.state_.s.offscreen_canvas_context=e}))}}}),Object.defineProperty(s.prototype,"destroy",{get:function(){return function(){Object.keys(this.state_).forEach((function(e){delete this.state_[e]})),this.state_=null}}}),e.exports=s},944:function(e,t,n){var _=n(596);const s={"new":function(){return{to_int_array_from_uint32_array_for_subcolor:function(e,t){let n;switch(t){case"r":n=3;break;case"g":n=2;break;case"b":n=1;break;default:n=0}const s=new Uint8ClampedArray(e.buffer);let a=new Uint8ClampedArray(e.length);for(let i=0;_.simdops.uint_less(i,s.length);i=_.simdops.plus_uint(i,4))a[_.simdops.divide_4_uint(i)]=s[_.simdops.plus_uint(i,n)];return a},format_hex_color:function(e){if(void 0===e)return"#00000000";{let t,n,_,s,a="";switch((e=e.replace("#","")).length){case 8:a="#".concat(e);break;case 6:a="#".concat(e.concat("ff"));break;case 4:t=e.charAt(0),n=e.charAt(1),_=e.charAt(2),s=e.charAt(3),a="#".concat(t,t,n,n,_,_,s,s);break;case 3:t=e.charAt(0),n=e.charAt(1),_=e.charAt(2),a="#".concat(t,t,n,n,_,_,"ff");break;default:a="#00000000"}return a}},blend_colors:function(e,t,n,_,s){if(e|=0,t|=0,_=_||!1,s=s||!1,0===(n=n||1)&&_)return 0;if(_&&0===t&&1===n)return 0;const a=this.to_rgba_from_uint32(e),i=this.to_rgba_from_uint32(t);if(255===i[3]&&1===n)return t;const o=a[3]/255,r=i[3]/255*n;let l=new Uint8ClampedArray(4),c=0;if(o>0&&r>0){c=s?r+o:1-(1-r)*(1-o);const e=r/c,t=o*(1-r)/c;l.set(Uint8ClampedArray.of(i[0]*e+a[0]*t,i[1]*e+a[1]*t,i[2]*e+a[2]*t),0)}else r>0?(c=i[3]/255,l.set(i,0)):(c=a[3]/255,l.set(a,0));return s&&(c/=2),l[3]=255*c|0,this.to_uint32_from_rgba(l)},blend_rgba_colors:function(e,t,n,_){n|=0,_|=0;let s=e[0].length/4|0,a=0|e.length,i=new Uint8ClampedArray(e[0].length),o=new Uint8ClampedArray(4),r=new ArrayBuffer(4),l=new Uint8ClampedArray(r),c=new ArrayBuffer(4),p=new DataView(c),h=new Uint8ClampedArray(c),d=new DataView(new ArrayBuffer(24));d.setFloat32(20,(65535*t|0)/65535);let u=0;for(let f=0,m=0;(0|f)<(0|s);f=(f+1|0)>>>0,m=(m+4|0)>>>0){u=0,o.set(e[0].slice(m,m+4|0),0);for(let t=1;(0|t)<(0|a);t=t+1|0)l.set(e[t].slice(m,m+4|0),0),0!==n&&0===l[3]&&1===d.getFloat32(20)?o.fill(0):255===l[3]&&1===d.getFloat32(20)?o.set(l,0):(d.setFloat32(0,o[3]/255),d.setFloat32(4,l[3]/255*d.getFloat32(20)),h.fill(0),d.setFloat32(8,0),d.getFloat32(0)>0&&d.getFloat32(4)>0?(_>0?d.setFloat32(8,d.getFloat32(0)+d.getFloat32(4)):d.setFloat32(8,1-(1-d.getFloat32(4))*(1-d.getFloat32(0))),d.setFloat32(12,d.getFloat32(4)/d.getFloat32(8)),d.setFloat32(16,d.getFloat32(0)*(1-d.getFloat32(4))/d.getFloat32(8)),p.setUint8(0,l[0]*d.getFloat32(12)+o[0]*d.getFloat32(16)),p.setUint8(1,l[1]*d.getFloat32(12)+o[1]*d.getFloat32(16)),p.setUint8(2,l[2]*d.getFloat32(12)+o[2]*d.getFloat32(16))):d.getFloat32(4)>0?(d.setFloat32(2,l[3]/255),h.set(l,0)):(d.setFloat32(2,o[3]/255),h.set(o,0)),_&&d.setFloat32(2,d.getFloat32(8)/2),h.fill(255*d.getFloat32(8),3,4),o.set(h));i.set(o,m)}return i},to_hex_from_uint32:function(e){return e=(0|e)>>>0,"#".concat("00000000".concat(new Uint32Array(new Uint8Array(Uint32Array.of(e).buffer).reverse().buffer).toString(16)).slice(-8))},to_hex_from_rgba:function(e){return"#".concat("00000000".concat(new Uint32Array(e.buffer)[0].toString(16)).slice(-8))},to_rgba_from_hex:function(e){return new Uint8ClampedArray(Uint32Array.of(parseInt(e.slice(1),16)).buffer)},to_rgba_from_uint32:function(e){return e=(0|e)>>>0,new Uint8ClampedArray(Uint32Array.of(e).buffer)},to_uint32_from_rgba:function(e){return(0|new Uint32Array(e.buffer)[0])>>>0},to_uint32_from_hex:function(e){return new Uint32Array(new Uint8Array(Uint32Array.of((0|parseInt(e.slice(1),16))>>>0).buffer).reverse().buffer)},to_hsla_from_rgba:function(e){let[t,n,_,s]=e;t/=255,n/=255,_/=255,s/=255;const a=Math.max(t,n,_),i=Math.min(t,n,_);let o,r,l=(a+i)/2;if(a==i)o=r=0;else{var c=a-i;switch(r=l>.5?c/(2-a-i):c/(a+i),a){case t:o=(n-_)/c+(n<_?6:0);break;case n:o=(_-t)/c+2;break;case _:o=(t-n)/c+4}o/=6}return Array.of(360*o|0,100*r|0,100*l|0,100*s|0)},to_rgba_from_hsla:function(e){let t,n,_,[s,a,i,o]=e;if(s/=360,a/=100,i/=100,o/=100,0===a)t=n=_=i;else{function r(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}const l=i<.5?i*(1+a):i+a-i*a,c=2*i-l;t=r(c,l,s+1/3),n=r(c,l,s),_=r(c,l,s-1/3)}return Uint8ClampedArray.of(255*t|0,255*n|0,255*_|0,255*o|0)},invert_uint32:function(e){e=(0|e)>>>0;const[t,n,_,s]=this.to_rgba_from_uint32(e);return this.to_uint32_from_rgba(Uint8ClampedArray.of(255-t|0,255-n|0,255-_|0,0|s))},match_color:function(e,t,n){if(e=4294967295&(0|e),t=4294967295&(0|t),1===(n=void 0===n?null:n))return!0;if(0===n)return e===t;{const _=255*n|0,s=this.to_rgba_from_uint32(e),a=this.to_rgba_from_uint32(t),i=0|Math.abs(s[3]-a[3]),o=0|Math.abs(s[0]-a[0]),r=0|Math.abs(s[1]-a[1]),l=0|Math.abs(s[2]-a[2]);return null!==n?o<_&&r<_&&l<_&&i<_:(o+r+l|0)/765*Math.abs(1-i/255)}},clean_duplicate_colors(e,t){var n,_,s,a,i=new Map,o=0|e.length,r=new Uint16Array(o),l=0;for(n=0;n<o;n=(n+1|0)>>>0)l=4294967295&(0|t[(0|e[(0|n)>>>0])>>>0]),void 0===(_=i.get(l))&&(_=(0|i.size)>>>0,i.set(l,_)),r[n]=(0|_)>>>0;for(a of(s=new Uint32Array(i.size),i))s[a[1]]=4294967295&(0|a[0]);return Array.of(r,s)}}}};e.exports=s}}]);