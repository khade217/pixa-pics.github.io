(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{654:function(e,t,n){"use strict";var r,a=n(653),i=n(647),o=(0,i.SIMDopeCreateConfAdd)({create:{new_of:!0},properties:{uint32:!0,laba:!0,rgbaon4bits:!0,rgbaon6bits:!0,rgbaon8bits:!0,rgbaon12bits:!0,rgbaon16bits:!0,skin:!0},methods:{simplify:!0,get_new_element:!0,get_use_element:!0,set_tail:!0,is_dark:!0,blend_first_with:!0,blend_first_with_tails:!0,blend_all:!0,manhattan_match_with:!0,copy:!0}}),s=Math.fround,u=s(1),c=s(.777),l=(0,i.SIMDopeCreate)(o),p=l.simdops,h=l.Color,f=l.Colors,d=(p.minus_int,p.int_not_equal,p.plus_int,p.plus_uint,p.minus_uint,p.multiply_int,p.multiply_uint,p.multiply_uint_4),_=(p.divide_uint,p.clamp_uint8,p.clamp_uint32,p.int_equal,p.uint_less,p.int_less,p.int_greater_equal,p.uint_not_equal,p.uint_less_equal,p.min_uint,function e(t){if(t=t||{},!(this instanceof e))return new e(t);t.pxl_colors=t.pxl_colors||new Uint32Array(0),t.pxls=t.pxls||new Uint32Array(0),this.new_pxls_="buffer"in t.pxls?new Uint32Array(t.pxls.buffer):Uint32Array.from(t.pxls),this.new_pxl_colors_="buffer"in t.pxl_colors?new f(t.pxl_colors.buffer):new f(Uint32Array.from(t.pxl_colors).buffer),this.original_pxls_=this.new_pxls_.slice(0,this.new_pxls_.length),this.original_pxl_colors_=this.new_pxl_colors_.slice_uint32(0,this.new_pxl_colors_.length);var n=0|this.new_pxl_colors_.length;this.new_pxl_colors_is_skin_mask_=new a.SetFixed(0|n),this.set_new_pxl_skin_mask(),this.best_color_number_=t.number_of_color,this.max_cluster_=n>65536?65537:n>16384?4097:n>8192?257:n>512?17:1,this.index_clusters_=Array(this.max_cluster_),this.length_clusters_=new Uint32Array(this.max_cluster_),this.pxl_colors_usage_=new Uint32Array(n),this.all_index_clusters_=new Uint32Array(n),this.clean_pxl_colors_=new Uint32Array(n),this.clean_pxl_colors_lookup_={},this.is_skin_ops_=0,this.match_ops_=0,this.blend_ops_=0,this.remove_duplicate_ops_=0,this.simplify_ops_=0,this.classify_on_x_bits_ops_=0});Object.defineProperty(_.prototype,"set_is_skin_ops",{get:function(){return function(e){this.is_skin_ops_=(0|e)>>>0}}}),Object.defineProperty(_.prototype,"set_match_ops",{get:function(){return function(e){this.match_ops_=(0|e)>>>0}}}),Object.defineProperty(_.prototype,"set_blend_ops",{get:function(){return function(e){this.blend_ops_=(0|e)>>>0}}}),Object.defineProperty(_.prototype,"set_remove_duplicate_ops",{get:function(){return function(e){this.remove_duplicate_ops_=(0|e)>>>0}}}),Object.defineProperty(_.prototype,"set_simplify_ops",{get:function(){return function(e){this.simplify_ops_=e}}}),Object.defineProperty(_.prototype,"set_classify_on_x_bits_ops",{get:function(){return function(e){this.classify_on_x_bits_ops_=e}}}),Object.defineProperty(_.prototype,"get_is_skin_ops",{get:function(){return function(){return 0|this.is_skin_ops_}}}),Object.defineProperty(_.prototype,"get_match_ops",{get:function(){return function(){return 0|this.match_ops_}}}),Object.defineProperty(_.prototype,"get_blend_ops",{get:function(){return function(){return 0|this.blend_ops_}}}),Object.defineProperty(_.prototype,"get_remove_duplicate_ops",{get:function(){return function(){return 0|this.remove_duplicate_ops_}}}),Object.defineProperty(_.prototype,"get_simplify_ops",{get:function(){return function(){return this.simplify_ops_}}}),Object.defineProperty(_.prototype,"get_classify_on_x_bits_ops",{get:function(){return function(){return this.classify_on_x_bits_ops_}}}),Object.defineProperty(_.prototype,"reset_deduplicate",{get:function(){return function(e){this.clean_pxl_colors_lookup_={},this.pxl_colors_usage_.fill(0,0,0|e),this.clean_pxl_colors_.fill(0,0,0|e)}}}),Object.defineProperty(_.prototype,"index_of_color_within_cleaned",{get:function(){return function(e){return(0|this.clean_pxl_colors_lookup_[(0|e)>>>0])-1|0}}}),Object.defineProperty(_.prototype,"set_cleaned_pxl_colors",{get:function(){return function(e,t){this.clean_pxl_colors_[(0|e)>>>0]=(0|t)>>>0,this.clean_pxl_colors_lookup_[(0|t)>>>0]=(e+1|0)>>>0}}}),Object.defineProperty(_.prototype,"increase_color_usage",{get:function(){return function(e){this.pxl_colors_usage_[(0|e)>>>0]=(this.pxl_colors_usage_[(0|e)>>>0]+1|0)>>>0}}}),Object.defineProperty(_.prototype,"set_new_pxls",{get:function(){return function(e,t){this.new_pxls_[(0|e)>>>0]=(0|t)>>>0}}}),Object.defineProperty(_.prototype,"set_new_pxl_colors",{get:function(){return function(e){this.new_pxl_colors_=new f(this.clean_pxl_colors_.buffer.slice(0,d(0|e))),this.set_new_pxl_skin_mask()}}}),Object.defineProperty(_.prototype,"set_new_pxl_skin_mask",{get:function(){return function(){var e=new h(new ArrayBuffer(4)),t=0|this.new_pxl_colors_.length,n=0;for(this.new_pxl_colors_is_skin_mask_=new a.SetFixed(0|t);(0|n)<(0|t);n=n+1|0)this.new_pxl_colors_.get_use_element(0|n,e).skin&&this.new_pxl_colors_is_skin_mask_.add(0|n);this.set_is_skin_ops(this.get_is_skin_ops()+n|0)}}}),Object.defineProperty(_.prototype,"get_a_new_pxl_color_from_pxl_index",{get:function(){return function(e){return 4294967295&this.new_pxl_colors_.buffer_getUint32(this.new_pxls_[0|e])}}}),Object.defineProperty(_.prototype,"reset_cluster",{get:function(){return function(){this.max_cluster_=this.new_pxl_colors_.length>65536?65537:this.new_pxl_colors_.length>16384?4097:this.new_pxl_colors_.length>8192?257:this.new_pxl_colors_.length>512?17:1,this.length_clusters_.fill(0,0,0|this.max_cluster);for(var e=0;(0|e)<(0|this.max_cluster);e=(e+1|0)>>>0)this.index_clusters_[0|e]=[]}}}),Object.defineProperty(_.prototype,"reset_original_data",{get:function(){return function(){this.new_pxl_colors_=new f(this.original_pxl_colors_.slice(0,this.original_pxl_colors_.length).buffer),this.new_pxls_=this.original_pxls_.slice(0,this.original_pxls_.length)}}}),Object.defineProperty(_.prototype,"add_in_indexes_cluster",{get:function(){return function(e,t){this.index_clusters_[(0|e)>>>0].push((0|t)>>>0)}}}),Object.defineProperty(_.prototype,"set_all_cluster_indexes",{get:function(){return function(){for(var e=0,t=0;(0|e)<(0|this.max_cluster);e=(e+1|0)>>>0)this.all_index_clusters_.set(this.index_clusters_[(0|e)>>>0],(0|t)>>>0),t=(t+this.get_length_in_index_clusters(0|e)|0)>>>0}}}),Object.defineProperty(_.prototype,"get_length_in_index_clusters",{get:function(){return function(e){return(0|this.index_clusters_[(0|e)>>>0].length)>>>0}}}),Object.defineProperty(_.prototype,"get_in_cluster_lengths",{get:function(){return function(e){return(0|this.length_clusters_[(0|e)>>>0])>>>0}}}),Object.defineProperty(_.prototype,"get_an_index_in_clusters",{get:function(){return function(e){return(0|this.all_index_clusters_[0|e])>>>0}}}),Object.defineProperty(_.prototype,"get_a_color_usage",{get:function(){return function(e){return(0|this.pxl_colors_usage_[0|e])>>>0}}}),Object.defineProperty(_.prototype,"set_a_color_usage",{get:function(){return function(e,t){return this.pxl_colors_usage_[0|e]=(0|t)>>>0}}}),Object.defineProperty(_.prototype,"get_a_color_usage_percent",{get:function(){return function(e){return s(this.pxl_colors_usage_[0|e]/this.new_pxls_.length)}}}),Object.defineProperty(_.prototype,"get_average_color_usage_percent",{get:function(){return function(e,t){var n,r,a;for(t=0|((t|=0)<(e|=0)?this.pxl_colors_usage_.length:t),n=0,r=0,a=0,r=0|e;(0|r)<(0|t);r=(r+1|0)>>>0)a=(0|this.get_an_index_in_clusters((0|r)>>>0))>>>0,n+=this.pxl_colors_usage_[0|a]/this.new_pxls_.length;return n/(t-e|0)}}}),Object.defineProperty(_.prototype,"get_a_new_pxl_color",{get:function(){return function(e){return this.new_pxl_colors_.get_new_element(0|e)}}}),Object.defineProperty(_.prototype,"is_pxl_color_skin",{get:function(){return function(e){return this.new_pxl_colors_is_skin_mask_.has(0|e)}}}),Object.defineProperty(_.prototype,"max_cluster",{get:function(){return 0|this.max_cluster_}}),Object.defineProperty(_.prototype,"new_pxls_length",{get:function(){return 0|this.new_pxls_.length}}),Object.defineProperty(_.prototype,"new_pxl_colors_length",{get:function(){return 0|this.new_pxl_colors_.length}}),Object.defineProperty(_.prototype,"best_color_number",{get:function(){return 0|this.best_color_number_}}),Object.defineProperty(_.prototype,"get_data",{get:function(){return function(){return Array.of(this.new_pxls_,this.new_pxl_colors_.slice_uint32(0,this.new_pxl_colors_.length),{deduplicate:this.get_remove_duplicate_ops(),simplify:this.get_simplify_ops(),classify:this.get_classify_on_x_bits_ops(),skin:this.get_is_skin_ops(),blend:this.get_blend_ops(),match:this.get_match_ops()})}}}),_.prototype.output=function(e){var t,n;return e=e||"heap",t=this.get_data(),"heap"==e?((n=new Uint32Array(2+t[0].length+t[1].length))[0]=0|t[0].length,n[1]=0|t[1].length,n.set(t[0],2),n.set(t[1],2+t[0].length),n.buffer):t},_.prototype.deduplicate=function(){var e,t,n,r,a;for(this.set_remove_duplicate_ops(this.get_remove_duplicate_ops()+1|0),this.reset_deduplicate(0|this.new_pxl_colors_length),e=0,t=0,n=0,r=0,a=0|this.new_pxls_length;(0|r)<(0|a);r=(r+1|0)>>>0)t=0|this.get_a_new_pxl_color_from_pxl_index(0|r),-1==(0|(n=0|this.index_of_color_within_cleaned(0|t)))&&(this.set_cleaned_pxl_colors(0|e,0|t),n=0|e,e=e+1|0),this.increase_color_usage(0|n),this.set_new_pxls(0|r,0|n);this.set_new_pxl_colors(e)},_.prototype.clusterize=function(){this.reset_cluster();var e=0;if(65537===this.max_cluster)for(;(0|e)<(0|this.new_pxl_colors_length);e=(e+1|0)>>>0)this.add_in_indexes_cluster((0|this.get_a_new_pxl_color((0|e)>>>0).rgbaon16bits)>>>0,(0|e)>>>0);else if(4097===this.max_cluster)for(;(0|e)<(0|this.new_pxl_colors_length);e=(e+1|0)>>>0)this.add_in_indexes_cluster((0|this.get_a_new_pxl_color((0|e)>>>0).rgbaon12bits)>>>0,(0|e)>>>0);else if(257===this.max_cluster)for(;(0|e)<(0|this.new_pxl_colors_length);e=(e+1|0)>>>0)this.add_in_indexes_cluster((0|this.get_a_new_pxl_color((0|e)>>>0).rgbaon8bits)>>>0,(0|e)>>>0);else if(17===this.max_cluster)for(;(0|e)<(0|this.new_pxl_colors_length);e=(e+1|0)>>>0)this.add_in_indexes_cluster((0|this.get_a_new_pxl_color((0|e)>>>0).rgbaon4bits)>>>0,(0|e)>>>0);else for(;(0|e)<(0|this.new_pxl_colors_length);e=(e+1|0)>>>0)this.add_in_indexes_cluster(0,(0|e)>>>0);this.max_cluster>1&&this.set_classify_on_x_bits_ops(this.get_classify_on_x_bits_ops()+this.new_pxl_colors_length),this.set_all_cluster_indexes()},_.prototype.process_threshold=function(e){var t,n,r,a,i,o,l,p,f,d,_,g,m,v,b,w,x,y,k,R,S,E,O,j,P,D;for(n=function(e,n){return s(Math.pow(e,t)/n)}(e=(0|e)>>>0,Math.pow(100,t=1.5)),r=!1,a=[],i=[],o=0,l=0,d=!1,_=!1,g=0,m=0,v=0,b=0,w=0,x=0,S=0,E=0,O=0,j=0,P=0,D=0,R=s((y=n)*c),k=s(y*u);(0|P)<(0|this.max_cluster);P=(P+1|0)>>>0){for(l=(o+((0|this.get_length_in_index_clusters(0|P))>>>0)|0)>>>0,w=this.get_average_color_usage_percent(0|o,0|l),O=0|o;(0|O)<(0|l);O=(O+1|0)>>>0){if(S=(0|this.get_an_index_in_clusters((0|O)>>>0))>>>0,p=this.get_a_new_pxl_color((0|S)>>>0),d=this.is_pxl_color_skin((0|S)>>>0),(0|(g=(0|this.get_a_color_usage((0|S)>>>0))>>>0))>0)for(a=[],j=0|o;(0|j)<(0|l);j=(j+1|0)>>>0)E=(0|this.get_an_index_in_clusters((0|j)>>>0))>>>0,f=this.get_a_new_pxl_color((0|E)>>>0),_=this.is_pxl_color_skin((0|E)>>>0),0|(m=(0|this.get_a_color_usage((0|E)>>>0))>>>0)&&(0|S)!=(0|E)&&(0|d)==(0|_)&&(v=this.get_a_color_usage_percent((0|S)>>>0)/w,b=this.get_a_color_usage_percent((0|E)>>>0)/w,D=s((D=d&&_?R:d||_?k:y)*(0*Math.abs(v-b)+.14*(2-(v+b))/2+.88)/1.02),p.manhattan_match_with(f,D)&&(x=s(m/g),r=!0,this.set_a_color_usage(0|E,0),a.push(f),i.push(x)));(0|a.length)>0&&(h.blend_all(p,a,i),a=[],i=[])}o=0|l}return r},_.prototype.round=function(){var e,t;if(this.new_pxl_colors_length>2048){for(e=0|(this.new_pxl_colors_length>6e4?4:this.new_pxl_colors_length>32e3?3:this.new_pxl_colors_length>16e3?2:this.new_pxl_colors_length>8192?1.5:this.new_pxl_colors_length>4096?1.25:1),t=0;(0|t)<(0|this.new_pxl_colors_length);t=(t+1|0)>>>0)this.get_a_new_pxl_color((0|t)>>>0).simplify(e);this.set_simplify_ops(this.get_simplify_ops()+this.new_pxl_colors_length)}},_.prototype.init=function(){return this.round(),this.deduplicate(),this.clusterize(),this},_.prototype.reset_original=function(){return this.reset_original_data(),this},_.prototype.run=function(){var e=0|(this.new_pxl_colors_length>6e4?12:this.new_pxl_colors_length>32e3?8:this.new_pxl_colors_length>16e3?4:this.new_pxl_colors_length>8192?3:this.new_pxl_colors_length>4096?2:1);if(this.new_pxl_colors_length<=this.best_color_number)return this.deduplicate(),this.clusterize(),this;for(;this.new_pxl_colors_length>this.best_color_number;)this.process_threshold(0|e)&&(this.deduplicate(),this.clusterize()),e=e+(this.new_pxl_colors_length>6e4?12:this.new_pxl_colors_length>32e3?8:this.new_pxl_colors_length>16e3?4:this.new_pxl_colors_length>8192?3:this.new_pxl_colors_length>4096?2:1)|0;return this.reset_original(),this.deduplicate(),this.clusterize(),this.process_threshold(0|e),this.deduplicate(),this.clusterize(),this},_.split_image_data=function(e){var t,n,r=new Uint32Array(e.data.buffer),a=Uint32Array.from(new Set(r)),i={},o=a.length,s=new Uint32Array(r.length);for(t=0,n=0|o;(0|t)<(0|n);t=(t+1|0)>>>0)i[a[0|t]]=(0|t)>>>0;for(t=0,n=0|r.length;(0|t)<(0|n);t=(t+1|0)>>>0)s[0|t]=(0|i[r[0|t]])>>>0;return[s,a,r,o]},r=function(e,t){return new Promise((function(n){var r,a=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n,r,a=[],i=!0,o=!1,s=void 0;try{for(n=e[Symbol.iterator]();!(i=(r=n.next()).done)&&(a.push(r.value),4!==a.length);i=!0);}catch(u){o=!0,s=u}finally{try{!i&&n.return&&n.return()}finally{if(o)throw s}}return a}(e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}(_.split_image_data(e)),i=a[0],o=a[1],s=a[2],u=a[3],c=Date.now(),l=_({pxls:i,pxl_colors:o,number_of_color:"auto"===t?u/1.314|0:parseFloat(t)<1?u-Math.ceil(u/25):t,width:e.width,height:e.height}).init().run().output("split"),p=Date.now(),h=l[0],f=0|h.length,d=l[1];for(r=0;(0|r)<(0|f);r=(r+1|0)>>>0)s[0|r]=(0|d[(0|h[0|r])>>>0])>>>0;n([e=new ImageData(new Uint8ClampedArray(s.buffer),e.width,e.height),h,d,u-d.length,d.length,p-c])}))},e.exports={QuantiMatGlobal:r,QuantiMat:_}},658:function(e,t,n){"use strict";var r,a;Object.defineProperty(t,"__esModule",{value:!0}),r=(a=n(671))&&a.__esModule?a:{default:a},t.default=r.default.pool({minWorkers:0,maxWorkers:3})},663:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=r(n(664)),i=r(n(665));e.exports=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=(0,a.default)(e);return n&&(t=/(?:#)[0-9a-f]{8}|(?:#)[0-9a-f]{6}|(?:#)[0-9a-f]{4}|(?:#)[0-9a-f]{3}/gi,r.match(t).forEach((function(e){var t=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n,r,a=[],i=!0,o=!1,s=void 0;try{for(n=e[Symbol.iterator]();!(i=(r=n.next()).done)&&(a.push(r.value),3!==a.length);i=!0);}catch(u){o=!0,s=u}finally{try{!i&&n.return&&n.return()}finally{if(o)throw s}}return a}(e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}(e.match(/\w\w/g).map((function(e){return parseInt(e,16)}))),n=t[0],a=t[1],i=t[2],o=Math.round((n+a+i)/3),s=function(e,t,n){return e=e.toString(16),t=t.toString(16),n=n.toString(16),1==e.length&&(e="0"+e),1==t.length&&(t="0"+t),1==n.length&&(n="0"+n),"#"+e+t+n}(o,o,o);r=r.replace(e,s)}))),(0,i.default)(r)}},668:function(e,t,n){"use strict";var r=n(669);e.exports={createLocalBlob:function(e){var t,n,a,i,o=(e.match(/(data\:([a-z]+\/[a-z\+]+)\;base64\,)([a-zA-Z0-9\/\+]+\(\=+)?/)||[,,])[1];return o?(n=(t=o.match(/data\:([a-z]+\/[a-z\+]+)\;base64\,/)[1]).match(/[a-z]+\/([a-z\+]+)/)[1],e=e.replace(o,""),a=(0,r.base64ToBytes)(e),i=new File([a],"name."+n,{type:t}),URL.createObjectURL(i)):""}}},677:function(e,t,n){"use strict";var r,a=n(678),i=Object.getPrototypeOf((r=regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e,this)})),function(){var e=r.apply(this,arguments);return new Promise((function(t,n){return function r(a,i){var o,s;try{s=(o=e[a](i)).value}catch(u){return void n(u)}if(!o.done)return Promise.resolve(s).then((function(e){r("next",e)}),(function(e){r("throw",e)}));t(s)}("next")}))})).constructor,o=Object.getPrototypeOf((function(){})).constructor,s=new o('var t = function(file) {\n    "use strict";\n    \n    try {\n        \n        return new Promise(function(resolve, _) {\n            resolve(new FileReaderSync().readAsDataURL(file));\n        });\n        \n    } catch(error) {\n    \n        return new Promise(function(resolve, _) {\n            var reader = new FileReader();\n            reader.onload = function(){ resolve(reader.result)};\n            reader.readAsDataURL(file);\n        });\n    }\n    \n}; return t;')(),u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null!==n?n.exec(s,[e]).catch((function(t){return s(e)})).timeout(5e3).then((function(e){t(e)})):s(e).then((function(e){t(e)}))},c=new i('var t = async function(base64) {\n\n    "use strict";\n\n    return fetch(base64).then(function(res) {\n\n        return res.blob().then(function(blb){\n\n            return createImageBitmap(blb, {\n                resizeQuality: "pixelated",\n                premultiplyAlpha: \'premultiply\'\n            });\n        });\n    });\n\n}; return t;')(),l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null!==n?n.exec(c,[e]).catch((function(t){return c(e)})).timeout(5e3).then((function(e){t(e)})):c(e).then((function(e){t(e)}))},p=function(e){for(var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2073600,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},i=1;Math.round(e.width*i)*Math.round(e.height*i)>r;)i-=.01;try{createImageBitmap(e,0,0,e.width,e.height,{resizeWidth:Math.round(e.width*i),resizeHeight:Math.round(e.height*i),resizeQuality:"pixelated",premultiplyAlpha:"premultiply"}).then((function(e){var t,n=void 0;try{n=new OffscreenCanvas(e.width,e.height)}catch(r){(n=document.createElement("canvas")).width=e.width,n.height=e.height}(t=n.getContext("2d")).imageSmoothingEnabled=!1,t.drawImage(e,0,0,e.width,e.height),a(t.getImageData(0,0,e.width,e.height))}))}catch(o){t=void 0;try{t=new OffscreenCanvas(Math.round(e.width*i),Math.round(e.height*i))}catch(s){(t=document.createElement("canvas")).width=Math.round(e.width*i),t.height=Math.round(e.height*i)}(n=t.getContext("2d")).imageSmoothingEnabled=!1,n.drawImage(e,0,0,t.width,t.height),a(n.getImageData(0,0,t.width,t.height))}},h=new o('var t = function(imagedata, type) {\n\n    "use strict"\n    type = type || "image/png";\n    var quality = type.includes("webp") ? 1: type.includes("png") ? undefined: 0.7;\n    try {\n    \n        return new Promise(function(resolve, _) {\n\n            createImageBitmap(imagedata, 0, 0, imagedata.width, imagedata.height, {\n                premultiplyAlpha: \'premultiply\',\n                resizeQuality: \'pixelated\'\n            }).then((bmp) => {\n            \n                var canvas;\n                    canvas = new OffscreenCanvas(imagedata.width, imagedata.height);\n                var ctx = canvas.getContext("bitmaprenderer");\n                    ctx.imageSmoothingEnabled = false;\n                    ctx.transferFromImageBitmap(bmp);\n                \n                canvas.convertToBlob({type: type, quality: quality}).then((blb) => {\n                    try {\n                        resolve(new FileReaderSync().readAsDataURL(blb));\n                    } catch(e2) {\n                        var reader = new FileReader();\n                        reader.onload = function(){ resolve(reader.result)};\n                        reader.readAsDataURL(blb);\n                    }\n                });\n            });\n        });\n       \n    }catch (e) {\n    \n        return new Promise(function(resolve, _) {\n            var canvas = document.createElement("canvas");\n            canvas.width = imagedata.width;\n            canvas.height = imagedata.height;\n            var ctx = canvas.getContext("2d");\n            ctx.imageSmoothingEnabled = false;\n            ctx.putImageData(imagedata, 0, 0);\n            \n            var base64 = canvas.toDataURL(type, quality);\n            canvas = null;\n            resolve(base64);\n        });\n    }\n\n}; return t;')();e.exports={file_to_imagedata_resized:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;Date.now(),e.type,"image/jpg"!==e.type&&e.type,e.type,u(e,(function(e){l(e,(function(e){p(e,t,(function(e){n(e)}),r)}),r)}),r)},file_to_base64:u,base64_to_bitmap:l,bitmap_to_imagedata:p,imagedata_to_base64:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/png",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;null!==r?r.exec(h,[e,t]).catch((function(n){return h(e,t)})).timeout(5e3).then((function(e){n(e)})):h(e,t).then((function(e){n(e)}))},base64_sanitize:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};(function(e,t,n){return n=n||"pixelize",new Promise((function(r,i){var o=new Image,s=e.startsWith("data:image/png;");o.onload=function(){var e,i,u=o.naturalWidth*t,c=o.naturalHeight*t,l=function(e,t,n,r){var i,o,s,u,c=void 0;if("pixelize"===r||"normal"===r){i=void 0,o=void 0;try{i=new OffscreenCanvas(e.width,e.height),o=new OffscreenCanvas(t,n)}catch(l){i=document.createElement("canvas"),o=document.createElement("canvas"),i.width=e.width,i.height=e.height,o.width=t,o.height=n}s=i.getContext("2d"),u=o.getContext("2d"),s.imageSmoothingEnabled=!("normal"!==r),u.imageSmoothingEnabled=!("normal"!==r),s.drawImage(e,0,0,e.width,e.height),u.drawImage(i,0,0,i.width,i.height,0,0,o.width,o.height),c=u}else"doppel"===r&&(c=a.scaler.processImage(e,t,n));return c}(o,0|u,0|c,n);try{e=l.getImageData(0,0,l.canvas.width,l.canvas.height),createImageBitmap(e).then((function(e){var t,n;try{t=new OffscreenCanvas(e.width,e.height)}catch(a){(t=document.createElement("canvas")).height=e.height,t.width=e.width}(n=t.getContext("bitmaprenderer")).imageSmoothingEnabled=!1,n.transferFromImageBitmap(e),t.convertToBlob({type:s?"image/png":"image/jpeg"}).then((function(e){try{r((new FileReaderSync).readAsDataURL(e))}catch(n){var t=new FileReader;t.onload=function(){r(t.result)},t.readAsDataURL(e)}}))}))}catch(p){i=l.canvas,r(i.toDataURL(s?"image/png":"image/jpeg"))}},o.onerror=function(){i()},o.src=e}))})(e,arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,arguments[4]).then((function(e){t(e)}))},file_to_bitmap:function(e,t){createImageBitmap(e).then(t)}}},692:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=r(n(740)),i=r(n(259));e.exports={UJS:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"COMPRESS_OBJECT";return new Promise((function(n,r){"COMPRESS_OBJECT"===t?n(new Uint8ClampedArray(a.default.compress(i.default.pack(e)).buffer)):"DECOMPRESS_UINT8A"===t&&n(i.default.unpack(a.default.uncompress(e)))}))}}},828:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=r(n(658)),i=r(n(155)),o=r(n(829));e.exports={base64png_to_xbrz_svg:function(e,t,r,s){var u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"xbrz",l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],p=arguments.length>7&&void 0!==arguments[7]&&arguments[7],h=arguments.length>8&&void 0!==arguments[8]&&arguments[8],f=new Image;f.onload=function(){var e,d,_,g,m,v,b,w,x,y,k=document.createElement("canvas"),R=k.getContext("2d"),S=f.width,E=f.height;k.width=S,k.height=E,R.drawImage(f,0,0,S,E),e=R.getImageData(0,0,S,E),d=function(e,t){return new Promise((function(t,r){(0,i.default)((function(){return n.e(4).then(n.t.bind(null,720,7))})).then((function(n){(0,n.crt)(e,1).then(t).catch(r)}))}))},_=function(e,t,r,o,s){l?(0,i.default)((function(){return n.e(1).then(n.t.bind(null,666,7))})).then((function(u){(0,u.oxi_png)(e,3,!1,a.default).then((function(e){s(e,t,r,o)})).catch((function(){(0,i.default)((function(){return n.e(0).then(n.t.bind(null,656,7))})).then((function(n){(0,n.png_quant)(e,100,100,1,a.default).then((function(e){s(e,t,r,o)})).catch((function(){s(e,t,r,o)}))})).catch((function(){s(e,t,r,o)}))}))})).catch((function(){s(e,t,r,o)})):s(e,t,r,o)},g=function(e,t){p?(0,i.default)((function(){return n.e(25).then(n.t.bind(null,946,7))})).then((function(o){(0,o.image_tracer)(e,{pal:u.map((function(e){return{r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16),a:parseInt(e.slice(7,9),16)}})),corsenabled:!1,ltres:t,qtres:t,pathomit:t,rightangleenhance:!1,colorsampling:2,numberofcolors:512,mincolorratio:0,colorquantcycles:1,layering:0,strokewidth:Math.ceil(t/2),linefilter:!0,scale:1,roundcoords:2,viewbox:!0,desc:!1,lcpr:0,qcpr:0,blurradius:t,blurdelta:4*t},a.default).then((function(e){l?(0,i.default)((function(){return n.e(2).then(n.bind(null,690))})).then((function(n){var a=n.optimize;e=a(e,{path:"path-to.svg",multipass:!0,mergePaths:!0,mergeStyles:!0,collapseGroups:!0,reusePaths:!0,plugin:["multipass","mergePaths","collapseGroups","reusePaths","mergeStyles"]}).data,r("data:image/svg+xml;base64,"+window.btoa(e),t)})):r("data:image/svg+xml;base64,"+window.btoa(e),t)}))})):r("",0)},"depixelize"===c?(v=(m=(0,o.default)(e,p))[0],b=m[1],(w=document.createElement("canvas")).width=v.width,w.height=v.height,(x=w.getContext("2d")).putImageData(v,0,0),y=x.canvas.toDataURL("image/png"),h&&d(v).then((function(e){var t,n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("2d").putImageData(e,0,0),t=n.toDataURL("image/png"),_(t,10,e.width,e.height,s)})),p&&(l?(0,i.default)((function(){return n.e(2).then(n.bind(null,690))})).then((function(e){var t=e.optimize;b=t(b,{path:"path-to.svg",multipass:!0,plugin:["mergePaths"]}).data,r("data:image/svg+xml;base64,"+window.btoa(b),10)})):r("data:image/svg+xml;base64,"+window.btoa(b),10)),_(y,10,v.width,v.height,t)):"omniscale"===c?(0,i.default)((function(){return n.e(26).then(n.t.bind(null,947,7))})).then((function(n){(0,n.omniscale)(e,8,a.default).then((function(e){var n,r,a=document.createElement("canvas");a.width=e.width,a.height=e.height,(n=a.getContext("2d")).putImageData(e,0,0),r=n.canvas.toDataURL("image/png"),h&&d(e).then((function(e){var t,n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("2d").putImageData(e,0,0),t=n.toDataURL("image/png"),_(t,8,e.width,e.height,s)})),g(e,8),_(r,8,e.width,e.height,t)}))})):"hexagon"===c?(0,i.default)((function(){return n.e(7).then(n.t.bind(null,721,7))})).then((function(n){(0,n.hexagonrender)(e,16).then((function(e){var n,r,a=document.createElement("canvas");a.width=e.width,a.height=e.height,(n=a.getContext("2d")).putImageData(e,0,0),r=n.canvas.toDataURL("image/png"),h&&d(e).then((function(e){var t,n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("2d").putImageData(e,0,0),t=n.toDataURL("image/png"),_(t,16,e.width,e.height,s)})),g(e,32/6),_(r,32,e.width,e.height,t)}))})):"kikko"===c?(0,i.default)((function(){return n.e(44).then(n.t.bind(null,948,7))})).then((function(n){(0,n.kikkorender)(e,24,a.default).then((function(e){var n,r,a=document.createElement("canvas");a.width=e.width,a.height=e.height,(n=a.getContext("2d")).putImageData(e,0,0),r=n.canvas.toDataURL("image/png"),h&&d(e).then((function(e){var t,n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("2d").putImageData(e,0,0),t=n.toDataURL("image/png"),_(t,24,e.width,e.height,s)})),g(e,6),_(r,48,e.width,e.height,t)}))})):"hqnx"===c?(0,i.default)((function(){return n.e(24).then(n.t.bind(null,949,7))})).then((function(n){(0,n.hqnx)(e,4,a.default).then((function(e){var n,r,a=document.createElement("canvas");a.width=e.width,a.height=e.height,(n=a.getContext("2d")).putImageData(e,0,0),r=n.canvas.toDataURL("image/png"),h&&d(e).then((function(e){var t,n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("2d").putImageData(e,0,0),t=n.toDataURL("image/png"),_(t,4,e.width,e.height,s)})),g(e,4),_(r,4,e.width,e.height,t)}))})):"epx"===c?(0,i.default)((function(){return n.e(23).then(n.t.bind(null,950,7))})).then((function(n){(0,n.epx)(e,4,a.default).then((function(e){var n,r,a=document.createElement("canvas");a.width=e.width,a.height=e.height,(n=a.getContext("2d")).putImageData(e,0,0),r=n.canvas.toDataURL("image/png"),h&&d(e).then((function(e){var t,n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("2d").putImageData(e,0,0),t=n.toDataURL("image/png"),_(t,4,e.width,e.height,s)})),g(e,4),_(r,4,e.width,e.height,t)}))})):(0,i.default)((function(){return n.e(5).then(n.t.bind(null,722,7))})).then((function(n){n.default(e,6,a.default).then((function(e){var n,r,a=document.createElement("canvas");a.width=e.width,a.height=e.height,(n=a.getContext("2d")).putImageData(e,0,0),r=n.canvas.toDataURL("image/png"),h&&d(e).then((function(e){var t,n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("2d").putImageData(e,0,0),t=n.toDataURL("image/png"),_(t,6,e.width,e.height,s)})),g(e,6),_(r,6,e.width,e.height,t)}))}))},f.src=e}}},830:function(e,t,n){"use strict";var r=n(831);e.exports={loadJSON:function(e,t){var n=new XMLHttpRequest;try{n=new XMLHttpRequest}catch(r){try{n=new ActiveXObject("Msxml2.XMLHTTP")}catch(r){try{n=new ActiveXObject("Microsoft.XMLHTTP")}catch(r){t("Cannot load data",null)}}}n.open("GET",e,!0),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status)try{var e=JSON.parse(n.responseText);t(null,e)}catch(r){t("Cannot understand response from network.",null)}else 4==n.readyState&&404==n.status&&t("Error 404",null)};try{n.send()}catch(r){t("Failed to fetch",null)}},postJSON:function(e,t,n){var a,i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"application/x-www-form-urlencoded",s=new Headers;s.append("Content-Type",o),a="multipart/form-data"===o?new FormData:new URLSearchParams,Object.entries(t).forEach((function(e){var t=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n,r,a=[],i=!0,o=!1,s=void 0;try{for(n=e[Symbol.iterator]();!(i=(r=n.next()).done)&&(a.push(r.value),2!==a.length);i=!0);}catch(u){o=!0,s=u}finally{try{!i&&n.return&&n.return()}finally{if(o)throw s}}return a}(e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}(e),n=t[0],r=t[1];a.append(n,r)})),i={method:"POST",redirect:"follow",headers:s,body:"application/text"===o?t:"application/json"===o?(0,r.clean_json_text)(JSON.stringify(t)):a},fetch(e,i).then((function(e){return e.text()})).then((function(e){return n(null,e)})).catch((function(e){return n(e,null)}))},postDATA:function(e,t,n){var r=new XMLHttpRequest;try{r=new XMLHttpRequest}catch(a){try{r=new ActiveXObject("Msxml2.XMLHTTP")}catch(a){try{r=new ActiveXObject("Microsoft.XMLHTTP")}catch(a){return void n("Cannot load data",null)}}}r.open("POST",e,!0),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){if(4==r.readyState&&200==r.status)try{var e=JSON.parse(r.responseText);n(null,e)}catch(a){n("Cannot understand response from network.",null)}else 4==r.readyState&&404==r.status&&n("Error 404",null)};try{r.send(t)}catch(a){n("Failed to post",null)}}}},831:function(e,t,n){"use strict";e.exports={clean_json_text:function(e){return(e=e.replace(/\\n/g,"\\n").replace(/\\'/g,"\\'").replace(/\\"/g,'\\"').replace(/\\&/g,"\\&").replace(/\\r/g,"\\r").replace(/\\t/g,"\\t").replace(/\\b/g,"\\b").replace(/\\f/g,"\\f")).replace(/[\u0000-\u0019]+/g,"")}}},841:function(e,t,n){"use strict";!function(e,r,a){function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e){if("function"==typeof Symbol){if(Symbol.asyncIterator){var t=e[Symbol.asyncIterator];if(null!=t)return t.call(e)}if(Symbol.iterator)return e[Symbol.iterator]()}throw new TypeError("Object is not async iterable")}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function c(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,n){return function r(a,i){var o,s;try{s=(o=t[a](i)).value}catch(u){return void n(u)}if(!o.done)return Promise.resolve(s).then((function(e){r("next",e)}),(function(e){r("throw",e)}));e(s)}("next")}))}}function l(e,t,n){return e=e.split("."),t=t.split("."),fe(e[0],t[0])||fe(e[1],t[1])||(t[2]=t.slice(2).join("."),(n=/[.-]/.test(e[2]=e.slice(2).join(".")))==/[.-]/.test(t[2])?fe(e[2],t[2]):n?-1:1)}function p(e,t,n){return t.startsWith("http://")||t.startsWith("https://")?n?e:t:e+t}function h(e){var t={};return e.forEach((function(e){var n=e.api_name,r=e.id;n&&(t[n]=r)})),t}function f(e){if(e.startsWith("http")){var t=new URL(e),n=t.protocol,r=t.host,a=t.pathname;return r.endsWith("hf.space")?{ws_protocol:"wss",host:r,http_protocol:n}:{ws_protocol:"https:"===n?"wss":"ws",http_protocol:n,host:r+("/"!==a?a:"")}}return e.startsWith("file:")?{ws_protocol:"ws",http_protocol:"http:",host:"lite.local"}:{ws_protocol:"wss",http_protocol:"https:",host:e}}function d(e,t,n){var r={named_endpoints:{},unnamed_endpoints:{}};return Object.keys(e).forEach((function(a){"named_endpoints"!==a&&"unnamed_endpoints"!==a||(r[a]={},Object.entries(e[a]).forEach((function(e){var i,o,s,u,c,l,p=D(e,2),h=p[0],f=p[1],d=f.parameters,m=f.returns,v=(null==(i=t.dependencies.find((function(e){return e.api_name===h||e.api_name===h.replace("/","")})))?void 0:i.id)||n[h.replace("/","")]||-1,b=-1!==v?null==(o=t.dependencies.find((function(e){return e.id==v})))?void 0:o.types:{continuous:!1,generator:!1,cancel:!1};if(-1!==v&&(null==(u=null==(s=t.dependencies.find((function(e){return e.id==v})))?void 0:s.inputs)?void 0:u.length)!==d.length){c=t.dependencies.find((function(e){return e.id==v})).inputs.map((function(e){var n;return null==(n=t.components.find((function(t){return t.id===e})))?void 0:n.type}));try{c.forEach((function(e,t){"state"===e&&d.splice(t,0,{component:"state",example:null,parameter_default:null,parameter_has_default:!0,parameter_name:null,hidden:!0})}))}catch(w){console.error(w)}}l=function(e,t,n,r){return C({},e,{description:g(null==e?void 0:e.type,n),type:_(null==e?void 0:e.type,t,n,r)||""})},r[a][h]={parameters:d.map((function(e){return l(e,null==e?void 0:e.component,null==e?void 0:e.serializer,"parameter")})),returns:m.map((function(e){return l(e,null==e?void 0:e.component,null==e?void 0:e.serializer,"return")})),type:b}})))})),r}function _(e,t,n,r){switch(null==e?void 0:e.type){case"string":return"string";case"boolean":return"boolean";case"number":return"number"}return"JSONSerializable"===n||"StringSerializable"===n?"any":"ListStringSerializable"===n?"string[]":"Image"===t?"parameter"===r?"Blob | File | Buffer":"string":"FileSerializable"===n?"array"===(null==e?void 0:e.type)?"parameter"===r?"(Blob | File | Buffer)[]":"{ name: string; data: string; size?: number; is_file?: boolean; orig_name?: string}[]":"parameter"===r?"Blob | File | Buffer":"{ name: string; data: string; size?: number; is_file?: boolean; orig_name?: string}":"GallerySerializable"===n?"parameter"===r?"[(Blob | File | Buffer), (string | null)][]":"[{ name: string; data: string; size?: number; is_file?: boolean; orig_name?: string}, (string | null))][]":void 0}function g(e,t){return"GallerySerializable"===t?"array of [file, label] tuples":"ListStringSerializable"===t?"array of strings":"FileSerializable"===t?"array of files or single file":null==e?void 0:e.description}function m(e,t){var n=!0;switch(e.msg){case"send_data":return{type:"data"};case"send_hash":return{type:"hash"};case"queue_full":return{type:"update",status:{queue:n,message:ye,stage:"error",code:e.code,success:e.success}};case"heartbeat":return{type:"heartbeat"};case"unexpected_error":return{type:"unexpected_error",status:{queue:n,message:e.message,stage:"error",success:!1}};case"estimation":return{type:"update",status:{queue:n,stage:t||"pending",code:e.code,size:e.queue_size,position:e.rank,eta:e.rank_eta,success:e.success}};case"progress":return{type:"update",status:{queue:n,stage:"pending",code:e.code,progress_data:e.progress_data,success:e.success}};case"log":return{type:"log",data:e};case"process_generating":return{type:"generating",status:{queue:n,message:e.success?null:e.output.error,stage:e.success?"generating":"error",code:e.code,progress_data:e.progress_data,eta:e.average_duration},data:e.success?e.output:null};case"process_completed":return"error"in e.output?{type:"update",status:{queue:n,message:e.output.error,stage:"error",code:e.code,success:e.success}}:{type:"complete",status:{queue:n,message:e.success?void 0:e.output.error,stage:e.success?"complete":"error",code:e.code,progress_data:e.progress_data,changed_state_ids:e.success?e.output.changed_state_ids:void 0},data:e.success?e.output:null};case"process_starts":return{type:"update",status:{queue:n,stage:"pending",code:e.code,size:e.rank,position:0,success:e.success,eta:e.eta}}}return{type:"none",status:{stage:"error",queue:n}}}function v(e,t,n){for(var r,a;n.length>1;){if("string"!=typeof(r=n.shift())&&"number"!=typeof r)throw Error("Invalid key type");e=e[r]}if("string"!=typeof(a=n.shift())&&"number"!=typeof a)throw Error("Invalid key type");e[a]=t}function b(e,t){var n,r,a=null==(r=null==(n=null==t?void 0:t.dependencies)?void 0:n.find((function(t){return t.id==e})))?void 0:r.queue;return null!=a?!a:!t.enable_queue}function w(e,t){return new Promise((function(n,r){var a=new MessageChannel;a.port1.onmessage=function(e){var t=e.data;a.port1.close(),n(t)},window.parent.postMessage(e,t,[a.port2])}))}function x(e,t,n,r){var a,i,o,s,u=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("input"===r&&!u)throw Error("Invalid code path. Cannot skip state inputs for input.");if("output"===r&&u)return e;for(a=[],i=0,o=function(r){var o,s,c=t.inputs[r],l=n.find((function(e){return e.id===c}));if("state"===(null==l?void 0:l.type))return u?(e.length===t.inputs.length?(o=e[i],a.push(o),i++):a.push(null),"continue"):(i++,"continue");s=e[i],a.push(s),i++},s=0;s<t.inputs.length;s++)o(s);return a}function y(e){var t=e.match(/https:\/\/huggingface.co\/spaces\/([^/]+\/[^/]+)/);if(t)return t[1]}function k(e){var t=/[:]\s*/.exec(e),n=t&&t.index;if(n)return[e.substring(0,n),e.substring(n+t[0].length)]}function R(e,t,n){e.get(t)||e.set(t,n)}function S(e,t){e&&(e.open=!1,null==t||t.abort())}function E(e,t,n){e[t]?n.data.forEach((function(r,a){var i,o=(i=e[t][a],r.forEach((function(e){var t=D(e,3),n=t[0],r=t[1],a=t[2];i=function(e,t,n,r){var a,i,o;if(0===t.length){if("replace"===n)return r;if("append"===n)return e+r;throw Error("Unsupported action: "+n)}for(a=e,i=0;i<t.length-1;i++)a=a[t[i]];switch(o=t[t.length-1],n){case"replace":a[o]=r;break;case"append":a[o]+=r;break;case"add":Array.isArray(a)?a.splice(Number(o),0,r):a[o]=r;break;case"delete":Array.isArray(a)?a.splice(Number(o),1):delete a[o];break;default:throw Error("Unknown action: "+n)}return e}(i,r,n,a)})),i);e[t][a]=o,n.data[a]=o})):(e[t]=[],n.data.forEach((function(n,r){e[t][r]=n})))}function O(e,t,n,r,a){var o,s,h,f,d,_,g,v,y,k,R,O,j,P,A,T,I,z,U,L,N,M,B,F,J,W,H,G,X,Q,$,Z,K,V,Y,ee,te,ne,re,ae,ie,oe,se,ue,ce,le,pe,he,fe,de,_e,ge=this;try{if(_e=c(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(te=t={stage:"complete",queue:!1,time:new Date},d(C({},t,{type:"status",endpoint:V,fn_index:H})),n={},r={},"ws"===K?($&&0===$.readyState?$.addEventListener("open",(function(){$.close()})):$.close(),n={fn_index:H,session_hash:A}):(S(z,J.abort_controller),_(),n={event_id:ee},r={event_id:ee,session_hash:A,fn_index:H}),e.prev=6,P){e.next=9;break}throw Error("Could not resolve app config");case 9:if(!("event_id"in r)){e.next=12;break}return e.next=12,O(P.root+"/cancel",{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(r)});case 12:return e.next=14,O(P.root+"/reset",{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(n)});case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(6),console.warn("The `/reset` endpoint could not be called. Subsequent endpoint results may be unreliable.");case 19:case"end":return e.stop()}}),e,this,[[6,16]])}))),h=function(){return _e.apply(this,arguments)},de=c(regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(P){e.next=2;break}return e.abrupt("return");case 2:return n=t.render_id,P.components=[].concat(u(P.components.filter((function(e){return e.props.rendered_in!==n}))),u(t.components)),P.dependencies=[].concat(u(P.dependencies.filter((function(e){return e.rendered_in!==n}))),u(t.dependencies)),r=P.components.some((function(e){return"state"===e.type})),a=P.dependencies.some((function(e){return e.targets.some((function(e){return"unload"===e[1]}))})),P.connect_heartbeat=r||a,e.next=10,ie(P);case 10:d({type:"render",data:t,endpoint:V,fn_index:H});case 11:case"end":return e.stop()}}),e,this)}))),f=function(e){return de.apply(this,arguments)},d=function(e){(a||ae[e.type])&&y(e)},_=function(){for(oe=!0;ue.length>0;)ue.shift()({value:void 0,done:!0})},g=function(e){oe||(ue.length>0?ue.shift()(e):se.push(e))},v=function(e){g(function(e){return{then:function(t,n){return n(e)}}}(e)),_()},y=function(e){g({value:e,done:!1})},k=function(){return se.length>0?Promise.resolve(se.shift()):oe?Promise.resolve({value:void 0,done:!0}):new Promise((function(e){return ue.push(e)}))},R=this.options.hf_token,O=this.fetch,j=this.app_reference,P=this.config,A=this.session_hash,T=this.api_info,I=this.api_map,z=this.stream_status,U=this.pending_stream_messages,L=this.pending_diff_streams,N=this.event_callbacks,M=this.unclosed_events,B=this.post_data,F=this.options,J=this,!T)throw Error("No API found");if(!P)throw Error("Could not resolve app config");return W=function(e,t,n,r){var a,i=void 0,o=void 0,s=void 0;if("number"==typeof t?(i=t,o=e.unnamed_endpoints[i],s=r.dependencies.find((function(e){return e.id==t}))):(a=t.replace(/^\//,""),i=n[a],o=e.named_endpoints[t.trim()],s=r.dependencies.find((function(e){return e.id==n[a]}))),"number"!=typeof i)throw Error("There is no endpoint matching that name of fn_index matching that number.");return{fn_index:i,endpoint_info:o,dependency:s}}(T,e,I,P),H=W.fn_index,G=W.endpoint_info,X=W.dependency,Q=qe(t,T),$=void 0,Z=void 0,K=P.protocol||"ws",V="number"==typeof e?"/predict":e,Y=void 0,ee=null,te=!1,ne={},re="undefined"!=typeof window&&"undefined"!=typeof document?new URLSearchParams(window.location.search).toString():"",ae=(null==(o=null==F?void 0:F.events)?void 0:o.reduce((function(e,t){return e[t]=!0,e}),{}))||{},fe=c(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ge._resolve_hearbeat(t);case 2:case"end":return e.stop()}}),e,ge)}))),ie=function(e){return fe.apply(this,arguments)},this.handle_blob(P.root,Q,G).then((he=c(regeneratorRuntime.mark((function e(t){var a,i,o,s,u,h,g,v,y,k,O,T;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=x(t,X,P.components,"input",!0),Y={data:i||[],event_data:n,fn_index:H,trigger_id:r},!b(H,P)){e.next=7;break}d({type:"status",endpoint:V,stage:"pending",queue:!1,fn_index:H,time:new Date}),B(P.root+"/run"+(V.startsWith("/")?V:"/"+V)+(re?"?"+re:""),C({},Y,{session_hash:A})).then((function(e){var t=D(e,2),a=t[0],i=t[1],o=a.data;200==i?(d({type:"data",endpoint:V,fn_index:H,data:x(o,X,P.components,"output",F.with_null_state),time:new Date,event_data:n,trigger_id:r}),a.render_config&&f(a.render_config),d({type:"status",endpoint:V,fn_index:H,stage:"complete",eta:a.average_duration,queue:!1,time:new Date})):d({type:"status",stage:"error",endpoint:V,fn_index:H,message:a.error,queue:!1,time:new Date})})).catch((function(e){d({type:"status",stage:"error",message:e.message,endpoint:V,fn_index:H,queue:!1,time:new Date})})),e.next=34;break;case 7:if("ws"!=K){e.next=22;break}return e.next=10,q(j,R);case 10:o=e.sent,s=o.ws_protocol,u=o.host,d({type:"status",stage:"pending",queue:!0,endpoint:V,fn_index:H,time:new Date}),h=new URL(s+"://"+p(u,P.path,!0)+"/queue/join"+(re?"?"+re:"")),ge.jwt&&h.searchParams.set("__sign",ge.jwt),($=new WebSocket(h)).onclose=function(e){e.wasClean||d({type:"status",stage:"error",broken:!0,message:ke,queue:!0,endpoint:V,fn_index:H,time:new Date})},$.onmessage=function(e){var t=m(JSON.parse(e.data),ne[H]),a=t.type,i=t.status,o=t.data;if("update"===a&&i&&!te)d(C({type:"status",endpoint:V,fn_index:H,time:new Date},i)),"error"===i.stage&&$.close();else{if("hash"===a)return void $.send(JSON.stringify({fn_index:H,session_hash:A}));"data"===a?$.send(JSON.stringify(C({},Y,{session_hash:A}))):"complete"===a?te=i:"log"===a?d({type:"log",log:o.log,level:o.level,endpoint:V,fn_index:H}):"generating"===a&&d(C({type:"status",time:new Date},i,{stage:null==i?void 0:i.stage,queue:!0,endpoint:V,fn_index:H}))}o&&(d({type:"data",time:new Date,data:x(o.data,X,P.components,"output",F.with_null_state),endpoint:V,fn_index:H,event_data:n,trigger_id:r}),te&&(d(C({type:"status",time:new Date},te,{stage:null==i?void 0:i.stage,queue:!0,endpoint:V,fn_index:H})),$.close()))},l(P.version||"2.0.0","3.6")<0&&addEventListener("open",(function(){return $.send(JSON.stringify({hash:A}))})),e.next=34;break;case 22:if("sse"!=K){e.next=33;break}if(d({type:"status",stage:"pending",queue:!0,endpoint:V,fn_index:H,time:new Date}),g=new URLSearchParams({fn_index:H.toString(),session_hash:A}).toString(),v=new URL(P.root+"/queue/join?"+(re?re+"&":"")+g),ge.jwt&&v.searchParams.set("__sign",ge.jwt),Z=ge.stream(v)){e.next=30;break}return e.abrupt("return",Promise.reject(Error("Cannot connect to SSE endpoint: "+v.toString())));case 30:Z.onmessage=function(){var e=c(regeneratorRuntime.mark((function e(t){var a,i,o,s,u,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=JSON.parse(t.data),i=m(a,ne[H]),o=i.type,s=i.status,u=i.data,"update"!==o||!s||te){e.next=7;break}d(C({type:"status",endpoint:V,fn_index:H,time:new Date},s)),"error"===s.stage&&(null==Z||Z.close(),_()),e.next=19;break;case 7:if("data"!==o){e.next=18;break}return ee=a.event_id,e.next=11,B(P.root+"/queue/data",C({},Y,{session_hash:A,event_id:ee}));case 11:c=e.sent,(l=D(c,2))[0],200!==l[1]&&(d({type:"status",stage:"error",message:ke,queue:!0,endpoint:V,fn_index:H,time:new Date}),null==Z||Z.close(),_()),e.next=19;break;case 18:"complete"===o?te=s:"log"===o?d({type:"log",log:u.log,level:u.level,endpoint:V,fn_index:H}):"generating"===o&&d(C({type:"status",time:new Date},s,{stage:null==s?void 0:s.stage,queue:!0,endpoint:V,fn_index:H}));case 19:u&&(d({type:"data",time:new Date,data:x(u.data,X,P.components,"output",F.with_null_state),endpoint:V,fn_index:H,event_data:n,trigger_id:r}),te&&(d(C({type:"status",time:new Date},te,{stage:null==s?void 0:s.stage,queue:!0,endpoint:V,fn_index:H})),null==Z||Z.close(),_()));case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),e.next=34;break;case 33:"sse_v1"!=K&&"sse_v2"!=K&&"sse_v2.1"!=K&&"sse_v3"!=K||(d({type:"status",stage:"pending",queue:!0,endpoint:V,fn_index:H,time:new Date}),y="","undefined"!=typeof window&&"undefined"!=typeof document&&(y=null==(a=null==window?void 0:window.location)?void 0:a.hostname),k=y.includes(".dev.")?"https://moon-"+y.split(".")[1]+".dev.spaces.huggingface.tech":"https://huggingface.co",O="undefined"!=typeof window&&"undefined"!=typeof document&&window.parent!=window,T=X.zerogpu&&P.space_id,(O&&T?w("zerogpu-headers",k):Promise.resolve(null)).then((function(e){return B(P.root+"/queue/join?"+re,C({},Y,{session_hash:A}),e)})).then(function(){var e=c(regeneratorRuntime.mark((function e(t){var n,r=D(t,2),a=r[0],i=r[1];return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(503!==i){e.next=4;break}d({type:"status",stage:"error",message:ye,queue:!0,endpoint:V,fn_index:H,time:new Date}),e.next=16;break;case 4:if(200===i){e.next=8;break}d({type:"status",stage:"error",message:ke,queue:!0,endpoint:V,fn_index:H,time:new Date}),e.next=16;break;case 8:if(ee=a.event_id,n=function(){var e=c(regeneratorRuntime.mark((function e(t){var n,r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=m(t,ne[H]),r=n.type,a=n.status,i=n.data,"heartbeat"!=r){e.next=4;break}return e.abrupt("return");case 4:if("update"!==r||!a||te){e.next=8;break}d(C({type:"status",endpoint:V,fn_index:H,time:new Date},a)),e.next=23;break;case 8:if("complete"!==r){e.next=12;break}te=a,e.next=23;break;case 12:if("unexpected_error"!=r){e.next=17;break}console.error("Unexpected error",null==a?void 0:a.message),d({type:"status",stage:"error",message:(null==a?void 0:a.message)||"An Unexpected Error Occurred!",queue:!0,endpoint:V,fn_index:H,time:new Date}),e.next=23;break;case 17:if("log"!==r){e.next=22;break}return d({type:"log",log:i.log,level:i.level,endpoint:V,fn_index:H}),e.abrupt("return");case 22:"generating"===r&&(d(C({type:"status",time:new Date},a,{stage:null==a?void 0:a.stage,queue:!0,endpoint:V,fn_index:H})),i&&["sse_v2","sse_v2.1","sse_v3"].includes(K)&&E(L,ee,i));case 23:if(!i){e.next=29;break}if(d({type:"data",time:new Date,data:x(i.data,X,P.components,"output",F.with_null_state),endpoint:V,fn_index:H}),!i.render_config){e.next=28;break}return e.next=28,f(i.render_config);case 28:te&&d(C({type:"status",time:new Date},te,{stage:null==a?void 0:a.stage,queue:!0,endpoint:V,fn_index:H}));case 29:"complete"!==(null==a?void 0:a.stage)&&"error"!==(null==a?void 0:a.stage)||(N[ee]&&delete N[ee],ee in L&&delete L[ee]),e.next=37;break;case 32:e.prev=32,e.t0=e.catch(0),console.error("Unexpected client exception",e.t0),d({type:"status",stage:"error",message:"An Unexpected Error Occurred!",queue:!0,endpoint:V,fn_index:H,time:new Date}),["sse_v2","sse_v2.1","sse_v3"].includes(K)&&(S(z,J.abort_controller),z.open=!1,_());case 37:case"end":return e.stop()}}),e,this,[[0,32]])})));return function(t){return e.apply(this,arguments)}}(),ee in U&&(U[ee].forEach((function(e){return n(e)})),delete U[ee]),N[ee]=n,M.add(ee),z.open){e.next=16;break}return e.next=16,ge.open_stream();case 16:case"end":return e.stop()}}),e,ge)})));return function(t){return e.apply(this,arguments)}}()));case 34:case"end":return e.stop()}}),e,ge)}))),function(e){return he.apply(this,arguments)})),oe=!1,se=[],ue=[],i(s={},Symbol.asyncIterator,(function(){return ce})),i(s,"next",k),i(s,"throw",(pe=c(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v(t),e.abrupt("return",k());case 2:case"end":return e.stop()}}),e,ge)}))),function(e){return pe.apply(this,arguments)})),i(s,"return",(le=c(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _(),e.abrupt("return",k());case 2:case"end":return e.stop()}}),e,ge)}))),function(){return le.apply(this,arguments)})),i(s,"cancel",h),ce=s}catch(me){throw console.error("Submit function encountered an error:",me),me}}var j,P,D,C,A,T,I,z,U,q,L,N,M,B,F,J,W,H,G,X,Q,$,Z,K,V,Y,ee,te,ne,re,ae,ie,oe,se,ue,ce,le,pe,he,fe,de,_e,ge,me,ve,be,we,xe,ye,ke,Re,Se,Ee,Oe,je,Pe,De,Ce,Ae,Te,Ie,ze,Ue,qe,Le,Ne,Me,Be,Fe,Je,We,He,Ge,Xe,Qe,$e,Ze,Ke,Ve,Ye,et,tt,nt,rt,at,it,ot,st,ut,ct,lt,pt,ht,ft,dt,_t,gt;Object.defineProperty(t,"__esModule",{value:!0}),j=function(){function e(e,t){var n,r;for(n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),P=function(){function e(e){this.value=e}function t(t){function n(a,i){var o,s;try{(s=(o=t[a](i)).value)instanceof e?Promise.resolve(s.value).then((function(e){n("next",e)}),(function(e){n("throw",e)})):r(o.done?"return":"normal",o.value)}catch(u){r("throw",u)}}function r(e,t){switch(e){case"return":a.resolve({value:t,done:!0});break;case"throw":a.reject(t);break;default:a.resolve({value:t,done:!1})}(a=a.next)?n(a.key,a.arg):i=null}var a,i;this._invoke=function(e,t){return new Promise((function(r,o){var s={key:e,arg:t,resolve:r,reject:o,next:null};i?i=i.next=s:(a=i=s,n(e,t))}))},"function"!=typeof t.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)},{wrap:function(e){return function(){return new t(e.apply(this,arguments))}},await:function(t){return new e(t)}}}(),D=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n,r,a=[],i=!0,o=!1,s=void 0;try{for(n=e[Symbol.iterator]();!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(u){o=!0,s=u}finally{try{!i&&n.return&&n.return()}finally{if(o)throw s}}return a}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},C=Object.assign||function(e){var t,n,r;for(t=1;t<arguments.length;t++)for(r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e},A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},He=c(regeneratorRuntime.mark((function e(t,n,r){var a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("https://huggingface.co/api/spaces/"+t+"/jwt",{headers:C({Authorization:"Bearer "+n},r?{Cookie:r}:{})});case 3:return a=e.sent,e.next=6,a.json();case 6:return i=e.sent.token,e.abrupt("return",i||!1);case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e,this,[[0,10]])}))),T=function(e,t,n){return He.apply(this,arguments)},Ge=c(regeneratorRuntime.mark((function e(t){var n,r,a,i,o,s,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=this.options.hf_token?{Authorization:"Bearer "+this.options.hf_token}:{})["Content-Type"]="application/json","undefined"==typeof window||!window.gradio_config||"http://localhost:9876"===location.origin||window.gradio_config.dev_mode){e.next=10;break}return a=window.gradio_config.root,i=window.gradio_config,o=p(t,i.root,!1),i.root=o,e.abrupt("return",C({},i,{path:a}));case 10:if(!t){e.next=34;break}return s=Ue(t,me),e.next=14,this.fetch(s,{headers:r,credentials:"include"});case 14:if(401!==(null==(u=e.sent)?void 0:u.status)||this.options.auth){e.next=19;break}throw Error(Pe);case 19:if(401!==(null==u?void 0:u.status)||!this.options.auth){e.next=21;break}throw Error(je);case 21:if(200!==(null==u?void 0:u.status)){e.next=31;break}return e.next=24,u.json();case 24:return(c=e.sent).path=c.path||"",c.root=t,null==(n=c.dependencies)||n.forEach((function(e,t){void 0===e.id&&(e.id=t)})),e.abrupt("return",c);case 31:if(401!==(null==u?void 0:u.status)){e.next=33;break}throw Error(Oe);case 33:case 34:throw Error(Re);case 35:case"end":return e.stop()}}),e,this)}))),I=function(e){return Ge.apply(this,arguments)},Xe=c(regeneratorRuntime.mark((function e(){var t,n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,q(this.app_reference,this.options.hf_token);case 2:if(t=e.sent,n=t.http_protocol,r=t.host,e.prev=5,!this.options.auth){e.next=11;break}return e.next=9,U(n,r,this.options.auth,this.fetch,this.options.hf_token);case 9:(a=e.sent)&&this.set_cookies(a);case 11:e.next=16;break;case 13:throw e.prev=13,e.t0=e.catch(5),Error(e.t0.message);case 16:case"end":return e.stop()}}),e,this,[[5,13]])}))),z=function(){return Xe.apply(this,arguments)},Qe=c(regeneratorRuntime.mark((function e(t,n,r,a,i){var o,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(o=new FormData).append("username",null==r?void 0:r[0]),o.append("password",null==r?void 0:r[1]),s={},i&&(s.Authorization="Bearer "+i),e.next=7,a(t+"//"+n+"/"+ge,{headers:s,method:"POST",body:o,credentials:"include"});case 7:if(200!==(u=e.sent).status){e.next=12;break}return e.abrupt("return",u.headers.get("set-cookie"));case 12:if(401!==u.status){e.next=16;break}throw Error(je);case 16:throw Error(Ee);case 17:case"end":return e.stop()}}),e,this)}))),U=function(e,t,n,r,a){return Qe.apply(this,arguments)},$e=c(regeneratorRuntime.mark((function e(t,n){var r,a,i,o,s,u,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r={},n&&(r.Authorization="Bearer "+n),a=t.trim().replace(/\/$/,""),!Ie.test(a)){e.next=17;break}return e.prev=4,e.next=7,fetch("https://huggingface.co/api/spaces/"+a+"/"+de,{headers:r});case 7:return i=e.sent,e.next=10,i.json();case 10:return o=e.sent.host,e.abrupt("return",C({space_id:t},f(o)));case 14:throw e.prev=14,e.t0=e.catch(4),Error(Ee);case 17:if(!ze.test(a)){e.next=20;break}return s=f(a),u=s.ws_protocol,c=s.http_protocol,l=s.host,e.abrupt("return",{space_id:l.replace(".hf.space",""),ws_protocol:u,http_protocol:c,host:l});case 20:return e.abrupt("return",C({space_id:!1},f(a)));case 21:case"end":return e.stop()}}),e,this,[[4,14]])}))),q=function(e,t){return $e.apply(this,arguments)},Ze=c(regeneratorRuntime.mark((function e(){var t,n,r,a,i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.api_info){e.next=2;break}return e.abrupt("return",this.api_info);case 2:if(t=this.options.hf_token,n=this.config,r={"Content-Type":"application/json"},t&&(r.Authorization="Bearer "+t),n){e.next=8;break}return e.abrupt("return");case 8:if(e.prev=8,a=void 0,!(l((null==n?void 0:n.version)||"2.0.0","3.30")<0)){e.next=16;break}return e.next=13,this.fetch(xe,{method:"POST",body:JSON.stringify({serialize:!1,config:JSON.stringify(n)}),headers:r,credentials:"include"});case 13:a=e.sent,e.next=20;break;case 16:return i=Ue(n.root,ve),e.next=19,this.fetch(i,{headers:r,credentials:"include"});case 19:a=e.sent;case 20:if(a.ok){e.next=22;break}throw Error(ke);case 22:return e.next=24,a.json();case 24:return"api"in(o=e.sent)&&(o=o.api),o.named_endpoints["/predict"]&&!o.unnamed_endpoints[0]&&(o.unnamed_endpoints[0]=o.named_endpoints["/predict"]),e.abrupt("return",d(o,n,this.api_map));case 30:e.prev=30,e.t0=e.catch(8),e.t0.message;case 33:case"end":return e.stop()}}),e,this,[[8,30]])}))),L=function(){return Ze.apply(this,arguments)},Ke=c(regeneratorRuntime.mark((function e(t,n,r){var a,i,o,s,c,l,p,h,f=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i={},(null==(a=null==this?void 0:this.options)?void 0:a.hf_token)&&(i.Authorization="Bearer "+this.options.hf_token),o=1e3,s=[],c=void 0,l=regeneratorRuntime.mark((function e(a){var l,p,h,d,_;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=n.slice(a,a+o),p=new FormData,l.forEach((function(e){p.append("files",e)})),e.prev=3,h=r?t+"/"+_e+"?upload_id="+r:t+"/"+_e,e.next=7,f.fetch(h,{method:"POST",body:p,headers:i,credentials:"include"});case 7:c=e.sent,e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(3),Error(ke+e.t0.message);case 13:if(c.ok){e.next=18;break}return e.next=16,c.text();case 16:return d=e.sent,e.abrupt("return",{v:{error:"HTTP "+c.status+": "+d}});case 18:return e.next=20,c.json();case 20:(_=e.sent)&&s.push.apply(s,u(_));case 22:case"end":return e.stop()}}),e,f,[[3,10]])})),p=0;case 7:if(!(p<n.length)){e.next=15;break}return e.delegateYield(l(p),"t0",9);case 9:if("object"!==(void 0===(h=e.t0)?"undefined":A(h))){e.next=12;break}return e.abrupt("return",h.v);case 12:p+=o,e.next=7;break;case 15:return e.abrupt("return",{files:s});case 16:case"end":return e.stop()}}),e,this)}))),N=function(e,t,n){return Ke.apply(this,arguments)},Ve=c(regeneratorRuntime.mark((function e(t,n,r,a){var i,o,s=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=(Array.isArray(t)?t:[t]).map((function(e){return e.blob})),!(o=i.filter((function(e){return e.size>(a||1/0)}))).length){e.next=4;break}throw Error("File size exceeds the maximum allowed size of "+a+" bytes: "+o.map((function(e){return e.name})).join(", "));case 4:return e.t0=Promise,e.next=7,this.upload_files(n,i,r).then(function(){var e=c(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.error){e.next=4;break}throw Error(r.error);case 4:if(!r.files){e.next=6;break}return e.abrupt("return",r.files.map((function(e,r){return new Le(C({},t[r],{path:e,url:n+"/file="+e}))})));case 6:return e.abrupt("return",[]);case 7:case"end":return e.stop()}}),e,s)})));return function(t){return e.apply(this,arguments)}}());case 7:return e.t1=e.sent,e.next=10,e.t0.all.call(e.t0,e.t1);case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),e,this)}))),M=function(e,t,n,r){return Ve.apply(this,arguments)},Ye=c(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.map((function(e){return new Le({path:e.name,orig_name:e.name,blob:e,size:e.size,mime_type:e.type,is_stream:n})})));case 1:case"end":return e.stop()}}),e,this)}))),B=function(e,t){return Ye.apply(this,arguments)},et=c(regeneratorRuntime.mark((function e(t){var n,r,a,i,o,s,l,p,h,f,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,_=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],g=this,m=arguments.length>3&&void 0!==arguments[3]&&arguments[3],v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.isArray(t)){e.next=7;break}return n=[],e.next=4,Promise.all(t.map(function(){var e=c(regeneratorRuntime.mark((function e(r,a){var i,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(o=_.slice()).push(a+""),e.next=4,F(t[a],m?(null==(i=null==v?void 0:v.parameters[a])?void 0:i.component)||void 0:d,o,!1,v);case 4:s=e.sent,n=n.concat(s);case 6:case"end":return e.stop()}}),e,g)})));return function(t,n){return e.apply(this,arguments)}}()));case 4:return e.abrupt("return",n);case 7:if(!(globalThis.Buffer&&t instanceof globalThis.Buffer||t instanceof Blob)){e.next=11;break}return e.abrupt("return",[{path:_,blob:new Blob([t]),type:d}]);case 11:if("object"!==(void 0===t?"undefined":A(t))||null===t){e.next=45;break}r=[],a=!0,i=!1,o=void 0,e.prev=16,s=Object.keys(t)[Symbol.iterator]();case 18:if(a=(l=s.next()).done){e.next=30;break}return p=l.value,h=[].concat(u(_),[p]),f=t[p],e.t0=r,e.next=25,F(f,void 0,h,!1,v);case 25:e.t1=e.sent,r=e.t0.concat.call(e.t0,e.t1);case 27:a=!0,e.next=18;break;case 30:e.next=36;break;case 32:e.prev=32,e.t2=e.catch(16),i=!0,o=e.t2;case 36:e.prev=36,e.prev=37,!a&&s.return&&s.return();case 39:if(e.prev=39,!i){e.next=42;break}throw o;case 42:return e.finish(39);case 43:return e.finish(36);case 44:return e.abrupt("return",r);case 45:return e.abrupt("return",[]);case 46:case"end":return e.stop()}}),e,this,[[16,32,36,44],[37,,39,43]])}))),F=function(e){return et.apply(this,arguments)},tt=c(regeneratorRuntime.mark((function e(t,n,r){var a,i,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this,e.next=3,W(a,n);case 3:return e.next=5,F(n,void 0,[],!0,r);case 5:return i=e.sent,e.next=8,Promise.all(i.map(function(){var e=c(regeneratorRuntime.mark((function e(n){var r,i,s=n.path,u=n.blob,c=n.type;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u){e.next=2;break}return e.abrupt("return",{path:s,type:c});case 2:return e.next=4,a.upload_files(t,[u]);case 4:return r=e.sent,i=r.files&&r.files[0],e.abrupt("return",{path:s,file_url:i,type:c,name:u instanceof File?null==u?void 0:u.name:void 0});case 7:case"end":return e.stop()}}),e,o)})));return function(t){return e.apply(this,arguments)}}()));case 8:return e.sent.forEach((function(e){var t,r=e.path,a=e.file_url,i=e.type,o=e.name;"Gallery"===i?v(n,a,r):a&&(t=new Le({path:a,orig_name:o}),v(n,t,r))})),e.abrupt("return",n);case 11:case"end":return e.stop()}}),e,this)}))),J=function(e,t,n){return tt.apply(this,arguments)},nt=c(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((null==(r=t.config)?void 0:r.root)||(null==(a=t.config)?void 0:a.root_url)){e.next=3;break}throw Error(Ce);case 3:return e.next=5,H(t,n);case 5:case"end":return e.stop()}}),e,this)}))),W=function(e,t){return nt.apply(this,arguments)},rt=c(regeneratorRuntime.mark((function e(t,n){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=regeneratorRuntime.keys(n);case 1:if((e.t1=e.t0()).done){e.next=13;break}if(r=e.t1.value,!(n[r]instanceof Ne)){e.next=8;break}return e.next=6,G(t,n,r);case 6:e.next=11;break;case 8:if("object"!==A(n[r])||null===n[r]){e.next=11;break}return e.next=11,H(t,n[r],[].concat(u(a),[r]));case 11:e.next=1;break;case 13:case"end":return e.stop()}}),e,this)}))),H=function(e,t){return rt.apply(this,arguments)},at=c(regeneratorRuntime.mark((function t(r,a,i){var o,s,u,c,l,p,h,f,d,_,g,m;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(u=a[i],c=(null==(o=r.config)?void 0:o.root)||(null==(s=r.config)?void 0:s.root_url)){t.next=4;break}throw Error(Ce);case 4:if(t.prev=4,l=void 0,p=void 0,void 0===e||!e.versions||!e.versions.node){t.next=20;break}return t.next=10,n.e(3).then(n.t.bind(null,723,7));case 10:return h=t.sent,t.next=13,n.e(8).then(n.t.bind(null,657,7));case 13:return f=t.sent,p=f.resolve(e.cwd()),t.next=17,h.readFile(p);case 17:l=t.sent,t.next=21;break;case 20:throw Error(De);case 21:return d=new Blob([l],{type:"application/octet-stream"}),t.next=24,r.upload_files(c,[d]);case 24:_=t.sent,(g=_.files&&_.files[0])&&(m=new Le({path:g,orig_name:u.meta.name||""}),a[i]=m),t.next=32;break;case 29:t.prev=29,t.t0=t.catch(4),console.error(Ae,t.t0);case 32:case"end":return t.stop()}}),t,this,[[4,29]])}))),G=function(e,t,n){return at.apply(this,arguments)},it=c(regeneratorRuntime.mark((function e(t,n,r){var a,i,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={"Content-Type":"application/json"},this.options.hf_token&&(a.Authorization="Bearer "+this.options.hf_token),e.prev=2,e.next=5,this.fetch(t,{method:"POST",body:JSON.stringify(n),headers:C({},a,r),credentials:"include"});case 5:i=e.sent,e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(2),e.abrupt("return",[{error:ke},500]);case 11:return o=void 0,s=void 0,e.prev=13,e.next=16,i.json();case 16:o=e.sent,s=i.status,e.next=24;break;case 20:e.prev=20,e.t1=e.catch(13),o={error:"Could not parse server response: "+e.t1},s=500;case 24:return e.abrupt("return",[o,s]);case 25:case"end":return e.stop()}}),e,this,[[2,8],[13,20]])}))),X=function(e,t,n){return it.apply(this,arguments)},ot=c(regeneratorRuntime.mark((function e(t,n){var r,a,i,s,u=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!1,a=!1,i=void 0,this.config){e.next=5;break}throw Error("Could not resolve app config");case 5:if("number"==typeof t?i=this.config.dependencies.find((function(e){return e.id==t})):(s=t.replace(/^\//,""),i=this.config.dependencies.find((function(e){return e.id==u.api_map[s]}))),!(null==i?void 0:i.types.continuous)){e.next=8;break}throw Error("Cannot call predict on this function as it may run forever. Use submit instead");case 8:return e.abrupt("return",new Promise(function(){var e=c(regeneratorRuntime.mark((function e(i,s){var c,l,p,h,f,d,_,g,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c=u.submit(t,n,null,null,!0),l=void 0,p=!0,h=!1,f=void 0,e.prev=5,d=o(c);case 7:return e.next=9,d.next();case 9:return _=e.sent,p=_.done,e.next=13,_.value;case 13:if(g=e.sent,p){e.next=21;break}"data"===(m=g).type&&(a&&i(l),r=!0,l=m),"status"===m.type&&("error"===m.stage&&s(m),"complete"===m.stage&&(a=!0,r&&i(l)));case 18:p=!0,e.next=7;break;case 21:e.next=27;break;case 23:e.prev=23,e.t0=e.catch(5),h=!0,f=e.t0;case 27:if(e.prev=27,e.prev=28,p||!d.return){e.next=32;break}return e.next=32,d.return();case 32:if(e.prev=32,!h){e.next=35;break}throw f;case 35:return e.finish(32);case 36:return e.finish(27);case 37:case"end":return e.stop()}}),e,u,[[5,23,27,37],[28,,32,36]])})));return function(t,n){return e.apply(this,arguments)}}()));case 9:case"end":return e.stop()}}),e,this)}))),Q=function(e,t){return ot.apply(this,arguments)},st=c(regeneratorRuntime.mark((function e(t,n,r){var a,i,o,s,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="subdomain"===n?"https://huggingface.co/api/spaces/by-subdomain/"+t:"https://huggingface.co/api/spaces/"+t,i=void 0,o=void 0,e.prev=3,e.next=6,fetch(a);case 6:if(i=e.sent,200===(o=i.status)){e.next=10;break}throw Error();case 10:return e.next=12,i.json();case 12:i=e.sent,e.next=19;break;case 15:return e.prev=15,e.t0=e.catch(3),r({status:"error",load_status:"error",message:Se,detail:"NOT_FOUND"}),e.abrupt("return");case 19:if(i&&200===o){e.next=21;break}return e.abrupt("return");case 21:u=(s=i).runtime.stage,c=s.id,e.t1=u,e.next="STOPPED"===e.t1||"SLEEPING"===e.t1?25:"PAUSED"===e.t1?28:"RUNNING"===e.t1||"RUNNING_BUILDING"===e.t1?36:"BUILDING"===e.t1?38:41;break;case 25:return r({status:"sleeping",load_status:"pending",message:"Space is asleep. Waking it up...",detail:u}),setTimeout((function(){$(t,n,r)}),1e3),e.abrupt("break",49);case 28:return e.t2=r,e.t3=u,e.next=32,Z(c);case 32:return e.t4=e.sent,e.t5={status:"paused",load_status:"error",message:"This space has been paused by the author. If you would like to try this demo, consider duplicating the space.",detail:e.t3,discussions_enabled:e.t4},(0,e.t2)(e.t5),e.abrupt("break",49);case 36:return r({status:"running",load_status:"complete",message:"",detail:u}),e.abrupt("break",49);case 38:return r({status:"building",load_status:"pending",message:"Space is building...",detail:u}),setTimeout((function(){$(t,n,r)}),1e3),e.abrupt("break",49);case 41:return e.t6=r,e.t7=u,e.next=45,Z(c);case 45:return e.t8=e.sent,e.t9={status:"space_error",load_status:"error",message:"This space is experiencing an issue.",detail:e.t7,discussions_enabled:e.t8},(0,e.t6)(e.t9),e.abrupt("break",49);case 49:case"end":return e.stop()}}),e,this,[[3,15]])}))),$=function(e,t,n){return st.apply(this,arguments)},ut=c(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("https://huggingface.co/api/spaces/"+t+"/discussions",{method:"HEAD"});case 3:if(n=e.sent,r=n.headers.get("x-error-message"),!(!n.ok||r&&Be.test(r))){e.next=7;break}return e.abrupt("return",!1);case 7:return e.abrupt("return",!0);case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e,this,[[0,10]])}))),Z=function(e){return ut.apply(this,arguments)},ct=c(regeneratorRuntime.mark((function e(t,n){var r,a,i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={},n&&(r.Authorization="Bearer "+n),e.prev=2,e.next=5,fetch("https://huggingface.co/api/spaces/"+t+"/"+be,{headers:r});case 5:if(200===(a=e.sent).status){e.next=8;break}throw Error("Space hardware could not be obtained.");case 8:return e.next=10,a.json();case 10:return i=e.sent,o=i.hardware,e.abrupt("return",o.current);case 15:throw e.prev=15,e.t0=e.catch(2),Error(e.t0.message);case 18:case"end":return e.stop()}}),e,this,[[2,15]])}))),K=function(e,t){return ct.apply(this,arguments)},lt=c(regeneratorRuntime.mark((function e(t,n,r){var a,i,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={},r&&(a.Authorization="Bearer "+r),i={seconds:n},e.prev=3,e.next=6,fetch("https://huggingface.co/api/spaces/"+t+"/"+we,{method:"POST",headers:C({"Content-Type":"application/json"},a),body:JSON.stringify(i)});case 6:if(200===(o=e.sent).status){e.next=9;break}throw Error("Could not set sleep timeout on duplicated Space. Please visit *ADD HF LINK TO SETTINGS* to set a timeout manually to reduce billing charges.");case 9:return e.next=11,o.json();case 11:return s=e.sent,e.abrupt("return",s);case 15:throw e.prev=15,e.t0=e.catch(3),Error(e.t0.message);case 18:case"end":return e.stop()}}),e,this,[[3,15]])}))),V=function(e,t,n){return lt.apply(this,arguments)},pt=c(regeneratorRuntime.mark((function e(t,n){var r,a,i,o,s,u,c,l,p,h,f,d,_,g,m,v,b,w,x;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.hf_token,a=n.private,i=n.hardware,o=n.timeout,s=n.auth,!i||Fe.includes(i)){e.next=3;break}throw Error("Invalid hardware type provided. Valid types are: "+Fe.map((function(e){return'"'+e+'"'})).join(",")+".");case 3:return e.next=5,q(t,r);case 5:if(u=e.sent,c=u.http_protocol,l=u.host,p=null,!s){e.next=14;break}return e.next=12,U(c,l,s,fetch);case 12:(h=e.sent)&&(p=Te(h));case 14:return f=C({Authorization:"Bearer "+r,"Content-Type":"application/json"},p?{Cookie:p.join("; ")}:{}),e.next=17,fetch("https://huggingface.co/api/whoami-v2",{headers:f});case 17:return e.next=19,e.sent.json();case 19:if(d=e.sent.name,_=t.split("/")[1],g={repository:d+"/"+_},a&&(g.private=!0),m=void 0,e.prev=24,i){e.next=29;break}return e.next=28,K(t,r);case 28:m=e.sent;case 29:e.next=34;break;case 31:throw e.prev=31,e.t0=e.catch(24),Error(Ee+e.t0.message);case 34:return v=i||m||"cpu-basic",g.hardware=v,e.prev=36,e.next=39,fetch("https://huggingface.co/api/spaces/"+t+"/duplicate",{method:"POST",headers:f,body:JSON.stringify(g)});case 39:if(409!==(b=e.sent).status){e.next=54;break}return e.prev=41,e.next=44,We.connect(d+"/"+_,n);case 44:return w=e.sent,e.abrupt("return",w);case 48:throw e.prev=48,e.t1=e.catch(41),console.error("Failed to connect Client instance:",e.t1),e.t1;case 52:e.next=56;break;case 54:if(200===b.status){e.next=56;break}throw Error(b.statusText);case 56:return e.next=58,b.json();case 58:return x=e.sent,e.next=61,V(d+"/"+_,o||300,r);case 61:return e.next=63,We.connect(y(x.url),n);case 63:return e.abrupt("return",e.sent);case 66:throw e.prev=66,e.t2=e.catch(36),Error(e.t2);case 69:case"end":return e.stop()}}),e,this,[[24,31],[36,66],[41,48]])}))),Y=function(e,t){return pt.apply(this,arguments)},ht=P.wrap(regeneratorRuntime.mark((function e(t,n){var r,a,i,o,s,u,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.body){e.next=2;break}return e.abrupt("return");case 2:p=t.body,h=new TextDecoderStream,f=new Je({allowCR:!0}),r=p.pipeThrough(h).pipeThrough(f),a=void 0,i=r.getReader(),o=void 0;case 5:if(!n||!n.aborted){e.next=7;break}return e.abrupt("return",i.cancel());case 7:return e.next=9,P.await(i.read());case 9:if(!(a=e.sent).done){e.next=12;break}return e.abrupt("return");case 12:if(a.value){e.next=18;break}if(!o){e.next=16;break}return e.next=16,o;case 16:return o=void 0,e.abrupt("continue",22);case 18:if(s=k(a.value)||[],u=D(s,2),c=u[0],l=u[1],c){e.next=21;break}return e.abrupt("continue",22);case 21:"data"===c?(o||(o={}),o[c]=o[c]?o[c]+"\n"+l:l):"event"===c?(o||(o={}),o[c]=l):"id"===c?(o||(o={}),o[c]=+l||l):"retry"===c&&(o||(o={}),o[c]=+l||void 0);case 22:e.next=5;break;case 24:case"end":return e.stop()}var p,h,f}),e,this)}))),ee=function(e,t){return ht.apply(this,arguments)},ft=c(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R((r=new Request(t,n)).headers,"Accept","text/event-stream"),R(r.headers,"Content-Type","application/json"),e.next=5,fetch(r);case 5:if((a=e.sent).ok){e.next=8;break}throw a;case 8:return e.abrupt("return",ee(a,r.signal));case 9:case"end":return e.stop()}}),e,this)}))),te=function(e,t){return ft.apply(this,arguments)},dt=c(regeneratorRuntime.mark((function e(){var t,n,r,a,i,o,s,u,l,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.event_callbacks,n=this.unclosed_events,r=this.pending_stream_messages,a=this.stream_status,i=this.config,o=this.jwt,s=this,i){e.next=4;break}throw Error("Could not resolve app config");case 4:if(a.open=!0,u=null,l=new URLSearchParams({session_hash:this.session_hash}).toString(),p=new URL(i.root+"/queue/data?"+l),o&&p.searchParams.set("__sign",o),u=this.stream(p)){e.next=13;break}return console.warn("Cannot connect to SSE endpoint: "+p.toString()),e.abrupt("return");case 13:u.onmessage=function(){var e=c(regeneratorRuntime.mark((function e(o){var u,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("close_stream"!==(u=JSON.parse(o.data)).msg){e.next=4;break}return S(a,s.abort_controller),e.abrupt("return");case 4:if(c=u.event_id){e.next=10;break}return e.next=8,Promise.all(Object.keys(t).map((function(e){return t[e](u)})));case 8:e.next=11;break;case 10:t[c]&&i?("process_completed"===u.msg&&["sse","sse_v1","sse_v2","sse_v2.1","sse_v3"].includes(i.protocol)&&n.delete(c),l=t[c],"undefined"!=typeof window&&"undefined"!=typeof document?setTimeout(l,0,u):l(u)):(r[c]||(r[c]=[]),r[c].push(u));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),u.onerror=c(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(Object.keys(t).map((function(e){return t[e]({msg:"unexpected_error",message:ke})})));case 2:case"end":return e.stop()}}),e,this)})));case 15:case"end":return e.stop()}}),e,this)}))),ne=function(){return dt.apply(this,arguments)},_t=c(regeneratorRuntime.mark((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{events:["data"]};return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,We.connect(t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),re=function(e){return _t.apply(this,arguments)},gt=c(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,We.duplicate(t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),ae=function(e,t){return gt.apply(this,arguments)},ie=Object.defineProperty,oe=function(e,t,n){return t in e?ie(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},se=function(e,t,n){return oe(e,"symbol"!==(void 0===t?"undefined":A(t))?t+"":t,n),n},ue=function(e,t,n){if(!t.has(e))throw TypeError("Cannot "+n)},ce=function(e,t,n){return ue(e,t,"read from private field"),n?n.call(e):t.get(e)},le=function(e,t,n){if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},pe=function(e,t,n,r){return ue(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n},fe=new Intl.Collator(0,{numeric:1}).compare,de="host",_e="upload",ge="login",me="config",ve="info",be="runtime",we="sleeptime",xe="https://gradio-space-api-fetcher-v2.hf.space/api",ye="This application is currently busy. Please try again. ",ke="Connection errored out. ",Re="Could not resolve app config. ",Se="Could not get space status. ",Ee="Space metadata could not be loaded. ",Oe="Not authorized to access this space. ",je="Invalid credentials. Could not login. ",Pe="Login credentials are required to access this space.",De="File system access is only available in Node.js environments",Ce="Root URL not found in client config",Ae="Error uploading file",Te=function(e){var t=[];return e.split(/,(?=\s*[^\s=;]+=[^\s=;]+)/).forEach((function(e){var n=e.split(";")[0].split("="),r=D(n,2),a=r[0],i=r[1];a&&i&&t.push(a.trim()+"="+i.trim())})),t},Ie=/^[a-zA-Z0-9_\-\.]+\/[a-zA-Z0-9_\-\.]+$/,ze=/.*hf\.space\/{0,1}$/,Ue=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];try{return t.reduce((function(e,t){return e=e.replace(/\/+$/,""),t=t.replace(/^\/+/,""),new URL(t,e+"/").toString()}))}catch(r){throw Error("Invalid URL. A full URL path is required.")}},qe=function(e,t){var n,r,a=Object.values(t.named_endpoints).flatMap((function(e){return e.parameters}));return Array.isArray(e)?(e.length>a.length&&console.warn("Too many arguments provided for the endpoint."),e):(n=[],r=Object.keys(e),a.forEach((function(t,r){if(e.hasOwnProperty(t.parameter_name))n[r]=e[t.parameter_name];else{if(!t.parameter_has_default)throw Error("No value provided for required parameter: "+t.parameter_name);n[r]=t.parameter_default}})),r.forEach((function(e){if(!a.some((function(t){return t.parameter_name===e})))throw Error("Parameter `"+e+"` is not a valid keyword argument. Please refer to the API for usage.")})),n.forEach((function(e,t){if(void 0===e&&!a[t].parameter_has_default)throw Error("No value provided for required parameter: "+a[t].parameter_name)})),n)},Le=function e(t){var n=t.path,r=t.url,a=t.orig_name,i=t.size,o=t.blob,u=t.is_stream,c=t.mime_type,l=t.alt_text;s(this,e),se(this,"path"),se(this,"url"),se(this,"orig_name"),se(this,"size"),se(this,"blob"),se(this,"is_stream"),se(this,"mime_type"),se(this,"alt_text"),se(this,"meta",{_type:"gradio.FileData"}),this.path=n,this.url=r,this.orig_name=a,this.size=i,this.blob=r?void 0:o,this.is_stream=u,this.mime_type=c,this.alt_text=l},Ne=function e(t,n){s(this,e),se(this,"type"),se(this,"command"),se(this,"meta"),se(this,"fileData"),this.type="command",this.command=t,this.meta=n},Me=void 0!==e&&e.versions&&e.versions.node,Be=/^(?=[^]*\b[dD]iscussions{0,1}\b)(?=[^]*\b[dD]isabled\b)[^]*$/,Fe=["cpu-basic","cpu-upgrade","cpu-xl","t4-small","t4-medium","a10g-small","a10g-large","a10g-largex2","a10g-largex4","a100-large","zero-a10g","h100","h100x8"],Je=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{allowCR:!1};return s(this,t),e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{transform:function(t,r){var a,i,o;for(t=ce(e,he)+t;;)if(a=t.indexOf("\n"),-1!==(i=n.allowCR?t.indexOf("\r"):-1)&&i!==t.length-1&&(-1===a||a-1>i))r.enqueue(t.slice(0,i)),t=t.slice(i+1);else{if(-1===a)break;o="\r"===t[a-1]?a-1:a,r.enqueue(t.slice(0,o)),t=t.slice(a+1)}pe(e,he,t)},flush:function(t){if(""!==ce(e,he)){var r=n.allowCR&&ce(e,he).endsWith("\r")?ce(e,he).slice(0,-1):ce(e,he);t.enqueue(r)}}})),le(e,he,""),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,TransformStream),t}(),he=new WeakMap,We=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{events:["data"]};s(this,e),se(this,"app_reference"),se(this,"options"),se(this,"config"),se(this,"api_info"),se(this,"api_map",{}),se(this,"session_hash",Math.random().toString(36).substring(2)),se(this,"jwt",!1),se(this,"last_status",{}),se(this,"cookies",null),se(this,"stream_status",{open:!1}),se(this,"pending_stream_messages",{}),se(this,"pending_diff_streams",{}),se(this,"event_callbacks",{}),se(this,"unclosed_events",new Set),se(this,"heartbeat_event",null),se(this,"abort_controller",null),se(this,"stream_instance",null),se(this,"view_api"),se(this,"upload_files"),se(this,"upload"),se(this,"handle_blob"),se(this,"post_data"),se(this,"submit"),se(this,"predict"),se(this,"open_stream"),se(this,"resolve_config"),se(this,"resolve_cookies"),this.app_reference=t,n.events||(n.events=["data"]),this.options=n,this.view_api=L.bind(this),this.upload_files=N.bind(this),this.handle_blob=J.bind(this),this.post_data=X.bind(this),this.submit=O.bind(this),this.predict=Q.bind(this),this.open_stream=ne.bind(this),this.resolve_config=I.bind(this),this.resolve_cookies=z.bind(this),this.upload=M.bind(this)}var t,r,i,u,l,p,f,d;return j(e,[{key:"fetch",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return""+e},t}((function(e,t){var n=new Headers((null==t?void 0:t.headers)||{});return this&&this.cookies&&n.append("Cookie",this.cookies),fetch(e,C({},t,{headers:n}))}))},{key:"stream",value:function(e){return this.abort_controller=new AbortController,this.stream_instance=function(e){var t,n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a={close:function(){throw Error("Method not implemented.")},onerror:null,onmessage:null,onopen:null,readyState:0,url:e.toString(),withCredentials:!1,CONNECTING:0,OPEN:1,CLOSED:2,addEventListener:function(){throw Error("Method not implemented.")},dispatchEvent:function(){throw Error("Method not implemented.")},removeEventListener:function(){throw Error("Method not implemented.")}};return te(e,r).then((t=c(regeneratorRuntime.mark((function e(t){var r,i,s,u,c,l,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.readyState=a.OPEN,e.prev=1,r=!0,i=!1,s=void 0,e.prev=5,u=o(t);case 7:return e.next=9,u.next();case 9:return c=e.sent,r=c.done,e.next=13,c.value;case 13:if(l=e.sent,r){e.next=20;break}p=l,a.onmessage&&a.onmessage(p);case 17:r=!0,e.next=7;break;case 20:e.next=26;break;case 22:e.prev=22,e.t0=e.catch(5),i=!0,s=e.t0;case 26:if(e.prev=26,e.prev=27,r||!u.return){e.next=31;break}return e.next=31,u.return();case 31:if(e.prev=31,!i){e.next=34;break}throw s;case 34:return e.finish(31);case 35:return e.finish(26);case 36:a.readyState=a.CLOSED,e.next=43;break;case 39:e.prev=39,e.t1=e.catch(1),a.onerror&&a.onerror(e.t1),a.readyState=a.CLOSED;case 43:case"end":return e.stop()}}),e,n,[[1,39],[5,22,26,36],[27,,31,35]])}))),function(e){return t.apply(this,arguments)})).catch((function(e){console.error(e),a.onerror&&a.onerror(e),a.readyState=a.CLOSED})),a}(e.toString(),{signal:this.abort_controller.signal}),this.stream_instance}},{key:"init",value:(d=c(regeneratorRuntime.mark((function e(){var t,r,i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!=typeof window&&"WebSocket"in window||a.WebSocket){e.next=5;break}return e.next=3,n.e(43).then(n.t.bind(null,727,7));case 3:r=e.sent,a.WebSocket=r.WebSocket;case 5:if(e.prev=5,!this.options.auth){e.next=9;break}return e.next=9,this.resolve_cookies();case 9:return e.next=11,this._resolve_config().then((function(e){var t=e.config;return i._resolve_hearbeat(t)}));case 11:e.next=16;break;case 13:throw e.prev=13,e.t0=e.catch(5),Error(e.t0);case 16:return e.next=18,this.view_api();case 18:this.api_info=e.sent,this.api_map=h((null==(t=this.config)?void 0:t.dependencies)||[]);case 20:case"end":return e.stop()}}),e,this,[[5,13]])}))),function(){return d.apply(this,arguments)})},{key:"_resolve_hearbeat",value:(f=c(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=7;break}if(this.config=t,!this.config||!this.config.connect_heartbeat){e.next=7;break}if(!this.config.space_id||!this.options.hf_token){e.next=7;break}return e.next=6,T(this.config.space_id,this.options.hf_token,this.cookies);case 6:this.jwt=e.sent;case 7:if(!t.space_id||!this.options.hf_token){e.next=11;break}return e.next=10,T(t.space_id,this.options.hf_token);case 10:this.jwt=e.sent;case 11:this.config&&this.config.connect_heartbeat&&(n=new URL(this.config.root+"/heartbeat/"+this.session_hash),this.jwt&&n.searchParams.set("__sign",this.jwt),this.heartbeat_event||(this.heartbeat_event=this.stream(n)));case 12:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"close",value:function(){var e;null==(e=this.heartbeat_event)||e.close()}},{key:"_resolve_config",value:(p=c(regeneratorRuntime.mark((function e(){var t,n,r,a,i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,q(this.app_reference,this.options.hf_token);case 2:return t=e.sent,n=t.http_protocol,r=t.host,a=t.space_id,i=this.options.status_callback,o=void 0,e.prev=8,e.next=11,this.resolve_config(n+"//"+r);case 11:if(o=e.sent){e.next=14;break}throw Error(Re);case 14:return e.abrupt("return",this.config_success(o));case 17:if(e.prev=17,e.t0=e.catch(8),!a||!i){e.next=23;break}$(a,Ie.test(a)?"space_name":"subdomain",this.handle_space_success),e.next=25;break;case 23:throw i&&i({status:"error",message:"Could not load this space.",load_status:"error",detail:"NOT_FOUND"}),Error(e.t0);case 25:case"end":return e.stop()}}),e,this,[[8,17]])}))),function(){return p.apply(this,arguments)})},{key:"config_success",value:(l=c(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.config=t,"undefined"!=typeof window&&"undefined"!=typeof document&&"https:"===window.location.protocol&&(this.config.root=this.config.root.replace("http://","https://")),!this.config.auth_required){e.next=4;break}return e.abrupt("return",this.prepare_return_obj());case 4:return e.prev=4,e.next=7,this.view_api();case 7:this.api_info=e.sent,e.next=13;break;case 10:e.prev=10,e.t0=e.catch(4),console.error("Could not get API info. "+e.t0.message);case 13:return e.abrupt("return",this.prepare_return_obj());case 14:case"end":return e.stop()}}),e,this,[[4,10]])}))),function(e){return l.apply(this,arguments)})},{key:"handle_space_success",value:(u=c(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this){e.next=2;break}throw Error(Re);case 2:if((n=this.options.status_callback)&&n(t),"running"!==t.status){e.next=21;break}return e.prev=5,e.next=8,this._resolve_config();case 8:if(this.config=e.sent,this.config){e.next=11;break}throw Error(Re);case 11:return e.next=13,this.config_success(this.config);case 13:return r=e.sent,e.abrupt("return",r);case 17:throw e.prev=17,e.t0=e.catch(5),n&&n({status:"error",message:"Could not load this space.",load_status:"error",detail:"NOT_FOUND"}),e.t0;case 21:case"end":return e.stop()}}),e,this,[[5,17]])}))),function(e){return u.apply(this,arguments)})},{key:"component_server",value:(i=c(regeneratorRuntime.mark((function e(t,n,r){var a,i,o,s,u,c,l,p,h,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.config){e.next=2;break}throw Error(Re);case 2:if(i={},o=this.options.hf_token,s=this.session_hash,o&&(i.Authorization="Bearer "+this.options.hf_token),u=void 0,c=this.config.components.find((function(e){return e.id===t})),u=(null==(a=null==c?void 0:c.props)?void 0:a.root_url)?c.props.root_url:this.config.root,l=void 0,!("binary"in r)){e.next=25;break}l=new FormData,e.t0=regeneratorRuntime.keys(r.data);case 13:if((e.t1=e.t0()).done){e.next=20;break}if("binary"!==(p=e.t1.value)){e.next=17;break}return e.abrupt("continue",13);case 17:l.append(p,r.data[p]),e.next=13;break;case 20:l.set("component_id",t.toString()),l.set("fn_name",n),l.set("session_hash",s),e.next=27;break;case 25:l=JSON.stringify({data:r,component_id:t,fn_name:n,session_hash:s}),i["Content-Type"]="application/json";case 27:return o&&(i.Authorization="Bearer "+o),e.prev=28,e.next=31,this.fetch(u+"/component_server/",{method:"POST",body:l,headers:i,credentials:"include"});case 31:if((h=e.sent).ok){e.next=34;break}throw Error("Could not connect to component server: "+h.statusText);case 34:return e.next=36,h.json();case 36:return f=e.sent,e.abrupt("return",f);case 40:e.prev=40,e.t2=e.catch(28),console.warn(e.t2);case 43:case"end":return e.stop()}}),e,this,[[28,40]])}))),function(e,t,n){return i.apply(this,arguments)})},{key:"set_cookies",value:function(e){this.cookies=Te(e).join("; ")}},{key:"prepare_return_obj",value:function(){return{config:this.config,predict:this.predict,submit:this.submit,view_api:this.view_api,component_server:this.component_server}}}],[{key:"connect",value:(r=c(regeneratorRuntime.mark((function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{events:["data"]};return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new this(t,r),e.next=3,n.init();case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"duplicate",value:(t=c(regeneratorRuntime.mark((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{events:["data"]};return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Y(t,n));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),t.Client=We,t.FileData=Le,t.client=re,t.duplicate=ae,t.handle_file=function(e){if("string"==typeof e){if(e.startsWith("http://")||e.startsWith("https://"))return{path:e,url:e,orig_name:e.split("/").pop()||"unknown",meta:{_type:"gradio.FileData"}};if(Me)return new Ne("upload_file",{path:e,name:e,orig_path:e})}else{if("undefined"!=typeof File&&e instanceof File)return{path:e instanceof File?e.name:"blob",orig_name:e instanceof File?e.name:"unknown",blob:e instanceof File?e:new Blob([e]),size:e instanceof Blob?e.size:r.byteLength(e),mime_type:e instanceof File?e.type:"application/octet-stream",meta:{_type:"gradio.FileData"}};if(e instanceof r)return new Blob([e]);if(e instanceof Blob)return e}throw Error("Invalid input: must be a URL, File, Blob, or Buffer object.")},t.predict=Q,t.prepare_files=B,t.submit=O,t.upload=M,t.upload_files=N}(n(43),n(210).Buffer,n(67))}}]);