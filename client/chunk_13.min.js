/*! For license information please see chunk_13.min.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{649:function(e,t,n){"use strict";var r,i;Object.defineProperty(t,"__esModule",{value:!0}),r=function(){function e(e,t){var n,r;for(n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.rgba_=t}return r(e,[{key:"setRGBA",value:function(e){this.rgba_[0]=e[0],this.rgba_[1]=e[1],this.rgba_[2]=e[2],this.rgba_[3]=e[3]}},{key:"setUint32",value:function(e){e=(0|e)>>>0,this.rgba_[3]=e>>24&255,this.rgba_[2]=e>>16&255,this.rgba_[1]=e>>8&255,this.rgba_[0]=255&e}},{key:"r",get:function(){return this.rgba_[0]}},{key:"g",get:function(){return this.rgba_[1]}},{key:"b",get:function(){return this.rgba_[2]}},{key:"a",get:function(){return this.rgba_[3]}},{key:"rgba",get:function(){return this.rgba_.subarray(0,4)}},{key:"uint32",get:function(){return(this.r<<24|this.g<<16|this.b<<8|this.a)>>>0}}],[{key:"createUint32",value:function(t){return new e(new Uint8Array(Uint32Array.of((0|t)>>>0).buffer))}}]),e}(),t.default=i},650:function(e,t,n){"use strict";var r,i,a,o,s;Object.defineProperty(t,"__esModule",{value:!0}),r=function(){function e(e,t){var n,r;for(n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(649),a=(s=i)&&s.__esModule?s:{default:s},o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"colorDifference",value:function(e,t){return Math.sqrt(Math.pow(e.r-t.r,2)+Math.pow(e.g-t.g,2)+Math.pow(e.b-t.b,2)+Math.pow(e.a-t.a,2))}},{key:"averageColor",value:function(e){var t,n=new Uint32Array(4);return e.forEach((function(e){var t=e.rgba;n[0]=(n[0]+t[0]|0)>>>0,n[1]=(n[1]+t[1]|0)>>>0,n[2]=(n[2]+t[2]|0)>>>0,n[3]=(n[3]+t[3]|0)>>>0})),t=e.length,new a.default(Uint8Array.of(n[0]/t|0,n[1]/t|0,n[2]/t|0,n[3]/t|0))}}]),e}(),t.default=o},652:function(e,t,n){"use strict";var r,i=n(651),a=n(645),o=(0,a.SIMDopeCreateConfAdd)({create:{new_of:!0},properties:{uint32:!0,laba:!0,rgbaon4bits:!0,rgbaon6bits:!0,rgbaon8bits:!0,rgbaon12bits:!0,rgbaon16bits:!0,skin:!0},methods:{simplify:!0,get_new_element:!0,get_use_element:!0,set_tail:!0,is_dark:!0,blend_first_with:!0,blend_first_with_tails:!0,blend_all:!0,manhattan_match_with:!0,copy:!0}}),s=Math.fround,u=s(1),c=s(.777),l=(0,a.SIMDopeCreate)(o),h=l.simdops,f=l.Color,p=l.Colors,d=(h.minus_int,h.int_not_equal,h.plus_int,h.plus_uint,h.minus_uint,h.multiply_int,h.multiply_uint,h.multiply_uint_4),g=(h.divide_uint,h.clamp_uint8,h.clamp_uint32,h.int_equal,h.uint_less,h.int_less,h.int_greater_equal,h.uint_not_equal,h.uint_less_equal,h.min_uint,function e(t){if(t=t||{},!(this instanceof e))return new e(t);t.pxl_colors=t.pxl_colors||new Uint32Array(0),t.pxls=t.pxls||new Uint32Array(0),this.new_pxls_="buffer"in t.pxls?new Uint32Array(t.pxls.buffer):Uint32Array.from(t.pxls),this.new_pxl_colors_="buffer"in t.pxl_colors?new p(t.pxl_colors.buffer):new p(Uint32Array.from(t.pxl_colors).buffer),this.original_pxls_=this.new_pxls_.slice(0,this.new_pxls_.length),this.original_pxl_colors_=this.new_pxl_colors_.slice_uint32(0,this.new_pxl_colors_.length);var n=0|this.new_pxl_colors_.length;this.new_pxl_colors_is_skin_mask_=new i.SetFixed(0|n),this.set_new_pxl_skin_mask(),this.best_color_number_=t.number_of_color,this.max_cluster_=n>65536?65537:n>16384?4097:n>8192?257:n>512?17:1,this.index_clusters_=Array(this.max_cluster_),this.length_clusters_=new Uint32Array(this.max_cluster_),this.pxl_colors_usage_=new Uint32Array(n),this.all_index_clusters_=new Uint32Array(n),this.clean_pxl_colors_=new Uint32Array(n),this.clean_pxl_colors_lookup_={},this.is_skin_ops_=0,this.match_ops_=0,this.blend_ops_=0,this.remove_duplicate_ops_=0,this.simplify_ops_=0,this.classify_on_x_bits_ops_=0});Object.defineProperty(g.prototype,"set_is_skin_ops",{get:function(){return function(e){this.is_skin_ops_=(0|e)>>>0}}}),Object.defineProperty(g.prototype,"set_match_ops",{get:function(){return function(e){this.match_ops_=(0|e)>>>0}}}),Object.defineProperty(g.prototype,"set_blend_ops",{get:function(){return function(e){this.blend_ops_=(0|e)>>>0}}}),Object.defineProperty(g.prototype,"set_remove_duplicate_ops",{get:function(){return function(e){this.remove_duplicate_ops_=(0|e)>>>0}}}),Object.defineProperty(g.prototype,"set_simplify_ops",{get:function(){return function(e){this.simplify_ops_=e}}}),Object.defineProperty(g.prototype,"set_classify_on_x_bits_ops",{get:function(){return function(e){this.classify_on_x_bits_ops_=e}}}),Object.defineProperty(g.prototype,"get_is_skin_ops",{get:function(){return function(){return 0|this.is_skin_ops_}}}),Object.defineProperty(g.prototype,"get_match_ops",{get:function(){return function(){return 0|this.match_ops_}}}),Object.defineProperty(g.prototype,"get_blend_ops",{get:function(){return function(){return 0|this.blend_ops_}}}),Object.defineProperty(g.prototype,"get_remove_duplicate_ops",{get:function(){return function(){return 0|this.remove_duplicate_ops_}}}),Object.defineProperty(g.prototype,"get_simplify_ops",{get:function(){return function(){return this.simplify_ops_}}}),Object.defineProperty(g.prototype,"get_classify_on_x_bits_ops",{get:function(){return function(){return this.classify_on_x_bits_ops_}}}),Object.defineProperty(g.prototype,"reset_deduplicate",{get:function(){return function(e){this.clean_pxl_colors_lookup_={},this.pxl_colors_usage_.fill(0,0,0|e),this.clean_pxl_colors_.fill(0,0,0|e)}}}),Object.defineProperty(g.prototype,"index_of_color_within_cleaned",{get:function(){return function(e){return(0|this.clean_pxl_colors_lookup_[(0|e)>>>0])-1|0}}}),Object.defineProperty(g.prototype,"set_cleaned_pxl_colors",{get:function(){return function(e,t){this.clean_pxl_colors_[(0|e)>>>0]=(0|t)>>>0,this.clean_pxl_colors_lookup_[(0|t)>>>0]=(e+1|0)>>>0}}}),Object.defineProperty(g.prototype,"increase_color_usage",{get:function(){return function(e){this.pxl_colors_usage_[(0|e)>>>0]=(this.pxl_colors_usage_[(0|e)>>>0]+1|0)>>>0}}}),Object.defineProperty(g.prototype,"set_new_pxls",{get:function(){return function(e,t){this.new_pxls_[(0|e)>>>0]=(0|t)>>>0}}}),Object.defineProperty(g.prototype,"set_new_pxl_colors",{get:function(){return function(e){this.new_pxl_colors_=new p(this.clean_pxl_colors_.buffer.slice(0,d(0|e))),this.set_new_pxl_skin_mask()}}}),Object.defineProperty(g.prototype,"set_new_pxl_skin_mask",{get:function(){return function(){var e=new f(new ArrayBuffer(4)),t=0|this.new_pxl_colors_.length,n=0;for(this.new_pxl_colors_is_skin_mask_=new i.SetFixed(0|t);(0|n)<(0|t);n=n+1|0)this.new_pxl_colors_.get_use_element(0|n,e).skin&&this.new_pxl_colors_is_skin_mask_.add(0|n);this.set_is_skin_ops(this.get_is_skin_ops()+n|0)}}}),Object.defineProperty(g.prototype,"get_a_new_pxl_color_from_pxl_index",{get:function(){return function(e){return 4294967295&this.new_pxl_colors_.buffer_getUint32(this.new_pxls_[0|e])}}}),Object.defineProperty(g.prototype,"reset_cluster",{get:function(){return function(){this.max_cluster_=this.new_pxl_colors_.length>65536?65537:this.new_pxl_colors_.length>16384?4097:this.new_pxl_colors_.length>8192?257:this.new_pxl_colors_.length>512?17:1,this.length_clusters_.fill(0,0,0|this.max_cluster);for(var e=0;(0|e)<(0|this.max_cluster);e=(e+1|0)>>>0)this.index_clusters_[0|e]=[]}}}),Object.defineProperty(g.prototype,"reset_original_data",{get:function(){return function(){this.new_pxl_colors_=new p(this.original_pxl_colors_.slice(0,this.original_pxl_colors_.length).buffer),this.new_pxls_=this.original_pxls_.slice(0,this.original_pxls_.length)}}}),Object.defineProperty(g.prototype,"add_in_indexes_cluster",{get:function(){return function(e,t){this.index_clusters_[(0|e)>>>0].push((0|t)>>>0)}}}),Object.defineProperty(g.prototype,"set_all_cluster_indexes",{get:function(){return function(){for(var e=0,t=0;(0|e)<(0|this.max_cluster);e=(e+1|0)>>>0)this.all_index_clusters_.set(this.index_clusters_[(0|e)>>>0],(0|t)>>>0),t=(t+this.get_length_in_index_clusters(0|e)|0)>>>0}}}),Object.defineProperty(g.prototype,"get_length_in_index_clusters",{get:function(){return function(e){return(0|this.index_clusters_[(0|e)>>>0].length)>>>0}}}),Object.defineProperty(g.prototype,"get_in_cluster_lengths",{get:function(){return function(e){return(0|this.length_clusters_[(0|e)>>>0])>>>0}}}),Object.defineProperty(g.prototype,"get_an_index_in_clusters",{get:function(){return function(e){return(0|this.all_index_clusters_[0|e])>>>0}}}),Object.defineProperty(g.prototype,"get_a_color_usage",{get:function(){return function(e){return(0|this.pxl_colors_usage_[0|e])>>>0}}}),Object.defineProperty(g.prototype,"set_a_color_usage",{get:function(){return function(e,t){return this.pxl_colors_usage_[0|e]=(0|t)>>>0}}}),Object.defineProperty(g.prototype,"get_a_color_usage_percent",{get:function(){return function(e){return s(this.pxl_colors_usage_[0|e]/this.new_pxls_.length)}}}),Object.defineProperty(g.prototype,"get_average_color_usage_percent",{get:function(){return function(e,t){var n,r,i;for(t=0|((t|=0)<(e|=0)?this.pxl_colors_usage_.length:t),n=0,r=0,i=0,r=0|e;(0|r)<(0|t);r=(r+1|0)>>>0)i=(0|this.get_an_index_in_clusters((0|r)>>>0))>>>0,n+=this.pxl_colors_usage_[0|i]/this.new_pxls_.length;return n/(t-e|0)}}}),Object.defineProperty(g.prototype,"get_a_new_pxl_color",{get:function(){return function(e){return this.new_pxl_colors_.get_new_element(0|e)}}}),Object.defineProperty(g.prototype,"is_pxl_color_skin",{get:function(){return function(e){return this.new_pxl_colors_is_skin_mask_.has(0|e)}}}),Object.defineProperty(g.prototype,"max_cluster",{get:function(){return 0|this.max_cluster_}}),Object.defineProperty(g.prototype,"new_pxls_length",{get:function(){return 0|this.new_pxls_.length}}),Object.defineProperty(g.prototype,"new_pxl_colors_length",{get:function(){return 0|this.new_pxl_colors_.length}}),Object.defineProperty(g.prototype,"best_color_number",{get:function(){return 0|this.best_color_number_}}),Object.defineProperty(g.prototype,"get_data",{get:function(){return function(){return Array.of(this.new_pxls_,this.new_pxl_colors_.slice_uint32(0,this.new_pxl_colors_.length),{deduplicate:this.get_remove_duplicate_ops(),simplify:this.get_simplify_ops(),classify:this.get_classify_on_x_bits_ops(),skin:this.get_is_skin_ops(),blend:this.get_blend_ops(),match:this.get_match_ops()})}}}),g.prototype.output=function(e){var t,n;return e=e||"heap",t=this.get_data(),"heap"==e?((n=new Uint32Array(2+t[0].length+t[1].length))[0]=0|t[0].length,n[1]=0|t[1].length,n.set(t[0],2),n.set(t[1],2+t[0].length),n.buffer):t},g.prototype.deduplicate=function(){var e,t,n,r,i;for(this.set_remove_duplicate_ops(this.get_remove_duplicate_ops()+1|0),this.reset_deduplicate(0|this.new_pxl_colors_length),e=0,t=0,n=0,r=0,i=0|this.new_pxls_length;(0|r)<(0|i);r=(r+1|0)>>>0)t=0|this.get_a_new_pxl_color_from_pxl_index(0|r),-1==(0|(n=0|this.index_of_color_within_cleaned(0|t)))&&(this.set_cleaned_pxl_colors(0|e,0|t),n=0|e,e=e+1|0),this.increase_color_usage(0|n),this.set_new_pxls(0|r,0|n);this.set_new_pxl_colors(e)},g.prototype.clusterize=function(){this.reset_cluster();var e=0;if(65537===this.max_cluster)for(;(0|e)<(0|this.new_pxl_colors_length);e=(e+1|0)>>>0)this.add_in_indexes_cluster((0|this.get_a_new_pxl_color((0|e)>>>0).rgbaon16bits)>>>0,(0|e)>>>0);else if(4097===this.max_cluster)for(;(0|e)<(0|this.new_pxl_colors_length);e=(e+1|0)>>>0)this.add_in_indexes_cluster((0|this.get_a_new_pxl_color((0|e)>>>0).rgbaon12bits)>>>0,(0|e)>>>0);else if(257===this.max_cluster)for(;(0|e)<(0|this.new_pxl_colors_length);e=(e+1|0)>>>0)this.add_in_indexes_cluster((0|this.get_a_new_pxl_color((0|e)>>>0).rgbaon8bits)>>>0,(0|e)>>>0);else if(17===this.max_cluster)for(;(0|e)<(0|this.new_pxl_colors_length);e=(e+1|0)>>>0)this.add_in_indexes_cluster((0|this.get_a_new_pxl_color((0|e)>>>0).rgbaon4bits)>>>0,(0|e)>>>0);else for(;(0|e)<(0|this.new_pxl_colors_length);e=(e+1|0)>>>0)this.add_in_indexes_cluster(0,(0|e)>>>0);this.max_cluster>1&&this.set_classify_on_x_bits_ops(this.get_classify_on_x_bits_ops()+this.new_pxl_colors_length),this.set_all_cluster_indexes()},g.prototype.process_threshold=function(e){var t,n,r,i,a,o,l,h,p,d,g,_,v,m,y,b,w,x,k,E,O,S,j,P,C,R;for(n=function(e,n){return s(Math.pow(e,t)/n)}(e=(0|e)>>>0,Math.pow(100,t=1.5)),r=!1,i=[],a=[],o=0,l=0,d=!1,g=!1,_=0,v=0,m=0,y=0,b=0,w=0,O=0,S=0,j=0,P=0,C=0,R=0,E=s((x=n)*c),k=s(x*u);(0|C)<(0|this.max_cluster);C=(C+1|0)>>>0){for(l=(o+((0|this.get_length_in_index_clusters(0|C))>>>0)|0)>>>0,b=this.get_average_color_usage_percent(0|o,0|l),j=0|o;(0|j)<(0|l);j=(j+1|0)>>>0){if(O=(0|this.get_an_index_in_clusters((0|j)>>>0))>>>0,h=this.get_a_new_pxl_color((0|O)>>>0),d=this.is_pxl_color_skin((0|O)>>>0),(0|(_=(0|this.get_a_color_usage((0|O)>>>0))>>>0))>0)for(i=[],P=0|o;(0|P)<(0|l);P=(P+1|0)>>>0)S=(0|this.get_an_index_in_clusters((0|P)>>>0))>>>0,p=this.get_a_new_pxl_color((0|S)>>>0),g=this.is_pxl_color_skin((0|S)>>>0),0|(v=(0|this.get_a_color_usage((0|S)>>>0))>>>0)&&(0|O)!=(0|S)&&(0|d)==(0|g)&&(m=this.get_a_color_usage_percent((0|O)>>>0)/b,y=this.get_a_color_usage_percent((0|S)>>>0)/b,R=s((R=d&&g?E:d||g?k:x)*(0*Math.abs(m-y)+.14*(2-(m+y))/2+.88)/1.02),h.manhattan_match_with(p,R)&&(w=s(v/_),r=!0,this.set_a_color_usage(0|S,0),i.push(p),a.push(w)));(0|i.length)>0&&(f.blend_all(h,i,a),i=[],a=[])}o=0|l}return r},g.prototype.round=function(){var e,t;if(this.new_pxl_colors_length>2048){for(e=0|(this.new_pxl_colors_length>6e4?4:this.new_pxl_colors_length>32e3?3:this.new_pxl_colors_length>16e3?2:this.new_pxl_colors_length>8192?1.5:this.new_pxl_colors_length>4096?1.25:1),t=0;(0|t)<(0|this.new_pxl_colors_length);t=(t+1|0)>>>0)this.get_a_new_pxl_color((0|t)>>>0).simplify(e);this.set_simplify_ops(this.get_simplify_ops()+this.new_pxl_colors_length)}},g.prototype.init=function(){return this.round(),this.deduplicate(),this.clusterize(),this},g.prototype.reset_original=function(){return this.reset_original_data(),this},g.prototype.run=function(){var e=0|(this.new_pxl_colors_length>6e4?12:this.new_pxl_colors_length>32e3?8:this.new_pxl_colors_length>16e3?4:this.new_pxl_colors_length>8192?3:this.new_pxl_colors_length>4096?2:1);if(this.new_pxl_colors_length<=this.best_color_number)return this.deduplicate(),this.clusterize(),this;for(;this.new_pxl_colors_length>this.best_color_number;)this.process_threshold(0|e)&&(this.deduplicate(),this.clusterize()),e=e+(this.new_pxl_colors_length>6e4?12:this.new_pxl_colors_length>32e3?8:this.new_pxl_colors_length>16e3?4:this.new_pxl_colors_length>8192?3:this.new_pxl_colors_length>4096?2:1)|0;return this.reset_original(),this.deduplicate(),this.clusterize(),this.process_threshold(0|e),this.deduplicate(),this.clusterize(),this},g.split_image_data=function(e){var t,n,r=new Uint32Array(e.data.buffer),i=Uint32Array.from(new Set(r)),a={},o=i.length,s=new Uint32Array(r.length);for(t=0,n=0|o;(0|t)<(0|n);t=(t+1|0)>>>0)a[i[0|t]]=(0|t)>>>0;for(t=0,n=0|r.length;(0|t)<(0|n);t=(t+1|0)>>>0)s[0|t]=(0|a[r[0|t]])>>>0;return[s,i,r,o]},r=function(e,t){return new Promise((function(n){var r,i=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n,r,i=[],a=!0,o=!1,s=void 0;try{for(n=e[Symbol.iterator]();!(a=(r=n.next()).done)&&(i.push(r.value),4!==i.length);a=!0);}catch(u){o=!0,s=u}finally{try{!a&&n.return&&n.return()}finally{if(o)throw s}}return i}(e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}(g.split_image_data(e)),a=i[0],o=i[1],s=i[2],u=i[3],c=Date.now(),l=g({pxls:a,pxl_colors:o,number_of_color:"auto"===t?u/1.314|0:parseFloat(t)<1?u-Math.ceil(u/25):t,width:e.width,height:e.height}).init().run().output("split"),h=Date.now(),f=l[0],p=0|f.length,d=l[1];for(r=0;(0|r)<(0|p);r=(r+1|0)>>>0)s[0|r]=(0|d[(0|f[0|r])>>>0])>>>0;n([e=new ImageData(new Uint8ClampedArray(s.buffer),e.width,e.height),f,d,u-d.length,d.length,h-c])}))},e.exports={QuantiMatGlobal:r,QuantiMat:g}},653:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.strength=t,this.tilesManager=n,this.tiles=n.getTiles(),this.width=r,this.height=i}},656:function(e,t,n){"use strict";var r,i;Object.defineProperty(t,"__esModule",{value:!0}),r=(i=n(669))&&i.__esModule?i:{default:i},t.default=r.default.pool({minWorkers:0,maxWorkers:3})},658:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var a,o,s,u,c,l;Object.defineProperty(t,"__esModule",{value:!0}),a=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n,r,i=[],a=!0,o=!1,s=void 0;try{for(n=e[Symbol.iterator]();!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(u){o=!0,s=u}finally{try{!a&&n.return&&n.return()}finally{if(o)throw s}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=function(){function e(e,t){var n,r;for(n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),r(n(649)),r(n(650)),n(651),s=n(652),u=Math.abs,c=Math.imul,l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.contextSource=t}return o(e,[{key:"computePaletteData",value:function(){var t=this.contextSource.getImageData(0,0,this.contextSource.canvas.width,this.contextSource.canvas.height),n=Date.now(),r=e.quantizeImageData(this.contextSource,256),i=r.centroids.length,a=Date.now(),o=e._calculateDistortions(r,t),s=Date.now(),u=e._findElbowPoint(o.clustersDistortion),c=Date.now(),l=e._calculateElbowStrength(o.clustersDistortion,u),h=Date.now(),f=0===u?this.contextSource.getImageData(0,0,this.contextSource.canvas.width,this.contextSource.canvas.height):e.quantizeImageData(this.contextSource,u).imageData,p=Date.now();return console.log({quantizeImageData1:a-n,_calculateDistortions:s-a,_findElbowPoint:c-s,"_calculateElbowStrength+updateThreshold":h-c,quantizeImageData2:p-h}),{colorNumber:0===u?i:u,colorNumberCertainty:l,colorData:f}}},{key:"analyzeImageForTileSize",value:function(e){function t(e){for(var t,n,r,i=0,a=4,o=1;a>=4&&a<=32;)t=e[a],e[2*a-1],e[2*a],e[2*a+1],e[4*a-1],e[4*a],e[4*a+1],i<(n=t*a*(1+.1*a))&&(i=n,o=a),a++;return r=0,e.forEach((function(e,t){r+=e*t})),{tileSize:o,certainty:Math.fround(o*e[o]/r)}}var n,r,i,a,o,s,u,c=e.width,l=e.height,h=new Uint32Array(e.data.buffer),f=256,p=new Uint32Array(f),d=new Uint32Array(f),g=0,_=new Uint32Array(2);for(n=0;n<l;n++){for(g=0,r=1;r<c;r++)_[0]=n*c+r|0,_[1]=_[0]-1|0,h[_[0]]==h[_[1]]?g++:(g>1&&g<f&&(p[g]=p[g]+1|0),g=1);g>0&&g<f&&(p[g]=p[g]+1|0)}for(i=0;i<c;i++){for(g=0,a=1;a<l;a++)_[0]=a*c+i|0,_[1]=_[0]-c|0,h[_[0]]==h[_[1]]?g++:(g>1&&g<f&&(d[g]=d[g]+1|0),g=1);g>0&&g<f&&(d[g]=d[g]+1|0)}return o=t(p),s=t(d),{tileSize:(u=100*Math.max(o.certainty,s.certainty))===o.certainty?o.tileSize:s.tileSize,certainty:u}}}],[{key:"colorDifference",value:function(e,t){var n=Uint8Array.of(u((e>>24&255)-(t>>24&255)),u((e>>16&255)-(t>>16&255)),u((e>>8&255)-(t>>8&255))),r=Uint16Array.of(c(n[0],n[0]),c(n[1],n[1]),c(n[2],n[2]));return(0|Math.sqrt((((r[0]<<1)+r[0]|0)+(r[1]<<2)+(r[2]<<1)|0)/10))>>>0}},{key:"quantizeImageData",value:function(e,t){var n,r,i,o,u=e.getImageData(0,0,e.canvas.width,e.canvas.height),c=Date.now(),l=s.QuantiMat.split_image_data(u),h=a(l,2),f=h[0],p=h[1],d=Date.now(),g=(0,s.QuantiMat)({pxls:f,pxl_colors:p,number_of_color:Math.min(p.length,t),width:u.width,height:u.height}).init().run().output("split"),_=Date.now();for(console.log(d-c,_-d),n=g[0],r=g[1],i=new Uint32Array(n.length),o=0;o<n.length;o++)i[o]=r[n[o]];return u.data.set(new Uint8ClampedArray(i.buffer)),{imageData:u,clusterAssignments:n,centroids:r}}},{key:"_calculateDistortions",value:function(t,n){var r,i=t.imageData,a=t.clusterAssignments,o=t.centroids,s=Math.imul,u=0,c=new Uint32Array(n.data.buffer),l=new Uint32Array(i.data.buffer),h=new BigUint64Array(o.length),f=0;for(r=0;r<l.length;r++)u+=f=0|s(f=0|e.colorDifference(l[r],c[r]),f),h[a[r]]+=BigInt(f);return{totalDistortion:u,clustersDistortion:Array.from(h).map((function(e){return Number(e)})).sort((function(e,t){return t-e}))}}},{key:"_findElbowPoint",value:function(e){var t,n,r,i,a,o,s,u=[];for(e.forEach((function(e){e&&u.push(e)})),t=[],n=1;n<e.length;n++)r=e[n]-e[n-1],0!==(i=e[n-1])?t.push(r/i):t.push(0);for(a=0,o=t[0],s=1;s<t.length;s++)t[s]>o&&(a=s,o=t[s]);return a}},{key:"_calculateElbowStrength",value:function(e,t){var n,r,a,o=e.map((function(t,n){return n/(e.length-1)})),s=Math.max.apply(Math,i(e)),u=Math.min.apply(Math,i(e)),c=e.map((function(e){return(e-u)/(s-u)})),l=[0,c[0]],h=[1,c[c.length-1]],f=[o[t],c[t]],p=Math.sqrt(Math.pow(h[0]-l[0],2)+Math.pow(h[1]-l[1],2)),d=Math.abs(((a=h)[1]-(r=l)[1])*(n=f)[0]-(a[0]-r[0])*n[1]+a[0]*r[1]-a[1]*r[0])/Math.sqrt(Math.pow(a[1]-r[1],2)+Math.pow(a[0]-r[0],2));return Math.fround(d/p)}}]),e}(),t.default=l},659:function(e,t,n){"use strict";var r,i,a;Object.defineProperty(t,"__esModule",{value:!0}),r=function(){function e(e,t){var n,r;for(n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(645),a=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.data=t,this.k=Math.min(n,Math.ceil(Math.sqrt(this.data.length))),this.centroids=Array(this.k),this.clusters=new Uint32Array(this.data.length),this.c1=new i.Color(new ArrayBuffer(4)),this.c2=new i.Color(new ArrayBuffer(4))}return r(e,[{key:"initializeCentroids",value:function(){var e,t,n=new Set,r=[];for(e=0;e<this.k;e++){t=void 0;do{t=Math.floor(Math.random()*this.data.length)}while(n.has(t));n.add(t),r.push(Uint8Array.from(this.data[t]))}this.centroids=r}},{key:"assignClusters",value:function(){var e=this;this.data.forEach((function(t,n){var r=Number.MAX_VALUE,i=0;e.centroids.forEach((function(n,a){var o=e.distance(t,n);o<r&&(r=o,i=a)})),e.clusters[n]=i}))}},{key:"updateCentroids",value:function(){var e=this,t=Array.from({length:this.k},(function(){return new Uint32Array(e.data[0].length)})),n=new Uint32Array(this.k);return this.data.forEach((function(r,i){var a=e.clusters[i];t[a]=t[a].map((function(e,t){return e+r[t]})),n[a]++})),n}},{key:"findFarthestPointFromCentroids",value:function(){var e=this,t=0,n=0;return this.data.forEach((function(r,i){var a=Number.MAX_VALUE;e.centroids.forEach((function(t){var n=e.distance(r,t);n<a&&(a=n)})),a>t&&(t=a,n=i)})),n}},{key:"distance",value:function(e,t){return this.c1.set_from_array(e),this.c2.set_from_array(t),16192*this.c1.fast_match_with(this.c2)|0}},{key:"reassignCentroids",value:function(e){for(var t=0;t<e.length;t++)0===e[t]&&(this.centroids[t]=this.findFarthestPointFromCentroids())}},{key:"run",value:function(){var e,t,n,r,i,a,o=this,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.initializeCentroids(),e=0,t=!1,n=void 0,r=function(){var r=o.centroids.map((function(e){return Uint32Array.from(e)}));o.assignClusters(),n=o.updateCentroids(),e++,t=o.centroids.every((function(e,t){return o.distance(e,r[t])<2})),u&&!t&&o.reassignCentroids(n)};!t&&e<s;)r();return i=this.getCentroidsPopulationCount(this.centroids,this.clusters),a=Array.from(this.centroids).map((function(e,t){return{data:Uint8ClampedArray.from(e),count:i[t]}})).sort((function(e,t){return t.count-e.count})),{centroids:this.centroids,clusters:this.clusters,centroidsSorted:a}}},{key:"getCentroidsPopulationCount",value:function(e,t){var n=new Uint32Array(e.length);return t.forEach((function(e){n[e]++})),n}}]),e}(),t.default=a},660:function(e,t,n){"use strict";var r,i;Object.defineProperty(t,"__esModule",{value:!0}),r=function(){function e(e,t){var n,r;for(n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"initializeCanvas",value:function(e,t,n){t=(e=e||{width:0,height:0}).width||t||1,n=e.height||n||1;var r=void 0,i=void 0;try{i=(r=new OffscreenCanvas(t,n)).getContext("2d",{willReadFrequently:!0,desynchronized:!0})}catch(a){(r=document.createElement("canvas")).width=t,r.height=n,i=r.getContext("2d",{willReadFrequently:!0})}return e instanceof ImageData?i.putImageData(e,0,0):e.width&&i.drawImage(e,0,0,t,n),{canvas:r,context:i}}},{key:"canvasContextToImageData",value:function(e){return e.getImageData(0,0,e.canvas.width,e.canvas.height)}}]),e}(),t.default=i},661:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(n(662)),a=r(n(663));e.exports=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=(0,i.default)(e);return n&&(t=/(?:#)[0-9a-f]{8}|(?:#)[0-9a-f]{6}|(?:#)[0-9a-f]{4}|(?:#)[0-9a-f]{3}/gi,r.match(t).forEach((function(e){var t=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n,r,i=[],a=!0,o=!1,s=void 0;try{for(n=e[Symbol.iterator]();!(a=(r=n.next()).done)&&(i.push(r.value),3!==i.length);a=!0);}catch(u){o=!0,s=u}finally{try{!a&&n.return&&n.return()}finally{if(o)throw s}}return i}(e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}(e.match(/\w\w/g).map((function(e){return parseInt(e,16)}))),n=t[0],i=t[1],a=t[2],o=Math.round((n+i+a)/3),s=function(e,t,n){return e=e.toString(16),t=t.toString(16),n=n.toString(16),1==e.length&&(e="0"+e),1==t.length&&(t="0"+t),1==n.length&&(n="0"+n),"#"+e+t+n}(o,o,o);r=r.replace(e,s)}))),(0,a.default)(r)}},666:function(e,t,n){"use strict";var r=n(667);e.exports={createLocalBlob:function(e){var t,n,i,a,o=(e.match(/(data\:([a-z]+\/[a-z\+]+)\;base64\,)([a-zA-Z0-9\/\+]+\(\=+)?/)||[,,])[1];return o?(n=(t=o.match(/data\:([a-z]+\/[a-z\+]+)\;base64\,/)[1]).match(/[a-z]+\/([a-z\+]+)/)[1],e=e.replace(o,""),i=(0,r.base64ToBytes)(e),a=new File([i],"name."+n,{type:t}),URL.createObjectURL(a)):""}}},667:function(e,t,n){"use strict";var r=new(n(266).B64chromium);e.exports={bytesToBase64:r.bytesToBase64.bind(r),base64ToBytes:r.base64ToBytes.bind(r)}},675:function(e,t,n){"use strict";var r,i=n(676),a=Object.getPrototypeOf((r=regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e,this)})),function(){var e=r.apply(this,arguments);return new Promise((function(t,n){return function r(i,a){var o,s;try{s=(o=e[i](a)).value}catch(u){return void n(u)}if(!o.done)return Promise.resolve(s).then((function(e){r("next",e)}),(function(e){r("throw",e)}));t(s)}("next")}))})).constructor,o=Object.getPrototypeOf((function(){})).constructor,s=new o('var t = function(file) {\n    "use strict";\n    \n    try {\n        \n        return new Promise(function(resolve, _) {\n            resolve(new FileReaderSync().readAsDataURL(file));\n        });\n        \n    } catch(error) {\n    \n        return new Promise(function(resolve, _) {\n            var reader = new FileReader();\n            reader.onload = function(){ resolve(reader.result)};\n            reader.readAsDataURL(file);\n        });\n    }\n    \n}; return t;')(),u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null!==n?n.exec(s,[e]).catch((function(t){return s(e)})).timeout(5e3).then((function(e){t(e)})):s(e).then((function(e){t(e)}))},c=new a('var t = async function(base64) {\n\n    "use strict";\n\n    return fetch(base64).then(function(res) {\n\n        return res.blob().then(function(blb){\n\n            return createImageBitmap(blb, {\n                resizeQuality: "pixelated",\n                premultiplyAlpha: \'premultiply\'\n            });\n        });\n    });\n\n}; return t;')(),l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null!==n?n.exec(c,[e]).catch((function(t){return c(e)})).timeout(5e3).then((function(e){t(e)})):c(e).then((function(e){t(e)}))},h=function(e){for(var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2073600,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},a=1;Math.round(e.width*a)*Math.round(e.height*a)>r;)a-=.01;try{createImageBitmap(e,0,0,e.width,e.height,{resizeWidth:Math.round(e.width*a),resizeHeight:Math.round(e.height*a),resizeQuality:"pixelated",premultiplyAlpha:"premultiply"}).then((function(e){var t,n=void 0;try{n=new OffscreenCanvas(e.width,e.height)}catch(r){(n=document.createElement("canvas")).width=e.width,n.height=e.height}(t=n.getContext("2d")).imageSmoothingEnabled=!1,t.drawImage(e,0,0,e.width,e.height),i(t.getImageData(0,0,e.width,e.height))}))}catch(o){t=void 0;try{t=new OffscreenCanvas(Math.round(e.width*a),Math.round(e.height*a))}catch(s){(t=document.createElement("canvas")).width=Math.round(e.width*a),t.height=Math.round(e.height*a)}(n=t.getContext("2d")).imageSmoothingEnabled=!1,n.drawImage(e,0,0,t.width,t.height),i(n.getImageData(0,0,t.width,t.height))}},f=new o('var t = function(imagedata, type) {\n\n    "use strict"\n    type = type || "image/png";\n    var quality = type.includes("webp") ? 1: type.includes("png") ? undefined: 0.7;\n    try {\n    \n        return new Promise(function(resolve, _) {\n\n            createImageBitmap(imagedata, 0, 0, imagedata.width, imagedata.height, {\n                premultiplyAlpha: \'premultiply\',\n                resizeQuality: \'pixelated\'\n            }).then((bmp) => {\n            \n                var canvas;\n                    canvas = new OffscreenCanvas(imagedata.width, imagedata.height);\n                var ctx = canvas.getContext("bitmaprenderer");\n                    ctx.imageSmoothingEnabled = false;\n                    ctx.transferFromImageBitmap(bmp);\n                \n                canvas.convertToBlob({type: type, quality: quality}).then((blb) => {\n                    try {\n                        resolve(new FileReaderSync().readAsDataURL(blb));\n                    } catch(e2) {\n                        var reader = new FileReader();\n                        reader.onload = function(){ resolve(reader.result)};\n                        reader.readAsDataURL(blb);\n                    }\n                });\n            });\n        });\n       \n    }catch (e) {\n    \n        return new Promise(function(resolve, _) {\n            var canvas = document.createElement("canvas");\n            canvas.width = imagedata.width;\n            canvas.height = imagedata.height;\n            var ctx = canvas.getContext("2d");\n            ctx.imageSmoothingEnabled = false;\n            ctx.putImageData(imagedata, 0, 0);\n            \n            var base64 = canvas.toDataURL(type, quality);\n            canvas = null;\n            resolve(base64);\n        });\n    }\n\n}; return t;')();e.exports={file_to_imagedata_resized:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;Date.now(),e.type,"image/jpg"!==e.type&&e.type,e.type,u(e,(function(e){l(e,(function(e){h(e,t,(function(e){n(e)}),r)}),r)}),r)},file_to_base64:u,base64_to_bitmap:l,bitmap_to_imagedata:h,imagedata_to_base64:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/png",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;null!==r?r.exec(f,[e,t]).catch((function(n){return f(e,t)})).timeout(5e3).then((function(e){n(e)})):f(e,t).then((function(e){n(e)}))},base64_sanitize:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};(function(e,t,n){return n=n||"pixelize",new Promise((function(r,a){var o=new Image,s=e.startsWith("data:image/png;");o.onload=function(){var e,a,u=o.naturalWidth*t,c=o.naturalHeight*t,l=function(e,t,n,r){var a,o,s,u,c=void 0;if("pixelize"===r||"normal"===r){a=void 0,o=void 0;try{a=new OffscreenCanvas(e.width,e.height),o=new OffscreenCanvas(t,n)}catch(l){a=document.createElement("canvas"),o=document.createElement("canvas"),a.width=e.width,a.height=e.height,o.width=t,o.height=n}s=a.getContext("2d"),u=o.getContext("2d"),s.imageSmoothingEnabled=!("normal"!==r),u.imageSmoothingEnabled=!("normal"!==r),s.drawImage(e,0,0,e.width,e.height),u.drawImage(a,0,0,a.width,a.height,0,0,o.width,o.height),c=u}else"doppel"===r&&(c=i.scaler.processImage(e,t,n));return c}(o,0|u,0|c,n);try{e=l.getImageData(0,0,l.canvas.width,l.canvas.height),createImageBitmap(e).then((function(e){var t,n;try{t=new OffscreenCanvas(e.width,e.height)}catch(i){(t=document.createElement("canvas")).height=e.height,t.width=e.width}(n=t.getContext("bitmaprenderer")).imageSmoothingEnabled=!1,n.transferFromImageBitmap(e),t.convertToBlob({type:s?"image/png":"image/jpeg"}).then((function(e){try{r((new FileReaderSync).readAsDataURL(e))}catch(n){var t=new FileReader;t.onload=function(){r(t.result)},t.readAsDataURL(e)}}))}))}catch(h){a=l.canvas,r(a.toDataURL(s?"image/png":"image/jpeg"))}},o.onerror=function(){a()},o.src=e}))})(e,arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,arguments[4]).then((function(e){t(e)}))},file_to_bitmap:function(e,t){createImageBitmap(e).then(t)}}},676:function(e,t,n){"use strict";var r,i=(r=n(677))&&r.__esModule?r:{default:r},a=new i.default({strength:1,overlapFactor:1,despeckleStrength:.88});e.exports={scaler:a,ImageProcessor:i.default}},677:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i,a,o,s,u,c,l,h,f,p,d,g;Object.defineProperty(t,"__esModule",{value:!0}),i=function(){function e(e,t){var n,r;for(n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(658),o=r(a),s=n(678),u=r(s),c=n(680),l=r(c),h=n(660),f=r(h),p=n(650),d=r(p),g=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.o=t||{},this.canvas=f.default.initializeCanvas(void 0,1,1).canvas,this.targetCanvas=f.default.initializeCanvas(void 0,1,1).canvas,this.options={despeckleStrength:this.o.despeckleStrength||this.o.strength||1,quantizeStrength:this.o.quantizeStrength||this.o.strength||1,mergeStrength:this.o.mergeStrength||this.o.strength||1,overlapFactor:this.o.overlapFactor||this.o.strength||1}}return i(e,[{key:"updateFilters",value:function(e){this.filters=new l.default(this.options,this.tilesManager,e,this.finalWidth,this.finalHeight)}},{key:"computeSmartParameters",value:function(){var e,t,n,r,i,a,s,u;this.imageManager=new o.default(this.context),t=(e=this.imageManager.computePaletteData()).colorNumber,n=e.colorNumberCertainty,r=e.colorData,n>.25&&(this.options.quantizeStrength=t,a=(i=this.imageManager.analyzeImageForTileSize(r)).tileSize,s=i.certainty,u=Math.sqrt(this.tileWidth*this.tileHeight),console.log(s,a),4*a>u&&a<4*u&&(console.log("changeFinalCanvasParameters: "+(this.canvas.width/a|0)+"/"+(this.canvas.height/a|0)),this.changeFinalCanvasParameters(this.canvas.width/a|0,this.canvas.height/a|0)))}},{key:"updateTiles",value:function(){this.tilesManager=new u.default(this.context,this.targetContext,this.targetImageData,this.sizes),this.tilesManager.createTiles(),this.tilesManager.computeTiles()}},{key:"paintTiles",value:function(){this.tilesManager.paintTiles()}},{key:"filterTiles",value:function(){this.filters.applyFilters()}},{key:"setCanvas",value:function(e,t,n){var r,i;e=0|e||1,t=0|t||1,n=n||{width:0,height:0},r=f.default.initializeCanvas(n),this.canvas=r.canvas,this.context=r.context,i=f.default.initializeCanvas(void 0,e,t),this.targetCanvas=i.canvas,this.targetContext=i.context,this.targetImageData=this.targetContext.getImageData(0,0,e,t),this.finalWidth=e,this.finalHeight=t,this.tileWidth=Math.fround(this.canvas.width/this.targetCanvas.width),this.tileHeight=Math.fround(this.canvas.height/this.targetCanvas.height)}},{key:"changeFinalCanvasParameters",value:function(e,t){e=0|e||1,t=0|t||1;var n=f.default.initializeCanvas(void 0,e,t);this.targetCanvas=n.canvas,this.targetContext=n.context,this.targetImageData=this.targetContext.getImageData(0,0,e,t),this.finalWidth=e,this.finalHeight=t,this.tileWidth=Math.fround(this.canvas.width/this.targetCanvas.width),this.tileHeight=Math.fround(this.canvas.height/this.targetCanvas.height)}},{key:"updateThreshold",value:function(){var e,t,n,r,i,a=this,o=this.tilesManager.getTiles(),s=[];for(e=0;e<this.finalHeight;e++)for(t=function(t){var n=o[t+e*a.finalWidth];a.tilesManager.getExtendedNeighbors(t,e,1).forEach((function(e){s.push(d.default.colorDifference(n.meanColor,e.meanColor))}))},n=0;n<this.finalWidth;n++)t(n);return r=s.reduce((function(e,t){return e+t}),0)/s.length,i=Math.sqrt(s.map((function(e){return Math.pow(e-r,2)})).reduce((function(e,t){return e+t}))/s.length),(r+i)/25}},{key:"processImage",value:function(e,t,n){var r,i,a,o,s,u,c,l=Date.now();return this.setCanvas(t,n,e),e.width<=t&&e.height<=n?this.context:(r=Date.now(),this.computeSmartParameters(),i=Date.now(),this.updateTiles(),a=Date.now(),this.updateFilters(this.updateThreshold()),o=Date.now(),this.filterTiles(),s=Date.now(),this.paintTiles(),u=Date.now(),console.log({setCanvas:r-l,updateTilesManager:i-r,initializeTiles:a-i,"updateFilters+updateThreshold":o-a,filterTiles:s-o,paintTiles:u-o}),c=this.targetContext,this.reset(),c)}},{key:"reset",value:function(){var e=this;Array.of("targetContext","tileHeight","tileWidth","finalWidth","finalHeight","targetImageData","targetContext","targetCanvas","context","canvas","tilesManager","filters","imageManager").forEach((function(t){delete e[t]})),this.canvas=f.default.initializeCanvas(void 0,1,1).canvas,this.targetCanvas=f.default.initializeCanvas(void 0,1,1).canvas}},{key:"sizes",get:function(){return{finalWidth:this.finalWidth,finalHeight:this.finalHeight,tileWidth:this.tileWidth,tileHeight:this.tileHeight,overlapFactor:this.options.overlapFactor}}}]),e}(),t.default=g},678:function(e,t,n){"use strict";var r,i,a,o,s;Object.defineProperty(t,"__esModule",{value:!0}),r=function(){function e(e,t){var n,r;for(n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(679),a=(s=i)&&s.__esModule?s:{default:s},o=function(){function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.contextSource=t,this.contextDestination=n,this.imageData=r,this.overlapFactor=i.overlapFactor,this.finalWidth=i.finalWidth,this.finalHeight=i.finalHeight,this.tileWidth=i.tileWidth,this.tileHeight=i.tileHeight,this.tiles=Array(this.finalWidth*this.finalHeight).fill(null),this.tilesColorUint32a=new Uint32Array(this.finalWidth*this.finalHeight),this.tilesColorUint8a=new Uint8ClampedArray(this.tilesColorUint32a.buffer),this.extendedTileWidth=this.tileWidth*this.overlapFactor|0,this.extendedTileHeight=this.tileHeight*this.overlapFactor|0,this.tilePaddingWidth=(this.extendedTileWidth-this.tileWidth)/2+1|0,this.tilePaddingHeight=(this.extendedTileHeight-this.tileHeight)/2+1|0}return r(e,[{key:"getTiles",value:function(){return this.tiles}},{key:"extractTileData",value:function(e,t){var n=Math.max(0,e*this.tileWidth-this.tilePaddingWidth|0),r=Math.max(0,t*this.tileHeight-this.tilePaddingHeight|0);return this.contextSource.getImageData(0|n,0|r,0|this.extendedTileWidth,0|this.extendedTileHeight)}},{key:"createTiles",value:function(){var e,t,n,r;for(e=0;e<this.finalHeight;e++)for(t=0;t<this.finalWidth;t++)r=4*(n=t+e*this.finalWidth),this.tiles[n]=new a.default(this.extractTileData(t,e),this.tilesColorUint8a.subarray(r,r+4),t,e)}},{key:"computeTiles",value:function(){for(var e=0;e<this.tiles.length;e++)this.tiles[e].calculateMeanColor()}},{key:"getExtendedNeighbors",value:function(e,t,n){var r,i,a,o,s=[];for(r=-n;r<=n;r++)for(i=-n;i<=n;i++)a=e+r,o=t+i,0===r&&0===i||a<0||o<0||a>=this.finalWidth||o>=this.finalHeight||s.push(this.tiles[a+o*this.finalWidth]);return s}},{key:"paintTiles",value:function(){this.imageData.data.set(this.tilesColorUint8a),this.contextDestination.putImageData(this.imageData,0,0)}}]),e}(),t.default=o},679:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i,a,o,s,u,c;Object.defineProperty(t,"__esModule",{value:!0}),i=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n,r,i=[],a=!0,o=!1,s=void 0;try{for(n=e[Symbol.iterator]();!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(u){o=!0,s=u}finally{try{!a&&n.return&&n.return()}finally{if(o)throw s}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},a=function(){function e(e,t){var n,r;for(n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(649),s=r(o),r(n(659)),u=n(652),c=function(){function e(t,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.imageData=t,this.meanColor=new s.default(n),this.coordinates=Uint16Array.of(i,a),r=this.imageData.data.length,this.k=r>=64?8:r>=16?6:r>=9?4:r>=2?3:1}return a(e,[{key:"extractColorData",value:function(e){var t,n=Array(e.length/4);for(t=0;t<e.length;t+=4)n[t/4]=e.subarray(t,t+4);return n}},{key:"quantizeColors",value:function(){var e,t=u.QuantiMat.split_image_data(this.imageData),n=i(t,2),r=n[0],a=n[1],o=(0,u.QuantiMat)({pxls:r,pxl_colors:a,number_of_color:Math.min(a.length,this.k),width:this.imageData.width,height:this.imageData.height}).init().run().output("split"),s=o[0],c=o[1],l=new Uint32Array(c.length);for(e=0;e<s.length;e++)l[c.indexOf(c[s[e]])]++;return[l,c]}},{key:"calculateMeanColor",value:function(){var e=this.quantizeColors(),t=i(e,2),n=t[0],r=t[1][n.indexOf(Math.max.apply(Math,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(Array.from(n))))];this.meanColor.setUint32(r)}},{key:"x",get:function(){return this.coordinates[0]}},{key:"y",get:function(){return this.coordinates[1]}}]),e}(),t.default=c},680:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i,a,o,s,u,c,l,h;Object.defineProperty(t,"__esModule",{value:!0}),i=function(){function e(e,t){var n,r;for(n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(681),o=r(a),s=n(682),u=r(s),c=n(683),l=r(c),h=function(){function e(t,n,r,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mergeFilter=new o.default(r*t.mergeStrength,n,i,a),this.despeckleFilter=new u.default(r*t.despeckleStrength,n,i,a),this.quantizeFilter=new l.default(t.quantizeStrength,n,i,a)}return i(e,[{key:"applyFilters",value:function(){this.quantizeFilter.apply()}}]),e}(),t.default=h},681:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i,a,o,s,u;Object.defineProperty(t,"__esModule",{value:!0}),i=function(){function e(e,t){var n,r;for(n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=r(n(653)),o=n(650),s=r(o),u=function(e){function t(e,n,r,i){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r,i))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"apply",value:function(){var e,t,n,r=this,i=Array(this.width*this.height).fill(!1);for(e=0;e<this.height;e++)for(t=function(t){var n,a,o,u,c=t+e*r.width;if(i[c])return"continue";n=r.tiles[c],o=(a=r.tilesManager.getExtendedNeighbors(t,e,1)).length,(u=a.filter((function(e){return s.default.colorDifference(n.meanColor,e.meanColor)<r.strength}))).length>=o-2&&(u.forEach((function(e){e.meanColor.setRGBA(n.meanColor.rgba);var t=e.x+e.y*r.width;i[t]=!0})),i[c]=!0)},n=0;n<this.width;n++)t(n)}}]),t}(a.default),t.default=u},682:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i,a,o,s,u,c,l,h,f;Object.defineProperty(t,"__esModule",{value:!0}),i=function(){function e(e,t){var n,r;for(n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=r(n(653)),o=n(650),s=r(o),u=n(649),c=r(u),l=n(659),h=r(l),f=function(e){function t(e,n,r,i){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r,i))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"apply",value:function(){var e,t;for(e=0;e<this.height;e++)for(t=0;t<this.width;t++)this.adaptiveDespeckleTile(t,e,this.strength)}},{key:"adaptiveDespeckleTile",value:function(e,t,n){var r,i,a,o,u,l,f,p,d=this.tiles[e+t*this.width].meanColor,g=this.tilesManager.getExtendedNeighbors(e,t,4),_=this.tilesManager.getExtendedNeighbors(e,t,1),v=g.length,m=g.map((function(e){return e.meanColor})),y=new h.default(m.map((function(e){return e.rgba})),4).run(v),b=(y.centroids,y.centroidsSorted);switch(y.clusters,this.determineClassification(b,v)){case"AREA":r=new c.default(b[0].data),(i=s.default.colorDifference(r,d))>0&&i<60&&d.setRGBA(r.rgba);break;case"EDGE":a=new c.default(b[0].data),o=new c.default(b[1].data),u=s.default.colorDifference(a,o),l=s.default.colorDifference(a,d),f=s.default.colorDifference(o,d),5*Math.abs(l-f)>=u&&(p=new c.default(new h.default(_.map((function(e){return e.meanColor.rgba})),4).run(4).centroidsSorted[0].data),d.setRGBA(p.rgba))}}},{key:"determineClassification",value:function(e,t){return e[0].count>=.75*t?"AREA":Math.abs(e[0].count-e[1].count)*Math.abs(e[2].count-e[3].count)<25?"SHAPE":Math.abs(e[0].count-e[1].count)<.75*Math.abs(e[1].count-e[2].count)?"EDGE":"COMPLEX"}}]),t}(a.default),t.default=f},683:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i,a,o,s,u,c,l;Object.defineProperty(t,"__esModule",{value:!0}),i=function(){function e(e,t){var n,r;for(n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=r(n(653)),o=n(658),s=r(o),u=n(660),c=r(u),l=function(e){function t(e,n,r,i){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r,i))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"apply",value:function(){var e=this.strength,t=new ImageData(this.tilesManager.tilesColorUint8a,this.width,this.height),n=c.default.initializeCanvas(t).context,r=s.default.quantizeImageData(n,e).imageData;this.tilesManager.tilesColorUint8a.set(r.data)}}]),t}(a.default),t.default=l},690:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(n(738)),a=r(n(259));e.exports={UJS:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"COMPRESS_OBJECT";return new Promise((function(n,r){"COMPRESS_OBJECT"===t?n(new Uint8ClampedArray(i.default.compress(a.default.pack(e)).buffer)):"DECOMPRESS_UINT8A"===t&&n(a.default.unpack(i.default.uncompress(e)))}))}}},826:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(n(656)),a=r(n(155)),o=r(n(827));e.exports={base64png_to_xbrz_svg:function(e,t,r,s){var u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"xbrz",l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],h=arguments.length>7&&void 0!==arguments[7]&&arguments[7],f=arguments.length>8&&void 0!==arguments[8]&&arguments[8],p=new Image;p.onload=function(){var e,d,g,_,v,m,y,b,w,x,k=document.createElement("canvas"),E=k.getContext("2d"),O=p.width,S=p.height;k.width=O,k.height=S,E.drawImage(p,0,0,O,S),e=E.getImageData(0,0,O,S),d=function(e,t){return new Promise((function(t,r){(0,a.default)((function(){return n.e(4).then(n.t.bind(null,718,7))})).then((function(n){(0,n.crt)(e,1).then(t).catch(r)}))}))},g=function(e,t,r,o,s){l?(0,a.default)((function(){return n.e(1).then(n.t.bind(null,664,7))})).then((function(u){(0,u.oxi_png)(e,3,!1,i.default).then((function(e){s(e,t,r,o)})).catch((function(){(0,a.default)((function(){return n.e(0).then(n.t.bind(null,654,7))})).then((function(n){(0,n.png_quant)(e,100,100,1,i.default).then((function(e){s(e,t,r,o)})).catch((function(){s(e,t,r,o)}))})).catch((function(){s(e,t,r,o)}))}))})).catch((function(){s(e,t,r,o)})):s(e,t,r,o)},_=function(e,t){h?(0,a.default)((function(){return n.e(24).then(n.t.bind(null,944,7))})).then((function(o){(0,o.image_tracer)(e,{pal:u.map((function(e){return{r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16),a:parseInt(e.slice(7,9),16)}})),corsenabled:!1,ltres:t,qtres:t,pathomit:t,rightangleenhance:!1,colorsampling:2,numberofcolors:512,mincolorratio:0,colorquantcycles:1,layering:0,strokewidth:Math.ceil(t/2),linefilter:!0,scale:1,roundcoords:2,viewbox:!0,desc:!1,lcpr:0,qcpr:0,blurradius:t,blurdelta:4*t},i.default).then((function(e){l?(0,a.default)((function(){return n.e(2).then(n.bind(null,688))})).then((function(n){var i=n.optimize;e=i(e,{path:"path-to.svg",multipass:!0,mergePaths:!0,mergeStyles:!0,collapseGroups:!0,reusePaths:!0,plugin:["multipass","mergePaths","collapseGroups","reusePaths","mergeStyles"]}).data,r("data:image/svg+xml;base64,"+window.btoa(e),t)})):r("data:image/svg+xml;base64,"+window.btoa(e),t)}))})):r("",0)},"depixelize"===c?(m=(v=(0,o.default)(e,h))[0],y=v[1],(b=document.createElement("canvas")).width=m.width,b.height=m.height,(w=b.getContext("2d")).putImageData(m,0,0),x=w.canvas.toDataURL("image/png"),f&&d(m).then((function(e){var t,n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("2d").putImageData(e,0,0),t=n.toDataURL("image/png"),g(t,10,e.width,e.height,s)})),h&&(l?(0,a.default)((function(){return n.e(2).then(n.bind(null,688))})).then((function(e){var t=e.optimize;y=t(y,{path:"path-to.svg",multipass:!0,plugin:["mergePaths"]}).data,r("data:image/svg+xml;base64,"+window.btoa(y),10)})):r("data:image/svg+xml;base64,"+window.btoa(y),10)),g(x,10,m.width,m.height,t)):"omniscale"===c?(0,a.default)((function(){return n.e(25).then(n.t.bind(null,945,7))})).then((function(n){(0,n.omniscale)(e,8,i.default).then((function(e){var n,r,i=document.createElement("canvas");i.width=e.width,i.height=e.height,(n=i.getContext("2d")).putImageData(e,0,0),r=n.canvas.toDataURL("image/png"),f&&d(e).then((function(e){var t,n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("2d").putImageData(e,0,0),t=n.toDataURL("image/png"),g(t,8,e.width,e.height,s)})),_(e,8),g(r,8,e.width,e.height,t)}))})):"hexagon"===c?(0,a.default)((function(){return n.e(7).then(n.t.bind(null,719,7))})).then((function(n){(0,n.hexagonrender)(e,16).then((function(e){var n,r,i=document.createElement("canvas");i.width=e.width,i.height=e.height,(n=i.getContext("2d")).putImageData(e,0,0),r=n.canvas.toDataURL("image/png"),f&&d(e).then((function(e){var t,n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("2d").putImageData(e,0,0),t=n.toDataURL("image/png"),g(t,16,e.width,e.height,s)})),_(e,32/6),g(r,32,e.width,e.height,t)}))})):"kikko"===c?(0,a.default)((function(){return n.e(44).then(n.t.bind(null,946,7))})).then((function(n){(0,n.kikkorender)(e,24,i.default).then((function(e){var n,r,i=document.createElement("canvas");i.width=e.width,i.height=e.height,(n=i.getContext("2d")).putImageData(e,0,0),r=n.canvas.toDataURL("image/png"),f&&d(e).then((function(e){var t,n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("2d").putImageData(e,0,0),t=n.toDataURL("image/png"),g(t,24,e.width,e.height,s)})),_(e,6),g(r,48,e.width,e.height,t)}))})):"hqnx"===c?(0,a.default)((function(){return n.e(23).then(n.t.bind(null,947,7))})).then((function(n){(0,n.hqnx)(e,4,i.default).then((function(e){var n,r,i=document.createElement("canvas");i.width=e.width,i.height=e.height,(n=i.getContext("2d")).putImageData(e,0,0),r=n.canvas.toDataURL("image/png"),f&&d(e).then((function(e){var t,n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("2d").putImageData(e,0,0),t=n.toDataURL("image/png"),g(t,4,e.width,e.height,s)})),_(e,4),g(r,4,e.width,e.height,t)}))})):"epx"===c?(0,a.default)((function(){return n.e(22).then(n.t.bind(null,948,7))})).then((function(n){(0,n.epx)(e,4,i.default).then((function(e){var n,r,i=document.createElement("canvas");i.width=e.width,i.height=e.height,(n=i.getContext("2d")).putImageData(e,0,0),r=n.canvas.toDataURL("image/png"),f&&d(e).then((function(e){var t,n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("2d").putImageData(e,0,0),t=n.toDataURL("image/png"),g(t,4,e.width,e.height,s)})),_(e,4),g(r,4,e.width,e.height,t)}))})):(0,a.default)((function(){return n.e(5).then(n.t.bind(null,720,7))})).then((function(n){n.default(e,6,i.default).then((function(e){var n,r,i=document.createElement("canvas");i.width=e.width,i.height=e.height,(n=i.getContext("2d")).putImageData(e,0,0),r=n.canvas.toDataURL("image/png"),f&&d(e).then((function(e){var t,n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("2d").putImageData(e,0,0),t=n.toDataURL("image/png"),g(t,6,e.width,e.height,s)})),_(e,6),g(r,6,e.width,e.height,t)}))}))},p.src=e}}},827:function(e,t,n){"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==m(Symbol.iterator)?function(e){return void 0===e?"undefined":m(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":m(e)},r(e)}function i(){function e(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}function t(e,t,n,r){var i=t&&t.prototype instanceof a?t:a,o=Object.create(i.prototype),s=new d(r||[]);return b(o,"_invoke",{value:l(e,n,s)}),o}function n(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(r){return{type:"throw",arg:r}}}function a(){}function o(){}function s(){}function u(t){["next","throw","return"].forEach((function(n){e(t,n,(function(e){return this._invoke(n,e)}))}))}function c(e,t){function i(a,o,s,u){var c,l,h=n(e[a],e,o);if("throw"!==h.type)return(l=(c=h.arg).value)&&"object"==r(l)&&y.call(l,"__await")?t.resolve(l.__await).then((function(e){i("next",e,s,u)}),(function(e){i("throw",e,s,u)})):t.resolve(l).then((function(e){c.value=e,s(c)}),(function(e){return i("throw",e,s,u)}));u(h.arg)}var a;b(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return a=a?a.then(r,r):r()}})}function l(e,t,r){var i="suspendedStart";return function(a,o){var s,u,c;if("executing"===i)throw Error("Generator is already running");if("completed"===i){if("throw"===a)throw o;return{value:void 0,done:!0}}for(r.method=a,r.arg=o;;){if((s=r.delegate)&&(u=h(s,r))){if(u===O)continue;return u}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===i)throw i="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);if(i="executing","normal"===(c=n(e,t,r)).type){if(i=r.done?"completed":"suspendedYield",c.arg===O)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i="completed",r.method="throw",r.arg=c.arg)}}}function h(e,t){var r,i,a=t.method,o=e.iterator[a];return void 0===o?(t.delegate=null,"throw"===a&&e.iterator.return&&(t.method="return",t.arg=void 0,h(e,t),"throw"===t.method)||"return"!==a&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+a+"' method")),O):"throw"===(r=n(o,e.iterator,t.arg)).type?(t.method="throw",t.arg=r.arg,t.delegate=null,O):(i=r.arg)?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,O):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,O)}function f(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function p(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function d(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(f,this),this.reset(!0)}function g(e){var t,n,r;if(e){if(t=e[x])return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return n=-1,(r=function t(){for(;++n<e.length;)if(y.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t}).next=r}return{next:_}}function _(){return{value:void 0,done:!0}}var v,m,y,b,w,x,k,E,O,S,j,P,C;i=function(){return v},v={},y=(m=Object.prototype).hasOwnProperty,b=Object.defineProperty||function(e,t,n){e[t]=n.value},w="function"==typeof Symbol?Symbol:{},x=w.iterator||"@@iterator",k=w.asyncIterator||"@@asyncIterator",E=w.toStringTag||"@@toStringTag";try{e({},"")}catch(R){e=function(e,t,n){return e[t]=n}}return v.wrap=t,O={},e(S={},x,(function(){return this})),(P=(j=Object.getPrototypeOf)&&j(j(g([]))))&&P!==m&&y.call(P,x)&&(S=P),C=s.prototype=a.prototype=Object.create(S),o.prototype=s,b(C,"constructor",{value:s,configurable:!0}),b(s,"constructor",{value:o,configurable:!0}),o.displayName=e(s,E,"GeneratorFunction"),v.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===o||"GeneratorFunction"===(t.displayName||t.name))},v.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,e(t,E,"GeneratorFunction")),t.prototype=Object.create(C),t},v.awrap=function(e){return{__await:e}},u(c.prototype),e(c.prototype,k,(function(){return this})),v.AsyncIterator=c,v.async=function(e,n,r,i,a){void 0===a&&(a=Promise);var o=new c(t(e,n,r,i),a);return v.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},u(C),e(C,E,"Generator"),e(C,x,(function(){return this})),e(C,"toString",(function(){return"[object Generator]"})),v.keys=function(e){var t,n=Object(e),r=[];for(t in n)r.push(t);return r.reverse(),function e(){for(;r.length;){var t=r.pop();if(t in n)return e.value=t,e.done=!1,e}return e.done=!0,e}},v.values=g,d.prototype={constructor:d,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(p),!e)for(var t in this)"t"===t.charAt(0)&&y.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){function t(t,r){return a.type="throw",a.arg=e,n.next=t,r&&(n.method="next",n.arg=void 0),!!r}var n,r,i,a,o,s;if(this.done)throw e;for(n=this,r=this.tryEntries.length-1;r>=0;--r){if(i=this.tryEntries[r],a=i.completion,"root"===i.tryLoc)return t("end");if(i.tryLoc<=this.prev)if(o=y.call(i,"catchLoc"),s=y.call(i,"finallyLoc"),o&&s){if(this.prev<i.catchLoc)return t(i.catchLoc,!0);if(this.prev<i.finallyLoc)return t(i.finallyLoc)}else if(o){if(this.prev<i.catchLoc)return t(i.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return t(i.finallyLoc)}}},abrupt:function(e,t){var n,r,i,a;for(n=this.tryEntries.length-1;n>=0;--n)if((r=this.tryEntries[n]).tryLoc<=this.prev&&y.call(r,"finallyLoc")&&this.prev<r.finallyLoc){i=r;break}return i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null),(a=i?i.completion:{}).type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,O):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),O},finish:function(e){var t,n;for(t=this.tryEntries.length-1;t>=0;--t)if((n=this.tryEntries[t]).finallyLoc===e)return this.complete(n.completion,n.afterLoc),p(n),O},catch:function(e){var t,n,r,i;for(t=this.tryEntries.length-1;t>=0;--t)if((n=this.tryEntries[t]).tryLoc===e)return"throw"===(r=n.completion).type&&(i=r.arg,p(n)),i;throw Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:g(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),O}},v}function a(e,t){var n,r,i,a,o,s="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!s){if(Array.isArray(e)||(s=f(e))||t&&e&&"number"==typeof e.length)return s&&(e=s),n=0,{s:r=function(){},n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return i=!0,a=!1,{s:function(){s=s.call(e)},n:function(){var e=s.next();return i=e.done,e},e:function(e){a=!0,o=e},f:function(){try{i||null==s.return||s.return()}finally{if(a)throw o}}}}function o(e){var t="function"==typeof Map?new Map:void 0;return o=function(e){function n(){return s(e,arguments,l(this).constructor)}if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),c(n,e)},o(e)}function s(e,t,n){return s=u()?Reflect.construct.bind():function(e,t,n){var r,i=[null];return i.push.apply(i,t),r=new(Function.bind.apply(e,i)),n&&c(r,n.prototype),r},s.apply(null,arguments)}function u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function c(e,t){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},c(e,t)}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,i,a,o,s,u,c=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=c){o=[],s=!0,u=!1;try{if(i=(c=c.call(e)).next,0===t){if(Object(c)!==c)return;s=!1}else for(;!(s=(n=i.call(c)).done)&&(o.push(n.value),o.length!==t);s=!0);}catch(l){u=!0,r=l}finally{try{if(!s&&null!=c.return&&(a=c.return(),Object(a)!==a))return}finally{if(u)throw r}}return o}}(e,t)||f(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){if(e){if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(e,t):void 0}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){var n,i,a;for(n=0;n<t.length;n++)(i=t[n]).enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(a=function(e,t){var n,i;if("object"!==r(e)||null===e)return e;if(void 0!==(n=e[Symbol.toPrimitive])){if("object"!==r(i=n.call(e,"string")))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return e+""}(i.key),"symbol"===r(a)?a:a+""),i)}function _(e,t,n){return t&&g(e.prototype,t),n&&g(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function v(e){var t=e.length;return e.forEach((function(e,n,r){e.addEdge(r[(n+1)%t])})),e}var m,y,b;Object.defineProperty(t,"__esModule",{value:!0}),m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y=function(){function e(e,t,n){return[f(e,t,n),p(e,t,n),f(e,t+1,n),p(e,t,n+1)]}function t(e,t,n,r,i){var a,o=Array(i);for(a=0;a<i;++a)o[a]=e[a+n].slice(t,t+r);return o}function n(){this.vertices=[]}var s,f,p,g,v,m,y,b,w,x=function(){function e(t){var n,r=h(t,3),i=r[0],a=r[1],o=r[2];d(this,e),n=.299*i+.587*a+.114*o,this.y=Math.round(n),this.u=Math.round(.492*(o-n)),this.v=Math.round(.877*(i-n)),this.r=i,this.g=a,this.b=o,this.rgb=[i,a,o]}return _(e,[{key:"dissimilar",value:function(e){return Math.abs(this.r-e.r)+Math.abs(this.g-e.g)+Math.abs(this.b-e.b)>=1}},{key:"toString",value:function(){return"rgb("+this.rgb.join()+")"}}]),e}(),k=function(){function e(t,n){d(this,e),this.x=t,this.y=n,this.edges=[]}return _(e,[{key:"split",value:function(t){return new e((this.x+t.x)/2,(this.y+t.y)/2)}},{key:"adjust",value:function(e,t){return this.x+=e,this.y+=t,this}},{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"equals",value:function(e){return this.x===e.x&&this.y===e.y}},{key:"addEdge",value:function(e){-1==this.edges.indexOf(e)&&(this.edges.push(e),e.addEdge(this))}}]),e}(),E=function(e){function t(e){var n;return d(this,t),(n=o.call(this,1))[0]=e,n.circular=!1,n}!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}(t,e);var n,i,o=(n=t,i=u(),function(){var e,t,a=l(n);return i?(t=l(this).constructor,e=Reflect.construct(a,arguments,t)):e=a.apply(this,arguments),function(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});return _(t,[{key:"splitAt",value:function(e){var n,r,i,o,s;if(1!==this.length){if(this[0]===e)this.shift();else if(this[this.length-1]===e)this.pop();else if(this.circular)for(n=this.shift();n!==e;n=this.shift())this.push(n);else{r=this.indexOf(e),o=a(i=this.slice(r+1));try{for(o.s();!(s=o.n()).done;)s.value.curve=i}catch(u){o.e(u)}finally{o.f()}this.length=r}e.curve=new t(e)}}},{key:"merge",value:function(e){var t,n,r,i,a,o;if(this!==e)for(n=(t=h([this,e].sort((function(e,t){return e.length-t.length})),2))[0],-1!==(r=t[1])[0].edges.indexOf(n[0])?(i=this.shift,a=this.unshift):-1!==r[0].edges.indexOf(n[n.length-1])?(i=this.pop,a=this.unshift):-1!==r[r.length-1].edges.indexOf(n[0])?(i=this.shift,a=this.push):-1!==r[r.length-1].edges.indexOf(n[n.length-1])&&(i=this.pop,a=this.push);n.length;)o=i.call(n),a.call(r,o),o.curve=r;else this.circular=e.length>2}}],[{key:"curve",value:function(e,t){return e.curve===t.curve?e.curve.length:0}}]),t}(o(Array)),O=function(){function e(t,n,r,i){d(this,e),this.x=t,this.y=n,this.edges=[,,,,,,,,],this.vertices=i||[],this.color=r,this.marked=!1,this.curve=new E(this)}return _(e,[{key:"relativePosition",value:function(e){var t=e.x,n=e.y-this.y;return(t-this.x+3*n+8)%9}},{key:"invalidCurve",value:function(){return this.valence()>2&&this.curve.length>1}},{key:"updateCurves",value:function(){this.valence()>2&&this.curve.splitAt(this)}},{key:"equals",value:function(e){return this.x===e.x&&this.y===e.y}},{key:"removeEdge",value:function(t){e.removeEdge(this,t)}},{key:"canReach",value:function(e){return e&&!!this.edges[this.relativePosition(e)]}},{key:"valence",value:function(){return this.edges.filter((function(e){return e})).length}},{key:"toString",value:function(){return"("+[this.x,this.y].join()+") => "+this.edges.filter((function(e){return e})).map((function(e){return"("+[e.x,e.y].join()+")"})).join()}},{key:"edge",value:function(e,t){return this.edges[(e+3*t+8)%9]}},{key:"right",value:function(){return this.edges[0]}},{key:"left",value:function(){return this.edges[7]}},{key:"up",value:function(){return this.edges[5]}},{key:"down",value:function(){return this.edges[2]}},{key:"isEdge",value:function(){return this.edges.filter((function(e){return e})).length<4}},{key:"follow",value:i().mark((function e(t){var n,r,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this;case 1:if(!(n.canReach(t)&&n.valence()<3)){e.next=14;break}return e.next=4,t;case 4:if(!(t.valence()>2)){e.next=6;break}return e.abrupt("break",14);case 6:if(r=t.edges.filter((function(e){return e})),a=r[0]!=n?r[0]:r[1],n=t,(t=a)!=this){e.next=12;break}return e.abrupt("break",14);case 12:e.next=1;break;case 14:case"end":return e.stop()}}),e,this)}))},{key:"square",value:function(){var e=h(this.edges,3),t=e[0],n=e[2],r=t&&n&&t.down()&&n.right();return[this,t,n,r].filter((function(e){return e}))}}],[{key:"addSimilarEdge",value:function(e,t){e.color&&t.color&&!e.color.dissimilar(t.color)&&(e.edges[e.relativePosition(t)]=t,t.edges[t.relativePosition(e)]=e,e.valence()>2&&e.curve.splitAt(e),t.valence()>2&&t.curve.splitAt(t),e.valence()<3&&t.valence()<3&&e.curve.merge(t.curve))}},{key:"removeEdge",value:function(e,t){e.edges[e.relativePosition(t)]=void 0,t.edges[t.relativePosition(e)]=void 0}}]),e}(),S=function(){function e(t,n,r){if(d(this,e),t.length!=n*r*4)throw Error("Wrong dimension of pixel buffer");this.width=n,this.height=r,this.pixels=t}return _(e,[{key:"create",value:i().mark((function e(){var t,n,r,a,o,s,u,c,l,h,f,p,d,g,_;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=this.width,n=this.height,r=Array(n),(a=Array(n+1))[0]=Array(t+1),o=0;o<t+1;++o)a[0][o]=new k(o,0);s=new O,u=Array(t).fill(s),o=0;case 9:if(!(o<n)){e.next=31;break}c=[s,s],l=r[o]=Array(t),h=a[o],(f=a[o+1]=Array(t+1))[0]=new k(0,o+1),p=0;case 16:if(!(p<t)){e.next=27;break}return f[p+1]=new k(p+1,o+1),d=[h[p],h[p+1],f[p+1],f[p]],g=l[p]=new O(p,o,this.pixel(p,o),d),_=[u[p],g],e.next=23,[c,_];case 23:c=_;case 24:++p,e.next=16;break;case 27:u=l;case 28:++o,e.next=9;break;case 31:this.nodes_old=r,this.vertices=r;case 33:case"end":return e.stop()}}),e,this)}))},{key:"createSimilarityGraph",value:function(){var e,t,n,r,i,o,s,u,c=a(this.create());try{for(c.s();!(e=c.n()).done;)t=h(e.value,2),r=(n=h(t[0],2))[0],i=n[1],s=(o=h(t[1],2))[0],u=o[1],O.addSimilarEdge(s,u),O.addSimilarEdge(i,u),4!==r.square().length&&(O.addSimilarEdge(s,i),O.addSimilarEdge(r,u))}catch(l){c.e(l)}finally{c.f()}return this}},{key:"graph",value:function(){this.height,this.width}},{key:"nodes",value:i().mark((function(){var e,t,n,r,a;return i().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:n=this.width,r=this.height,a=this.nodes_old,t=0;case 2:if(!(t<r)){i.next=13;break}e=0;case 4:if(!(e<n)){i.next=10;break}return i.next=7,a[t][e];case 7:++e,i.next=4;break;case 10:++t,i.next=2;break;case 13:case"end":return i.stop()}}),a,this)}))},{key:"diagonals",value:i().mark((function e(){var t,n,r,a,o,s,u,c,l,h,f;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=this.width,s=this.height,u=this.nodes_old,n=1;case 2:if(!(n<s)){e.next=22;break}r=u[n-1],a=u[n],t=1;case 6:if(!(t<o)){e.next=19;break}if(c=r[t-1],l=r[t],h=a[t-1],f=a[t],!(c.canReach(l)||c.canReach(h)||f.canReach(l)||f.canReach(h))){e.next=13;break}return e.abrupt("continue",16);case 13:if(!c.canReach(f)||!l.canReach(h)){e.next=16;break}return e.next=16,[[c,f],[h,l]];case 16:++t,e.next=6;break;case 19:++n,e.next=2;break;case 22:case"end":return e.stop()}}),e,this)}))},{key:"pixel",value:function(e,t){var n=t*this.width*4+4*e;return new x(this.pixels.subarray(n,n+3))}}]),e}();return S.diagonals=function(e){return e[0][0].canReach(e[0][1])+e[1][0].canReach(e[1][1])},f=(s=function(e,t){var n=e,r=t;return function(e,t,i){return[e[i][t],e[i+r][t+n]]}})(0,1),p=s(1,0),g=s(1,1),v=s(1,-1),S.prototype.getDiagonals=function(e,t){return[g(this.nodes_old,e,t),v(this.nodes_old,e,t+1)]},m=function(e){return e[0].canReach(e[1])},y=function(e){return!e},b=function(e,t,n,r){return function(i){var a,o;for(i=i[0].edges.filter((function(e){return e})),a=[];i.length>0;)o=i.pop(),-1==a.indexOf(o)&&o.x>e&&o.x<t&&o.y>n&&o.y<r&&(a.push(o),i=i.concat(o.edges.filter((function(e){return e}))));return a}},S.prototype.linearize=function(){var t,n,r,i,a,o,s,u,c;for(t=1;t<this.width;++t)for(n=1;n<this.height;++n)e(this.nodes_old,t-1,n-1).map(m).every(y)&&(i=[0,0],a=(r=this.getDiagonals(t-1,n-1)).map(b(t-3,t+2,n-3,n+2)),(s=(o=r.map((function(e){return E.curve(e[0],e[1])})))[0]-o[1])>0?i[0]+=s:i[1]-=s,(u=a[0].length-a[1].length)>0?i[1]+=u:i[0]-=u,(c=r.map((function(e){return 1==e[0].valence()||1==e[1].valence()})))[0]&&!c[1]?i[0]+=5:!c[0]&&c[1]&&(i[1]+=5),i[0]>i[1]?O.removeEdge(r[1][0],r[1][1]):i[0]<i[1]?O.removeEdge(r[0][0],r[0][1]):(O.removeEdge(r[0][0],r[0][1]),O.removeEdge(r[1][0],r[1][1])));return this},w=function(e){var t,n,r,i=e[0][1];i.edge(-1,1)&&(r=(n=(t=i.vertices)[3]).clone(),i.down()||n.adjust(.25,.25),i.left()||r.adjust(-.25,-.25),e[0][0].vertices[2]=r,t.splice(4,0,r),r=(t=e[1][0].vertices).splice(0,1,r).pop(),t.push(r)),i.edge(1,1)&&(r=(n=(t=i.vertices)[2]).clone(),i.down()||n.adjust(-.25,.25),i.right()||r.adjust(.25,-.25),e[0][2].vertices[3]=r,t.splice(2,0,r),r=(t=e[1][2].vertices).splice(0,1,r).pop(),t.push(r))},S.prototype.createVoronoiDiagram=function(){var e,n,r,i=this.width-2,a=this.height-1,o=this.nodes_old;for(e=0;e<a;++e){for((n=t(o,0,e,2,2))[0].unshift(new O),n[1].unshift(new O),w(n),r=0;r<i;++r)w(t(o,r,e,3,2));(n=t(o,r,e,2,2))[0].push(new O),n[1].push(new O),w(n)}return this},S.prototype.contour=function(e){var t,n,r,i,a,o,s,u,c,l,h=e,f=[];if(0===h.valence())return h.vertices.slice();if(h.marked||!h.isEdge()||[[-1,-1],[0,-1],[1,-1]].some((function(e){return null!=this.edge.apply(this,e)}),h))return f;for(n=[],r=1,i=0,h.vertices[0],o=null;;){switch(h.marked=!0,n.push(h),t=void 0,r){case 1:if(t=h.edge(1,-1)){r=7;break}case 2:if(t=h.edge(1,0)){r=0;break}case 3:if(t=h.edge(1,1)){r=1;break}case 4:if(t=h.edge(0,1)){r=2;break}case 5:if(t=h.edge(-1,1)){r=3;break}case 6:if(t=h.edge(-1,0)){r=4;break}case 7:if(t=h.edge(-1,-1)){r=5;break}case 0:r=(t=h.edge(0,-1))?6:1}if(t){for(s=i,u=h.vertices.length,o&&t.equals(o)&&(a=h.vertices[s++%u],f.push(a));;){if(a=h.vertices[s++%u],-1!=(c=t.vertices.indexOf(a))){i=c;break}f.push(a)}if(e.equals(t)&&e.edges.filter((function(e){return e})).every((function(e){return e.marked||!e.isEdge()}))){for(s=i,u=t.vertices.length;s<u;)a=t.vertices[s++],f.push(a);break}o=h,h=t}}for(;0!=n.length;)(l=n.pop().edges.filter((function(e){return e&&!e.marked}))).forEach((function(e){e.marked=!0})),n.push.apply(n,l);return f},n.prototype=Object.create(null,{push:{enumerable:!1,value:function(e){this.vertices.push(e),e.addPath(this)}},splitAt:{enumerable:!1,value:function(e){var t=new n;t.vertices=this.vertices.slice(e),this.vertices.length=e+1,t.vertices.forEach((function(e){e.removePath(this),e.addPath(t)}))}}}),S.prototype.paths=function(e){new n},function(e,t,n){return new S(e,t,n)}}(),b=function(e,t,n){var r,i=y(e.data,e.width,e.height);return i.createSimilarityGraph(),i.createVoronoiDiagram(),i.linearize(),r=function(e,t){var n,r,i,a,o,s,u,c=e.width,l=e.height,h=e.nodes(),f=[],p=!0,d=!1,g=void 0;try{for(n=h[Symbol.iterator]();!(p=(r=n.next()).done);p=!0){for(i=r.value,a="L",s=(o=v(i.vertices))[0],u=0;u<o.length;++u)s=o[u],a+=Math.ceil(s.x*t)+","+Math.ceil(s.y*t)+" ";f.push('<path fill="'+i.color+'" d="M'+Math.ceil(o[0].x*t)+","+Math.ceil(o[0].y*t)+" "+a+'Z"/>')}}catch(_){d=!0,g=_}finally{try{!p&&n.return&&n.return()}finally{if(d)throw g}}return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 '+c*t+" "+l*t+'">'+f.join("\n\t")+"</svg>"}(i,t),r},t.default=b},828:function(e,t,n){"use strict";var r=n(829);e.exports={loadJSON:function(e,t){var n=new XMLHttpRequest;try{n=new XMLHttpRequest}catch(r){try{n=new ActiveXObject("Msxml2.XMLHTTP")}catch(r){try{n=new ActiveXObject("Microsoft.XMLHTTP")}catch(r){t("Cannot load data",null)}}}n.open("GET",e,!0),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status)try{var e=JSON.parse(n.responseText);t(null,e)}catch(r){t("Cannot understand response from network.",null)}else 4==n.readyState&&404==n.status&&t("Error 404",null)};try{n.send()}catch(r){t("Failed to fetch",null)}},postJSON:function(e,t,n){var i,a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"application/x-www-form-urlencoded",s=new Headers;s.append("Content-Type",o),i="multipart/form-data"===o?new FormData:new URLSearchParams,Object.entries(t).forEach((function(e){var t=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n,r,i=[],a=!0,o=!1,s=void 0;try{for(n=e[Symbol.iterator]();!(a=(r=n.next()).done)&&(i.push(r.value),2!==i.length);a=!0);}catch(u){o=!0,s=u}finally{try{!a&&n.return&&n.return()}finally{if(o)throw s}}return i}(e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}(e),n=t[0],r=t[1];i.append(n,r)})),a={method:"POST",redirect:"follow",headers:s,body:"application/text"===o?t:"application/json"===o?(0,r.clean_json_text)(JSON.stringify(t)):i},fetch(e,a).then((function(e){return e.text()})).then((function(e){return n(null,e)})).catch((function(e){return n(e,null)}))},postDATA:function(e,t,n){var r=new XMLHttpRequest;try{r=new XMLHttpRequest}catch(i){try{r=new ActiveXObject("Msxml2.XMLHTTP")}catch(i){try{r=new ActiveXObject("Microsoft.XMLHTTP")}catch(i){return void n("Cannot load data",null)}}}r.open("POST",e,!0),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){if(4==r.readyState&&200==r.status)try{var e=JSON.parse(r.responseText);n(null,e)}catch(i){n("Cannot understand response from network.",null)}else 4==r.readyState&&404==r.status&&n("Error 404",null)};try{r.send(t)}catch(i){n("Failed to post",null)}}}},829:function(e,t,n){"use strict";e.exports={clean_json_text:function(e){return(e=e.replace(/\\n/g,"\\n").replace(/\\'/g,"\\'").replace(/\\"/g,'\\"').replace(/\\&/g,"\\&").replace(/\\r/g,"\\r").replace(/\\t/g,"\\t").replace(/\\b/g,"\\b").replace(/\\f/g,"\\f")).replace(/[\u0000-\u0019]+/g,"")}}},839:function(e,t,n){"use strict";!function(e,r,i){function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e){if("function"==typeof Symbol){if(Symbol.asyncIterator){var t=e[Symbol.asyncIterator];if(null!=t)return t.call(e)}if(Symbol.iterator)return e[Symbol.iterator]()}throw new TypeError("Object is not async iterable")}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function c(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,n){return function r(i,a){var o,s;try{s=(o=t[i](a)).value}catch(u){return void n(u)}if(!o.done)return Promise.resolve(s).then((function(e){r("next",e)}),(function(e){r("throw",e)}));e(s)}("next")}))}}function l(e,t,n){return e=e.split("."),t=t.split("."),pe(e[0],t[0])||pe(e[1],t[1])||(t[2]=t.slice(2).join("."),(n=/[.-]/.test(e[2]=e.slice(2).join(".")))==/[.-]/.test(t[2])?pe(e[2],t[2]):n?-1:1)}function h(e,t,n){return t.startsWith("http://")||t.startsWith("https://")?n?e:t:e+t}function f(e){var t={};return e.forEach((function(e){var n=e.api_name,r=e.id;n&&(t[n]=r)})),t}function p(e){if(e.startsWith("http")){var t=new URL(e),n=t.protocol,r=t.host,i=t.pathname;return r.endsWith("hf.space")?{ws_protocol:"wss",host:r,http_protocol:n}:{ws_protocol:"https:"===n?"wss":"ws",http_protocol:n,host:r+("/"!==i?i:"")}}return e.startsWith("file:")?{ws_protocol:"ws",http_protocol:"http:",host:"lite.local"}:{ws_protocol:"wss",http_protocol:"https:",host:e}}function d(e,t,n){var r={named_endpoints:{},unnamed_endpoints:{}};return Object.keys(e).forEach((function(i){"named_endpoints"!==i&&"unnamed_endpoints"!==i||(r[i]={},Object.entries(e[i]).forEach((function(e){var a,o,s,u,c,l,h=R(e,2),f=h[0],p=h[1],d=p.parameters,v=p.returns,m=(null==(a=t.dependencies.find((function(e){return e.api_name===f||e.api_name===f.replace("/","")})))?void 0:a.id)||n[f.replace("/","")]||-1,y=-1!==m?null==(o=t.dependencies.find((function(e){return e.id==m})))?void 0:o.types:{continuous:!1,generator:!1,cancel:!1};if(-1!==m&&(null==(u=null==(s=t.dependencies.find((function(e){return e.id==m})))?void 0:s.inputs)?void 0:u.length)!==d.length){c=t.dependencies.find((function(e){return e.id==m})).inputs.map((function(e){var n;return null==(n=t.components.find((function(t){return t.id===e})))?void 0:n.type}));try{c.forEach((function(e,t){"state"===e&&d.splice(t,0,{component:"state",example:null,parameter_default:null,parameter_has_default:!0,parameter_name:null,hidden:!0})}))}catch(b){console.error(b)}}l=function(e,t,n,r){return D({},e,{description:_(null==e?void 0:e.type,n),type:g(null==e?void 0:e.type,t,n,r)||""})},r[i][f]={parameters:d.map((function(e){return l(e,null==e?void 0:e.component,null==e?void 0:e.serializer,"parameter")})),returns:v.map((function(e){return l(e,null==e?void 0:e.component,null==e?void 0:e.serializer,"return")})),type:y}})))})),r}function g(e,t,n,r){switch(null==e?void 0:e.type){case"string":return"string";case"boolean":return"boolean";case"number":return"number"}return"JSONSerializable"===n||"StringSerializable"===n?"any":"ListStringSerializable"===n?"string[]":"Image"===t?"parameter"===r?"Blob | File | Buffer":"string":"FileSerializable"===n?"array"===(null==e?void 0:e.type)?"parameter"===r?"(Blob | File | Buffer)[]":"{ name: string; data: string; size?: number; is_file?: boolean; orig_name?: string}[]":"parameter"===r?"Blob | File | Buffer":"{ name: string; data: string; size?: number; is_file?: boolean; orig_name?: string}":"GallerySerializable"===n?"parameter"===r?"[(Blob | File | Buffer), (string | null)][]":"[{ name: string; data: string; size?: number; is_file?: boolean; orig_name?: string}, (string | null))][]":void 0}function _(e,t){return"GallerySerializable"===t?"array of [file, label] tuples":"ListStringSerializable"===t?"array of strings":"FileSerializable"===t?"array of files or single file":null==e?void 0:e.description}function v(e,t){var n=!0;switch(e.msg){case"send_data":return{type:"data"};case"send_hash":return{type:"hash"};case"queue_full":return{type:"update",status:{queue:n,message:xe,stage:"error",code:e.code,success:e.success}};case"heartbeat":return{type:"heartbeat"};case"unexpected_error":return{type:"unexpected_error",status:{queue:n,message:e.message,stage:"error",success:!1}};case"estimation":return{type:"update",status:{queue:n,stage:t||"pending",code:e.code,size:e.queue_size,position:e.rank,eta:e.rank_eta,success:e.success}};case"progress":return{type:"update",status:{queue:n,stage:"pending",code:e.code,progress_data:e.progress_data,success:e.success}};case"log":return{type:"log",data:e};case"process_generating":return{type:"generating",status:{queue:n,message:e.success?null:e.output.error,stage:e.success?"generating":"error",code:e.code,progress_data:e.progress_data,eta:e.average_duration},data:e.success?e.output:null};case"process_completed":return"error"in e.output?{type:"update",status:{queue:n,message:e.output.error,stage:"error",code:e.code,success:e.success}}:{type:"complete",status:{queue:n,message:e.success?void 0:e.output.error,stage:e.success?"complete":"error",code:e.code,progress_data:e.progress_data,changed_state_ids:e.success?e.output.changed_state_ids:void 0},data:e.success?e.output:null};case"process_starts":return{type:"update",status:{queue:n,stage:"pending",code:e.code,size:e.rank,position:0,success:e.success,eta:e.eta}}}return{type:"none",status:{stage:"error",queue:n}}}function m(e,t,n){for(var r,i;n.length>1;){if("string"!=typeof(r=n.shift())&&"number"!=typeof r)throw Error("Invalid key type");e=e[r]}if("string"!=typeof(i=n.shift())&&"number"!=typeof i)throw Error("Invalid key type");e[i]=t}function y(e,t){var n,r,i=null==(r=null==(n=null==t?void 0:t.dependencies)?void 0:n.find((function(t){return t.id==e})))?void 0:r.queue;return null!=i?!i:!t.enable_queue}function b(e,t){return new Promise((function(n,r){var i=new MessageChannel;i.port1.onmessage=function(e){var t=e.data;i.port1.close(),n(t)},window.parent.postMessage(e,t,[i.port2])}))}function w(e,t,n,r){var i,a,o,s,u=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("input"===r&&!u)throw Error("Invalid code path. Cannot skip state inputs for input.");if("output"===r&&u)return e;for(i=[],a=0,o=function(r){var o,s,c=t.inputs[r],l=n.find((function(e){return e.id===c}));if("state"===(null==l?void 0:l.type))return u?(e.length===t.inputs.length?(o=e[a],i.push(o),a++):i.push(null),"continue"):(a++,"continue");s=e[a],i.push(s),a++},s=0;s<t.inputs.length;s++)o(s);return i}function x(e){var t=e.match(/https:\/\/huggingface.co\/spaces\/([^/]+\/[^/]+)/);if(t)return t[1]}function k(e){var t=/[:]\s*/.exec(e),n=t&&t.index;if(n)return[e.substring(0,n),e.substring(n+t[0].length)]}function E(e,t,n){e.get(t)||e.set(t,n)}function O(e,t){e&&(e.open=!1,null==t||t.abort())}function S(e,t,n){e[t]?n.data.forEach((function(r,i){var a,o=(a=e[t][i],r.forEach((function(e){var t=R(e,3),n=t[0],r=t[1],i=t[2];a=function(e,t,n,r){var i,a,o;if(0===t.length){if("replace"===n)return r;if("append"===n)return e+r;throw Error("Unsupported action: "+n)}for(i=e,a=0;a<t.length-1;a++)i=i[t[a]];switch(o=t[t.length-1],n){case"replace":i[o]=r;break;case"append":i[o]+=r;break;case"add":Array.isArray(i)?i.splice(Number(o),0,r):i[o]=r;break;case"delete":Array.isArray(i)?i.splice(Number(o),1):delete i[o];break;default:throw Error("Unknown action: "+n)}return e}(a,r,n,i)})),a);e[t][i]=o,n.data[i]=o})):(e[t]=[],n.data.forEach((function(n,r){e[t][r]=n})))}function j(e,t,n,r,i){var o,s,f,p,d,g,_,m,x,k,E,j,P,C,A,M,T,I,z,q,L,F,N,B,W,H,G,J,X,Q,$,V,Z,Y,K,ee,te,ne,re,ie,ae,oe,se,ue,ce,le,he,fe,pe,de,ge=this;try{if(de=c(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ee=t={stage:"complete",queue:!1,time:new Date},m(D({},t,{type:"status",endpoint:Z,fn_index:H})),n={},r={},"ws"===V?(Q&&0===Q.readyState?Q.addEventListener("open",(function(){Q.close()})):Q.close(),n={fn_index:H,session_hash:C}):(O(T,B.abort_controller),d(),n={event_id:K},r={event_id:K,session_hash:C,fn_index:H}),e.prev=6,P){e.next=9;break}throw Error("Could not resolve app config");case 9:if(!("event_id"in r)){e.next=12;break}return e.next=12,E(P.root+"/cancel",{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(r)});case 12:return e.next=14,E(P.root+"/reset",{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(n)});case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(6),console.warn("The `/reset` endpoint could not be called. Subsequent endpoint results may be unreliable.");case 19:case"end":return e.stop()}}),e,this,[[6,16]])}))),f=function(){return de.apply(this,arguments)},pe=c(regeneratorRuntime.mark((function e(t){var n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(P){e.next=2;break}return e.abrupt("return");case 2:return n=t.render_id,P.components=[].concat(u(P.components.filter((function(e){return e.props.rendered_in!==n}))),u(t.components)),P.dependencies=[].concat(u(P.dependencies.filter((function(e){return e.rendered_in!==n}))),u(t.dependencies)),r=P.components.some((function(e){return"state"===e.type})),i=P.dependencies.some((function(e){return e.targets.some((function(e){return"unload"===e[1]}))})),P.connect_heartbeat=r||i,e.next=10,ie(P);case 10:m({type:"render",data:t,endpoint:Z,fn_index:H});case 11:case"end":return e.stop()}}),e,this)}))),p=function(e){return pe.apply(this,arguments)},d=function(){for(ae=!0;se.length>0;)se.shift()({value:void 0,done:!0})},g=function(e){ae||(se.length>0?se.shift()(e):oe.push(e))},_=function(e){g({value:e,done:!1})},m=function(e){(i||re[e.type])&&_(e)},x=function(){return oe.length>0?Promise.resolve(oe.shift()):ae?Promise.resolve({value:void 0,done:!0}):new Promise((function(e){return se.push(e)}))},k=this.options.hf_token,E=this.fetch,j=this.app_reference,P=this.config,C=this.session_hash,A=this.api_info,M=this.api_map,T=this.stream_status,I=this.pending_stream_messages,z=this.pending_diff_streams,q=this.event_callbacks,L=this.unclosed_events,F=this.post_data,N=this.options,B=this,!A)throw Error("No API found");if(!P)throw Error("Could not resolve app config");return W=function(e,t,n,r){var i,a=void 0,o=void 0,s=void 0;if("number"==typeof t?(a=t,o=e.unnamed_endpoints[a],s=r.dependencies.find((function(e){return e.id==t}))):(i=t.replace(/^\//,""),a=n[i],o=e.named_endpoints[t.trim()],s=r.dependencies.find((function(e){return e.id==n[i]}))),"number"!=typeof a)throw Error("There is no endpoint matching that name of fn_index matching that number.");return{fn_index:a,endpoint_info:o,dependency:s}}(A,e,M,P),H=W.fn_index,G=W.endpoint_info,J=W.dependency,X=Ue(t,A),Q=void 0,$=void 0,V=P.protocol||"ws",Z="number"==typeof e?"/predict":e,Y=void 0,K=null,ee=!1,te={},ne="undefined"!=typeof window&&"undefined"!=typeof document?new URLSearchParams(window.location.search).toString():"",re=(null==(o=null==N?void 0:N.events)?void 0:o.reduce((function(e,t){return e[t]=!0,e}),{}))||{},fe=c(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ge._resolve_hearbeat(t);case 2:case"end":return e.stop()}}),e,ge)}))),ie=function(e){return fe.apply(this,arguments)},this.handle_blob(P.root,X,G).then((he=c(regeneratorRuntime.mark((function e(t){var i,a,o,s,u,f,g,_,x,E,A,M;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=w(t,J,P.components,"input",!0),Y={data:a||[],event_data:n,fn_index:H,trigger_id:r},!y(H,P)){e.next=7;break}m({type:"status",endpoint:Z,stage:"pending",queue:!1,fn_index:H,time:new Date}),F(P.root+"/run"+(Z.startsWith("/")?Z:"/"+Z)+(ne?"?"+ne:""),D({},Y,{session_hash:C})).then((function(e){var t=R(e,2),i=t[0],a=t[1],o=i.data;200==a?(m({type:"data",endpoint:Z,fn_index:H,data:w(o,J,P.components,"output",N.with_null_state),time:new Date,event_data:n,trigger_id:r}),i.render_config&&p(i.render_config),m({type:"status",endpoint:Z,fn_index:H,stage:"complete",eta:i.average_duration,queue:!1,time:new Date})):m({type:"status",stage:"error",endpoint:Z,fn_index:H,message:i.error,queue:!1,time:new Date})})).catch((function(e){m({type:"status",stage:"error",message:e.message,endpoint:Z,fn_index:H,queue:!1,time:new Date})})),e.next=34;break;case 7:if("ws"!=V){e.next=22;break}return e.next=10,U(j,k);case 10:o=e.sent,s=o.ws_protocol,u=o.host,m({type:"status",stage:"pending",queue:!0,endpoint:Z,fn_index:H,time:new Date}),f=new URL(s+"://"+h(u,P.path,!0)+"/queue/join"+(ne?"?"+ne:"")),ge.jwt&&f.searchParams.set("__sign",ge.jwt),(Q=new WebSocket(f)).onclose=function(e){e.wasClean||m({type:"status",stage:"error",broken:!0,message:ke,queue:!0,endpoint:Z,fn_index:H,time:new Date})},Q.onmessage=function(e){var t=v(JSON.parse(e.data),te[H]),i=t.type,a=t.status,o=t.data;if("update"===i&&a&&!ee)m(D({type:"status",endpoint:Z,fn_index:H,time:new Date},a)),"error"===a.stage&&Q.close();else{if("hash"===i)return void Q.send(JSON.stringify({fn_index:H,session_hash:C}));"data"===i?Q.send(JSON.stringify(D({},Y,{session_hash:C}))):"complete"===i?ee=a:"log"===i?m({type:"log",log:o.log,level:o.level,endpoint:Z,fn_index:H}):"generating"===i&&m(D({type:"status",time:new Date},a,{stage:null==a?void 0:a.stage,queue:!0,endpoint:Z,fn_index:H}))}o&&(m({type:"data",time:new Date,data:w(o.data,J,P.components,"output",N.with_null_state),endpoint:Z,fn_index:H,event_data:n,trigger_id:r}),ee&&(m(D({type:"status",time:new Date},ee,{stage:null==a?void 0:a.stage,queue:!0,endpoint:Z,fn_index:H})),Q.close()))},l(P.version||"2.0.0","3.6")<0&&addEventListener("open",(function(){return Q.send(JSON.stringify({hash:C}))})),e.next=34;break;case 22:if("sse"!=V){e.next=33;break}if(m({type:"status",stage:"pending",queue:!0,endpoint:Z,fn_index:H,time:new Date}),g=new URLSearchParams({fn_index:H.toString(),session_hash:C}).toString(),_=new URL(P.root+"/queue/join?"+(ne?ne+"&":"")+g),ge.jwt&&_.searchParams.set("__sign",ge.jwt),$=ge.stream(_)){e.next=30;break}return e.abrupt("return",Promise.reject(Error("Cannot connect to SSE endpoint: "+_.toString())));case 30:$.onmessage=function(){var e=c(regeneratorRuntime.mark((function e(t){var i,a,o,s,u,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=JSON.parse(t.data),a=v(i,te[H]),o=a.type,s=a.status,u=a.data,"update"!==o||!s||ee){e.next=7;break}m(D({type:"status",endpoint:Z,fn_index:H,time:new Date},s)),"error"===s.stage&&(null==$||$.close(),d()),e.next=19;break;case 7:if("data"!==o){e.next=18;break}return K=i.event_id,e.next=11,F(P.root+"/queue/data",D({},Y,{session_hash:C,event_id:K}));case 11:c=e.sent,(l=R(c,2))[0],200!==l[1]&&(m({type:"status",stage:"error",message:ke,queue:!0,endpoint:Z,fn_index:H,time:new Date}),null==$||$.close(),d()),e.next=19;break;case 18:"complete"===o?ee=s:"log"===o?m({type:"log",log:u.log,level:u.level,endpoint:Z,fn_index:H}):"generating"===o&&m(D({type:"status",time:new Date},s,{stage:null==s?void 0:s.stage,queue:!0,endpoint:Z,fn_index:H}));case 19:u&&(m({type:"data",time:new Date,data:w(u.data,J,P.components,"output",N.with_null_state),endpoint:Z,fn_index:H,event_data:n,trigger_id:r}),ee&&(m(D({type:"status",time:new Date},ee,{stage:null==s?void 0:s.stage,queue:!0,endpoint:Z,fn_index:H})),null==$||$.close(),d()));case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),e.next=34;break;case 33:"sse_v1"!=V&&"sse_v2"!=V&&"sse_v2.1"!=V&&"sse_v3"!=V||(m({type:"status",stage:"pending",queue:!0,endpoint:Z,fn_index:H,time:new Date}),x="","undefined"!=typeof window&&"undefined"!=typeof document&&(x=null==(i=null==window?void 0:window.location)?void 0:i.hostname),E=x.includes(".dev.")?"https://moon-"+x.split(".")[1]+".dev.spaces.huggingface.tech":"https://huggingface.co",A="undefined"!=typeof window&&"undefined"!=typeof document&&window.parent!=window,M=J.zerogpu&&P.space_id,(A&&M?b("zerogpu-headers",E):Promise.resolve(null)).then((function(e){return F(P.root+"/queue/join?"+ne,D({},Y,{session_hash:C}),e)})).then(function(){var e=c(regeneratorRuntime.mark((function e(t){var n,r=R(t,2),i=r[0],a=r[1];return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(503!==a){e.next=4;break}m({type:"status",stage:"error",message:xe,queue:!0,endpoint:Z,fn_index:H,time:new Date}),e.next=16;break;case 4:if(200===a){e.next=8;break}m({type:"status",stage:"error",message:ke,queue:!0,endpoint:Z,fn_index:H,time:new Date}),e.next=16;break;case 8:if(K=i.event_id,n=function(){var e=c(regeneratorRuntime.mark((function e(t){var n,r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=v(t,te[H]),r=n.type,i=n.status,a=n.data,"heartbeat"!=r){e.next=4;break}return e.abrupt("return");case 4:if("update"!==r||!i||ee){e.next=8;break}m(D({type:"status",endpoint:Z,fn_index:H,time:new Date},i)),e.next=21;break;case 8:if("complete"!==r){e.next=12;break}ee=i,e.next=21;break;case 12:if("unexpected_error"!=r){e.next=15;break}e.next=21;break;case 15:if("log"!==r){e.next=20;break}return m({type:"log",log:a.log,level:a.level,endpoint:Z,fn_index:H}),e.abrupt("return");case 20:"generating"===r&&(m(D({type:"status",time:new Date},i,{stage:null==i?void 0:i.stage,queue:!0,endpoint:Z,fn_index:H})),a&&["sse_v2","sse_v2.1","sse_v3"].includes(V)&&S(z,K,a));case 21:if(!a){e.next=27;break}if(m({type:"data",time:new Date,data:w(a.data,J,P.components,"output",N.with_null_state),endpoint:Z,fn_index:H}),!a.render_config){e.next=26;break}return e.next=26,p(a.render_config);case 26:ee&&m(D({type:"status",time:new Date},ee,{stage:null==i?void 0:i.stage,queue:!0,endpoint:Z,fn_index:H}));case 27:"complete"!==(null==i?void 0:i.stage)&&"error"!==(null==i?void 0:i.stage)||(q[K]&&delete q[K],K in z&&delete z[K]),e.next=35;break;case 30:e.prev=30,e.t0=e.catch(0),console.error("Unexpected client exception",e.t0),m({type:"status",stage:"error",message:"An Unexpected Error Occurred!",queue:!0,endpoint:Z,fn_index:H,time:new Date}),["sse_v2","sse_v2.1","sse_v3"].includes(V)&&(O(T,B.abort_controller),T.open=!1,d());case 35:case"end":return e.stop()}}),e,this,[[0,30]])})));return function(t){return e.apply(this,arguments)}}(),K in I&&(I[K].forEach((function(e){return n(e)})),delete I[K]),q[K]=n,L.add(K),T.open){e.next=16;break}return e.next=16,ge.open_stream();case 16:case"end":return e.stop()}}),e,ge)})));return function(t){return e.apply(this,arguments)}}()));case 34:case"end":return e.stop()}}),e,ge)}))),function(e){return he.apply(this,arguments)})),ae=!1,oe=[],se=[],a(s={},Symbol.asyncIterator,(function(){return ue})),a(s,"next",x),a(s,"throw",(le=c(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",x());case 2:case"end":return e.stop()}}),e,ge)}))),function(e){return le.apply(this,arguments)})),a(s,"return",(ce=c(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d(),e.abrupt("return",x());case 2:case"end":return e.stop()}}),e,ge)}))),function(){return ce.apply(this,arguments)})),a(s,"cancel",f),ue=s}catch(_e){throw console.error("Submit function encountered an error:",_e),_e}}var P,C,R,D,A,M,T,I,z,U,q,L,F,N,B,W,H,G,J,X,Q,$,V,Z,Y,K,ee,te,ne,re,ie,ae,oe,se,ue,ce,le,he,fe,pe,de,ge,_e,ve,me,ye,be,we,xe,ke,Ee,Oe,Se,je,Pe,Ce,Re,De,Ae,Me,Te,Ie,ze,Ue,qe,Le,Fe,Ne,Be,We,He,Ge,Je,Xe,Qe,$e,Ve,Ze,Ye,Ke,et,tt,nt,rt,it,at,ot,st,ut,ct,lt,ht,ft,pt,dt,gt,_t;Object.defineProperty(t,"__esModule",{value:!0}),P=function(){function e(e,t){var n,r;for(n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),C=function(){function e(e){this.value=e}function t(t){function n(i,a){var o,s;try{(s=(o=t[i](a)).value)instanceof e?Promise.resolve(s.value).then((function(e){n("next",e)}),(function(e){n("throw",e)})):r(o.done?"return":"normal",o.value)}catch(u){r("throw",u)}}function r(e,t){switch(e){case"return":i.resolve({value:t,done:!0});break;case"throw":i.reject(t);break;default:i.resolve({value:t,done:!1})}(i=i.next)?n(i.key,i.arg):a=null}var i,a;this._invoke=function(e,t){return new Promise((function(r,o){var s={key:e,arg:t,resolve:r,reject:o,next:null};a?a=a.next=s:(i=a=s,n(e,t))}))},"function"!=typeof t.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)},{wrap:function(e){return function(){return new t(e.apply(this,arguments))}},await:function(t){return new e(t)}}}(),R=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n,r,i=[],a=!0,o=!1,s=void 0;try{for(n=e[Symbol.iterator]();!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(u){o=!0,s=u}finally{try{!a&&n.return&&n.return()}finally{if(o)throw s}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},D=Object.assign||function(e){var t,n,r;for(t=1;t<arguments.length;t++)for(r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e},A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ge=c(regeneratorRuntime.mark((function e(t,n,r){var i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("https://huggingface.co/api/spaces/"+t+"/jwt",{headers:D({Authorization:"Bearer "+n},r?{Cookie:r}:{})});case 3:return i=e.sent,e.next=6,i.json();case 6:return a=e.sent.token,e.abrupt("return",a||!1);case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e,this,[[0,10]])}))),M=function(e,t,n){return Ge.apply(this,arguments)},Je=c(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=this.options.hf_token?{Authorization:"Bearer "+this.options.hf_token}:{})["Content-Type"]="application/json","undefined"==typeof window||!window.gradio_config||"http://localhost:8080"===location.origin||window.gradio_config.dev_mode){e.next=10;break}return i=window.gradio_config.root,a=window.gradio_config,o=h(t,a.root,!1),a.root=o,e.abrupt("return",D({},a,{path:i}));case 10:if(!t){e.next=34;break}return s=ze(t,ve),e.next=14,this.fetch(s,{headers:r,credentials:"include"});case 14:if(401!==(null==(u=e.sent)?void 0:u.status)||this.options.auth){e.next=19;break}throw Error(Ce);case 19:if(401!==(null==u?void 0:u.status)||!this.options.auth){e.next=21;break}throw Error(Pe);case 21:if(200!==(null==u?void 0:u.status)){e.next=31;break}return e.next=24,u.json();case 24:return(c=e.sent).path=c.path||"",c.root=t,null==(n=c.dependencies)||n.forEach((function(e,t){void 0===e.id&&(e.id=t)})),e.abrupt("return",c);case 31:if(401!==(null==u?void 0:u.status)){e.next=33;break}throw Error(je);case 33:case 34:throw Error(Ee);case 35:case"end":return e.stop()}}),e,this)}))),T=function(e){return Je.apply(this,arguments)},Xe=c(regeneratorRuntime.mark((function e(){var t,n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U(this.app_reference,this.options.hf_token);case 2:if(t=e.sent,n=t.http_protocol,r=t.host,e.prev=5,!this.options.auth){e.next=11;break}return e.next=9,z(n,r,this.options.auth,this.fetch,this.options.hf_token);case 9:(i=e.sent)&&this.set_cookies(i);case 11:e.next=16;break;case 13:throw e.prev=13,e.t0=e.catch(5),Error(e.t0.message);case 16:case"end":return e.stop()}}),e,this,[[5,13]])}))),I=function(){return Xe.apply(this,arguments)},Qe=c(regeneratorRuntime.mark((function e(t,n,r,i,a){var o,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(o=new FormData).append("username",null==r?void 0:r[0]),o.append("password",null==r?void 0:r[1]),s={},a&&(s.Authorization="Bearer "+a),e.next=7,i(t+"//"+n+"/"+_e,{headers:s,method:"POST",body:o,credentials:"include"});case 7:if(200!==(u=e.sent).status){e.next=12;break}return e.abrupt("return",u.headers.get("set-cookie"));case 12:if(401!==u.status){e.next=16;break}throw Error(Pe);case 16:throw Error(Se);case 17:case"end":return e.stop()}}),e,this)}))),z=function(e,t,n,r,i){return Qe.apply(this,arguments)},$e=c(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s,u,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r={},n&&(r.Authorization="Bearer "+n),i=t.trim().replace(/\/$/,""),!Te.test(i)){e.next=17;break}return e.prev=4,e.next=7,fetch("https://huggingface.co/api/spaces/"+i+"/"+de,{headers:r});case 7:return a=e.sent,e.next=10,a.json();case 10:return o=e.sent.host,e.abrupt("return",D({space_id:t},p(o)));case 14:throw e.prev=14,e.t0=e.catch(4),Error(Se);case 17:if(!Ie.test(i)){e.next=20;break}return s=p(i),u=s.ws_protocol,c=s.http_protocol,l=s.host,e.abrupt("return",{space_id:l.replace(".hf.space",""),ws_protocol:u,http_protocol:c,host:l});case 20:return e.abrupt("return",D({space_id:!1},p(i)));case 21:case"end":return e.stop()}}),e,this,[[4,14]])}))),U=function(e,t){return $e.apply(this,arguments)},Ve=c(regeneratorRuntime.mark((function e(){var t,n,r,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.api_info){e.next=2;break}return e.abrupt("return",this.api_info);case 2:if(t=this.options.hf_token,n=this.config,r={"Content-Type":"application/json"},t&&(r.Authorization="Bearer "+t),n){e.next=8;break}return e.abrupt("return");case 8:if(e.prev=8,i=void 0,!(l((null==n?void 0:n.version)||"2.0.0","3.30")<0)){e.next=16;break}return e.next=13,this.fetch(we,{method:"POST",body:JSON.stringify({serialize:!1,config:JSON.stringify(n)}),headers:r,credentials:"include"});case 13:i=e.sent,e.next=20;break;case 16:return a=ze(n.root,me),e.next=19,this.fetch(a,{headers:r,credentials:"include"});case 19:i=e.sent;case 20:if(i.ok){e.next=22;break}throw Error(ke);case 22:return e.next=24,i.json();case 24:return"api"in(o=e.sent)&&(o=o.api),o.named_endpoints["/predict"]&&!o.unnamed_endpoints[0]&&(o.unnamed_endpoints[0]=o.named_endpoints["/predict"]),e.abrupt("return",d(o,n,this.api_map));case 30:e.prev=30,e.t0=e.catch(8),e.t0.message;case 33:case"end":return e.stop()}}),e,this,[[8,30]])}))),q=function(){return Ve.apply(this,arguments)},Ze=c(regeneratorRuntime.mark((function e(t,n,r){var i,a,o,s,c,l,h,f,p=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a={},(null==(i=null==this?void 0:this.options)?void 0:i.hf_token)&&(a.Authorization="Bearer "+this.options.hf_token),o=1e3,s=[],c=void 0,l=regeneratorRuntime.mark((function e(i){var l,h,f,d,g;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=n.slice(i,i+o),h=new FormData,l.forEach((function(e){h.append("files",e)})),e.prev=3,f=r?t+"/"+ge+"?upload_id="+r:t+"/"+ge,e.next=7,p.fetch(f,{method:"POST",body:h,headers:a,credentials:"include"});case 7:c=e.sent,e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(3),Error(ke+e.t0.message);case 13:if(c.ok){e.next=18;break}return e.next=16,c.text();case 16:return d=e.sent,e.abrupt("return",{v:{error:"HTTP "+c.status+": "+d}});case 18:return e.next=20,c.json();case 20:(g=e.sent)&&s.push.apply(s,u(g));case 22:case"end":return e.stop()}}),e,p,[[3,10]])})),h=0;case 7:if(!(h<n.length)){e.next=15;break}return e.delegateYield(l(h),"t0",9);case 9:if("object"!==(void 0===(f=e.t0)?"undefined":A(f))){e.next=12;break}return e.abrupt("return",f.v);case 12:h+=o,e.next=7;break;case 15:return e.abrupt("return",{files:s});case 16:case"end":return e.stop()}}),e,this)}))),L=function(e,t,n){return Ze.apply(this,arguments)},Ye=c(regeneratorRuntime.mark((function e(t,n,r,i){var a,o,s=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(Array.isArray(t)?t:[t]).map((function(e){return e.blob})),!(o=a.filter((function(e){return e.size>(i||1/0)}))).length){e.next=4;break}throw Error("File size exceeds the maximum allowed size of "+i+" bytes: "+o.map((function(e){return e.name})).join(", "));case 4:return e.t0=Promise,e.next=7,this.upload_files(n,a,r).then(function(){var e=c(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.error){e.next=4;break}throw Error(r.error);case 4:if(!r.files){e.next=6;break}return e.abrupt("return",r.files.map((function(e,r){return new qe(D({},t[r],{path:e,url:n+"/file="+e}))})));case 6:return e.abrupt("return",[]);case 7:case"end":return e.stop()}}),e,s)})));return function(t){return e.apply(this,arguments)}}());case 7:return e.t1=e.sent,e.next=10,e.t0.all.call(e.t0,e.t1);case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),e,this)}))),F=function(e,t,n,r){return Ye.apply(this,arguments)},Ke=c(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.map((function(e){return new qe({path:e.name,orig_name:e.name,blob:e,size:e.size,mime_type:e.type,is_stream:n})})));case 1:case"end":return e.stop()}}),e,this)}))),N=function(e,t){return Ke.apply(this,arguments)},et=c(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,l,h,f,p,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],_=this,v=arguments.length>3&&void 0!==arguments[3]&&arguments[3],m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.isArray(t)){e.next=7;break}return n=[],e.next=4,Promise.all(t.map(function(){var e=c(regeneratorRuntime.mark((function e(r,i){var a,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(o=g.slice()).push(i+""),e.next=4,B(t[i],v?(null==(a=null==m?void 0:m.parameters[i])?void 0:a.component)||void 0:d,o,!1,m);case 4:s=e.sent,n=n.concat(s);case 6:case"end":return e.stop()}}),e,_)})));return function(t,n){return e.apply(this,arguments)}}()));case 4:return e.abrupt("return",n);case 7:if(!(globalThis.Buffer&&t instanceof globalThis.Buffer||t instanceof Blob)){e.next=11;break}return e.abrupt("return",[{path:g,blob:new Blob([t]),type:d}]);case 11:if("object"!==(void 0===t?"undefined":A(t))||null===t){e.next=45;break}r=[],i=!0,a=!1,o=void 0,e.prev=16,s=Object.keys(t)[Symbol.iterator]();case 18:if(i=(l=s.next()).done){e.next=30;break}return h=l.value,f=[].concat(u(g),[h]),p=t[h],e.t0=r,e.next=25,B(p,void 0,f,!1,m);case 25:e.t1=e.sent,r=e.t0.concat.call(e.t0,e.t1);case 27:i=!0,e.next=18;break;case 30:e.next=36;break;case 32:e.prev=32,e.t2=e.catch(16),a=!0,o=e.t2;case 36:e.prev=36,e.prev=37,!i&&s.return&&s.return();case 39:if(e.prev=39,!a){e.next=42;break}throw o;case 42:return e.finish(39);case 43:return e.finish(36);case 44:return e.abrupt("return",r);case 45:return e.abrupt("return",[]);case 46:case"end":return e.stop()}}),e,this,[[16,32,36,44],[37,,39,43]])}))),B=function(e){return et.apply(this,arguments)},tt=c(regeneratorRuntime.mark((function e(t,n,r){var i,a,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this,e.next=3,H(i,n);case 3:return e.next=5,B(n,void 0,[],!0,r);case 5:return a=e.sent,e.next=8,Promise.all(a.map(function(){var e=c(regeneratorRuntime.mark((function e(n){var r,a,s=n.path,u=n.blob,c=n.type;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u){e.next=2;break}return e.abrupt("return",{path:s,type:c});case 2:return e.next=4,i.upload_files(t,[u]);case 4:return r=e.sent,a=r.files&&r.files[0],e.abrupt("return",{path:s,file_url:a,type:c,name:u instanceof File?null==u?void 0:u.name:void 0});case 7:case"end":return e.stop()}}),e,o)})));return function(t){return e.apply(this,arguments)}}()));case 8:return e.sent.forEach((function(e){var t,r=e.path,i=e.file_url,a=e.type,o=e.name;"Gallery"===a?m(n,i,r):i&&(t=new qe({path:i,orig_name:o}),m(n,t,r))})),e.abrupt("return",n);case 11:case"end":return e.stop()}}),e,this)}))),W=function(e,t,n){return tt.apply(this,arguments)},nt=c(regeneratorRuntime.mark((function e(t,n){var r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((null==(r=t.config)?void 0:r.root)||(null==(i=t.config)?void 0:i.root_url)){e.next=3;break}throw Error(De);case 3:return e.next=5,G(t,n);case 5:case"end":return e.stop()}}),e,this)}))),H=function(e,t){return nt.apply(this,arguments)},rt=c(regeneratorRuntime.mark((function e(t,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=regeneratorRuntime.keys(n);case 1:if((e.t1=e.t0()).done){e.next=13;break}if(r=e.t1.value,!(n[r]instanceof Le)){e.next=8;break}return e.next=6,J(t,n,r);case 6:e.next=11;break;case 8:if("object"!==A(n[r])||null===n[r]){e.next=11;break}return e.next=11,G(t,n[r],[].concat(u(i),[r]));case 11:e.next=1;break;case 13:case"end":return e.stop()}}),e,this)}))),G=function(e,t){return rt.apply(this,arguments)},it=c(regeneratorRuntime.mark((function t(r,i,a){var o,s,u,c,l,h,f,p,d,g,_,v;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(u=i[a],c=(null==(o=r.config)?void 0:o.root)||(null==(s=r.config)?void 0:s.root_url)){t.next=4;break}throw Error(De);case 4:if(t.prev=4,l=void 0,h=void 0,void 0===e||!e.versions||!e.versions.node){t.next=20;break}return t.next=10,n.e(3).then(n.t.bind(null,721,7));case 10:return f=t.sent,t.next=13,n.e(8).then(n.t.bind(null,655,7));case 13:return p=t.sent,h=p.resolve(e.cwd()),t.next=17,f.readFile(h);case 17:l=t.sent,t.next=21;break;case 20:throw Error(Re);case 21:return d=new Blob([l],{type:"application/octet-stream"}),t.next=24,r.upload_files(c,[d]);case 24:g=t.sent,(_=g.files&&g.files[0])&&(v=new qe({path:_,orig_name:u.meta.name||""}),i[a]=v),t.next=32;break;case 29:t.prev=29,t.t0=t.catch(4),console.error(Ae,t.t0);case 32:case"end":return t.stop()}}),t,this,[[4,29]])}))),J=function(e,t,n){return it.apply(this,arguments)},at=c(regeneratorRuntime.mark((function e(t,n,r){var i,a,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={"Content-Type":"application/json"},this.options.hf_token&&(i.Authorization="Bearer "+this.options.hf_token),e.prev=2,e.next=5,this.fetch(t,{method:"POST",body:JSON.stringify(n),headers:D({},i,r),credentials:"include"});case 5:a=e.sent,e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(2),e.abrupt("return",[{error:ke},500]);case 11:return o=void 0,s=void 0,e.prev=13,e.next=16,a.json();case 16:o=e.sent,s=a.status,e.next=24;break;case 20:e.prev=20,e.t1=e.catch(13),o={error:"Could not parse server response: "+e.t1},s=500;case 24:return e.abrupt("return",[o,s]);case 25:case"end":return e.stop()}}),e,this,[[2,8],[13,20]])}))),X=function(e,t,n){return at.apply(this,arguments)},ot=c(regeneratorRuntime.mark((function e(t,n){var r,i,a,s,u=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!1,i=!1,a=void 0,this.config){e.next=5;break}throw Error("Could not resolve app config");case 5:if("number"==typeof t?a=this.config.dependencies.find((function(e){return e.id==t})):(s=t.replace(/^\//,""),a=this.config.dependencies.find((function(e){return e.id==u.api_map[s]}))),!(null==a?void 0:a.types.continuous)){e.next=8;break}throw Error("Cannot call predict on this function as it may run forever. Use submit instead");case 8:return e.abrupt("return",new Promise(function(){var e=c(regeneratorRuntime.mark((function e(a,s){var c,l,h,f,p,d,g,_,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c=u.submit(t,n,null,null,!0),l=void 0,h=!0,f=!1,p=void 0,e.prev=5,d=o(c);case 7:return e.next=9,d.next();case 9:return g=e.sent,h=g.done,e.next=13,g.value;case 13:if(_=e.sent,h){e.next=21;break}"data"===(v=_).type&&(i&&a(l),r=!0,l=v),"status"===v.type&&"error"===v.stage&&"complete"===v.stage&&(i=!0,r&&a(l));case 18:h=!0,e.next=7;break;case 21:e.next=27;break;case 23:e.prev=23,e.t0=e.catch(5),f=!0,p=e.t0;case 27:if(e.prev=27,e.prev=28,h||!d.return){e.next=32;break}return e.next=32,d.return();case 32:if(e.prev=32,!f){e.next=35;break}throw p;case 35:return e.finish(32);case 36:return e.finish(27);case 37:case"end":return e.stop()}}),e,u,[[5,23,27,37],[28,,32,36]])})));return function(t,n){return e.apply(this,arguments)}}()));case 9:case"end":return e.stop()}}),e,this)}))),Q=function(e,t){return ot.apply(this,arguments)},st=c(regeneratorRuntime.mark((function e(t,n,r){var i,a,o,s,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="subdomain"===n?"https://huggingface.co/api/spaces/by-subdomain/"+t:"https://huggingface.co/api/spaces/"+t,a=void 0,o=void 0,e.prev=3,e.next=6,fetch(i);case 6:if(a=e.sent,200===(o=a.status)){e.next=10;break}throw Error();case 10:return e.next=12,a.json();case 12:a=e.sent,e.next=19;break;case 15:return e.prev=15,e.t0=e.catch(3),r({status:"error",load_status:"error",message:Oe,detail:"NOT_FOUND"}),e.abrupt("return");case 19:if(a&&200===o){e.next=21;break}return e.abrupt("return");case 21:u=(s=a).runtime.stage,c=s.id,e.t1=u,e.next="STOPPED"===e.t1||"SLEEPING"===e.t1?25:"PAUSED"===e.t1?28:"RUNNING"===e.t1||"RUNNING_BUILDING"===e.t1?36:"BUILDING"===e.t1?38:41;break;case 25:return r({status:"sleeping",load_status:"pending",message:"Space is asleep. Waking it up...",detail:u}),setTimeout((function(){$(t,n,r)}),1e3),e.abrupt("break",49);case 28:return e.t2=r,e.t3=u,e.next=32,V(c);case 32:return e.t4=e.sent,e.t5={status:"paused",load_status:"error",message:"This space has been paused by the author. If you would like to try this demo, consider duplicating the space.",detail:e.t3,discussions_enabled:e.t4},(0,e.t2)(e.t5),e.abrupt("break",49);case 36:return r({status:"running",load_status:"complete",message:"",detail:u}),e.abrupt("break",49);case 38:return r({status:"building",load_status:"pending",message:"Space is building...",detail:u}),setTimeout((function(){$(t,n,r)}),1e3),e.abrupt("break",49);case 41:return e.t6=r,e.t7=u,e.next=45,V(c);case 45:return e.t8=e.sent,e.t9={status:"space_error",load_status:"error",message:"This space is experiencing an issue.",detail:e.t7,discussions_enabled:e.t8},(0,e.t6)(e.t9),e.abrupt("break",49);case 49:case"end":return e.stop()}}),e,this,[[3,15]])}))),$=function(e,t,n){return st.apply(this,arguments)},ut=c(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("https://huggingface.co/api/spaces/"+t+"/discussions",{method:"HEAD"});case 3:if(n=e.sent,r=n.headers.get("x-error-message"),!(!n.ok||r&&Ne.test(r))){e.next=7;break}return e.abrupt("return",!1);case 7:return e.abrupt("return",!0);case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e,this,[[0,10]])}))),V=function(e){return ut.apply(this,arguments)},ct=c(regeneratorRuntime.mark((function e(t,n){var r,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={},n&&(r.Authorization="Bearer "+n),e.prev=2,e.next=5,fetch("https://huggingface.co/api/spaces/"+t+"/"+ye,{headers:r});case 5:if(200===(i=e.sent).status){e.next=8;break}throw Error("Space hardware could not be obtained.");case 8:return e.next=10,i.json();case 10:return a=e.sent,o=a.hardware,e.abrupt("return",o.current);case 15:throw e.prev=15,e.t0=e.catch(2),Error(e.t0.message);case 18:case"end":return e.stop()}}),e,this,[[2,15]])}))),Z=function(e,t){return ct.apply(this,arguments)},lt=c(regeneratorRuntime.mark((function e(t,n,r){var i,a,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={},r&&(i.Authorization="Bearer "+r),a={seconds:n},e.prev=3,e.next=6,fetch("https://huggingface.co/api/spaces/"+t+"/"+be,{method:"POST",headers:D({"Content-Type":"application/json"},i),body:JSON.stringify(a)});case 6:if(200===(o=e.sent).status){e.next=9;break}throw Error("Could not set sleep timeout on duplicated Space. Please visit *ADD HF LINK TO SETTINGS* to set a timeout manually to reduce billing charges.");case 9:return e.next=11,o.json();case 11:return s=e.sent,e.abrupt("return",s);case 15:throw e.prev=15,e.t0=e.catch(3),Error(e.t0.message);case 18:case"end":return e.stop()}}),e,this,[[3,15]])}))),Y=function(e,t,n){return lt.apply(this,arguments)},ht=c(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s,u,c,l,h,f,p,d,g,_,v,m,y,b,w;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.hf_token,i=n.private,a=n.hardware,o=n.timeout,s=n.auth,!a||Be.includes(a)){e.next=3;break}throw Error("Invalid hardware type provided. Valid types are: "+Be.map((function(e){return'"'+e+'"'})).join(",")+".");case 3:return e.next=5,U(t,r);case 5:if(u=e.sent,c=u.http_protocol,l=u.host,h=null,!s){e.next=14;break}return e.next=12,z(c,l,s,fetch);case 12:(f=e.sent)&&(h=Me(f));case 14:return p=D({Authorization:"Bearer "+r,"Content-Type":"application/json"},h?{Cookie:h.join("; ")}:{}),e.next=17,fetch("https://huggingface.co/api/whoami-v2",{headers:p});case 17:return e.next=19,e.sent.json();case 19:if(d=e.sent.name,g=t.split("/")[1],_={repository:d+"/"+g},i&&(_.private=!0),v=void 0,e.prev=24,a){e.next=29;break}return e.next=28,Z(t,r);case 28:v=e.sent;case 29:e.next=34;break;case 31:throw e.prev=31,e.t0=e.catch(24),Error(Se+e.t0.message);case 34:return m=a||v||"cpu-basic",_.hardware=m,e.prev=36,e.next=39,fetch("https://huggingface.co/api/spaces/"+t+"/duplicate",{method:"POST",headers:p,body:JSON.stringify(_)});case 39:if(409!==(y=e.sent).status){e.next=54;break}return e.prev=41,e.next=44,He.connect(d+"/"+g,n);case 44:return b=e.sent,e.abrupt("return",b);case 48:throw e.prev=48,e.t1=e.catch(41),console.error("Failed to connect Client instance:",e.t1),e.t1;case 52:e.next=56;break;case 54:if(200===y.status){e.next=56;break}throw Error(y.statusText);case 56:return e.next=58,y.json();case 58:return w=e.sent,e.next=61,Y(d+"/"+g,o||300,r);case 61:return e.next=63,He.connect(x(w.url),n);case 63:return e.abrupt("return",e.sent);case 66:throw e.prev=66,e.t2=e.catch(36),Error(e.t2);case 69:case"end":return e.stop()}}),e,this,[[24,31],[36,66],[41,48]])}))),K=function(e,t){return ht.apply(this,arguments)},ft=C.wrap(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s,u,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.body){e.next=2;break}return e.abrupt("return");case 2:h=t.body,f=new TextDecoderStream,p=new We({allowCR:!0}),r=h.pipeThrough(f).pipeThrough(p),i=void 0,a=r.getReader(),o=void 0;case 5:if(!n||!n.aborted){e.next=7;break}return e.abrupt("return",a.cancel());case 7:return e.next=9,C.await(a.read());case 9:if(!(i=e.sent).done){e.next=12;break}return e.abrupt("return");case 12:if(i.value){e.next=18;break}if(!o){e.next=16;break}return e.next=16,o;case 16:return o=void 0,e.abrupt("continue",22);case 18:if(s=k(i.value)||[],u=R(s,2),c=u[0],l=u[1],c){e.next=21;break}return e.abrupt("continue",22);case 21:"data"===c?(o||(o={}),o[c]=o[c]?o[c]+"\n"+l:l):"event"===c?(o||(o={}),o[c]=l):"id"===c?(o||(o={}),o[c]=+l||l):"retry"===c&&(o||(o={}),o[c]=+l||void 0);case 22:e.next=5;break;case 24:case"end":return e.stop()}var h,f,p}),e,this)}))),ee=function(e,t){return ft.apply(this,arguments)},pt=c(regeneratorRuntime.mark((function e(t,n){var r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return E((r=new Request(t,n)).headers,"Accept","text/event-stream"),E(r.headers,"Content-Type","application/json"),e.next=5,fetch(r);case 5:if((i=e.sent).ok){e.next=8;break}throw i;case 8:return e.abrupt("return",ee(i,r.signal));case 9:case"end":return e.stop()}}),e,this)}))),te=function(e,t){return pt.apply(this,arguments)},dt=c(regeneratorRuntime.mark((function e(){var t,n,r,i,a,o,s,u,l,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.event_callbacks,n=this.unclosed_events,r=this.pending_stream_messages,i=this.stream_status,a=this.config,o=this.jwt,s=this,a){e.next=4;break}throw Error("Could not resolve app config");case 4:if(i.open=!0,u=null,l=new URLSearchParams({session_hash:this.session_hash}).toString(),h=new URL(a.root+"/queue/data?"+l),o&&h.searchParams.set("__sign",o),u=this.stream(h)){e.next=13;break}return console.warn("Cannot connect to SSE endpoint: "+h.toString()),e.abrupt("return");case 13:u.onmessage=function(){var e=c(regeneratorRuntime.mark((function e(o){var u,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("close_stream"!==(u=JSON.parse(o.data)).msg){e.next=4;break}return O(i,s.abort_controller),e.abrupt("return");case 4:if(c=u.event_id){e.next=10;break}return e.next=8,Promise.all(Object.keys(t).map((function(e){return t[e](u)})));case 8:e.next=11;break;case 10:t[c]&&a?("process_completed"===u.msg&&["sse","sse_v1","sse_v2","sse_v2.1","sse_v3"].includes(a.protocol)&&n.delete(c),l=t[c],"undefined"!=typeof window&&"undefined"!=typeof document?setTimeout(l,0,u):l(u)):(r[c]||(r[c]=[]),r[c].push(u));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),u.onerror=c(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(Object.keys(t).map((function(e){return t[e]({msg:"unexpected_error",message:ke})})));case 2:case"end":return e.stop()}}),e,this)})));case 15:case"end":return e.stop()}}),e,this)}))),ne=function(){return dt.apply(this,arguments)},gt=c(regeneratorRuntime.mark((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{events:["data"]};return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,He.connect(t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),re=function(e){return gt.apply(this,arguments)},_t=c(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,He.duplicate(t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),ie=function(e,t){return _t.apply(this,arguments)},ae=Object.defineProperty,oe=function(e,t,n){return t in e?ae(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},se=function(e,t,n){return oe(e,"symbol"!==(void 0===t?"undefined":A(t))?t+"":t,n),n},ue=function(e,t,n){if(!t.has(e))throw TypeError("Cannot "+n)},ce=function(e,t,n){return ue(e,t,"read from private field"),n?n.call(e):t.get(e)},le=function(e,t,n){if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},he=function(e,t,n,r){return ue(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n},pe=new Intl.Collator(0,{numeric:1}).compare,de="host",ge="upload",_e="login",ve="config",me="info",ye="runtime",be="sleeptime",we="https://gradio-space-api-fetcher-v2.hf.space/api",xe="This application is currently busy. Please try again. ",ke="Connection errored out. ",Ee="Could not resolve app config. ",Oe="Could not get space status. ",Se="Space metadata could not be loaded. ",je="Not authorized to access this space. ",Pe="Invalid credentials. Could not login. ",Ce="Login credentials are required to access this space.",Re="File system access is only available in Node.js environments",De="Root URL not found in client config",Ae="Error uploading file",Me=function(e){var t=[];return e.split(/,(?=\s*[^\s=;]+=[^\s=;]+)/).forEach((function(e){var n=e.split(";")[0].split("="),r=R(n,2),i=r[0],a=r[1];i&&a&&t.push(i.trim()+"="+a.trim())})),t},Te=/^[a-zA-Z0-9_\-\.]+\/[a-zA-Z0-9_\-\.]+$/,Ie=/.*hf\.space\/{0,1}$/,ze=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];try{return t.reduce((function(e,t){return e=e.replace(/\/+$/,""),t=t.replace(/^\/+/,""),new URL(t,e+"/").toString()}))}catch(r){throw Error("Invalid URL. A full URL path is required.")}},Ue=function(e,t){var n,r,i=Object.values(t.named_endpoints).flatMap((function(e){return e.parameters}));return Array.isArray(e)?(e.length>i.length&&console.warn("Too many arguments provided for the endpoint."),e):(n=[],r=Object.keys(e),i.forEach((function(t,r){if(e.hasOwnProperty(t.parameter_name))n[r]=e[t.parameter_name];else{if(!t.parameter_has_default)throw Error("No value provided for required parameter: "+t.parameter_name);n[r]=t.parameter_default}})),r.forEach((function(e){if(!i.some((function(t){return t.parameter_name===e})))throw Error("Parameter `"+e+"` is not a valid keyword argument. Please refer to the API for usage.")})),n.forEach((function(e,t){if(void 0===e&&!i[t].parameter_has_default)throw Error("No value provided for required parameter: "+i[t].parameter_name)})),n)},qe=function e(t){var n=t.path,r=t.url,i=t.orig_name,a=t.size,o=t.blob,u=t.is_stream,c=t.mime_type,l=t.alt_text;s(this,e),se(this,"path"),se(this,"url"),se(this,"orig_name"),se(this,"size"),se(this,"blob"),se(this,"is_stream"),se(this,"mime_type"),se(this,"alt_text"),se(this,"meta",{_type:"gradio.FileData"}),this.path=n,this.url=r,this.orig_name=i,this.size=a,this.blob=r?void 0:o,this.is_stream=u,this.mime_type=c,this.alt_text=l},Le=function e(t,n){s(this,e),se(this,"type"),se(this,"command"),se(this,"meta"),se(this,"fileData"),this.type="command",this.command=t,this.meta=n},Fe=void 0!==e&&e.versions&&e.versions.node,Ne=/^(?=[^]*\b[dD]iscussions{0,1}\b)(?=[^]*\b[dD]isabled\b)[^]*$/,Be=["cpu-basic","cpu-upgrade","cpu-xl","t4-small","t4-medium","a10g-small","a10g-large","a10g-largex2","a10g-largex4","a100-large","zero-a10g","h100","h100x8"],We=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{allowCR:!1};return s(this,t),e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{transform:function(t,r){var i,a,o;for(t=ce(e,fe)+t;;)if(i=t.indexOf("\n"),-1!==(a=n.allowCR?t.indexOf("\r"):-1)&&a!==t.length-1&&(-1===i||i-1>a))r.enqueue(t.slice(0,a)),t=t.slice(a+1);else{if(-1===i)break;o="\r"===t[i-1]?i-1:i,r.enqueue(t.slice(0,o)),t=t.slice(i+1)}he(e,fe,t)},flush:function(t){if(""!==ce(e,fe)){var r=n.allowCR&&ce(e,fe).endsWith("\r")?ce(e,fe).slice(0,-1):ce(e,fe);t.enqueue(r)}}})),le(e,fe,""),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,TransformStream),t}(),fe=new WeakMap,He=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{events:["data"]};s(this,e),se(this,"app_reference"),se(this,"options"),se(this,"config"),se(this,"api_info"),se(this,"api_map",{}),se(this,"session_hash",Math.random().toString(36).substring(2)),se(this,"jwt",!1),se(this,"last_status",{}),se(this,"cookies",null),se(this,"stream_status",{open:!1}),se(this,"pending_stream_messages",{}),se(this,"pending_diff_streams",{}),se(this,"event_callbacks",{}),se(this,"unclosed_events",new Set),se(this,"heartbeat_event",null),se(this,"abort_controller",null),se(this,"stream_instance",null),se(this,"view_api"),se(this,"upload_files"),se(this,"upload"),se(this,"handle_blob"),se(this,"post_data"),se(this,"submit"),se(this,"predict"),se(this,"open_stream"),se(this,"resolve_config"),se(this,"resolve_cookies"),this.app_reference=t,n.events||(n.events=["data"]),this.options=n,this.view_api=q.bind(this),this.upload_files=L.bind(this),this.handle_blob=W.bind(this),this.post_data=X.bind(this),this.submit=j.bind(this),this.predict=Q.bind(this),this.open_stream=ne.bind(this),this.resolve_config=T.bind(this),this.resolve_cookies=I.bind(this),this.upload=F.bind(this)}var t,r,a,u,l,h,p,d;return P(e,[{key:"fetch",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return""+e},t}((function(e,t){var n=new Headers((null==t?void 0:t.headers)||{});return this&&this.cookies&&n.append("Cookie",this.cookies),fetch(e,D({},t,{headers:n}))}))},{key:"stream",value:function(e){return this.abort_controller=new AbortController,this.stream_instance=function(e){var t,n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i={close:function(){throw Error("Method not implemented.")},onerror:null,onmessage:null,onopen:null,readyState:0,url:e.toString(),withCredentials:!1,CONNECTING:0,OPEN:1,CLOSED:2,addEventListener:function(){throw Error("Method not implemented.")},dispatchEvent:function(){throw Error("Method not implemented.")},removeEventListener:function(){throw Error("Method not implemented.")}};return te(e,r).then((t=c(regeneratorRuntime.mark((function e(t){var r,a,s,u,c,l,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i.readyState=i.OPEN,e.prev=1,r=!0,a=!1,s=void 0,e.prev=5,u=o(t);case 7:return e.next=9,u.next();case 9:return c=e.sent,r=c.done,e.next=13,c.value;case 13:if(l=e.sent,r){e.next=20;break}h=l,i.onmessage&&i.onmessage(h);case 17:r=!0,e.next=7;break;case 20:e.next=26;break;case 22:e.prev=22,e.t0=e.catch(5),a=!0,s=e.t0;case 26:if(e.prev=26,e.prev=27,r||!u.return){e.next=31;break}return e.next=31,u.return();case 31:if(e.prev=31,!a){e.next=34;break}throw s;case 34:return e.finish(31);case 35:return e.finish(26);case 36:i.readyState=i.CLOSED,e.next=43;break;case 39:e.prev=39,e.t1=e.catch(1),i.onerror&&i.onerror(e.t1),i.readyState=i.CLOSED;case 43:case"end":return e.stop()}}),e,n,[[1,39],[5,22,26,36],[27,,31,35]])}))),function(e){return t.apply(this,arguments)})).catch((function(e){console.error(e),i.onerror&&i.onerror(e),i.readyState=i.CLOSED})),i}(e.toString(),{signal:this.abort_controller.signal}),this.stream_instance}},{key:"init",value:(d=c(regeneratorRuntime.mark((function e(){var t,r,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!=typeof window&&"WebSocket"in window||i.WebSocket){e.next=5;break}return e.next=3,n.e(43).then(n.t.bind(null,725,7));case 3:r=e.sent,i.WebSocket=r.WebSocket;case 5:if(e.prev=5,!this.options.auth){e.next=9;break}return e.next=9,this.resolve_cookies();case 9:return e.next=11,this._resolve_config().then((function(e){var t=e.config;return a._resolve_hearbeat(t)}));case 11:e.next=16;break;case 13:throw e.prev=13,e.t0=e.catch(5),Error(e.t0);case 16:return e.next=18,this.view_api();case 18:this.api_info=e.sent,this.api_map=f((null==(t=this.config)?void 0:t.dependencies)||[]);case 20:case"end":return e.stop()}}),e,this,[[5,13]])}))),function(){return d.apply(this,arguments)})},{key:"_resolve_hearbeat",value:(p=c(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=7;break}if(this.config=t,!this.config||!this.config.connect_heartbeat){e.next=7;break}if(!this.config.space_id||!this.options.hf_token){e.next=7;break}return e.next=6,M(this.config.space_id,this.options.hf_token,this.cookies);case 6:this.jwt=e.sent;case 7:if(!t.space_id||!this.options.hf_token){e.next=11;break}return e.next=10,M(t.space_id,this.options.hf_token);case 10:this.jwt=e.sent;case 11:this.config&&this.config.connect_heartbeat&&(n=new URL(this.config.root+"/heartbeat/"+this.session_hash),this.jwt&&n.searchParams.set("__sign",this.jwt),this.heartbeat_event||(this.heartbeat_event=this.stream(n)));case 12:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"close",value:function(){var e;null==(e=this.heartbeat_event)||e.close()}},{key:"_resolve_config",value:(h=c(regeneratorRuntime.mark((function e(){var t,n,r,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U(this.app_reference,this.options.hf_token);case 2:return t=e.sent,n=t.http_protocol,r=t.host,i=t.space_id,a=this.options.status_callback,o=void 0,e.prev=8,e.next=11,this.resolve_config(n+"//"+r);case 11:if(o=e.sent){e.next=14;break}throw Error(Ee);case 14:return e.abrupt("return",this.config_success(o));case 17:if(e.prev=17,e.t0=e.catch(8),!i||!a){e.next=23;break}$(i,Te.test(i)?"space_name":"subdomain",this.handle_space_success),e.next=25;break;case 23:throw a&&a({status:"error",message:"Could not load this space.",load_status:"error",detail:"NOT_FOUND"}),Error(e.t0);case 25:case"end":return e.stop()}}),e,this,[[8,17]])}))),function(){return h.apply(this,arguments)})},{key:"config_success",value:(l=c(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.config=t,"undefined"!=typeof window&&"undefined"!=typeof document&&"https:"===window.location.protocol&&(this.config.root=this.config.root.replace("http://","https://")),!this.config.auth_required){e.next=4;break}return e.abrupt("return",this.prepare_return_obj());case 4:return e.prev=4,e.next=7,this.view_api();case 7:this.api_info=e.sent,e.next=13;break;case 10:e.prev=10,e.t0=e.catch(4),console.error("Could not get API info. "+e.t0.message);case 13:return e.abrupt("return",this.prepare_return_obj());case 14:case"end":return e.stop()}}),e,this,[[4,10]])}))),function(e){return l.apply(this,arguments)})},{key:"handle_space_success",value:(u=c(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this){e.next=2;break}throw Error(Ee);case 2:if((n=this.options.status_callback)&&n(t),"running"!==t.status){e.next=21;break}return e.prev=5,e.next=8,this._resolve_config();case 8:if(this.config=e.sent,this.config){e.next=11;break}throw Error(Ee);case 11:return e.next=13,this.config_success(this.config);case 13:return r=e.sent,e.abrupt("return",r);case 17:throw e.prev=17,e.t0=e.catch(5),n&&n({status:"error",message:"Could not load this space.",load_status:"error",detail:"NOT_FOUND"}),e.t0;case 21:case"end":return e.stop()}}),e,this,[[5,17]])}))),function(e){return u.apply(this,arguments)})},{key:"component_server",value:(a=c(regeneratorRuntime.mark((function e(t,n,r){var i,a,o,s,u,c,l,h,f,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.config){e.next=2;break}throw Error(Ee);case 2:if(a={},o=this.options.hf_token,s=this.session_hash,o&&(a.Authorization="Bearer "+this.options.hf_token),u=void 0,c=this.config.components.find((function(e){return e.id===t})),u=(null==(i=null==c?void 0:c.props)?void 0:i.root_url)?c.props.root_url:this.config.root,l=void 0,!("binary"in r)){e.next=25;break}l=new FormData,e.t0=regeneratorRuntime.keys(r.data);case 13:if((e.t1=e.t0()).done){e.next=20;break}if("binary"!==(h=e.t1.value)){e.next=17;break}return e.abrupt("continue",13);case 17:l.append(h,r.data[h]),e.next=13;break;case 20:l.set("component_id",t.toString()),l.set("fn_name",n),l.set("session_hash",s),e.next=27;break;case 25:l=JSON.stringify({data:r,component_id:t,fn_name:n,session_hash:s}),a["Content-Type"]="application/json";case 27:return o&&(a.Authorization="Bearer "+o),e.prev=28,e.next=31,this.fetch(u+"/component_server/",{method:"POST",body:l,headers:a,credentials:"include"});case 31:if((f=e.sent).ok){e.next=34;break}throw Error("Could not connect to component server: "+f.statusText);case 34:return e.next=36,f.json();case 36:return p=e.sent,e.abrupt("return",p);case 40:e.prev=40,e.t2=e.catch(28),console.warn(e.t2);case 43:case"end":return e.stop()}}),e,this,[[28,40]])}))),function(e,t,n){return a.apply(this,arguments)})},{key:"set_cookies",value:function(e){this.cookies=Me(e).join("; ")}},{key:"prepare_return_obj",value:function(){return{config:this.config,predict:this.predict,submit:this.submit,view_api:this.view_api,component_server:this.component_server}}}],[{key:"connect",value:(r=c(regeneratorRuntime.mark((function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{events:["data"]};return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new this(t,r),e.next=3,n.init();case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"duplicate",value:(t=c(regeneratorRuntime.mark((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{events:["data"]};return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",K(t,n));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),t.Client=He,t.FileData=qe,t.client=re,t.duplicate=ie,t.handle_file=function(e){if("string"==typeof e){if(e.startsWith("http://")||e.startsWith("https://"))return{path:e,url:e,orig_name:e.split("/").pop()||"unknown",meta:{_type:"gradio.FileData"}};if(Fe)return new Le("upload_file",{path:e,name:e,orig_path:e})}else{if("undefined"!=typeof File&&e instanceof File)return{path:e instanceof File?e.name:"blob",orig_name:e instanceof File?e.name:"unknown",blob:e instanceof File?e:new Blob([e]),size:e instanceof Blob?e.size:r.byteLength(e),mime_type:e instanceof File?e.type:"application/octet-stream",meta:{_type:"gradio.FileData"}};if(e instanceof r)return new Blob([e]);if(e instanceof Blob)return e}throw Error("Invalid input: must be a URL, File, Blob, or Buffer object.")},t.predict=Q,t.prepare_files=N,t.submit=j,t.upload=F,t.upload_files=L}(n(49),n(210).Buffer,n(76))}}]);