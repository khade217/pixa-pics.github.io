(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{656:function(e,t,n){const a=new Int32Array(15),_={_get_init_state:(e,t,n,a,_,i)=>({canvas_event_target:"CANVAS_WRAPPER_OVERFLOW",canvas_container:{top:0,left:0,height:0,width:0},sizes:{width:0|e,height:0|t},screen_zoom_ratio:1,canvas_wrapper:{padding:0|a,border_width:0|_},scale:{"default":n,current:n,move_x:0,move_y:0,moves_speeds:[],move_speed_timestamp:0|Date.now(),moves_speed_average_now:16},device_pixel_ratio:window.devicePixelRatio,perspective:i}),_get_screen_zoom_ratio:e=>e.canvas_container.width>e.canvas_container.height?(e.canvas_container.height-e.canvas_wrapper.padding/e.device_pixel_ratio*2)/e.sizes.height:(e.canvas_container.width-e.canvas_wrapper.padding/e.device_pixel_ratio*2)/e.sizes.width,_get_pos:(e,t,n)=>(a[0]=2*Math.round(e.canvas_wrapper.padding/e.device_pixel_ratio*e.scale.current+e.canvas_wrapper.border_width)|0,a[1]=Math.round(e.sizes.width*t*e.scale.current)+a[0]|0,a[2]=Math.round(e.sizes.height*t*e.scale.current)+a[0]|0,a[3]=0|e.scale.move_x,a[4]=0|e.scale.move_y,a[5]=e.canvas_container.left+a[3]|0,a[6]=e.canvas_container.top+a[4]|0,a[7]=a[5]+a[1]|0,a[8]=a[6]+a[2]|0,a[9]=a[0]/2|0,a[10]=a[0]/2|0,a[11]=a[5]+a[9]|0,a[12]=a[6]+a[10]|0,a[13]=a[7]-a[0]/2|0,a[14]=a[8]-a[0]/2|0,void 0===n&&(n={}),"undefined"==typeof n.canvas&&(n.canvas={}),n.canvas.offset_left=a[9],n.canvas.offset_top=a[10],n.canvas.left=a[11],n.canvas.top=a[12],n.canvas.right=a[13],n.canvas.bottom=a[14],n.canvas.width=a[13]-a[11]|0,n.canvas.height=a[14]-a[12]|0,"undefined"==typeof n.canvas_wrapper&&(n.canvas_wrapper={}),n.canvas_wrapper.offset_left=a[3],n.canvas_wrapper.offset_top=a[4],n.canvas_wrapper.left=a[5],n.canvas_wrapper.top=a[6],n.canvas_wrapper.right=a[7],n.canvas_wrapper.bottom=a[8],n.canvas_wrapper.width=a[7]-a[5]|0,n.canvas_wrapper.height=a[8]-a[6]|0,"undefined"==typeof n.canvas_container&&(n.canvas_container={}),n.canvas_container.offset_left=0|e.canvas_container.left,n.canvas_container.offset_top=0|e.canvas_container.top,n.canvas_container.left=0|e.canvas_container.left,n.canvas_container.top=0|e.canvas_container.top,n.canvas_container.right=e.canvas_container.left+e.canvas_container.width|0,n.canvas_container.bottom=e.canvas_container.top+e.canvas_container.height|0,n.canvas_container.width=0|e.canvas_container.width,n.canvas_container.height=0|e.canvas_container.height,n),_get_init_pointer_state:()=>({event_button:null,mouse_down:!1,pointer_events:new Map,previous_single_pointer_down_timestamp:0,previous_double_pointer_down_timestamp:0,latest_pointers_distance:0,latest_pointers_client_x_center:0,latest_pointers_client_y_center:0,previous_double_pointer_move_timestamp:0}),_copy_event:e=>({pointerId:0|e.pointerId,clientX:0|e.clientX,clientY:0|e.clientY,pageX:0|e.pageX,pageY:0|e.pageY,button:0|e.button}),_get_shadows(e){function t(t){const a=n.to_rgba_from_hex(n.format_hex_color(e));let _=n.to_hex_from_rgba(Uint8ClampedArray.of(a[0],a[1],a[2],parseInt(142.8))),i=n.to_hex_from_rgba(Uint8ClampedArray.of(a[0],a[1],a[2],parseInt(91.8))),o=n.to_hex_from_rgba(Uint8ClampedArray.of(a[0],a[1],a[2],parseInt(.24*255)));return Array.of(`${t[0]}px ${t[1]}px ${t[2]}px ${t[3]}px ${_}`,`${t[4]}px ${t[5]}px ${t[6]}px ${t[7]}px ${i}`,`${t[8]}px ${t[9]}px ${t[10]}px ${t[11]}px ${o}`).join(",")}const n={format_hex_color(e){const t=0|e.length;if(void 0===e)return"#00000000";{let n="",a="",_="",i="",o="#12345678";switch(t){case 9:o=e;break;case 7:o=e.concat("ff");break;case 5:n=e.charAt(1),a=e.charAt(2),_=e.charAt(3),i=e.charAt(4),o="#".concat(n,n,a,a,_,_,i,i);break;case 4:n=e.charAt(1),a=e.charAt(2),_=e.charAt(3),o="#".concat(n,n,a,a,_,_,"ff")}return o}},to_hex_from_rgba:e=>"#".concat("00000000".concat(new Uint32Array(e.reverse().buffer)[0].toString(16)).slice(-8)),to_rgba_from_hex:e=>new Uint8ClampedArray(Uint32Array.of(parseInt(e.slice(1),16)).buffer).reverse()};return Array.of("",t([0,2,1,-1,0,1,1,0,0,1,3,0]),t([0,3,1,-2,0,2,2,0,0,1,5,0]),t([0,3,3,-2,0,3,4,0,0,1,8,0]),t([0,2,4,-1,0,4,5,0,0,1,10,0]),t([0,3,5,-1,0,5,8,0,0,1,14,0]),t([0,3,5,-1,0,6,10,0,0,1,18,0]),t([0,4,5,-2,0,7,10,1,0,2,16,1]),t([0,5,5,-3,0,8,10,1,0,3,14,2]),t([0,5,6,-3,0,9,12,1,0,3,16,2]),t([0,6,6,-3,0,10,14,1,0,4,18,3]),t([0,6,7,-4,0,11,15,1,0,4,20,3]),t([0,7,8,-4,0,12,17,2,0,5,22,4]),t([0,7,8,-4,0,13,19,2,0,5,24,4]),t([0,7,9,-4,0,14,21,2,0,5,26,4]),t([0,8,9,-5,0,15,22,2,0,6,28,5]),t([0,8,10,-5,0,16,24,2,0,6,30,5]),t([0,8,11,-5,0,17,26,2,0,6,32,5]),t([0,9,11,-5,0,18,28,2,0,7,34,6]),t([0,9,12,-6,0,19,29,2,0,7,36,6]),t([0,10,13,-6,0,20,31,3,0,8,38,7]),t([0,10,13,-6,0,21,33,3,0,8,40,7]),t([0,10,14,-6,0,22,35,3,0,8,42,7]),t([0,11,14,-7,0,23,36,3,0,9,44,8]),t([0,11,15,-7,0,24,38,3,0,9,46,8]))},from(e,t,n,a,_,i){const o=this._get_screen_zoom_ratio,s=this._get_init_state,r=this._get_init_pointer_state,l=this._get_pos,c=this._get_shadows;this._copy_event;let p=!1,h=c("#020529"),d=r(),u=s(e,t,n,a,_,i),m=o(u),g=l(u,m),f={update(){},menu(){},move(){},up(){},down(){},middle(){},ripple(){}},A=null,x=null,w={box_shadow:"",will_change:!1};return{init_speed_interval:function(){null!==A?setTimeout(this.set_move_speed_average_now,5):A=setInterval(this.set_move_speed_average_now,20)},set_canvas_wrapper:function(e,t){u.canvas_wrapper={padding:e,border_width:t},m=o(u),g=l(u,m),this.set_current_scale_default()},set_canvas_container:function(e,t,n,a){u.canvas_container={top:e,left:t,height:n,width:a},m=o(u),g=l(u,m),this.set_current_scale_default()},set_sizes:function(e,t){u.sizes={width:e,height:t},u.scale.moves_speed_average_now=16,m=o(u),g=l(u,m)},set_perspective:function(e){u.perspective=e},get_pointer_state:function(){return d},get_perspective_state:function(){return x||{}},get_screen_zoom_ratio:function(){return Math.fround(parseFloat(m)).toFixed(2)},compute_perspective_from_pointer_event:function(e,t){if(e|=0,t|=0,!(u.perspective>0))return;const n=e-g.canvas_container.left|0,a=t-g.canvas_container.top|0,_=u.perspective*(n-g.canvas_container.width/2)/(g.canvas_container.width/2),i=-u.perspective*(a-g.canvas_container.height/2)/(g.canvas_container.height/2),o=_>u.perspective?_:2*_,s=i<0?i:2*i,r=255-o/2*255,l=s/2*255,c=(1.25*o/u.scale.current*1e3|0)/1e3,p=(1.25*s/u.scale.current*1e3|0)/1e3,h=!(!p&&!c),d=h?`rotateX(${p}deg) rotateY(${c}deg)`:"",m=h?`linear-gradient(to right, rgba(\n                            ${r.toFixed(3)},\n                            ${r.toFixed(3)},\n                            ${r.toFixed(3)}, \n                            ${(Math.abs(.1*o)/(2*u.perspective)).toFixed(2)}\n                            ), rgba(\n                            ${r.toFixed(3)},\n                            ${r.toFixed(3)},\n                            ${r.toFixed(3)}, \n                            ${(Math.abs(.6*o)/(2*u.perspective)).toFixed(2)}\n                            )), linear-gradient(to top, rgba(\n                            ${l.toFixed(3)},\n                            ${l.toFixed(3)},\n                            ${l.toFixed(3)}, \n                            ${(Math.abs(.75*s)/(2*u.perspective)).toFixed(2)}\n                            ), rgba(\n                            ${l.toFixed(3)},\n                            ${l.toFixed(3)},\n                            ${l.toFixed(3)}, \n                            ${(Math.abs(.25*s)/(2*u.perspective)).toFixed(2)}\n                            ))`:"",f=(1+(-c+p)/80).toFixed(2);x={transform_rotate:d,background_image:m,filter:h?`brightness(${f}) contrast(${f})`:""}},set_pointer_state:function(e){var t="",n=!1;for(t in"mouse_down"in e&&d.mouse_down!==e.mouse_down&&(n=!0),e)d[t]=e[t];n&&this.notify_cursor()},set_moves:function(e,t,n,a){n=n||null,a=a||function(){};let _=Date.now();const{scale:i,canvas_event_target:s}=u,r="CANVAS_WRAPPER_OVERFLOW"!==s?18:24;let{move_x:c,move_y:p,moves_speeds:h,move_speed_timestamp:d,current:f}=i;const A=_-d|0,x=c-e|0,w=p-t|0,y=0|Math.min(Math.round((0|Math.sqrt(x*x+w*w))/A*200),200);h.push(y),h.length>=r&&h.shift();let v=h.slice(-r).reduce(((e,t,n,a)=>e+t/a.length),0);v=Math.max(1,Math.round(Math.floor(v*r/200)));const b=!(null===n);u.scale["default"]=Math.fround(parseFloat(i["default"])),u.scale.current=Math.fround(parseFloat(b?n:f)),u.scale.move_x=0|e,u.scale.move_y=0|t,u.scale.move_speed_timestamp=Date.now(),u.scale.moves_speeds=h,u.scale.moves_speed_average_now=null!==n&&n>f?r:null!==n&&n<f?0:parseInt(v),m=o(u),g=l(u,m,g),this.notify_moved(a)},set_notifiers:function(e=function(){},t=function(){},n=function(){},a=function(){},_=function(){},i=function(){},o=function(){},s=function(){}){f={update:e,menu:t,move:n,up:a,down:_,middle:i,cursor:o,ripple:s}},notify_moved:function(e){f.update(!1,!1,e)},notify_menu:function(e,t){setTimeout((function(){f.menu(e)}),t|=0)},notify_move:function(e){f.move(e)},notify_up:function(e){f.up(e)},notify_down:function(e){f.down(e)},notify_ripple:function(e){f.ripple(e)},notify_middle:function(){f.middle(!1,!1)},notify_cursor:function(){f.cursor(d.mouse_down,u.canvas_event_target)},set_shadow_color:function(e){h=c(e)},set_zoom:function(e=1,t,n,a=0,_=0,i=function(){}){const{scale:o,canvas_container:s,canvas_wrapper:r}=u,{current:l,move_y:c,move_x:p}=o;let h=l*e;if(!(h>6||h<1/6)){let e,o,d=1-l/h,u=h/l;if(t&&n?(e=t-s.left|0,o=n-s.top|0):(e=s.width/2|0,o=s.height/2|0),0===a&&0===_)this.set_moves(p,c,h,i);else{let t=(p-e*d)*u+a|0,n=(c-o*d)*u+_|0;const l=(s.width-r.width)/2|0,m=(s.height-r.height)/2|0,g=3/4*r.width+l,f=3/4*r.height+m;n-=m,t-=l;let A=Math.min(Math.abs(t),g)*(t<0?-1:1)+l,x=Math.min(Math.abs(n),f)*(n<0?-1:1)+m;this.set_moves(A,x,h,i)}}},handle_wheel:function({deltaY:e,pageY:t,pageX:n,movementX:a=0,movementY:_=0}){const{canvas_container:i,canvas_wrapper:o}=this.get_pos(),{move_x:s,move_y:r,current:l}=u.scale;let c=Math.max(Math.min(.125,Math.abs(-.01*e)),.25);c=-.01*e>0?c:-c;let p=l+c*l*(.9/Math.pow(l<1?1/l:l,1.6));if(!(p>6||p<1/6)){let e,c,h=1-l/p,d=p/l;n&&t?(e=n-i.left|0,c=t-i.top|0):(e=i.width/2|0,c=i.height/2|0);let u=(s-e*h)*d+a|0,m=(r-c*h)*d+_|0;const g=(i.width-o.width)/2|0,f=(i.height-o.height)/2|0,A=3/4*o.width+g,x=3/4*o.height+f;m-=f,u-=g;let w=Math.min(Math.abs(u),A)*(u<0?-1:1)+g,y=Math.min(Math.abs(m),x)*(m<0?-1:1)+f;this.set_moves(w,y,p)}},handle_move:function(e,t,n,a){const{canvas_container:_,canvas_wrapper:i}=this.get_pos(),{move_x:o,move_y:s}=u.scale,r=(_.width-i.width)/2|0,l=(_.height-i.height)/2|0,c=3/4*i.width+r|0,p=3/4*i.height+l|0,h=o+(n-e|0)-l|0,d=s+(a-t|0)-r|0,m=h<0?-1:1,g=Math.min(Math.abs(h),c)*m+r|0,f=Math.min(Math.abs(d),p)*m+l|0;this.set_moves(g,f)},set_boolean_move_on_click:function(e){p=e},handle_pointer_down:function(e){e.preventDefault();const{canvas_event_target:t}=u;let{latest_pointers_distance:n,latest_pointers_client_x_center:a,latest_pointers_client_y_center:_,previous_single_pointer_down_timestamp:i,previous_double_pointer_down_timestamp:o,pointer_events:s}=this.get_pointer_state();const r=parseInt(i),l=parseInt(o);s.set(""+e.pointerId,e);const c=!(1!==s.size),p=!(2!==s.size);i=c?Date.now():r,o=p?Date.now():l,this.set_pointer_state({pointer_events:s,mouse_down:!0,event_button:parseInt(e.button),latest_pointers_distance:p?0:parseFloat(n),previous_single_pointer_down_timestamp:parseInt(i),previous_double_pointer_down_timestamp:parseInt(o),latest_pointers_client_x_center:parseInt(e.clientX),latest_pointers_client_y_center:parseInt(e.clientY)}),2===parseInt(e.button||0)||Math.abs(i-r)<200&&Math.abs(a-e.clientX)<20&&Math.abs(_-e.clientY)<20?this.notify_menu(e,180):c&&l+200>Date.now()||!c&&"mouse"!==e.pointerType||"CANVAS"!==t||this.notify_down(e),"CANVAS_WRAPPER_OVERFLOW"===t&&this.notify_ripple(e)},handle_pointer_up:function(e){e.preventDefault();const{canvas_event_target:t}=u;let{pointer_events:n}=this.get_pointer_state();n["delete"](""+e.pointerId),this.set_pointer_state({pointer_events:n,mouse_down:!(0===n.size)}),this.notify_up(e),("CANVAS_WRAPPER_OVERFLOW"===t&&1===e.which||"CANVAS"!==t)&&this.notify_moved()},handle_pointer_move:function(e){e.preventDefault();const t=""+u.canvas_event_target;this.compute_canvas_event_target(parseInt(e.pageX),parseInt(e.pageY));const n=""+u.canvas_event_target;let{mouse_down:a,event_button:_,pointer_events:i,latest_pointers_distance:o,latest_pointers_client_x_center:s,latest_pointers_client_y_center:r,previous_double_pointer_move_timestamp:l,previous_single_pointer_down_timestamp:c}=this.get_pointer_state();if(i.set(""+e.pointerId,e),2===i.size){const e=Array.from(i.values()),t=e[0].clientX-e[1].clientX,n=e[0].clientY-e[1].clientY,a=Math.sqrt(t*t+n*n),_=parseInt(e[0].clientX+e[1].clientX)/2,l=parseInt(e[0].clientY+e[1].clientY)/2,p=parseInt(e[0].pageX+e[1].pageX)/2,h=parseInt(e[0].pageY+e[1].pageY)/2,d=_-s,m=l-r,g=u.scale.move_x+d,f=u.scale.move_y+m,A=o>0?parseFloat(a/o):1,x={pointer_events:i,latest_pointers_distance:parseFloat(a),latest_pointers_client_x_center:parseInt(_),latest_pointers_client_y_center:parseInt(l),previous_double_pointer_move_timestamp:Date.now()};if(c+30<Date.now()){const{canvas_container:e,canvas_wrapper:t}=this.get_pos(),{current:n}=u.scale;let a=n*A;if(!(a>6||a<1/6)){let _,i,o=1-n/a,s=a/n;_=p-e.left|0,i=h-e.top|0;let r=(g-_*o)*s+d|0,l=(f-i*o)*s+m|0;const c=(e.width-t.width)/2|0,u=(e.height-t.height)/2|0,A=3/4*t.width+c,x=3/4*t.height+u;l-=u,r-=c;let w=Math.min(Math.abs(r),A)*(r<0?-1:1)+c,y=Math.min(Math.abs(l),x)*(l<0?-1:1)+u;this.set_moves(w,y,a)}this.set_pointer_state(x)}else this.set_pointer_state(x)}else if(a&&1===i.size){const t={pointer_events:i,latest_pointers_client_x_center:parseInt(e.clientX),latest_pointers_client_y_center:parseInt(e.clientY),previous_double_pointer_move_timestamp:parseInt(l)};"CANVAS"!==n||"CANVAS"===n&&0===_&&p||1===_?l+200<Date.now()||1===_?(this.set_pointer_state(t),this._handle_canvas_move(parseInt(e.clientX-s),parseInt(e.clientY-r))):this.set_pointer_state(t):(this.set_pointer_state(t),this.notify_move(e))}else t!==n?(this.notify_move(e),this.notify_moved()):"CANVAS"===n&&this.notify_move(e)},_handle_canvas_move:function(e,t){const{canvas_container:n,canvas_wrapper:a}=this.get_pos(),{move_x:_,move_y:i}=u.scale,o=(n.width-a.width)/2,s=(n.height-a.height)/2,r=3/4*a.width+o,l=3/4*a.height+s;let c=_+e,p=i+t;p-=s,c-=o;const h=Math.min(Math.abs(c),r)*(c<0?-1:1)+o,d=Math.min(Math.abs(p),l)*(p<0?-1:1)+s;this.set_moves(h,d)},"new":function(e,t,n,a,_,i){h=c("#020529"),d=r(),u=s(e,t,n,a,_,i),m=o(u),g=l(u,m),f={moved(){},menu(){},canvas(){},up(){}}},destroy:function(){h=null,p=null,d=null,u=null,g=null,f=null},get_pos:function(){return g},get_state:function(){return u},get_style:function(){return w.msan=u.scale.moves_speed_average_now,w.box_shadow=h[w.msan<0?Math.round(Math.abs(w.msan)/2):w.msan],w},get_canvas_pos_from_event:function(e,t){const{canvas:n}=this.get_pos(),{width:a,height:_}=u.sizes,i=parseInt(e)-n.left,o=parseInt(t)-n.top;let s=Math.floor(a*(i/n.width)),r=Math.floor(_*(o/n.height));return s=s!==Math.max(Math.min(s,a-1),0)?-1:s,r=r!==Math.max(Math.min(r,_-1),0)?-1:r,-1!==s&&-1!==r||(s=-1,r=-1),[s,r]},set_current_scale_default:function(){u.scale.current=parseFloat(u.scale["default"]),m=o(u),g=l(u,m,g),this.set_canvas_moves_middle()},set_canvas_moves_middle:function(){const{canvas_container:e,canvas_wrapper:t}=this.get_pos(),n=parseInt(parseInt(e.width-t.width)/2),a=parseInt(parseInt(e.height-t.height)/2);this.set_moves(n,a,null,this.notify_middle)},compute_canvas_event_target:function(e,t){e|=0,t|=0,this.compute_perspective_from_pointer_event(e,t);const{canvas:n,canvas_wrapper:a}=g;let _="CANVAS_WRAPPER_OVERFLOW",i=!1;e>=n.left&&t>=n.top&&e<=n.right&&t<=n.bottom?_="CANVAS":e>=a.left&&t>=a.top&&e<=a.right&&t<=a.bottom&&(_="CANVAS_WRAPPER"),u.canvas_event_target!==_&&(i=!0,u.canvas_event_target=_),i&&this.notify_cursor()},set_move_speed_average_now:function(){if(!u)return;const e="CANVAS_WRAPPER_OVERFLOW"!==u.canvas_event_target?18:24,t=Date.now();if(t-u.scale.move_speed_timestamp>=20&&u.scale.moves_speed_average_now>-e){const n=Math.max(u.scale.moves_speed_average_now-1,-e);u.scale.moves_speed_average_now=n,u.scale.move_speed_timestamp=0|t,f.update(!0,!0)}else t-u.scale.move_speed_timestamp>=20&&u.scale.moves_speed_average_now<-e&&e<24?(u.scale.moves_speed_average_now=0|Math.max(u.scale.moves_speed_average_now+1,-e),u.scale.move_speed_timestamp=0|t,f.update(!0,!0)):u.perspective>0&&f.update(!0,!0)}}}};e.exports=_},704:function(e,t,n){function a(e,t,n){e|=0,t|=0;var a=new Uint8Array(e);void 0!==n?(a.fill(255),a.set(n,0)):a.fill(255);let _={number_length_index_byte:Uint32Array.of(e,t,0,0),hover_data_in_layer:new Uint8Array(t),indexes_data_for_layers:new Uint32Array(t),colors_data_in_layers_uint32:new Uint32Array(t*e),layers_opacity_255:a};return _.colors_data_in_layers_uint32_SIMDope=new c(_.colors_data_in_layers_uint32.buffer),_}function _(e,t,n,_){if(t|=0,n|=0,void 0===e)return a(t,n,_);if(null===e)return a(t,n,_);{let i=p(t,e.layer_number);return h(i,0)||v(e.max_length,n)?a(t,n,_):(e.number_length_index_byte[0]=0|t,e.number_length_index_byte[1]=0|n,e.number_length_index_byte[2]=0,e.number_length_index_byte[3]=0,void 0!==_?(e.layers_opacity_255.fill(255),e.layers_opacity_255.set(_)):e.layers_opacity_255.fill(255),e)}}var i,o=n(596),s=(0,o.SIMDopeCreateConfAdd)({create:{new_of:!0},properties:{},methods:{get_use_element:!0,set_tail:!0,get_tail:!0,get_tail_opacity:!0,reset_tail:!0,is_dark:!0,blend_first_with:!0,blend_first_with_tails:!0}});const{simdops:r,Color:l,Colors:c}=(0,o.SIMDopeCreate)(s),{minus_int:p,int_not_equal:h,plus_int:d,plus_uint:u,minus_uint:m,multiply_int:g,multiply_uint:f,divide_uint:A,clamp_uint8:x,clamp_uint32:w,int_equal:y,uint_less:v,int_less:b,int_greater_equal:E,uint_not_equal:C,uint_less_equal:I,min_uint:R}=r;Object.defineProperty((i=function(e){return e=e||{},this instanceof i?(this.state_=a(e.layer_number||1,e.max_length||1,e.layers_opacity_255||new Uint8Array(0)),this.number_length_index_byte_=this.state_.number_length_index_byte,this.hover_data_in_layer_=this.state_.hover_data_in_layer,this.indexes_data_for_layers_=this.state_.indexes_data_for_layers,this.colors_data_in_layers_uint32_=this.state_.colors_data_in_layers_uint32,this.shadow_state_=((t=t||{base_rgba_colors_for_blending:new Uint32Array(0),color_less_uint8x4:l.new_of(255,255,255,255),color_full_uint8x4:l.new_of(0,0,0,255),layers_color:[],all_layers_length:0,used_colors_length:0}).base_rgba_colors_for_blending_SIMDope=new c(t.base_rgba_colors_for_blending.buffer),t),this.data_array_=[],this):new i(e);var t}).prototype,"state",{get:function(){return this.state_},enumerable:!1,configurable:!1}),Object.defineProperty(i.prototype,"set_state",{get:function(){return function(e){return this.state_=e,this.number_length_index_byte_=this.state_.number_length_index_byte,this.hover_data_in_layer_=this.state_.hover_data_in_layer,this.indexes_data_for_layers_=this.state_.indexes_data_for_layers,this.colors_data_in_layers_uint32_=this.state_.colors_data_in_layers_uint32,this.state_}},enumerable:!1,configurable:!1}),Object.defineProperty(i.prototype,"set_shadow_state",{get:function(){return function(e){return this.shadow_state_=e}},enumerable:!1,configurable:!1}),Object.defineProperty(i.prototype,"get_updated_shadow_state",{get:function(){return function(){return this.shadow_state_.layers_color.length<this.number_length_index_byte_[0]+1&&(this.shadow_state_.layers_colors=Array(this.number_length_index_byte_[0]+1|0).fill(null).map((function(){return new l(new ArrayBuffer(4))}))),this.shadow_state_.base_rgba_colors_for_blending.length>=this.number_length_index_byte_[2]?this.shadow_state_.base_rgba_colors_for_blending.fill(0,0,this.shadow_state_.used_colors_length):(this.shadow_state_.base_rgba_colors_for_blending=new Uint32Array(0|this.number_length_index_byte_[2]),this.shadow_state_.base_rgba_colors_for_blending_SIMDope=new c(this.shadow_state_.base_rgba_colors_for_blending.buffer)),this.shadow_state_.all_layers_length=0|this.number_length_index_byte_[0],this.shadow_state_.max_used_colors_length=0|this.number_length_index_byte_[1],this.shadow_state_.used_colors_length=0|this.number_length_index_byte_[2],this.shadow_state_}},enumerable:!1,configurable:!1}),Object.defineProperty(i.prototype,"shadow_state",{get:function(){return this.shadow_state_},enumerable:!1,configurable:!1}),Object.defineProperty(i.prototype,"set_bytes_index",{get:function(){return function(e){return this.number_length_index_byte_[3]=0|e}},enumerable:!1,configurable:!1}),Object.defineProperty(i.prototype,"data_array",{get:function(){return this.data_array_},enumerable:!1,configurable:!1}),Object.defineProperty(i.prototype,"set_data_array",{get:function(){return function(e){return this.data_array_=e}},enumerable:!1,configurable:!1}),Object.defineProperty(i.prototype,"bytes_index",{get:function(){return function(){return 0|this.number_length_index_byte_[3]}},enumerable:!1,configurable:!1}),i.init=function(e,t,n){return new i({layer_number:e,max_length:t,layers_opacity_255:n})},Object.defineProperty(i.prototype,"for",{get:function(){return function(e,t){this.indexes_data_for_layers_[this.number_length_index_byte_[2]]=w(e),this.hover_data_in_layer_[this.number_length_index_byte_[2]]=x(t),this.number_length_index_byte_[2]=u(this.number_length_index_byte_[2],1)}},enumerable:!1,configurable:!1}),Object.defineProperty(i.prototype,"next",{get:function(){return function(){this.number_length_index_byte_[3]=u(this.number_length_index_byte_[3],1)}},enumerable:!1,configurable:!1}),Object.defineProperty(i.prototype,"stack",{get:function(){return function(e,t){this.colors_data_in_layers_uint32_[u(f(this.number_length_index_byte_[0],this.number_length_index_byte_[3]),x(e))]=w(t)}},enumerable:!1,configurable:!1}),i.prototype.blend=function(e,t){var n,a,_;t|=0;var{base_rgba_colors_for_blending:i,base_rgba_colors_for_blending_SIMDope:o,all_layers_length:s,used_colors_length:r,layers_colors:l,color_less_uint8x4:p,color_full_uint8x4:h}=this.get_updated_shadow_state(),{colors_data_in_layers_uint32_SIMDope:m,hover_data_in_layer:f,layers_opacity_255:A,indexes_data_for_layers:x}=this.state;return n=this.data_array.map((function(e){return new c(e.data.buffer)})),a=n.length||0,_=l[0],new Promise((function(e){for(var c=0,w=new Uint32Array(2),y=0;v(0|c,r);c=u(c,1)){for(o.get_use_element(0|c,_),w[0]=g(c,s),y=0;b(y,a);y=d(y,1))n[0|y].get_use_element(x[0|c],l[y+1|0]),l[0|y].set_tail(l[y+1|0],A[0|y]);for(y=a;b(y,s);y=d(y,1))w[1]=d(w[0],y),m.get_use_element(w[1],l[y+1|0]),l[0|y].set_tail(l[y+1|0],A[0|y]);(0|f[0|c])>0?(_.blend_first_with_tails(t),_.blend_first_with(_.is_dark()?p:h,f[0|c],!1,!1)):_.blend_first_with_tails(t)}e(Array.of(x.subarray(0,r),i.subarray(0,r)))}))},i.prototype.build=function(e,t,n,_){e=(0|e)>>>0,t=(0|t)>>>0,_=_||[],this.set_bytes_index(0),this.set_state(a(e,t,n)),this.set_data_array(_)},i.prototype.update=function(e,t,n,a){e=(0|e)>>>0,t=(0|t)>>>0,a=a||[],this.set_bytes_index(0),this.set_state(_(this.state,e,t,n)),this.set_data_array(a)},i.prototype.clear=function(){this.set_bytes_index(0),this.set_state(_(this.state,1,1)),this.set_data_array([])},e.exports=i},942:function(e,t,n){var a,_=(a=n(704))&&a.__esModule?a:{"default":a},i=n(596);const o={_create_state:function(e,t,n,a,_,i,o,s){let r=Array.from(a.map((function(e){return Uint16Array.from(e)}))),l=Array.from(_.map((function(e){return Uint32Array.from(e)}))),c=Array.from(i.map((function(e){return Object.assign({},e)})));return Object.assign({},{w:t|=0,h:n|=0,sp:r,spc:l,l:c,s:o,wp:s})},from:function(e,t,n,a,o,s,r,l){let c=this._create_state,p=c(e,t,n,a,o,s,r,l);return{"new"(e,t,n,a,_,i,o,s){p=c(e,t,n,a,_,i,o,s)},destroy(e=function(){}){null!==p?(p=null,e()):e("ok")},render:()=>null!==p?function(e,t,n,a,o,s,r){return new Promise((function(l,c){s|=0;const p=(e|=0)*(t|=0)|0,h=0|a.length,d=_["default"].init(h,p,Uint8Array.from(o.map((function(e){return e.hidden?0:Math.round(255*parseFloat(e.opacity))}))));let u=0,m=0;for(;(0|u)<(0|p);u=(u+1|0)>>>0){for(d["for"](u,0),m=0;(0|m)<(0|h);m=(m+1|0)>>>0)d.stack(0|m,a[0|m][n[0|m][0|u]]);d.next()}d.blend(!1,!1).then((([n,a])=>{let _=new i.Colors(a),o=[];if(r){let e=new i.Colors(_.get_deduplicated_uint32a());o=Array(e.length).fill("");let t=new i.Color(new ArrayBuffer(4));for(let n=0;n<e.length;n++)o[n]=e.get_element(n,t).hex}(function(e,t){var n="image/png";try{return new Promise((function(a,_){createImageBitmap(e,{premultiplyAlpha:"premultiply",resizeQuality:"pixelated",resizeHeight:e.height*t|0,resizeWidth:e.width*t|0}).then((e=>{var t=new OffscreenCanvas(e.width,e.height),_=t.getContext("bitmaprenderer");_.imageSmoothingEnabled=!1,_.transferFromImageBitmap(e),t.convertToBlob({type:n}).then((e=>{try{a((new FileReaderSync).readAsDataURL(e))}catch(n){var t=new FileReader;t.onload=function(){a(t.result)},t.onerror=function(){c()},t.readAsDataURL(e)}}))}))}))}catch(a){return new Promise((function(a,_){var i,o,s=document.createElement("canvas"),r=document.createElement("canvas");s.width=e.width,s.height=e.height,r.width=e.width*t|0,r.height=e.height*t|0,(i=s.getContext("2d")).imageSmoothingEnabled=!1,(o=r.getContext("2d")).imageSmoothingEnabled=!1,i.putImageData(e,0,0),o.drawImage(s,0,0,r.width,r.height),a(r.toDataURL(n))}))}})(new ImageData(new Uint8ClampedArray(_.get_image_data().buffer),e,t),s).then((function(e){l(Object.assign({},r?{url:e,colors:Array.from(o)}:{url:e}))}))}))}))}(p.w,p.h,p.sp,p.spc,p.l,p.s,p.wp):Promise.reject()}}};e.exports=o},943:function(e,t,n){const a={_create_state:function(e,t,n,a){return{w:e,h:t,p:n,pc:a}},_create_func:function(){return new(0,Object.getPrototypeOf((function(){})).constructor)('\n           return function(\n                pxl_width,\n                pxl_height,\n                pxls,\n                pxl_colors,\n            ) {\n                "use strict";\n                pxl_width = pxl_width | 0;\n                pxl_height = pxl_height | 0;\n                \n                const full_pxls_length = pxls.length | 0;\n                const full_pxls = new Uint32Array(full_pxls_length|0);\n                for(var i = 0; (i|0) < (full_pxls_length|0); i = (i + 1 | 0) >>> 0) { full_pxls[i|0] = (pxl_colors[pxls[i|0]] | 0) >>> 0; }\n                let image_data = new ImageData(new Uint8ClampedArray(full_pxls.buffer), pxl_width, pxl_height);\n                \n                return new Promise(function(resolve, reject) {\n                    createImageBitmap(image_data).then(function(r){resolve(r);});\n                });\n            };\n        ')()},from:function(e){let t=this._create_func(),n=this._create_state,a=e||null;return{render(e,_,i,o,s){var r=n(e,_,i,o);a?a.exec(t,[r.w,r.h,r.p,r.pc])["catch"]((function(){return t(r.w,r.h,r.p,r.pc)})).then((function(e){s(e)})):t(r.w,r.h,r.p,r.pc).then((function(e){s(e)}))}}}};e.exports=a},944:function(e,t,n){var a=n(604),_=n(596),i=n(657);a.SetFixed.compute=function(e,t,n,a){var _,i=t.bitArrayData,o=[0].concat(n.map((function(e){return e.bitArrayData})));for(_=0;(0|_)<(0|e);_=(_+1|0)>>>0)o[0]=0|_,i[0|_]=a.apply(null,o)};const o={init(e,t,n,o,s,r){let{clamp_uint32:l,plus_uint:c,int_less:p,uint_equal:h,uint_not_equal:d,clamp_uint8:u}=_.simdops,m={index_changes:new Uint32Array(0),color_changes:new Uint32Array(0),_pxl_indexes_updated:new a.SetFixed(0),_pxl_indexes_of_selection_drawn:new a.SetFixed(0),_pxl_indexes_of_current_shape:new a.SetFixed(0),_pxl_indexes_of_old_shape:new a.SetFixed(0),_old_pxls_hovered:new a.SetFixed(0),_old_selection_pair_highlight:!0,_old_layers_string_id:"",_old_pxl_width:0,_old_pxl_height:0,_last_paint_timestamp:0,_is_there_new_dimension:!0,_did_hide_canvas_content:!1,_previous_imported_image_pxls_positioned_keyset:new a.SetFixed(0)},g={super_state:e,super_canvas:t,super_blend:n,canvas_pos:o,color_conversion:s,sraf:r},f={position(){},selection(){},color(){},action(){},update(){}},A=g.super_state.create_shape(),x=(new Uint32Array(0),new Uint32Array(0),""),w=undefined,y=g.canvas_pos.get_state().sizes,v=function(e,t,n,a){if(m._last_paint_timestamp>=a)e();else{let{_old_pxl_width:_,_old_pxl_height:i}=m,{pxl_width:o,pxl_height:s}=g.super_state.get_state();if(g.super_canvas.ok()){y=g.canvas_pos.get_state().sizes;let r=!(parseInt(_)===parseInt(o)&&parseInt(i)===parseInt(s)),l=parseInt(y.width)!==parseInt(o)||parseInt(y.height)!==parseInt(s);l||r?(g.super_state.set_state({pxl_width:parseInt(y.width),pxl_height:parseInt(y.height)}),m._is_there_new_dimension=!0,A.update_state(),f.update(!1,!1).then((function(){setTimeout((()=>{m._is_there_new_dimension=!1,f.update(!1,!1)}),500),w(r,l,n,a)["catch"]((function(){setTimeout(v,5,e,t,n,a)}))}))["catch"]((function(){setTimeout(v,10,e,t,n,a)}))):w(r,l,n,a)["catch"]((function(){setTimeout(v,5,e,t,n,a)}))}else setTimeout(v,15,e,t,n,a)}},b=new a.SetFixed(y.width*y.height),E=g.super_canvas.render.bind(g.super_canvas),C=g.super_blend,{bool_is_resize:I,bool_new_hover:R,bool_old_hover:S,bool_new_shape:U,bool_old_shape:k,bool_new_selection:F,bool_old_selection:Q,bool_new_import:B,bool_old_import:M,bool_new_pixel:L,bool_new_highlight:T}={bool_is_resize:!1,bool_new_hover:!1,bool_old_hover:!1,bool_new_shape:!1,bool_old_shape:!1,bool_new_selection:!1,bool_old_selection:!1,bool_new_import:!1,bool_old_import:!1,bool_new_pixel:!1,bool_new_highlight:!1},O=function(e,t,n,_,i,o){var s,r,l,h,d,u,f,x,w,y,I;if(m._last_paint_timestamp>=o)e();else{let{_is_there_new_dimension:S,_did_hide_canvas_content:U,_old_pxls_hovered:k,_old_layers_string_id:F,_pxl_indexes_of_old_shape:Q,_pxl_indexes_of_current_shape:B,_pxl_indexes_of_selection_drawn:M,_previous_imported_image_pxls_positioned_keyset:L,_old_selection_pair_highlight:O}=m,{_s_layers:P,_layer_index:Y,_layers:D,select_mode:N,hide_canvas_content:V,pxl_width:G,pxl_height:z,_pxls_hovered:K,tool:q,_shape_index_a:j,_select_shape_index_a:X,_pxl_indexes_of_selection:J,_paint_or_select_hover_pxl_indexes:W,_selection_pair_highlight:H}=g.super_state.get_state();const{imported_image_pxls_positioned:Z,imported_image_pxl_colors:$,imported_image_pxls_positioned_keyset:ee,image_imported_resizer_index:te}=g.super_state.get_imported_image_data(),ne=ee.size>0,ae=0|P.length,_e=P[0].indexes.length;r=(s=ae+(ne?1:0))-1;const ie=""+Array.from(D).map((function(e,t){return t+"-id-"+e.id+"-v-"+(e.hidden||V?"0":"1")+"-o-"+parseInt(255*e.opacity).toString(16)+"-w-"+e.width+"-h-"+e.height+"-end"})).join("+"),oe=F!==ie,se=U!==V||oe||S||n||i,re=Uint8Array.from(D.map((function(e){return parseInt(e.hidden||V?0:Math.round(255*parseFloat(e.opacity)))})).concat(ne?[196]:[]));if("LINE"!==q&&"RECTANGLE"!==q&&"ELLIPSE"!==q&&"TRIANGLE"!==q||-1===j||-1===K)if("SELECT LINE"!==q&&"SELECT RECTANGLE"!==q&&"SELECT ELLIPSE"!==q||-1===X||-1===K){if(("SELECT PATH"===q||"CONTOUR"===q)&&W.size>0){const de=W[0],ue=W[W.size-1],me=A.from_line(de,ue);"REMOVE"===N&&"SELECT PATH"===q?me.forEach((e=>{J["delete"](e)})):"SELECT PATH"===q?me.forEach((e=>{J.add(e)})):me.forEach((e=>{B.add(e)}))}}else B="SELECT LINE"===q?A.from_line(X,K,B):"SELECT RECTANGLE"===q?A.from_rectangle(X,K,B):"SELECT ELLIPSE"===q?A.from_ellipse(X,K,B):B;else B="LINE"===q?A.from_line(j,K,B):"RECTANGLE"===q?A.from_rectangle(j,K,B):"ELLIPSE"===q?A.from_ellipse(j,K,B):B;let le=0,ce=0,pe=0,he=P[Y];for(T=H!==O,C.update(0|s,0|_e,re,P),l=C["for"].bind(C),h=C.next.bind(C),d=C.stack.bind(C),u=B.has.bind(B),f=J.has.bind(J),x=ee.has.bind(ee),w=T?4294967295:0,te>=0&&B.add(te),B.add(K),y=function(e,t,n,a,_,i,o,s,r){return t[0|(e=(0|e)>>>0)]|n[0|e]|a[0|e]^_[0|e]|i[0|e]^o[0|e]|i[0|e]&w[0|e]|s[0|e]|r[0|e]},b.length!==_e&&(b=new a.SetFixed(_e)),a.SetFixed.compute(_e,b,[he.setFixed,k,Q,B,M,J,L,ee],y),I=b.has.bind(b);p(pe,_e);pe=c(pe,1))(se||I(pe))&&(u(pe)?l((0|pe)>>>0,128):f(pe)?(le=pe%G|0,ce=(pe-le)/G|0,l((0|pe)>>>0,72+48*(1&(le+ce+(H?1:0)|0)|0)|0)):l((0|pe)>>>0,0),x(pe)&&d((0|r)>>>0,(0|$[0|Z[(0|pe)>>>0]])>>>0),h());function R(){setTimeout(v,5,e,t,i,o)}C.blend(!1,!1).then((function(t){t[0].length>0||se||n||i?g.super_canvas.pile(t[0],t[1]).then((function(){g.super_canvas.unpile(G,z).then((function(){g.super_canvas.prender().then((function(){g.sraf.run_frame((function(){return k.clearAndBulkAdd(Uint32Array.of(te,K)),he.clear_changes(),M.setFromSetFixed(J),Q.setFromSetFixed(B),L.setFromSetFixed(ee),B.clear(),m._old_selection_pair_highlight=H,m._old_layers_string_id=""+ie,m._did_hide_canvas_content=!!V,m._old_pxl_width=parseInt(G),m._old_pxl_height=parseInt(z),m._last_paint_timestamp=+o,E()}),!1,se||n||i,Date.now(),"render").then(e)["catch"](R)}))["catch"](R)}))["catch"](R)}))["catch"](R):e()}))}};return{get:function(){return m},set:function(e){for(x in e)m[x]=e[x];return Promise.resolve()},set_notifiers:function(e=function(){},t=function(){},n=function(){},a=function(){},_=function(){}){f={position:e,selection:t,color:n,action:a,update:_}},is_there_new_dimension:function(){return m._is_there_new_dimension&&!0},update_canvas:function(e,t){return e=e||!1,t=t||Date.now(),void 0===w&&this&&(w=this.render_canvas),new Promise(v)},render_canvas:function(e,t,n,a){return new Promise(O)},_should_remove_not_perfect_second_latest_pixel_from_array(e){const t=g.super_state.get_state().pxl_width;if(e.size>=3){const n=0|e[e.size-1],a=n%t|0,_=(n-a)/t,i=0|e[e.size-2],o=i%t|0,s=(i-o)/t,r=0|e[e.size-3],l=r%t|0,c=(r-l)/t,p=0|Math.abs(a-l),h=0|Math.abs(_-c);if(1===p&&1===h&&(a===o&&s===c||_===s&&o===l))return!0}return!1},_handle_canvas_mouse_move(e){let{_pxl_indexes_of_selection:t,_imported_image_pxls:n,pxl_current_color_uint32:_,tool:i,pxl_width:o,pxl_height:s,_pxls_hovered:r,hide_canvas_content:l,_is_on_resize_element:c,_paint_or_select_hover_pxl_indexes:p,_paint_hover_old_pxls_snapshot:h,_last_action_timestamp:d,_paint_or_select_hover_pxl_indexes_exception:u,_paint_or_select_hover_actions_latest_index:m,_s_layers:f,_layer_index:x,pxl_current_opacity:w,_select_hover_old_pxls_snapshot:y,select_mode:v}=g.super_state.get_state();const{event_button:b,mouse_down:E}=g.canvas_pos.get_pointer_state(),C=b+1|0,[I,R]=g.canvas_pos.get_canvas_pos_from_event(e.pageX,e.pageY),S=R*o+I|0;if(-1==(0|I)||-1==(0|R))this._notify_position_change({x:I,y:R});else if((0|S)==(0|r)||l)r!==S&&g.super_state.set_state({_pxls_hovered:0|S,_mouse_inside:!0}).then((()=>{this.update_canvas(),this._notify_position_change({x:I,y:R})}));else if(n.length>0){let{_imported_image_move_from:e,_imported_image_scale_delta_x:t,_imported_image_scale_delta_y:n,_imported_image_start_x:a,_imported_image_start_y:_,_imported_image_width:i,_imported_image_height:l}=g.super_state.get_state();const p=i+t,h=l+n,d=a+p+(_+h)*o,u=(0|S)==(0|d)||(0|r)==(0|d);let m=0,f=0;const A=I-e[0],x=R-e[1];e=Array.of(I,R),1===C&&E?u||c?(m=t+A|0,f=n+x|0,m=0|Math.max(m,-(i-1)),f=0|Math.max(f,-(l-1)),t=0|m,n=0|f,g.super_state.set_state({_pxls_hovered:0|S,_is_on_resize_element:u,_mouse_inside:!0,_imported_image_scale_delta_x:t,_imported_image_scale_delta_y:n,_imported_image_move_from:Array.of(e[0],e[1])}).then((()=>{this.update_canvas(),this._notify_position_change({x:I,y:R})}))):(a=a+A|0,a=a<-p?-p:0|a,a=a>=o?o:0|a,_=_+x|0,_=_<-h?-h:0|_,_=_>=s?s:0|_,g.super_state.set_state({_pxls_hovered:0|S,_is_on_resize_element:u,_mouse_inside:!0,_imported_image_start_x:a,_imported_image_start_y:_,_imported_image_move_from:Array.of(e[0],e[1])}).then((()=>{this.update_canvas(),this._notify_position_change({x:I,y:R})}))):g.super_state.set_state({_pxls_hovered:0|S,_is_on_resize_element:u,_mouse_inside:!0}).then((()=>{this._notify_position_change({x:I,y:R})}))}else if("PENCIL"!==i&&"PENCIL PERFECT"!==i&&"CONTOUR"!==i||1!==C||!E)if("SELECT PIXEL"!==i&&"SELECT PIXEL PERFECT"!==i&&"SELECT PATH"!==i||1!==C||!E){const{_s_layers:e,_layer_index:t}=g.super_state.get_state();p.clear(),g.super_state.set_state({_pxls_hovered:0|S,_mouse_inside:!0,_paint_or_select_hover_actions_latest_index:-1,_paint_or_select_hover_pxl_indexes:p}).then((()=>{this.update_canvas(),this._notify_position_change({x:I,y:R})}))}else{-1===m&&(m=S);const e=A.from_line(m,S);if("SELECT PATH"===i)d=1/0,e.forEach((function(e){p.add(0|e)}));else if("SELECT PIXEL"===i)d=Date.now(),e.forEach((function(e){p.add(0|e)}));else if("SELECT PIXEL PERFECT"===i){d=Date.now(),e.forEach((function(e){p.add(0|e)}));const n=p.indexes;if(this._should_remove_not_perfect_second_latest_pixel_from_array(n)){const e=n[n.length-2];y.includes(e)||"ADD"!==v&&"REPLACE"!==v||t["delete"](e),p["delete"](e)}}"REPLACE"===v&&t.clear(),p.forEach((e=>{"ADD"===v||"REPLACE"===v?t.add(e):t["delete"](e)})),g.super_state.set_state({_pxls_hovered:0|S,_mouse_inside:!0,_pxl_indexes_of_selection:t,_paint_or_select_hover_pxl_indexes:p,_paint_or_select_hover_actions_latest_index:S,_last_action_timestamp:d}).then((()=>{this.update_canvas(),this._notify_is_something_selected(),this._notify_position_change({x:I,y:R})}))}else{-1===m&&(m=0|S),p=A.from_line(m,S,p);const{pencil_mirror_mode:e,_pencil_mirror_index:t}=g.super_state.get_state(),n=t%o,r=(t-n)/o;if("CONTOUR"===i)d=1/0;else if("PENCIL"===i)d=Date.now();else if("PENCIL PERFECT"===i&&(d=Date.now(),u.forEach((function(e){p["delete"](e)})),this._should_remove_not_perfect_second_latest_pixel_from_array(p.indexes))){const e=p[p.size-2];p["delete"](e),u.add(e);let t=new Set(Array.of(e));t.forEach((e=>{const[a,_]=e,i=_,r=a-2*(a-n);r>=0&&r<o&&i>=0&&i<=s&&t.add(i*o+r)})),t.forEach((e=>{f[x].set_uint32(e,h[e])}))}if("NONE"!==e){const t=new a.SetFixed(p);let i=new Set(p.filter((function(e){return!t.has(0|e)&&!u.has(0|e)})).map((function(e){var t=e%o|0;return[0|t,0|(e-t)/o]})));"VERTICAL"!==e&&"BOTH"!==e||i.forEach((e=>{const[t,n]=e,a=n-2*(n-r),_=t;_>=0&&_<o&&a>=0&&a<=s&&i.add([_,a])})),"HORIZONTAL"!==e&&"BOTH"!==e||i.forEach((e=>{const t=e[1],a=e[0]-2*(e[0]-n);a>=0&&a<o&&t>=0&&t<=s&&i.add([a,t])}));let l=new a.SetFixed(o*s);i.forEach((e=>{var t=e[1],n=e[0];l.add(t*o+n|0)})),g.super_state.paint_shape(l,_,w,{_pxls_hovered:0|S,_mouse_inside:!0,_paint_or_select_hover_pxl_indexes:p,_paint_or_select_hover_pxl_indexes_exception:u,_paint_or_select_hover_actions_latest_index:0|S,_last_action_timestamp:d},(()=>{this.update_canvas()}))}else g.super_state.paint_shape(p.indexes,_,w,{_pxls_hovered:0|S,_mouse_inside:!0,_paint_or_select_hover_pxl_indexes:p,_paint_or_select_hover_pxl_indexes_exception:u,_paint_or_select_hover_actions_latest_index:0|S,_last_action_timestamp:d},(()=>{this.update_canvas()}));this._notify_position_change({x:0|I,y:0|R})}},_notify_position_change(e,t){t=t||Date.now();const n=0|g.super_state.get_notified_pos_at(),a=0|Date.now();(a-n|0)>=100&&null==t||(0|t)>(0|n)&&(a-t|0)>=100?(e={x:"undefined"==typeof e.x?-1:e.x,y:"undefined"==typeof e.y?-1:e.y},g.super_state.set_state({_notified_position_at:a}).then((function(){f.position(e,g.sraf.get_state().previous_cpaf_fps)}))):(0|a)<(t+100|0)&&setTimeout(this._notify_position_change,100-(t-a|0)|0,{x:e.x,y:e.y},0|a)},_handle_canvas_mouse_up(){let{_paint_or_select_hover_pxl_indexes:e,tool:t,_imported_image_pxls:n,_pxl_indexes_of_selection:_,select_mode:i}=g.super_state.get_state();if(n.length>0)g.super_state.set_state({_imported_image_move_from:[-1,-1]});else if(e.size>0&&"CONTOUR"===t){A.update_state();let{pxl_current_opacity:t,pxl_current_color_uint32:n}=g.super_state.get_state();const _=e[0],i=e[e.size-1],o=A.from_line(_,i);e=new a.SetFixed(Array.from(e.indexes).concat(o)),e=A.from_path(e,e),e.clear(),g.super_state.paint_shape(e.indexes,n,t,{_last_action_timestamp:Date.now()},(()=>{this.update_canvas()}))}else if(e.size>0&&"SELECT PATH"===t){A.update_state();const t=e[0],n=e[e.size-1],o=A.from_line(t,n);e=new a.SetFixed(Array.from(e.indexes).concat(o)),e=A.from_path(e,e),"REPLACE"===i&&_.clear(),"ADD"===i||"REPLACE"===i?e.forEach((function(e){_.add(e)})):e.forEach((function(e){_["delete"](e)}))}},_handle_canvas_mouse_down(e){const{pxl_current_color:t,pxl_current_color_uint32:n,hide_canvas_content:_,tool:o,pxl_width:s,pxl_height:r,pxl_current_opacity:l,bucket_threshold:c,select_mode:p}=g.super_state.get_state(),h=e.button+1;let[d,u]=[-1,-1];if(-1!==g.super_state.get_state()._pxls_hovered&&null===e){const e=g.super_state.get_state()._pxls_hovered%s,t=(g.super_state.get_state()._pxls_hovered-e)/s;[d,u]=[e,t]}else e&&([d,u]=g.canvas_pos.get_canvas_pos_from_event(e.pageX,e.pageY));if(-1===d||-1===u)return;let{_shape_index_a:m,_select_shape_index_a:f,_shape_index_b:x,_select_shape_index_b:w,_pxl_indexes_of_selection:y,_s_layers:v,_layer_index:b,hue:E}=g.super_state.get_state();const C=u*s+d,I=v[b].indexes[C];if(-1===h)return void g.super_state.set_state({_pxls_hovered:C}).then((()=>{this.update_canvas()}));3===h&&(m=-1,f=-1,x=-1,w=-1);const{_imported_image_pxls:R}=g.super_state.get_state();if(g.super_state.set_state({_pxls_hovered:0|C,_mouse_inside:!0,_paint_or_select_hover_actions_latest_index:-1,_paint_hover_old_pxls_snapshot:v[b].indexes_copy,_select_hover_old_pxls_snapshot:new a.SetFixed(y)}),!_){let _=v[b].indexes,x=Array.from(v[b].colors);if(R.length>0&&1===h)g.super_state.set_state({_imported_image_move_from:[d,u]});else if(2===h||"MOVE"===o&&R.length<=0&&(1===h||-1===h))g.super_state.set_state({_imported_image_move_from:[e.x,e.y]});else if("PICKER"===o&&1===h){const t=this.get_pixel_color_from_pos(d,u);this._notify_current_color_change(t),this._notify_relevant_action_event(e,t,1)}else if("EXCHANGE"===o&&1===h){const t=v[b].colors[I];this.exchange_pixel_color(t,n),this._notify_relevant_action_event(e,n,1)}else if("LINE"===o||"RECTANGLE"===o||"ELLIPSE"===o)if(-1===m)1===h?g.super_state.set_state({_shape_index_a:C}).then((()=>{this.update_canvas()})):g.super_state.set_state({_shape_index_a:m}).then((()=>{this.update_canvas()}));else{let t;switch(o){case"LINE":t=A.from_line(m,C);break;case"RECTANGLE":t=A.from_rectangle(m,C);break;case"ELLIPSE":t=A.from_ellipse(m,C)}g.super_state.paint_shape(t.indexes,n,l,{_shape_index_a:-1,_last_action_timestamp:Date.now()},(()=>{this.update_canvas()})),this._notify_relevant_action_event(e,"#ffffffff",.6)}else if("SELECT LINE"===o||"SELECT RECTANGLE"===o||"SELECT ELLIPSE"===o)if(-1===f)1===h?g.super_state.set_state({_select_shape_index_a:C}).then((()=>{this.update_canvas()})):g.super_state.set_state({_select_shape_index_a:f}).then((()=>{this.update_canvas()}));else{let e="SELECT LINE"===o?A.from_line(f,C):"SELECT RECTANGLE"===o?A.from_rectangle(f,C):A.from_ellipse(f,C);"REPLACE"===p&&y.clear(),"ADD"===p||"REPLACE"===p?e.forEach((function(e){y.add(e)})):e.forEach((function(e){y["delete"](e)})),e.clear(),g.super_state.set_state({_pxl_indexes_of_selection:y,_select_shape_index_a:-1,_last_action_timestamp:Date.now()}).then((()=>{this.update_canvas(),this._notify_is_something_selected()}))}else if("SELECT PIXEL"!==o&&"SELECT PATH"!==o||1!==h)if("SET PENCIL MIRROR"===o&&1===h)g.super_state.set_state({_pencil_mirror_index:C,_last_action_timestamp:Date.now()}).then((()=>{this.update_canvas()}));else if("PENCIL"!==o&&"PENCIL PERFECT"!==o&&"CONTOUR"!==o||1!==h)if("BUCKET"!==o&&"HUE BUCKET"!==o&&"SELECT COLOR THRESHOLD"!==o&&"BORDER"!==o||1!==h){if("SELECT COLOR"===o&&1===h){const{_s_layers:e}=g.super_state.get_state(),t=e[b].indexes[C];"REPLACE"===p&&y.clear(),e[b].indexes.forEach(((e,n)=>{e===t&&("ADD"===p||"REPLACE"===p?y.add(n):y["delete"](n))})),g.super_state.set_state({_pxl_indexes_of_selection:y,_last_action_timestamp:Date.now()}).then((()=>{this.update_canvas(),this._notify_is_something_selected()}))}}else{const{_s_layers:h,_layer_index:m}=g.super_state.get_state(),f=h[m].indexes,w=[d,u],v=f[C],b=x[v];let I=[];const[R,S,U,k]=g.color_conversion.to_rgba_from_uint32(b),[F,Q,B,M]=g.color_conversion.to_hsla_from_rgba(Uint8ClampedArray.of(R,S,U,k)),L=F<E?E-F:360-F+E;let T=[w],O=new a.SetFixed(h[0].indexes.length);const P=e=>{if(0===c)return v===f[e];if(!O.has(e)&&e>=0&&e<s*r){const t=b||0,n=x[f[e]]||0;return g.color_conversion.match_color(t,n,c)}return!1},Y=(e,t)=>{if(t=t||!1,(!O.has(e)||t)&&e>=0&&e<s*r)if("HUE BUCKET"===o){if(t){const t=x[_[e]];if("undefined"==typeof I[t]){let[n,a,i,o]=g.color_conversion.to_rgba_from_uint32(t),[s,r,l,c]=g.color_conversion.to_hsla_from_rgba(Uint8ClampedArray.of(n,a,i,o));s=(s+L)%360,[n,a,i,o]=g.color_conversion.to_rgba_from_hsla(Array.of(s,r,l,c));const p=g.color_conversion.to_uint32_from_rgba(Uint8ClampedArray.of(n,a,i,o));x.includes(p)||x.push(p);let h=x.indexOf(p);-1===h&&(h=x.push(p)),I[t]=h,_[e]=h}else _[e]=I[t]}O.add(e)}else if("BUCKET"===o||"BORDER"===o){if(t){const t=g.color_conversion.blend_colors(x[_[e]],n,l,!1,!1);let a=x.indexOf(t);-1===a&&(a=x.push(t)),_[e]=a}O.add(e)}else"SELECT COLOR THRESHOLD"===o&&O.add(e)};let D=!1,N=!1;for(;T.length;){let[e,t]=T.pop(),n=t*s+e;for(;t>=0&&P(n);)n-=s,t--;for(n+=s,t++,D=!1,N=!1;t<r&&P(n);)t++,Y(n,"BORDER"!==o),e>0&&(P(n-1)?D||(T.push([e-1,t-1]),D=!0):D&&(D=!1)),e+1<s&&(P(n+1)?N||(T.push([e+1,t-1]),N=!0):N&&(N=!1)),n+=s}if("BORDER"===o){A.from_border(O,!0,!0).forEach((e=>{Y(e,!0)}));let{_s_layers:e,pxl_width:t,pxl_height:n}=g.super_state.get_state(),a=g.color_conversion.clean_duplicate_colors(_,x);e[m]=i.Layer.new_from_colors_and_indexes(a[1],a[0],t,n,!0),g.super_state.set_state({_s_layers:e,_last_action_timestamp:Date.now()}).then((()=>{this.update_canvas()}))}else if("SELECT COLOR THRESHOLD"===o)"REPLACE"===p&&y.clear(),O.forEach((e=>{"ADD"===p||"REPLACE"===p?y.add(e):y["delete"](e)})),g.super_state.set_state({_pxl_indexes_of_selection:y,_last_action_timestamp:Date.now()}).then((()=>{this.update_canvas(),this._notify_is_something_selected()}));else if("BUCKET"===o||"HUE BUCKET"===o){let{_s_layers:n,pxl_width:a,pxl_height:o}=g.super_state.get_state(),s=g.color_conversion.clean_duplicate_colors(_,x);n[m]=i.Layer.new_from_colors_and_indexes(s[1],s[0],a,o,!0),g.super_state.set_state({_s_layers:n,_last_action_timestamp:Date.now()}).then((()=>{this.update_canvas(),this._notify_relevant_action_event(e,t,1)}))}}else{const{pencil_mirror_mode:e,_pencil_mirror_index:t}=g.super_state.get_state(),i=t%s,o=(t-i)/s;let c=new Set(Array.of(Array.of(d,u)));if("VERTICAL"===e||"BOTH"===e){const e=u-2*(u-o),t=d;if(t>=0&&t<s&&e>=0&&e<=r){c.add(Array.of(t,e));const a=e*s+t,i=v[b].indexes[a],o=x[i],r=g.color_conversion.blend_colors(o,n,l,!0,!1);let p=x.indexOf(r);-1===p&&(p=x.push(r)),_[a]=p}}"HORIZONTAL"!==e&&"BOTH"!==e||c.forEach((e=>{const t=e[1],a=e[0]-2*(e[0]-i);if(a>=0&&a<s&&t>=0&&t<=r){const e=t*s+a,i=v[b].indexes[e],o=x[i],r=g.color_conversion.blend_colors(o,n,l,!0,!1);let c=x.indexOf(r);-1===c&&(c=x.push(r)),_[e]=c}})),g.super_state.paint_shape([C],n,l,{_paint_or_select_hover_pxl_indexes:new a.SetFixed([C]),_paint_or_select_hover_actions_latest_index:C,_paint_hover_old_pxls_snapshot:g.super_state.get_state()._s_layers[b].indexes_copy,_last_action_timestamp:Date.now()},(()=>{this.update_canvas()}))}else"REPLACE"===p&&y.clear(),"ADD"===p||"REPLACE"===p?y.add(C):y["delete"](C),"SELECT PIXEL"===o?g.super_state.set_state({_pxl_indexes_of_selection:y,_paint_or_select_hover_actions_latest_index:C,_last_action_timestamp:Date.now()}).then((()=>{this.update_canvas(),this._notify_is_something_selected()})):"SELECT PATH"===o&&g.super_state.set_state({_pxl_indexes_of_selection:y,_paint_or_select_hover_actions_latest_index:C,_last_action_timestamp:1/0}).then((()=>{this.update_canvas(),this._notify_is_something_selected()}))}},_notify_is_something_selected(){const e=g.super_state.get_state()._pxl_indexes_of_selection;!!g.super_state.get_state()._previous_pxl_indexes_of_selection.size!=!!e.size&&g.super_state.set_state({_is_something_selected:!!e.size,_previous_pxl_indexes_of_selection:new a.SetFixed(e)}).then((()=>{f.selection(!!e.size)}))},get_pixel_color_from_pos(e,t){const{pxl_height:n,pxl_width:a,_s_layers:i,_layers:o}=g.super_state.get_state(),s=t*a+e;if(e>a||t>n||e<0||t<0)return"#00000000";let r=new Uint32Array(i.length);for(let _=i.length-1;_>=0;_--)r[_]=4294967295&(0|i[_].get_uint32(0|s));let l=_.Color.new_zero();for(let c=0;c<i.length;c++)"undefined"!=typeof o[c]&&(o[c].hidden||l.blend_first_with(_.Color.new_uint32(r[c]),Math.round(255*parseFloat(o[c].opacity)),!1,!1));return l.hex},_notify_current_color_change(e,t=null){e=g.color_conversion.format_hex_color(e),f.color?f.color(e,t):g.super_state.set_state({pxl_current_color:e})},_notify_relevant_action_event(e,t,n=1){f.action&&("number"==typeof t&&(t=_.Color.new_uint32(t).hex),f.action(e,t,n))},exchange_pixel_color(e,t){const{_s_layers:n,pxl_width:a,pxl_height:_,_layer_index:o}=g.super_state.get_state();let s=n[o].indexes;const r=n[o].colors.indexOf(e);if(!n[o].colors.includes(t)){let e=new Uint32Array(n[o].colors.length+1);e.set(n[o].colors,0),e[e.length-1]=(0|t)>>>0,n[o].set_colors(e,!0)}const l=n[o].colors.indexOf(t);s=s.map((e=>e===r?l:e));const[c,p]=g.color_conversion.clean_duplicate_colors(s,n[o].colors);n[o]=i.Layer.new_from_colors_and_indexes(p,c,a,_,!0),g.super_state.set_state({_s_layers:n,_last_action_timestamp:Date.now()}).then((()=>{this.update_canvas()}))}}}};e.exports=o},945:function(e,t,n){function a(e,t,n){let a={s:function(e,t,n){var a;t|=0,n|=0,e||(e=document.createElement("canvas")),e.width=0|t,e.height=0|n;let _,i,o,s=!(!/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(navigator.userAgent||navigator.vendor||window.opera)&&!/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent||navigator.vendor||window.opera.substr(0,4))),r=!!("createImageBitmap"in window),l=!!("OffscreenCanvas"in window),c=!1,p=!0;if(l)try{i=e.transferControlToOffscreen();try{o=i.getContext("2d",{willReadFrequently:!0,desynchronized:!s})}catch(h){o=i.getContext("2d",{willReadFrequently:!0})}o.imageSmoothingEnabled=!1;try{o.webkitImageSmoothingEnabled=!1,o.mozImageSmoothingEnabled=!1,o.msImageSmoothingEnabled=!1}catch(h){}c=!0,_=o,p=!1}catch(h){try{i=new OffscreenCanvas(t,n),o=i.getContext("2d"),o.getContextAttributes&&"willReadFrequently"in(a=o.getContextAttributes())&&(o="desynchronized"in a?i.getContext("2d",{willReadFrequently:!0,desynchronized:!s}):i.getContext("2d",{willReadFrequently:!0})),o.imageSmoothingEnabled=!1;try{o.webkitImageSmoothingEnabled=!1,o.mozImageSmoothingEnabled=!1,o.msImageSmoothingEnabled=!1}catch(h){}}catch(h){l=!1}}if(p){_=e.getContext("2d");try{_.getContextAttributes&&"willReadFrequently"in(a=_.getContextAttributes())&&(_="desynchronized"in a?e.getContext("2d",{willReadFrequently:!0,desynchronized:!s}):e.getContext("2d",{willReadFrequently:!0}))}catch(h){}_.imageSmoothingEnabled=!1;try{_.mozImageSmoothingEnabled=!1,_.webkitImageSmoothingEnabled=!1,_.msImageSmoothingEnabled=!1}catch(h){}}return{is_bitmap:r,is_offscreen:l,is_offscreen_linked:c,width:0|t,height:0|n,canvas_context:_,offscreen_canvas_context:o}}(e,t|=0,n|=0),enable_paint_type:"",fp_buffer:new ArrayBuffer(n*t*4),ic:{indexes:new Uint16Array(0),colors:new Uint32Array(0),used:!0},b:{bmp_x:0,bmp_y:0,bmp_t:0,bmp:{close(){},width:0,height:0},old_bmp:{close(){},width:0,height:0}},b2:{bmp_x:0,bmp_y:0,bmp_t:0,bmp:{close(){},width:0,height:0},old_bmp:{close(){},width:0,height:0}},pr:{xy1xy2:new Uint16Array(4),width:0,height:0}};return a.fp=new Uint32Array(a.fp_buffer),a.pr_uint8a=new Uint8Array(a.fp.buffer),a}var _,i=n(596),o=(0,i.SIMDopeCreateConfAdd)({create:{new_zero:!0},properties:{hex:!0},methods:{get_use_element:!0}});const{simdops:s,Color:r,Colors:l}=(0,i.SIMDopeCreate)(o),{clamp_uint32:c,modulo_uint:p,divide_uint:h,minus_uint:d,uint_greater:u,uint_less:m,uint_greater_equal:g,uint_less_equal:f,plus_uint:A,minus_int:x,int_greater:w,int_less:y,int_greater_equal:v,int_less_equal:b,plus_int:E,max_int:C,min_int:I}=s;(0,Object.getPrototypeOf((function(){})).constructor)('var bpro = function(s_width, pr_width, pr_height, pr_top_left_x, pr_top_left_y, fp){\n            \n                "use strict";\n                var imul = Math.imul;\n                var fp_square = new Uint8Array(imul(pr_width, pr_height) << 4);\n                var current_offset_start_index = 0;\n                for(var i = 0; (i|0) < (pr_height|0) ; i = (i + 1 | 0)>>>0) {\n                    current_offset_start_index = (imul(s_width, (i + pr_top_left_y | 0)) + pr_top_left_x | 0) >>> 0;\n                    fp_square.set(fp.subarray((current_offset_start_index << 2|0)>>>0, ((current_offset_start_index + pr_width | 0)<<2|0)>>>0), (imul(i,pr_width)<<2|0)>>>0);\n                }\n                \n                return createImageBitmap(new ImageData(new Uint8ClampedArray(fp_square.buffer), pr_width|0, pr_height|0));                \n              \n            }; return bpro;')(),Object.defineProperty((_=function(e,t,n){return this instanceof _?(this.state_=a(e,t,n),this):new _(e,t,n)}).prototype,"ok",{get:function(){return function(){return!!this.state_.s.canvas_context.canvas}}}),Object.defineProperty(_.prototype,"new",{get:function(){return function(e,t,n){return this.state_=a(e,t,n),Promise.resolve()}}}),Object.defineProperty(_.prototype,"clear",{get:function(){return function(){return new Promise((function(e){this.state_.s.canvas_context.clearRect(0,0,this.state_.s.width,this.state_.s.height),e()}))}}}),Object.defineProperty(_.prototype,"render",{get:function(){return function(){var e=this.state_.b2;return this.state_.pr.xy1xy2[0]=this.state_.s.width-1|0,this.state_.pr.xy1xy2[1]=this.state_.s.height-1|0,this.state_.pr.xy1xy2[2]=0,this.state_.pr.xy1xy2[3]=0,void 0!==e&&"bitmap"===this.state_.enable_paint_type?(this.state_.b.old_bmp.close(),this.state_.s.canvas_context.clearRect(e.bmp_x,e.bmp_y,e.bmp.width,e.bmp.height),this.state_.s.canvas_context.globalCompositeOperation="source-over",this.state_.s.canvas_context.drawImage(e.bmp,e.bmp_x,e.bmp_y,e.bmp.width,e.bmp.height),this.state_.b=e,Promise.resolve()):"offscreen"===this.state_.enable_paint_type&&!1===this.state_.is_offscreen_linked?(this.state_.s.canvas_context.globalCompositeOperation="copy",this.state_.s.canvas_context.drawImage(this.state_.s.offscreen_canvas_context.canvas,0,0),Promise.resolve()):Promise.resolve()}}}),Object.defineProperty(_.prototype,"prender",{get:function(){return function(){if("bitmap"===this.state_.enable_paint_type){let e=Date.now(),t=this.state_.pr.xy1xy2[0],n=this.state_.pr.xy1xy2[1],a=0|this.state_.pr.width,_=0|this.state_.pr.height;return new Promise(((i,o)=>{createImageBitmap(new ImageData(new Uint8ClampedArray(this.state_.pr_uint8a.buffer),0|this.state_.s.width,0|this.state_.s.height),t,n,a,_).then((a=>{this.state_.b2.old_bmp=this.state_.b.bmp,this.state_.b2.bmp=a,this.state_.b2.bmp_x=0|t,this.state_.b2.bmp_y=0|n,this.state_.b2.bmp_t=0|e,i()}))["catch"]((()=>{this.state_.s.is_bitmap=!1,o()}))}))}return this.state_.enable_paint_type,Promise.resolve()}}}),Object.defineProperty(_.prototype,"unpile",{get:function(){return function(e,t){let n=0|this.state_.s.width,a=0|this.state_.s.height,_=this.state_.ic.indexes,i=this.state_.ic.colors;if(this.state_.enable_paint_type=this.state_.s.is_bitmap?"bitmap":this.state_.s.is_offscreen?"offscreen":"",n!==e||a!==t)return Promise.reject();if(_.length>0&&!1===this.state_.ic.used){let c=new Uint16Array(2),u=this.state_.fp,x=this.state_.pr,w=x.xy1xy2,y=new Uint32Array(1);if(_.length<1024||"bitmap"!==this.state_.enable_paint_type){let v="offscreen"===this.state_.enable_paint_type?this.state_.s.offscreen_canvas_context:this.state_.s.canvas_context,b=new l(i.buffer,i.byteOffset,i.byteLength),E=new r(new ArrayBuffer(4)),C={},I={};function o(e,t,n){e.fillStyle=n,e.fill(t)}for(let R=0,S=0|_.length;m(R,S);R=A(R,1))y[0]=_[0|R],u[y[0]]=i[0|R],c[0]=p(y[0],n),c[1]=h(d(y[0],c[0]),n),"undefined"==typeof C[i[0|R]]&&(C[i[0|R]]=b.get_use_element(R,E).hex,I[i[0|R]]=new Path2D),v.clearRect(c[0],c[1],1,1),I[i[0|R]].rect(c[0],c[1],1,1);var s=Uint32Array.from(Object.keys(I));for(let U=0,k=0|s.length;m(U,k);U=A(U,1))o(v,I[s[U]],C[s[U]]);this.state_.ic.used=!0,this.state_.enable_paint_type="offscreen"===this.state_.enable_paint_type?"offscreen":""}else{for(let F=0,Q=0|_.length;m(F,Q);F=A(F,1))y[0]=_[F],u[y[0]]=i[F],c[0]=p(y[0],n),c[1]=h(d(y[0],c[0]),n),g(w[0],c[0])&&(w[0]=c[0]),f(w[2],c[0])&&(w[2]=c[0]),g(w[1],c[1])&&(w[1]=c[1]),f(w[3],c[1])&&(w[3]=c[1]);x.width=w[2]-w[0]+1|0,x.height=w[3]-w[1]+1|0,this.state_.pr=x}return this.state_.ic.used=!0,Promise.resolve()}return Promise.resolve()}}}),Object.defineProperty(_.prototype,"pile",{get:function(){return function(e,t){return this.state_.ic.indexes=e,this.state_.ic.colors=t,this.state_.ic.used=!1,Promise.resolve()}}}),Object.defineProperty(_.prototype,"set_dimensions",{get:function(){return function(e,t){return this.state_.s.width!==e||this.state_.s.height!==t?(this.state_=a(this.state_.s.canvas_context.canvas,e,t),Promise.resolve()):Promise.reject()}}}),Object.defineProperty(_.prototype,"secure_context",{get:function(){return function(){this.state_.s.canvas_context.canvas.addEventListener("contextlost",(()=>{let e=this.state_.s.canvas_context.canvas.getContext("2d",{willReadFrequently:!0});e.imageSmoothingEnabled=!1,e.webkitImageSmoothingEnabled=!1,e.globalCompositeOperation="copy",this.state_.s.canvas_context=e})),this.state_.s.offscreen_canvas_context.canvas.addEventListener("contextlost",(()=>{let e=this.state_.s.offscreen_canvas_context.canvas.getContext("2d",{willReadFrequently:!0});e.imageSmoothingEnabled=!1,e.webkitImageSmoothingEnabled=!1,this.state_.s.offscreen_canvas_context=e}))}}}),Object.defineProperty(_.prototype,"destroy",{get:function(){return function(){Object.keys(this.state_).forEach((function(e){delete this.state_[e]})),this.state_=null}}}),e.exports=_},946:function(e,t,n){var a=n(604),_=n(596),i=n(657),o=n(620);const s={_get_build_state:e=>({_id:parseInt(1e3*Math.random()*1e3).toString(16)+"",className:e.className||null,perspective:e.perspective||0,animation:e.animation||!0,animation_duration:e.animation_duration||60,move_using_full_container:e.move_using_full_container,dont_compute_base64_original_image:e.dont_compute_base64_original_image||!1,dont_change_img_size_onload:e.dont_change_img_size_onload||!1,dont_show_canvas_until_img_set:e.dont_show_canvas_until_img_set||!1,show_image_only_before_canvas_set:e.show_image_only_before_canvas_set||!1,dont_show_canvas:e.dont_show_canvas||!1,but_show_canvas_once:e.but_show_canvas_once||!1,has_shown_canvas_once:!1,tool:e.tool||"PENCIL",select_mode:e.select_mode||"REPLACE",pencil_mirror_mode:e.pencil_mirror_mode||"NONE",hue:e.hue||0,pxl_width:32,pxl_height:32,pxl_current_color:e.pxl_current_color||"#00000000",pxl_current_color_uint32:_.Color.new_hex(e.pxl_current_color||"#00000000").uint32,pxl_current_opacity:e.pxl_current_opacity||1,bucket_threshold:e.bucket_threshold||0,color_loss:e.color_loss||.25,default_size:e.default_size||96,ideal_size:e.ideal_size||e.default_size||96,max_size:e.max_size||2*e.default_size||192,px_per_px:e.px_per_px||1,fast_drawing:e.fast_drawing||!1,canvas_border_radius:e.canvas_border_radius||0,canvas_wrapper_background_color:e.canvas_wrapper_background_color||"#020529",canvas_wrapper_background_color_focused:e.canvas_wrapper_background_color_focused||"#000000",canvas_wrapper_border_radius:e.canvas_wrapper_border_radius||4,show_original_image_in_background:e.show_original_image_in_background||!1,show_transparent_image_in_background:e.show_transparent_image_in_background||!1,hide_canvas_content:e.hide_canvas_content||!1,_pencil_mirror_index:-1,_previous_pencil_mirror_axes_indexes:new a.SetFixed((e.pxl_width||32)*(e.pxl_height||32)),_previous_pencil_mirror_axes_hover_indexes:new a.SetFixed((e.pxl_width||32)*(e.pxl_height||32)),_base64_original_images:[],_original_image_index:-1,_layers:[{id:Date.now(),name:"Layer 0",hidden:!1,opacity:1}],_layers_defined_at:0,_layer_index:0,_current_layer:new i.Layer(Uint32Array.of(0),1,1),_s_layers:[new i.Layer(Uint32Array.of(0),new Uint16Array((e.pxl_width||32)*(e.pxl_height||32)).fill(0),e.pxl_width||32,e.pxl_height||32,!0)],_json_state_history:{history_position:0,state_history:[]},_saving_json_state_history_running:!1,_pxls_hovered:-1,_canvas_container:null,_canvas_wrapper:null,_canvas_wrapper_overflow:null,_state_history_length:100,_last_action_timestamp:Date.now(),_lazy_lazy_compute_time_ms:1e4,_undo_buffer_time_ms:parseInt(parseInt(e.pxl_width||32)+parseInt(e.pxl_height||32)+1e3),_mouse_inside:!1,_paint_hover_old_pxls_snapshot:new Uint16Array((e.pxl_width||32)*(e.pxl_height||32)).fill(0),_select_hover_old_pxls_snapshot:new Uint16Array,_paint_or_select_hover_actions_latest_index:-1,_paint_or_select_hover_pxl_indexes:new a.SetFixed((e.pxl_width||32)*(e.pxl_height||32)),_pxl_indexes_newly_painted:new a.SetFixed((e.pxl_width||32)*(e.pxl_height||32)),_paint_or_select_hover_pxl_indexes_exception:new a.SetFixed((e.pxl_width||32)*(e.pxl_height||32)),_shape_index_a:-1,_select_shape_index_a:-1,_shape_index_b:-1,_select_shape_index_b:-1,_pxl_indexes_of_selection:new a.SetFixed((e.pxl_width||32)*(e.pxl_height||32)),_previous_pxl_indexes_of_selection:new a.SetFixed((e.pxl_width||32)*(e.pxl_height||32)),_imported_image_previous_start_x:0,_imported_image_previous_start_y:0,_imported_image_start_x:0,_imported_image_start_y:0,_imported_image_pxls:[],_imported_image_width:0,_imported_image_height:0,_imported_image_scale_delta_x:0,_imported_image_scale_delta_y:0,_imported_image_previous_scale_delta_x:0,_imported_image_previous_scale_delta_y:0,_is_on_resize_element:!1,_imported_image_pxl_colors:[],_is_image_import_mode:!1,_previous_image_imported_resizer_index:-1,_selection_pair_highlight:!0,_imported_image_move_from:[-1,-1],_updated_at:Date.now(),_notified_position_at:0,_force_updated_timestamp:0,_loading_base64_img:"",_loading_base64_img_changed:0,_intervals:[],_kb:0,export_state_every_ms:e.export_state_every_ms||6e4,_last_filters_hash:"",_saving_json_state_history_ran_timestamp:0,_processing_filters:!1,canvas_event_target:"CANVAS_WRAPPER_OVERFLOW",mouse_down:!1,cached_background_image_url:"",cached_background_image:""}),from:function(e){let t={imported_image_pxls_positioned:[],imported_image_pxl_colors:new Uint32Array(0),image_imported_resizer_index:-1,imported_image_pxls_positioned_keyset:new a.SetFixed((e.pxl_width||32)*(e.pxl_height||32))},n=this._get_build_state(e),i=Array(25),s="",r={update:function(){}};return i[0]=(0,o.createLocalBlob)("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAA9ElEQVRYR+3X0Q6FIAgGYDjn/R/5xBmtmjMTmIBd2G3WvsE/VISXPfgyDyyQ1JFbhYiIpI/q94joVukmyPJ/9i+Q1MUpFTpa8wWAzZoxy/puhg7E9b8MlAhiTRnyaJQIQsQPEW1ZKA2I12AWSgvaO5eBsoBSUFZQOErcyx6GHgf9FxH0kU0xJFMjoJD2jYIYZWpffbypI+EBMlWKQWf2WkcXL5AalQlSobJBImoGqIsq51d0hm5n/9beVx5nskG9kbDjZ4Ca7TtLGQ6S7nT19SoFNHqn8xyMnIlrCmtuGikV0kDKNVF7mdXxuN61ZR6qBZKq+Aeqdig0aelV6gAAAABJRU5ErkJggg=="),i[1]=(0,o.createLocalBlob)("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAABFUlEQVRYR+2Y2w6EIAxEl///aDYYa7C2dFqryyb4qsBhOr3E8kl4aq2Vb1NKKZGtQ4v4QQ2oP7/xTQckqYNAuhTSQiMp1IAiqrmBpEMWEPlBMy+qEOKrV0OG+GoBWZm3FFoKtUyiXsvV+P8sk3rVfqvN/BmF0eUhfiDJT136J0BSnEklrUUM1hzdQvMVH0kudWikkvQuMhV2vfEyyMFAtElwMhW5pclSBOIhYDe6I8ppLQQkZdMUQJpKafLsBdQ0tTaMZYK4TD010NNhg039lkohoKdU6ir3qfSYE2N2dR4Zeru8lT1TAmWHTQsXpBBV7iyoEQwMlAVlwbiA7kIhMG6gHsoTQhQmBNQXTStD+/fIz6r2/RftLsg0XDwDiAAAAABJRU5ErkJggg=="),i[2]=(0,o.createLocalBlob)("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAA80lEQVRYR+3X4Q6DIAwEYHn/h2bBQIJNoXcVHEb2c3PZx11hGo7FXmExz7FBViM7oe8lFGOMctUhBPcouL4oEfXvK77TiyJpUMEURALIQOR7DJICSUxaOQLSritImRwNstJwIC+G94K0uhxpXDZkrptPqIX5C6iHsU7d+vPO8OMJjcK04FRlszFV3XZCT2Bo0I2/I3i04MpSQhuUc1VP6uVmKA/c9NrgGVoWlG+s4F3DXkgl9ERKLtCslNw3aLPOJC2dc/FW70uCRtfWqgtKqAz3KFQPA4NGoSwMBbqLQjA0qEYxFaIYF6jsSu2Zvrdj0UfpHwMA+yX+QNKuAAAAAElFTkSuQmCC"),i[3]=(0,o.createLocalBlob)("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAAv0lEQVRYR+2X3Q6AIAiF5f0fmuaFG6OSH9F00a0IX+dAKZTNHtiMpySQ5Mg/FUJEpMoAwKsQSxSqQI2hsiUQb9whhbjf0lS0dWrDUw5qGc9J9956iL6NFob3hSUH33sWEJvWrmBLLJNG1GCpf+wtE5FAkZa5fx0zLNNaW+O6Yx+lUAJJCgwdP2b0kCXnkh5KIE0PuU+MXF6pmHY9BEhbzBInfdtCzkPTgSwFPLGf3zos0EvuZQlkUUCKTcuOU+gCTnb3JcS3RYIAAAAASUVORK5CYII="),i[4]=(0,o.createLocalBlob)("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAABH0lEQVRYR+2X4Q7CIAyEy0x8//c1WoNhCWOFawvo1PnTAf24HqUEOtgvzORhZs7XDyHAeHBAD3AEWhki2wlUqvmfCpVGRR7LPSSNLX1lMnWeAiE90bSIb/NdMrp6hRZMjJIWfw+QBFOUmCrI8JTVYDQ1Zfgp64FJaRxbGEsgbbVd8zdaoYWZ79bSn5tpKJCw2JWIbpZjNPRy9ezOAlsbW61DPwl0uJR5VJ6ashMInapToY8plPU77v5Jew+2AnTdZYJ/ltjHIVWbO/be9t55ERYCvQalXjnJfiGiR22nvT0U9IS02wS5m9sLAxWSGq3sv51I5atDa+TN+x+ZrAXVmuuBUStkhfLCmIHWxh2pqnmRmBs0FHTWd3jKZgX+GoWe1olaNCjYBWEAAAAASUVORK5CYII="),i[5]=(0,o.createLocalBlob)("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAA+klEQVRYR+3Y0Q6DIAwFUOr+/5NdTY1dkJS1YIsmstexcLhArYP0sA88zJN+IERECw4AQhdxAmlzkXmCaNvK3ePkbkson5jO1gQd23RKIr9xtydUu/7HVn5SSl9LiegZ03Tt+cADwEJnv2dC7TfmwpjXqMikrFV3QcRVQLknZQVR0kNQLaAhqFZQOKoHFIrqBYWhroBCUFdB7igPUBX1ryrXGj0vkIhSnoni3J4gM4r7rbKPp9S8QdRtmtsYqfkLB/GipcknSHtZGJ6QdsveC9LaVPqeDvuQhCwYHjMU1PDnxe7jYuleh6TVW1J7J8iSTPGG7P8sa0WU4zdwA0Y04iTpEgAAAABJRU5ErkJggg=="),i[6]=(0,o.createLocalBlob)("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAA7UlEQVRYR+3X2w6EIAwEUPv/H82GRDYE6dUO8KCvEntSBgG6DnvoMM/1gbQZWdKhUkppECISa8JBFdMbqk1CQUEjpnVJQsFAHEZDwUC1cASVDmoBbjmRULOpSwX1xftiniylgWZFJRQX7BSQdVraOOgq04J7h/v/77nHs4141SELRlvm41YSBnkwY5ek/SwEQmEq1A1CYtwgNMYFWoExg1ZhTKCVGBW0GiOCdmBY0C7MFLQT8xqkHdi1K8/s/eNPbe0QAhPuEAoTAiExbhAaw4K4MGrX4EiI0w5oGcVNqwxVyPpd9wHN+uHouONAP0LJ2yWtxGVEAAAAAElFTkSuQmCC"),i[7]=(0,o.createLocalBlob)("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAA/0lEQVRYR+3XSw7DIAwE0Pj+h6ZCqiNE/cHAGBbttg1+GagBei770GWe5w/yZiQloVJKYQgRmTXhoIppDdVmoaCgHsMpWSgYSMN4KBioFp5BbQfxAuZ1YqGkqdsKaou3xSJraRtIKmqhtIW9BTQ6Lfw76L/MSOZtykJSahBLCVnTFG2Ibyf39hbt+wjm2wLMDr0EQmEqKjxlSEwYhMaEQBmYYVAWZgiUiXFB2RgTdAKjgk5hRNBJzBCIN0bveDG7BfXP/XRq6ZCVhXET4utUf5XyrjIraZkJSQMjMW5CPQiNUUFa5N41eGWqls5DOwqrL40cfGbs8AFtpkjkmetAH9mVQzQQt8P4AAAAAElFTkSuQmCC"),i[8]=(0,o.createLocalBlob)("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAABTUlEQVRYR+2W4RKEIAiEpd7/kS9ubLQxFCGUq5upv5X7uYsghIc98DCe8AJJifzEIUTEDAIAXU13oAhTMkS2HtQUoCS6hhC2MhIKk9/1oIaBsmgSOaA4GAlqCIiJY0XEj1AqO1fLqSGgEMJCxZOIdJjcgOLCFZSKxsmhqA2IuGkiIgXfPG2jkU2F2Xentbfxnal+vPpQ5UwSipBsfBKM1SHOmSXWaTrOp+5cHPGqeVLnr0YmwiSBZm3R5tkqlytAXEx0191Cl6C0QGZn8qDXDlgNkNmZwo04ZfZilwpbAhpyBgDKOPNa5vvQDGdO1xFNz+Nob4Hh+tBtME0g7o5DboNcbYmNT4qtiqwEYnqGG8wVhzK4Nk7JCPZ91yFy/60Gp9R1LVQqoGI4HhoeMKrIWrv0gjEBecKwQL3syTiwlEn3H2mWTReUFnyB/s6hL1JSZjT7s1UhAAAAAElFTkSuQmCC"),i[9]=(0,o.createLocalBlob)("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAABoklEQVRYR+2Y61IDMQiFoa2+//tqxdmdJAMJ5JBMR6tTf7ob9gMOl5Tpyf74yXjoXwBdReQzG1lm1k5fiOhrdjYdIRGRash+Y46mjg0vdrDn8xTQAbMCkY3eAdtDIaCLiNx7mJnXGgY5sQoUwjDzjYjuIBI3EfnQUAWgHVsC6tNUo+LlPQLTNurHnf+9EVErEjdlHgwzX1GF9GCBnbUIPQrm+CoqhlTKAiAk/ihrg470ixmgs+lVIXoHqkHdlzwapbUTCrzTHhvPHcG51YRSUdI19JhMf0JAQ6oyMCqKy1AvoBI9oyvd234lQl7DbIO7K8NziJbqeieioToeoaElILVimJauyx0NTSTqNFCmLH80Qn8SKDOjQGM046SfBuG0D1p909XC6DCmHP2YLWKpExdvXLHvpDszXLdWhgwMEQ0b6BZQZu1MAKVgDjt9ylzBzfoGgqlac3ZrV79QQ0GEMjpyl7NiL1yHIZAXgd1rEILxUgZFjVIUPZ9tn/rMUh86PTBX9TmejmT2+pRZ3s0PBKghGm83rk4ZoN0sbZ17AaGwfQNzJa40/U9w+QAAAABJRU5ErkJggg=="),i[10]=(0,o.createLocalBlob)("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAABMklEQVRYR+2XwRLDIAhEpen/f3FTOmaajrUgC5jpxVyD+lwXUCoXfszM5/RERMhSUBAyUR9TYVqGyoZAXQLUw1TYvwFlYCr4VIWyMFOBZsBMA5JgTpOj3vlkYySD2jEjmAhUykPaMR3Sd2UHVSoMZHnG+q+dTAgIXQyNa+HcQN5FvPEuIO/kjam/2siocsNAURgvFAQ0yiZv2bCyLwzkBdHi+3IAAb3P/McHWSipNo2Absy8E9FWSnnOhtIKpQp0+qYfiLQKS7lR1RaBrNteBspqIRLQxswP4fp5L6XsozTOKKN2e2330s48SlnKTAFCjY7CiBc0j0LI8Xlg1BujZWrJK9nWYt4YI4+8FsqrjAlkZcygFRyvVeRRKM0Bt44ooHfcArIUWwothSwFrP/LQ5ZCL65vGzRTMXdZAAAAAElFTkSuQmCC"),i[11]=(0,o.createLocalBlob)("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAABMklEQVRYR+2XwRLDIAhEpen/f3FTOmaajrUgC5jpxVyD+lwXUCoXfszM5/RERMhSUBAyUR9TYVqGyoZAXQLUw1TYvwFlYCr4VIWyMFOBZsBMA5JgTpOj3vlkYySD2jEjmAhUykPaMR3Sd2UHVSoMZHnG+q+dTAgIXQyNa+HcQN5FvPEuIO/kjam/2siocsNAURgvFAQ0yiZv2bCyLwzkBdHi+3IAAb3P/McHWSipNo2Absy8E9FWSnnOhtIKpQp0+qYfiLQKS7lR1RaBrNteBspqIRLQxswP4fp5L6XsozTOKKN2e2330s48SlnKTAFCjY7CiBc0j0LI8Xlg1BujZWrJK9nWYt4YI4+8FsqrjAlkZcygFRyvVeRRKM0Bt44ooHfcArIUWwothSwFrP/LQ5ZCL65vGzRTMXdZAAAAAElFTkSuQmCC"),i[12]=(0,o.createLocalBlob)("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAA/klEQVRYR+XX7Q6FIAgG4Lz/i/bMlo2ZIB++zO30t1xPgEjlOuwqh3mu/wPVWuuYhVIKGwhohBpm9u5m5FAwEIfp0eJQENAM0zNHIzZDbQdxmJ4ieh8O0tRMGkiqGbrRUlK2KmCu+UJSthPT4KGi3o0JgRAYNwiFcYGQGDMIjTGBMjBqUBbGBLof5seYT++TRgxpSjX1oT5srWBejCpCBPHiJVgEswSNJ3MPNR0laCqjGBOI5p0MW3fUZlH0/s2INbTaXSPMi6DrwiDpD8IDdIN21MsM7AKhMK6iRmLMIDTGBMrAqEFZGBXo6cSmM8+z3d9TILIYsTbty7X440A/uhPvJTjQhwcAAAAASUVORK5CYII="),i[13]=(0,o.createLocalBlob)("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAAk0lEQVRYR+2YwQ6AIAxD2f9/9AgHDyixrs5kxHotHeVtB9Basc+K5WkKhDpyIeTujkyZuplNGZaBTmsy959qjbPvHeir7h0dCBNaGd72b8yoAt1RFCE0YyIkQogA0jVDIoQIIF0zJEKIANI1Q/8jhE7M6PSdmtks4gm/OiLFmbWPAzHFWQ98ubKFs3z6HYNIliPUAQ/FUDSiymd+AAAAAElFTkSuQmCC"),i[14]=(0,o.createLocalBlob)("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAABR0lEQVRYR+3X3Q6CMAwF4DUY3v91NeIxEGYGbv1jXbzQW2R8nI5uo/RjP/J4AEBzHxGZxzffsGK0z1ndVpQJZMHkBK0oNeiMkapWpmhBqUA1jFCKGcDdgxJBDkyulgvFgi5g3KgmqAPGhVKBLJOy0Z8O5ePG6wGaADylflMmHgnKmAeAmUONAGXMViWprNEgFrM/fEopvYqO/VlyepdMg8mJfVBhCXEDV67Fg/b5sm0/yknMYfI9eSnpXbKvViNhhoI0mGGgCuaWUlpq3TpsUjOfcRMTnpC2TGVSoQntgy8AJiJikxnRGPNSsXZeFSa8ZJoj0Pk/oSX7g84112wvuNQs2+HoTf666h9OutK+KfIYZMZsC7Zmglrf8krJVaDWA7iX8Zxa1QnVuq0mWc/HoE7Ig5ImcO2lzKByxyilJJ3VuoEkyJXrb6IrI0OmlalfAAAAAElFTkSuQmCC"),i[15]=(0,o.createLocalBlob)("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAABeklEQVRYR82W2w7DIAxDQfv/P57GREWqNM3FlAh1j2trDokdqOVlv/oynnICtdZah6u13iC9Z3JDqzoXoM7SuThUX0D736qs9T6qc6kG/4gWnIGhbyyd/lxuWG5MbY/sWiSiVYug+DNEJwRCRBAgVAcF+pRSfjOJlBUaQKGO6iHq9Uhd2HctadT2Ed4eFEhHTRmL/6e19rXERhXMKrM2uTp8Q/AcklBejK1ZhMwzeFJzMcMfsJbnxWkRDjNacuijKYqCMQWkwFTtv2jRlAp5C2dCQRVCFkTeQSoHAQ2PHIes5Zcso8NAHpR2bj01+hSQBkXT3LmOqHcs6/1pIAmF+GJmJMCTmh0n5KPTU5lQSzdGyzsr7YNujJ5Bs6HC+xCSlkyoEAg1ZBYUChTe9LLSl35jXK3ULWXCM/BNjydrBSqMPW8F6qeV9kGDkRaQwzEaiI8qFYmuPkehqPqPzrJZyAiKW2ELkOcp6cttQBqUFpKtQEhitwMxKHXtP/Eo9zDGipjdAAAAAElFTkSuQmCC"),i[16]=(0,o.createLocalBlob)("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAA/klEQVRYR+XX7Q6FIAgG4Lz/i/bMlo2ZIB++zO30t1xPgEjlOuwqh3mu/wPVWuuYhVIKGwhohBpm9u5m5FAwEIfp0eJQENAM0zNHIzZDbQdxmJ4ieh8O0tRMGkiqGbrRUlK2KmCu+UJSthPT4KGi3o0JgRAYNwiFcYGQGDMIjTGBMjBqUBbGBLof5seYT++TRgxpSjX1oT5srWBejCpCBPHiJVgEswSNJ3MPNR0laCqjGBOI5p0MW3fUZlH0/s2INbTaXSPMi6DrwiDpD8IDdIN21MsM7AKhMK6iRmLMIDTGBMrAqEFZGBXo6cSmM8+z3d9TILIYsTbty7X440A/uhPvJTjQhwcAAAAASUVORK5CYII="),i[17]=(0,o.createLocalBlob)("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAABBElEQVRYR+3XyxLCIAwF0PL/H43DIk7EvG5KoOPoGuVwk1jarod92sM8lwnqvXcObq2VH8AFkWHYfgbEk/YOVZ7QwPBKe0mXgmYM9aOFeoPmBqYv8x6SJlIrgYbxUB8gdIi8+DOo5SBKmpKzUNKBlpaMb843Q3ppWVNLm1oordxLQNGy0LrQlEkTpJWAr/Uad6wVklKDuJVQBOON+RyEC9IerghmTsm6YaSe3lWYAYVBlRgYVI2BQDswYdAuTAi0E+OCdmNM0AmMCjqFEUEnMbdB3o0x8xL69U8dTagCk06oCpMCVWJgUDVGBWnN6L0GZ5oYuqCt2AD9Dfg+hG6Arv+DvMReyBw3NCzTf+YAAAAASUVORK5CYII="),{paint_shape(e,t,_,i,o){i=void 0===i?{}:i,o=void 0===o?function(){}:o,n._s_layers[n._layer_index].paint_uint32a(e instanceof a.SetFixed?e.indexes:e,(0|t)>>>0,Math.fround(_)),this.set_state(i).then(o)},set_state:function(e,t){t=t||!1;var a=this.set_cursor;return new Promise((function(i){var r=!1;if("tool"in e&&n.tool==e.tool&&(r=!0),"select_mode"in e&&n.select_mode==e.select_mode&&(r=!0),"_is_image_import_mode"in e&&n._is_image_import_mode==e._is_image_import_mode&&(r=!0),""in e&&n._is_on_resize_element==e._is_on_resize_element&&(r=!0),"pxl_current_color"in e&&(n.pxl_current_color_uint32=_.Color.new_hex(e.pxl_current_color).uint32),("show_original_image_in_background"in e||"_base64_original_images"in e||"_original_image_index"in e||"show_transparent_image_in_background"in e||"pxl_width"in e||"pxl_height"in e)&&(!n.cached_background_image_url||"undefined"!=typeof e._original_image_index&&n._original_image_index!==e._original_image_index||"undefined"!=typeof e.show_original_image_in_background&&n.show_original_image_in_background!==e.show_original_image_in_background||"undefined"!=typeof e.show_transparent_image_in_background&&n.show_transparent_image_in_background!==e.show_transparent_image_in_background||e._base64_original_images&&n._base64_original_images.length!==e._base64_original_images.length)&&(n.show_original_image_in_background&&"undefined"!=typeof n._base64_original_images[n._original_image_index]?(n.cached_background_image_url&&URL.revokeObjectURL(n.cached_background_image_url),n.cached_background_image_url=(0,o.createLocalBlob)(n._base64_original_images[n._original_image_index]),n.cached_background_image=`center / cover no-repeat url("${n.cached_background_image_url}")${n.show_transparent_image_in_background?`, repeating-conic-gradient(rgb(248 248 248 / 100%) 0% 25%, rgb(235 235 235 / 100%) 0% 50%) left top 50% / calc(200% / ${n.pxl_width}) calc(200% / ${n.pxl_height})`:""}`):n.show_transparent_image_in_background?n.cached_background_image=`repeating-conic-gradient(rgb(248 248 248 / 100%) 0% 25%, rgb(235 235 235 / 100%) 0% 50%) left top 50% / calc(200% / ${n.pxl_width}) calc(200% / ${n.pxl_height})`:n.cached_background_image=""),t)n=Object.assign(n,e);else for(s in e)n[s]=e[s];r&&a(n.mouse_down,n.canvas_event_target),i()}))},get_state:function(){return n},get_notified_pos_at:function(){return 0|n._notified_position_at},set_notifiers:function(e=function(){}){r={update:e}},set_cursor:function(e,t){var a,_=n.tool,o=n.select_mode,s=n._is_image_import_mode,l=n._is_on_resize_element;n.mouse_down=e,n.canvas_event_target=t,a=""+n.cursor,s?n.cursor=l?`url("${i[0]}") 18 18, auto`:e?`url("${i[2]}") 20 24, auto`:`url("${i[1]}") 20 18, auto`:"MOVE"!=_&&!t.includes("CANVAS_WRAPPER")||e?("MOVE"==_||t.includes("CANVAS_WRAPPER"))&&e?n.cursor="grabbing":"RECTANGLE"==_?n.cursor='url("'+i[3]+'") 27 12, auto':"ELLIPSE"==_?n.cursor='url("'+i[4]+'") 25 9, auto':"LINE"==_?n.cursor='url("'+i[5]+'") 32 32, auto':"PENCIL"==_?n.cursor='url("'+i[6]+'") 5 32, auto':"PENCIL PERFECT"==_?n.cursor='url("'+i[7]+'") 5 32, auto':"PICKER"==_?n.cursor='url("'+i[8]+'") 5 32, auto':"EXCHANGE"==_?n.cursor='url("'+i[9]+'") 18 18, auto':"BUCKET"==_?n.cursor='url("'+i[10]+'") 6 25, auto':"HUE BUCKET"==_?n.cursor='url("'+i[11]+'") 6 25, auto':"CONTOUR"==_?n.cursor='url("'+i[12]+'") 8 33, auto':"BORDER"==_?n.cursor='url("'+i[13]+'") 18 18, auto':"SET PENCIL MIRROR"==_?n.cursor='url("'+i[14]+'") 18 18, auto':"SELECT COLOR THRESHOLD"==_?n.cursor='url("'+i[15]+'") 7 7, auto':"SELECT PATH"==_?n.cursor='url("'+i[16]+'") 8 33, auto':"SELECT PIXEL"==_?"ADD"==o||"REPLACE"==o?n.cursor='url("'+i[17]+'") 5 32, auto':"REMOVE"==o?n.cursor='url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAA9klEQVRYR+3XQRKDMAgFUHP/Q6eTBR2MgQ8I0YXdmpHnh2jajpf92ss8xwdCHdmSUO+9E6S1ptYsBw0MNwybhioFzRhKSUP9QTxW1Gd+XXpaCYNQJxBo78WJ4o+g0kGUNCWnoVYPlNoyXpwX88xS2lCvimooqd0pIGtbaJ1pl3l2Fl+LBnesXSQlBnErIQsGbfM5iDDIg5lT0roRAlVhBtQNqsS4QdUYF2gHxgzahTGBdmIgaDdGBT2BEUFPYZagJzG3QejEGPlgX97U1oQqMOGEqjAhUCXGDarGiCBpGNHf4MgQpx3QMoqv7uE+D1VB6L4fCCX8A+VV8SWc4ctzAAAAAElFTkSuQmCC") 5 32, auto':"REPLACE"==o&&(n.cursor='url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAABNUlEQVRYR+3X4Q6EIAgAYLn3f+a42aIZgYCFddv165aXfiKYQXnZBS/zlN8AISICwKeUgiyCgIgLAKRN5NTxhimIWBiKMNTmRtU+aWLWZA6dEoYeblAVUSOzB2xrM1FKn+pzvGGPQouqvwWMtKSHFeYYNlERJd08odpRhKUUC1XDWCgtdCLKi2kGrcWh7izSst8OogSm5O1FygsaXrJ28HawSC7dltTSoD2UVqW3lL13Wdge56uy6MZoVVPNaCFS7n1orQjvq8ODscqcl6C502o1G8HwKPVOGEOgLMz6RoiehzIxYVA2JgSagXGDZmFcoJkYEzQb0wU9gVFBT2FE0JOYyyDvQT+y+aqfQVYnGZjhCGVhhkCZmDAoG6OCtPyxPoOtvPO0h48fnk6v/OcPsqL3ugh9ATjCXTQqEhJmAAAAAElFTkSuQmCC") 18 18, auto'):"SELECT PIXEL PERFECT"==_?"ADD"==o?n.cursor='url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAABFUlEQVRYR+3XWQ7DIAwE0HD/QxNRycil3oZigqrmm4jHmLVch33lMM9lgmqtlYNLKekDcEFkaLafAfGkvUGlJ9QwvNJe0qmgEUPz0UJ10DiB6Wc+h6QVqZVAw3ioNxC6iLz4Z1DLQZQ0JWehpAEtLRnvnHeGzKVlk1rq1EJp5V4CipaF2oVWmbSCtBLwtkYyvZmQlBrEVwlZZUI3xL7NWKe9dbgimNaHt0WEQBo2C9P6g68TmRgYlI2BQDswYdAuTAi0E+OCdmNM0BMYFfQURgQ9iQmBaMv3rherHpwfO7V0wu/CuAnRw3W8a0cPypnUzISUO1LqCxYCZSajXj+099mrvug7aaJm8PVjog/olz/Ii+u4hG5e9580PRb9NQAAAABJRU5ErkJggg==") 5 32, auto':"REMOVE"==o?n.cursor='url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAABBklEQVRYR+3Xyw6EMAgFUPn/j+6kCwwqj14t1Emc7TRyvFSqtL3sRy/zbB8o6khJQq21xhAicmumgzpGGrrNQ6WCzhhOyUPtIBlr1Gf5v3W3FiZCHUBBey/OKP47qOkgTpqT81DaDU1tmSwuiyF7adqm1op6KKvdU0CjbeF1Q08Z8mTJtU4y+zIlKTOIRwl5bUIH4j7JE5KhaD95NW8lhCTTi0fz6jBo0YQyMd0CJZSNgUAVmGFQFWYIVIkJQdUYF7QCY4JWYVTQSswQiKfsk+MAGb6Xwai9ZFVhwoT4c+r8ro2cTUg6IUi7WCYGBmVjTJAVc/QZjLZHWw+d9jMKRtf4QH+X0A98MFk0IsucOwAAAABJRU5ErkJggg==") 5 32, auto':"REPLACE"==o&&(n.cursor='url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAABUklEQVRYR9WX7RKEIAhFZd//mZcdG2mIQMDS2v3VbAbHi3wI5WU/eBlP+Q8gREQA+JRSUCgIiPgFgGkbORluMAURi4AiGHoXhqo2aWPeZg5GCYY+ZlAVoiqzC9beuVCGTfM7+WJXgUPVZwVGC+khwhJGbFSF0v48QXEvSijVRLVgPChLOhUqCsOc1uQwK4sW9tuB6ADT4e0pFQUaDhl3zp1lztJth1pz2oOysvSWtI+GRdS4WJZlC2NHGbVmtfXhOrQZibaOXpiyBXGv5KPdPgPTNlmLq1vZ3QUa8CyYrSNkFZoJkwaaDZMCWgETBloFEwJaCeMCrYbpAj0BYwI9BaMCPQkTAqIxwRsvsgXWWm9eg3j/WQXjKkTXKdkTo1egEdW6ChmNNdS1R2BchaTRmcqY8xC/9kqgyDwzqszlAe2q43CWzXIUtZse0KKGR9e9DugHz47FNAGTbH0AAAAASUVORK5CYII=") 5 32, auto'):_.includes("SELECT")?"ADD"==o?n.cursor='url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAAkElEQVRYR+2XQQqAMAwEm/8/OpKDUApmUwoScbwmpdNpXNRGs8ea8QyA1I1g6H+G3N3nU5vZ0RgcLQ6QALoZgg2gdSgxpF5TDGEoM7CG3lPvnEPKaNSzrEqDcR7YykaVHhWe3wOqnPq1K6vAkEPKEoYwpAyoOjNUMdTqI18B79aP/zp2N1T9AGFIGVD1djN0AfXGlCWHImsNAAAAAElFTkSuQmCC") 18 18, auto':"REMOVE"==o?n.cursor='url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAAb0lEQVRYR+2UQQrAIBDEdv7/6C0+oAYWClriNbiOcTB12MphecpA9CIa0hAZIG6HNEQGiNshDZEB4tsOdXfTgAlP8nouBtrsnWSpdcd/BRppgE1jQ1+EoZl+jBoiA8TtkIbIAHE7pCEyQNwOXWfoAYpLFiWYvOCxAAAAAElFTkSuQmCC") 18 18, auto':"REPLACE"==o&&(n.cursor='url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAABCElEQVRYR+2X3Q6DMAiFwb3/I8+zYFbj5ixwmixsqTdeWNqPw09RpdijxXhkAnkRmQr9p0IAoKo3EVk9Dy++LwDuquqmiLvgCbMCWEgoBbCq2sv86kN1gRqMiCzmOQBJQjVlmnDNsctzPYWad3skElCUrQdkIMzGjM3mdAQoC0XDZICiUEMwWSAPymrAqonJt90mGrJje3mvnK36NtpBGEahBnYKzZE4UYmnPsoo1IUagRlR6GM+kc3zRSVWoVIhK5XUvT7z9bKPNL3Imu4EE82hzEGZtVTZMwcwNqHLld6YnBL6t33FAc3uKZs7a4ywLeNKDfnkXwZtFi17+oCs4QTyFJsK/ZxCD73aLDSws54nAAAAAElFTkSuQmCC") 18 18, auto'):n.cursor='url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAAq0lEQVRYR+1WQQrAIAxb///oDmUOkc3W2kEG2XHQGpPURg6wTzLwqKr2fUQk3Ddc2AMogBqGgo2ARpkhGaKHZtMIKRmnjJLtrBBIU0O9QzvsjrUpyzUd0BgfvAdYWz3StzLUm7KBuWLEKzZPzHjqO8SWElXuX7UnLCCvTCvTFJYsAuarGswp270tQ77FIOQuY0BjQLOM+zuGVlbK7HIpLzXH3vIXGfIwlGXqE9034xUtxdxDAAAAAElFTkSuQmCC") 18 18, auto':n.cursor="grab",a!=n.cursor&&r.update()},get_imported_image_data:function(){var e,i,o,s;if(n._imported_image_pxls.length>0){let t=this.new_canvas_context_2d(n._imported_image_width,n._imported_image_height);n._imported_image_pxls.forEach(((e,a)=>{const i=a%n._imported_image_width,o=(a-i)/n._imported_image_width;t.fillStyle=_.Color.new_uint32(n._imported_image_pxl_colors[e]).hex,t.fillRect(i,o,1,1)}));const r=n._imported_image_width+n._imported_image_scale_delta_x,l=n._imported_image_height+n._imported_image_scale_delta_y;let c=this.new_canvas_context_2d(r,l);c.drawImage(t.canvas,0,0,n._imported_image_width,n._imported_image_height,0,0,r,l);let p=c.getImageData(0,0,r,l);const{new_pxls:h,new_pxl_colors:d}=this.get_pixels_palette_and_list_from_image_data(p);let u={},m=new a.SetFixed(n.pxl_width*n.pxl_height),g=-1;if(h.length>0)for(g=n._imported_image_start_x+r+(n._imported_image_start_y+l)*n.pxl_width|0,e=Uint32Array.of(r,n._imported_image_start_x,n._imported_image_start_y,n.pxl_width,n.pxl_height),i=Uint32Array.of(0,0,0,0,0),o=0,s=h.length;(0|o)<(0|s);o=o+1|0)i[0]=o%e[0],i[1]=(o-i[0])/e[0],i[2]=i[0]+e[1],i[3]=i[1]+e[2],i[4]=i[3]*e[3]+i[2],i[2]>=0&&i[2]<e[3]&&i[3]>=0&&i[3]<e[4]&&(u[i[4]]=h[0|o],m.add(i[4]));return{imported_image_pxls_positioned:u,imported_image_pxl_colors:d,image_imported_resizer_index:g,imported_image_pxls_positioned_keyset:m}}return t},get_pixels_palette_and_list_from_image_data:function(e){let t=new Uint16Array(e.width*e.height),n=new Uint32Array(e.data.buffer),a=Uint32Array.from(new Set(Array.from(n)));for(let _=0;_<n.length;_+=1)t[0|_]=a.indexOf(n[0|_]);return{ratio_pixel_per_color:t.length/a.length,new_pxl_colors:a,new_pxls:t}},new_canvas_context_2d:function(e,t,n){let a=void 0!==n?n.canvas:undefined;if(void 0===a){"OffscreenCanvas"in window?a=new OffscreenCanvas(e,t):(a=document.createElement("canvas"),a.width=e,a.height=t);let n=a.getContext("2d",{willReadFrequently:!0});return n.mozImageSmoothingEnabled=!1,n.webkitImageSmoothingEnabled=!1,n.msImageSmoothingEnabled=!1,n.imageSmoothingEnabled=!1,n}return a.width=e,a.height=t,n},get_opposite_coordinates:function(e,t,n){e|=0,t|=0,n|=0;let a={x:0,y:0},_={x:0,y:0};return _.x=n%e|0,a.x=t%e|0,a.y=(t-a.x)/e|0,_.y=(n-_.y)/e|0,{primary:a,secondary:_}},get_shadow_indexes_from_canvas_context:function(e,t){t=t instanceof a.SetFixed||void 0!==t?t:new a.SetFixed(e.canvas.width*e.canvas.height);let n=e.getImageData(0,0,e.canvas.width,e.canvas.height).data,_=n.length>>2;if(t instanceof a.SetFixed||t instanceof Set)for(let a=0;(0|a)<(0|_);a=(a+1|0)>>>0)0!=(0|n[a<<2|0])&&t.add(0|a);else for(let a=0;(0|a)<(0|_);a=(a+1|0)>>>0)0!=(0|n[a<<2|0])&&(t[0|a]=1);return t},create_shape:function(){let e=this.new_canvas_context_2d.bind(this),t=this.get_opposite_coordinates.bind(this),_=this.get_shadow_indexes_from_canvas_context.bind(this),i=0|n.pxl_width,o=0|n.pxl_height,s=e(i,o);return s.save(),{update_state:function(){i=0|n.pxl_width,o=0|n.pxl_height,s=e(i,o,s)},from_text:function(e,t,n){return s.clearRect(0,0,i,o),s.font=e+'px "Industry Book"',s.fillStyle="#ffffffff",s.textAlign="center",s.fillText(t,i/2,o/2),_(s,n)},from_border:function(e,t,n,_){t=t||!0,n=n||!1;let s=new a.SetFixed(i*o);return e.forEach(((a,_)=>{let r,l,c,p,h,d,u,m;r=a-i,r=r<0?-1:r,l=a+1,l=l%i==0?-1:l,c=a+i,c=c>i*o?-1:c,p=a-1,p=p%i==i-1?-1:p,h=r-1,h=-1===r||-1===p?-1:h,d=r+1,d=-1===r||-1===l?-1:d,u=c-1,u=-1===c||-1===p?-1:u,m=c+1,m=-1===c||-1===l?-1:m,t?(e.has(r)&&-1!==r&&e.has(l)&&-1!==l&&e.has(c)&&-1!==c&&e.has(p)&&-1!==p||s.add(0|a),n&&(e.has(h)&&-1!==h&&e.has(d)&&-1!==d&&e.has(u)&&-1!==u&&e.has(m)&&-1!==m||s.add(0|a))):(e.has(r)||s.add(r),e.has(l)||s.add(l),e.has(c)||s.add(c),e.has(p)||s.add(p),n&&(e.has(h)||s.add(h),e.has(d)||s.add(d),e.has(u)||s.add(u),e.has(m)||s.add(m)))})),s},from_path:function(e,t){t=void 0===t?new a.SetFixed(i*o):t,s.clearRect(0,0,i,o),s.lineWidth=0;let n=0,r=0;return e.forEach((function(e,t){const a=e%i|0,_=(e-a|0)/i|0;0==(0|t)?(s.moveTo(0|a,0|_),s.beginPath(),n=0|a,r=0|_):s.lineTo(0|a,0|_)})),s.strokeStyle="#ffffffff",s.fillStyle="#ffffffff",s.stroke(),s.fill(),_(s,t)},from_line:function(e,n,_){e|=0,n|=0,_=void 0===_?new a.SetFixed(i*o):_;let s=t(i,e,n),r=0|Math.abs(s.secondary.x-s.primary.x),l=0|Math.abs(s.secondary.y-s.primary.y),c=(0|s.primary.x)<(0|s.secondary.x)?1:-1,p=(0|s.primary.y)<(0|s.secondary.y)?1:-1,h=r-l|0,d=0;if(_ instanceof a.SetFixed)for(;_.add(s.primary.y*i+s.primary.x|0),(0|s.primary.x)!=(0|s.secondary.x)||(0|s.primary.y)!=(0|s.secondary.y);)d=2*h|0,(0|d)>(0|-l)&&(h=h-l|0,s.primary.x=s.primary.x+c|0),(0|d)<(0|r)&&(h=h+r|0,s.primary.y=s.primary.y+p|0);else for(;_[s.primary.y*i+s.primary.x|0]=1,(0|s.primary.x)!=(0|s.secondary.x)||(0|s.primary.y)!=(0|s.secondary.y);)d=2*h|0,(0|d)>(0|-l)&&(h=h-l|0,s.primary.x=s.primary.x+c|0),(0|d)<(0|r)&&(h=h+r|0,s.primary.y=s.primary.y+p|0);return _},from_rectangle:function(e,n,_){e|=0,n|=0;let s=void 0===_?new a.SetFixed(i*o):_,r=t(i,e,n);const l=Math.abs(r.primary.x-r.secondary.x|0)+1|0,c=Math.abs(r.primary.y-r.secondary.y|0)+1|0,p=Math.max(r.primary.x,0|r.secondary.x)-(l-1|0)|0,h=Math.max(r.primary.y,0|r.secondary.y)-(c-1|0)|0,d=l*c|0;let u=0,m=0;if(s instanceof a.SetFixed)for(let t=0;t<d;t=(t+1|0)>>>0)u=t%l|0,m=(t-u|0)/l|0,s.add((h+m|0)*i+(p+u|0)|0);else for(let t=0;t<d;t=(t+1|0)>>>0)u=t%l|0,m=(t-u|0)/l|0,s[(h+m|0)*i+(p+u)|0]=1;return s},from_ellipse:function(e,n,r){e|=0,n|=0,r=void 0===r?new a.SetFixed(i*o):r;let l=t(0|i,0|e,0|n),c=Math.abs(l.primary.x-l.secondary.x|0)+1|0,p=Math.abs(l.primary.y-l.secondary.y|0)+1|0,h=c/2,d=p/2;const u=h+(Math.max(l.primary.x,0|l.secondary.x)-(c-1|0)|0),m=d+(Math.max(l.primary.y,0|l.secondary.y)-(p-1|0)|0);return s.clearRect(0,0,0|i,0|o),s.translate(u,m),s.rotate(0),s.scale(h,d),s.arc(0,0,1,0,2*Math.PI),s.fillStyle="#ffffffff",s.fill(),_(s,r)}}}}}};e.exports=s},947:function(e,t,n){var a=n(596);const _={"new":function(){return{to_int_array_from_uint32_array_for_subcolor:function(e,t){let n;switch(t){case"r":n=3;break;case"g":n=2;break;case"b":n=1;break;default:n=0}const _=new Uint8ClampedArray(e.buffer);let i=new Uint8ClampedArray(e.length);for(let o=0;a.simdops.uint_less(o,_.length);o=a.simdops.plus_uint(o,4))i[a.simdops.divide_4_uint(o)]=_[a.simdops.plus_uint(o,n)];return i},format_hex_color:function(e){if(void 0===e)return"#00000000";{let t,n,a,_,i="";switch((e=e.replace("#","")).length){case 8:i="#".concat(e);break;case 6:i="#".concat(e.concat("ff"));break;case 4:t=e.charAt(0),n=e.charAt(1),a=e.charAt(2),_=e.charAt(3),i="#".concat(t,t,n,n,a,a,_,_);break;case 3:t=e.charAt(0),n=e.charAt(1),a=e.charAt(2),i="#".concat(t,t,n,n,a,a,"ff");break;default:i="#00000000"}return i}},blend_colors:function(e,t,n,a,_){if(e|=0,t|=0,a=a||!1,_=_||!1,0===(n=n||1)&&a)return 0;if(a&&0===t&&1===n)return 0;const i=this.to_rgba_from_uint32(e),o=this.to_rgba_from_uint32(t);if(255===o[3]&&1===n)return t;const s=i[3]/255,r=o[3]/255*n;let l=new Uint8ClampedArray(4),c=0;if(s>0&&r>0){c=_?r+s:1-(1-r)*(1-s);const e=r/c,t=s*(1-r)/c;l.set(Uint8ClampedArray.of(o[0]*e+i[0]*t,o[1]*e+i[1]*t,o[2]*e+i[2]*t),0)}else r>0?(c=o[3]/255,l.set(o,0)):(c=i[3]/255,l.set(i,0));return _&&(c/=2),l[3]=255*c|0,this.to_uint32_from_rgba(l)},blend_rgba_colors:function(e,t,n,a){n|=0,a|=0;let _=e[0].length/4|0,i=0|e.length,o=new Uint8ClampedArray(e[0].length),s=new Uint8ClampedArray(4),r=new ArrayBuffer(4),l=new Uint8ClampedArray(r),c=new ArrayBuffer(4),p=new DataView(c),h=new Uint8ClampedArray(c),d=new DataView(new ArrayBuffer(24));d.setFloat32(20,(65535*t|0)/65535);let u=0;for(let m=0,g=0;(0|m)<(0|_);m=(m+1|0)>>>0,g=(g+4|0)>>>0){u=0,s.set(e[0].slice(g,g+4|0),0);for(let t=1;(0|t)<(0|i);t=t+1|0)l.set(e[t].slice(g,g+4|0),0),0!==n&&0===l[3]&&1===d.getFloat32(20)?s.fill(0):255===l[3]&&1===d.getFloat32(20)?s.set(l,0):(d.setFloat32(0,s[3]/255),d.setFloat32(4,l[3]/255*d.getFloat32(20)),h.fill(0),d.setFloat32(8,0),d.getFloat32(0)>0&&d.getFloat32(4)>0?(a>0?d.setFloat32(8,d.getFloat32(0)+d.getFloat32(4)):d.setFloat32(8,1-(1-d.getFloat32(4))*(1-d.getFloat32(0))),d.setFloat32(12,d.getFloat32(4)/d.getFloat32(8)),d.setFloat32(16,d.getFloat32(0)*(1-d.getFloat32(4))/d.getFloat32(8)),p.setUint8(0,l[0]*d.getFloat32(12)+s[0]*d.getFloat32(16)),p.setUint8(1,l[1]*d.getFloat32(12)+s[1]*d.getFloat32(16)),p.setUint8(2,l[2]*d.getFloat32(12)+s[2]*d.getFloat32(16))):d.getFloat32(4)>0?(d.setFloat32(2,l[3]/255),h.set(l,0)):(d.setFloat32(2,s[3]/255),h.set(s,0)),a&&d.setFloat32(2,d.getFloat32(8)/2),h.fill(255*d.getFloat32(8),3,4),s.set(h));o.set(s,g)}return o},to_hex_from_uint32:function(e){return e=(0|e)>>>0,"#".concat("00000000".concat(new Uint32Array(new Uint8Array(Uint32Array.of(e).buffer).reverse().buffer).toString(16)).slice(-8))},to_hex_from_rgba:function(e){return"#".concat("00000000".concat(new Uint32Array(e.buffer)[0].toString(16)).slice(-8))},to_rgba_from_hex:function(e){return new Uint8ClampedArray(Uint32Array.of(parseInt(e.slice(1),16)).buffer)},to_rgba_from_uint32:function(e){return e=(0|e)>>>0,new Uint8ClampedArray(Uint32Array.of(e).buffer)},to_uint32_from_rgba:function(e){return(0|new Uint32Array(e.buffer)[0])>>>0},to_uint32_from_hex:function(e){return new Uint32Array(new Uint8Array(Uint32Array.of((0|parseInt(e.slice(1),16))>>>0).buffer).reverse().buffer)},to_hsla_from_rgba:function(e){let[t,n,a,_]=e;t/=255,n/=255,a/=255,_/=255;const i=Math.max(t,n,a),o=Math.min(t,n,a);let s,r,l=(i+o)/2;if(i==o)s=r=0;else{var c=i-o;switch(r=l>.5?c/(2-i-o):c/(i+o),i){case t:s=(n-a)/c+(n<a?6:0);break;case n:s=(a-t)/c+2;break;case a:s=(t-n)/c+4}s/=6}return Array.of(360*s|0,100*r|0,100*l|0,100*_|0)},to_rgba_from_hsla:function(e){let t,n,a,[_,i,o,s]=e;if(_/=360,i/=100,o/=100,s/=100,0===i)t=n=a=o;else{function r(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}const l=o<.5?o*(1+i):o+i-o*i,c=2*o-l;t=r(c,l,_+1/3),n=r(c,l,_),a=r(c,l,_-1/3)}return Uint8ClampedArray.of(255*t|0,255*n|0,255*a|0,255*s|0)},invert_uint32:function(e){e=(0|e)>>>0;const[t,n,a,_]=this.to_rgba_from_uint32(e);return this.to_uint32_from_rgba(Uint8ClampedArray.of(255-t|0,255-n|0,255-a|0,0|_))},match_color:function(e,t,n){if(e=4294967295&(0|e),t=4294967295&(0|t),1===(n=void 0===n?null:n))return!0;if(0===n)return e===t;{const a=255*n|0,_=this.to_rgba_from_uint32(e),i=this.to_rgba_from_uint32(t),o=0|Math.abs(_[3]-i[3]),s=0|Math.abs(_[0]-i[0]),r=0|Math.abs(_[1]-i[1]),l=0|Math.abs(_[2]-i[2]);return null!==n?s<a&&r<a&&l<a&&o<a:(s+r+l|0)/765*Math.abs(1-o/255)}},clean_duplicate_colors(e,t){var n,a,_,i,o=new Map,s=0|e.length,r=new Uint16Array(s),l=0;for(n=0;n<s;n=(n+1|0)>>>0)l=4294967295&(0|t[(0|e[(0|n)>>>0])>>>0]),void 0===(a=o.get(l))&&(a=(0|o.size)>>>0,o.set(l,a)),r[n]=(0|a)>>>0;for(i of(_=new Uint32Array(o.size),o))_[i[1]]=4294967295&(0|i[0]);return Array.of(r,_)}}}};e.exports=_},948:function(e,t,n){!function(t){function a(e){return e&&e.__esModule?e:{"default":e}}var _=a(n(702)),i=a(n(703));const o={_get_64_js:()=>({xxh_f:{create64:function(e){return _["default"].h64(e)}},xxh_v:"64",xxh_t:"js",xxh_tt:Date.now()}),_get_64_wasm:()=>new Promise((function(e,t){try{(0,i["default"])().then((function(t){e({xxh_f:{hasher:t,create64:function(e){return this.hasher.create64(BigInt(e))}},xxh_v:"64",xxh_t:"wasm",xxh_tt:Date.now()})}))["catch"]((function(e){t()}))}catch(n){t()}})),"new"(){const e=Uint8Array.from("0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").map((function(e){return e.charCodeAt(0)}))),n=BigInt(e.length);let a=new Uint8Array(14),_=this._get_64_js,i=this._get_64_wasm,o=_();return i().then((function(e){o=e})),{get_info:function(){return{version:o.xxh_v,type:o.xxh_t,timestamp:o.xxh_tt}},base58_that:function(_){let i=0,s=BigInt(0),r=BigInt(o.xxh_f.create64(64222).update(_ instanceof Uint8Array||_ instanceof Uint8ClampedArray?_:new Uint8Array("string"==typeof _?t.from(_):"buffer"in _?_.buffer:_)).digest());for(;r>0;)s=r%n,r/=n,a[0|i]=65535&(0|e[s]),i=15&(i+1|0);return""+String.fromCharCode.apply(null,a.slice(0,0|i))}}}};e.exports=o}(n(69).Buffer)}}]);