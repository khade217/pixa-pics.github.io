(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{729:function(t,e,s){"use strict";async function _(){function t(t,e){if(o.buffer.byteLength<t+e){const s=Math.ceil((t+e-o.buffer.byteLength)/65536);o.grow(s),g=new Uint8Array(o.buffer)}}function e(e,s,_,i,a,n){t(e);const o=new Uint8Array(e);return g.set(o),_(0,s),o.set(g.slice(0,e)),{update(s){let _;return g.set(o),"string"==typeof s?(t(3*s.length,e),_=y.encodeInto(s,g.subarray(e)).written):(t(s.byteLength,e),g.set(s,e),_=s.byteLength),i(0,e,_),o.set(g.slice(0,e)),this},digest:()=>(g.set(o),n(a(0)))}}function s(t){return t>>>0}function _(t){return t&f}function a(e){let _=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t(3*e.length,0),s(r(0,y.encodeInto(e,g).written,_))}function n(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:x;return t(3*e.length,0),_(h(0,y.encodeInto(e,g).written,s))}const{instance:{exports:{mem:o,xxh32:r,xxh64:h,init32:l,update32:p,digest32:c,init64:d,update64:m,digest64:u}}}=await WebAssembly.instantiate(i);let g=new Uint8Array(o.buffer);const f=2n**64n-1n,y=new TextEncoder,x=0n;return{h32:a,h32ToString(t){return a(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0).toString(16).padStart(8,"0")},h32Raw(e){let _=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t(e.byteLength,0),g.set(e),s(r(0,e.byteLength,_))},create32(){return e(48,arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,l,p,c,s)},h64:n,h64ToString(t){return n(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:x).toString(16).padStart(16,"0")},h64Raw(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:x;return t(e.byteLength,0),g.set(e),_(h(0,e.byteLength,s))},create64(){return e(88,arguments.length>0&&void 0!==arguments[0]?arguments[0]:x,d,m,u,_)}}}s.r(e),s.d(e,"default",(function(){return _}));const i=new Uint8Array([0,97,115,109,1,0,0,0,1,48,8,96,3,127,127,127,0,96,3,127,127,127,1,127,96,2,127,127,0,96,2,127,126,0,96,1,127,1,127,96,1,127,1,126,96,3,127,127,126,1,126,96,3,126,127,127,1,126,3,11,10,1,1,2,0,4,6,7,3,0,5,5,3,1,0,1,7,85,9,3,109,101,109,2,0,5,120,120,104,51,50,0,0,6,105,110,105,116,51,50,0,2,8,117,112,100,97,116,101,51,50,0,3,8,100,105,103,101,115,116,51,50,0,4,5,120,120,104,54,52,0,5,6,105,110,105,116,54,52,0,7,8,117,112,100,97,116,101,54,52,0,8,8,100,105,103,101,115,116,54,52,0,9,10,211,23,10,242,1,1,4,127,32,0,32,1,106,33,3,32,1,65,16,79,4,127,32,3,65,16,107,33,6,32,2,65,168,136,141,161,2,106,33,3,32,2,65,247,148,175,175,120,106,33,4,32,2,65,177,243,221,241,121,107,33,5,3,64,32,0,40,2,0,65,247,148,175,175,120,108,32,3,106,65,13,119,65,177,243,221,241,121,108,33,3,32,0,65,4,106,34,0,40,2,0,65,247,148,175,175,120,108,32,4,106,65,13,119,65,177,243,221,241,121,108,33,4,32,0,65,4,106,34,0,40,2,0,65,247,148,175,175,120,108,32,2,106,65,13,119,65,177,243,221,241,121,108,33,2,32,0,65,4,106,34,0,40,2,0,65,247,148,175,175,120,108,32,5,106,65,13,119,65,177,243,221,241,121,108,33,5,32,0,65,4,106,34,0,32,6,77,13,0,11,32,2,65,12,119,32,5,65,18,119,106,32,4,65,7,119,106,32,3,65,1,119,106,5,32,2,65,177,207,217,178,1,106,11,32,1,106,32,0,32,1,65,15,113,16,1,11,146,1,0,32,1,32,2,106,33,2,3,64,32,1,65,4,106,32,2,75,69,4,64,32,1,40,2,0,65,189,220,202,149,124,108,32,0,106,65,17,119,65,175,214,211,190,2,108,33,0,32,1,65,4,106,33,1,12,1,11,11,3,64,32,1,32,2,79,69,4,64,32,1,45,0,0,65,177,207,217,178,1,108,32,0,106,65,11,119,65,177,243,221,241,121,108,33,0,32,1,65,1,106,33,1,12,1,11,11,32,0,65,15,118,32,0,115,65,247,148,175,175,120,108,34,0,32,0,65,13,118,115,65,189,220,202,149,124,108,34,0,32,0,65,16,118,115,11,63,0,32,0,65,8,106,32,1,65,168,136,141,161,2,106,54,2,0,32,0,65,12,106,32,1,65,247,148,175,175,120,106,54,2,0,32,0,65,16,106,32,1,54,2,0,32,0,65,20,106,32,1,65,177,243,221,241,121,107,54,2,0,11,211,4,1,6,127,32,1,32,2,106,33,6,32,0,65,24,106,33,5,32,0,65,40,106,40,2,0,33,3,32,0,32,0,40,2,0,32,2,106,54,2,0,32,0,65,4,106,34,4,32,4,40,2,0,32,2,65,16,79,32,0,40,2,0,65,16,79,114,114,54,2,0,32,2,32,3,106,65,16,73,4,64,32,3,32,5,106,32,1,32,2,252,10,0,0,32,0,65,40,106,32,2,32,3,106,54,2,0,15,11,32,3,4,64,32,3,32,5,106,32,1,65,16,32,3,107,34,2,252,10,0,0,32,0,65,8,106,34,3,40,2,0,32,5,40,2,0,65,247,148,175,175,120,108,106,65,13,119,65,177,243,221,241,121,108,33,4,32,3,32,4,54,2,0,32,0,65,12,106,34,3,40,2,0,32,5,65,4,106,40,2,0,65,247,148,175,175,120,108,106,65,13,119,65,177,243,221,241,121,108,33,4,32,3,32,4,54,2,0,32,0,65,16,106,34,3,40,2,0,32,5,65,8,106,40,2,0,65,247,148,175,175,120,108,106,65,13,119,65,177,243,221,241,121,108,33,4,32,3,32,4,54,2,0,32,0,65,20,106,34,3,40,2,0,32,5,65,12,106,40,2,0,65,247,148,175,175,120,108,106,65,13,119,65,177,243,221,241,121,108,33,4,32,3,32,4,54,2,0,32,0,65,40,106,65,0,54,2,0,32,1,32,2,106,33,1,11,32,1,32,6,65,16,107,77,4,64,32,6,65,16,107,33,8,32,0,65,8,106,40,2,0,33,2,32,0,65,12,106,40,2,0,33,3,32,0,65,16,106,40,2,0,33,4,32,0,65,20,106,40,2,0,33,7,3,64,32,1,40,2,0,65,247,148,175,175,120,108,32,2,106,65,13,119,65,177,243,221,241,121,108,33,2,32,1,65,4,106,34,1,40,2,0,65,247,148,175,175,120,108,32,3,106,65,13,119,65,177,243,221,241,121,108,33,3,32,1,65,4,106,34,1,40,2,0,65,247,148,175,175,120,108,32,4,106,65,13,119,65,177,243,221,241,121,108,33,4,32,1,65,4,106,34,1,40,2,0,65,247,148,175,175,120,108,32,7,106,65,13,119,65,177,243,221,241,121,108,33,7,32,1,65,4,106,34,1,32,8,77,13,0,11,32,0,65,8,106,32,2,54,2,0,32,0,65,12,106,32,3,54,2,0,32,0,65,16,106,32,4,54,2,0,32,0,65,20,106,32,7,54,2,0,11,32,1,32,6,73,4,64,32,5,32,1,32,6,32,1,107,34,1,252,10,0,0,32,0,65,40,106,32,1,54,2,0,11,11,97,1,1,127,32,0,65,16,106,40,2,0,33,1,32,0,65,4,106,40,2,0,4,127,32,1,65,12,119,32,0,65,20,106,40,2,0,65,18,119,106,32,0,65,12,106,40,2,0,65,7,119,106,32,0,65,8,106,40,2,0,65,1,119,106,5,32,1,65,177,207,217,178,1,106,11,32,0,40,2,0,106,32,0,65,24,106,32,0,65,40,106,40,2,0,16,1,11,157,4,2,1,127,3,126,32,0,32,1,106,33,3,32,1,65,32,79,4,126,32,3,65,32,107,33,3,32,2,66,135,149,175,175,152,182,222,155,158,127,124,66,207,214,211,190,210,199,171,217,66,124,33,4,32,2,66,207,214,211,190,210,199,171,217,66,124,33,5,32,2,66,0,124,33,6,32,2,66,135,149,175,175,152,182,222,155,158,127,125,33,2,3,64,32,0,41,3,0,66,207,214,211,190,210,199,171,217,66,126,32,4,124,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,33,4,32,0,65,8,106,34,0,41,3,0,66,207,214,211,190,210,199,171,217,66,126,32,5,124,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,33,5,32,0,65,8,106,34,0,41,3,0,66,207,214,211,190,210,199,171,217,66,126,32,6,124,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,33,6,32,0,65,8,106,34,0,41,3,0,66,207,214,211,190,210,199,171,217,66,126,32,2,124,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,33,2,32,0,65,8,106,34,0,32,3,77,13,0,11,32,6,66,12,137,32,2,66,18,137,124,32,5,66,7,137,124,32,4,66,1,137,124,32,4,66,207,214,211,190,210,199,171,217,66,126,66,0,124,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,133,66,135,149,175,175,152,182,222,155,158,127,126,66,227,220,202,149,252,206,242,245,133,127,124,32,5,66,207,214,211,190,210,199,171,217,66,126,66,0,124,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,133,66,135,149,175,175,152,182,222,155,158,127,126,66,227,220,202,149,252,206,242,245,133,127,124,32,6,66,207,214,211,190,210,199,171,217,66,126,66,0,124,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,133,66,135,149,175,175,152,182,222,155,158,127,126,66,227,220,202,149,252,206,242,245,133,127,124,32,2,66,207,214,211,190,210,199,171,217,66,126,66,0,124,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,133,66,135,149,175,175,152,182,222,155,158,127,126,66,227,220,202,149,252,206,242,245,133,127,124,5,32,2,66,197,207,217,178,241,229,186,234,39,124,11,32,1,173,124,32,0,32,1,65,31,113,16,6,11,137,2,0,32,1,32,2,106,33,2,3,64,32,1,65,8,106,32,2,77,4,64,32,1,41,3,0,66,207,214,211,190,210,199,171,217,66,126,66,0,124,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,32,0,133,66,27,137,66,135,149,175,175,152,182,222,155,158,127,126,66,227,220,202,149,252,206,242,245,133,127,124,33,0,32,1,65,8,106,33,1,12,1,11,11,32,1,65,4,106,32,2,77,4,64,32,1,53,2,0,66,135,149,175,175,152,182,222,155,158,127,126,32,0,133,66,23,137,66,207,214,211,190,210,199,171,217,66,126,66,249,243,221,241,153,246,153,171,22,124,33,0,32,1,65,4,106,33,1,11,3,64,32,1,32,2,73,4,64,32,1,49,0,0,66,197,207,217,178,241,229,186,234,39,126,32,0,133,66,11,137,66,135,149,175,175,152,182,222,155,158,127,126,33,0,32,1,65,1,106,33,1,12,1,11,11,32,0,66,33,136,32,0,133,66,207,214,211,190,210,199,171,217,66,126,34,0,32,0,66,29,136,133,66,249,243,221,241,153,246,153,171,22,126,34,0,32,0,66,32,136,133,11,88,0,32,0,65,8,106,32,1,66,135,149,175,175,152,182,222,155,158,127,124,66,207,214,211,190,210,199,171,217,66,124,55,3,0,32,0,65,16,106,32,1,66,207,214,211,190,210,199,171,217,66,124,55,3,0,32,0,65,24,106,32,1,55,3,0,32,0,65,32,106,32,1,66,135,149,175,175,152,182,222,155,158,127,125,55,3,0,11,132,5,2,3,127,4,126,32,1,32,2,106,33,5,32,0,65,40,106,33,4,32,0,65,200,0,106,40,2,0,33,3,32,0,32,0,41,3,0,32,2,173,124,55,3,0,32,2,32,3,106,65,32,73,4,64,32,3,32,4,106,32,1,32,2,252,10,0,0,32,0,65,200,0,106,32,2,32,3,106,54,2,0,15,11,32,3,4,64,32,3,32,4,106,32,1,65,32,32,3,107,34,2,252,10,0,0,32,0,65,8,106,34,3,41,3,0,32,4,41,3,0,66,207,214,211,190,210,199,171,217,66,126,124,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,33,6,32,3,32,6,55,3,0,32,0,65,16,106,34,3,41,3,0,32,4,65,8,106,41,3,0,66,207,214,211,190,210,199,171,217,66,126,124,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,33,6,32,3,32,6,55,3,0,32,0,65,24,106,34,3,41,3,0,32,4,65,16,106,41,3,0,66,207,214,211,190,210,199,171,217,66,126,124,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,33,6,32,3,32,6,55,3,0,32,0,65,32,106,34,3,41,3,0,32,4,65,24,106,41,3,0,66,207,214,211,190,210,199,171,217,66,126,124,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,33,6,32,3,32,6,55,3,0,32,0,65,200,0,106,65,0,54,2,0,32,1,32,2,106,33,1,11,32,1,65,32,106,32,5,77,4,64,32,5,65,32,107,33,2,32,0,65,8,106,41,3,0,33,6,32,0,65,16,106,41,3,0,33,7,32,0,65,24,106,41,3,0,33,8,32,0,65,32,106,41,3,0,33,9,3,64,32,1,41,3,0,66,207,214,211,190,210,199,171,217,66,126,32,6,124,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,33,6,32,1,65,8,106,34,1,41,3,0,66,207,214,211,190,210,199,171,217,66,126,32,7,124,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,33,7,32,1,65,8,106,34,1,41,3,0,66,207,214,211,190,210,199,171,217,66,126,32,8,124,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,33,8,32,1,65,8,106,34,1,41,3,0,66,207,214,211,190,210,199,171,217,66,126,32,9,124,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,33,9,32,1,65,8,106,34,1,32,2,77,13,0,11,32,0,65,8,106,32,6,55,3,0,32,0,65,16,106,32,7,55,3,0,32,0,65,24,106,32,8,55,3,0,32,0,65,32,106,32,9,55,3,0,11,32,1,32,5,73,4,64,32,4,32,1,32,5,32,1,107,34,1,252,10,0,0,32,0,65,200,0,106,32,1,54,2,0,11,11,200,2,1,5,126,32,0,65,24,106,41,3,0,33,1,32,0,41,3,0,34,2,66,32,90,4,126,32,0,65,8,106,41,3,0,34,3,66,1,137,32,0,65,16,106,41,3,0,34,4,66,7,137,124,32,1,66,12,137,32,0,65,32,106,41,3,0,34,5,66,18,137,124,124,32,3,66,207,214,211,190,210,199,171,217,66,126,66,0,124,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,133,66,135,149,175,175,152,182,222,155,158,127,126,66,227,220,202,149,252,206,242,245,133,127,124,32,4,66,207,214,211,190,210,199,171,217,66,126,66,0,124,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,133,66,135,149,175,175,152,182,222,155,158,127,126,66,227,220,202,149,252,206,242,245,133,127,124,32,1,66,207,214,211,190,210,199,171,217,66,126,66,0,124,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,133,66,135,149,175,175,152,182,222,155,158,127,126,66,227,220,202,149,252,206,242,245,133,127,124,32,5,66,207,214,211,190,210,199,171,217,66,126,66,0,124,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,133,66,135,149,175,175,152,182,222,155,158,127,126,66,227,220,202,149,252,206,242,245,133,127,124,5,32,1,66,197,207,217,178,241,229,186,234,39,124,11,32,2,124,32,0,65,40,106,32,2,66,31,131,167,16,6,11])},955:function(t,e,s){"use strict";function _(t){return t&&t.__esModule?t:{default:t}}var i,a,n,o,r,h,l,p,c,d,m,u,g,f,y,x,v,w,b,M,I,z,C,A,S,E,j,D,L,O,k,F;Object.defineProperty(e,"__esModule",{value:!0}),i=s(625),a=s(683),n=s(0),o=_(n),r=s(704),h=_(r),l=s(634),p=_(l),c=s(959),d=_(c),m=s(960),u=_(m),g=s(637),f=s(961),y=_(f),x=s(966),v=_(x),w=s(967),b=_(w),M=s(730),I=_(M),z=s(968),C=_(z),A=s(726),S=_(A),E=s(969),j=_(E),D=s(682),L=_(D),O=s(619),k=s(649);class U extends o.default.PureComponent{constructor(t){super(t),F.call(this),this.hasnt_been_mount||(this.super_state=Object.create(b.default).from(t),this.xxhash=Object.create(j.default).new(),this.bmp_layer=Object.create(u.default).from(p.default),this.color_conversion=Object.create(C.default).new(),this.super_blend=I.default.init(1,1),this.super_canvas=new v.default(null,32,32),this.canvas_pos=Object.create(L.default).from(32,32,.9,32,0,0),this.sraf=Object.create(S.default).init(),this.sraf.start_timer(),this.super_master_meta=Object.create(y.default).init(this.super_state,this.super_canvas,this.super_blend,this.canvas_pos,this.color_conversion,this.sraf),this.hasnt_been_mount=!0,this._ripple=null,this.filters=new a.Filters)}componentDidMount(){window.addEventListener("resize",this._update_canvas_container_size),this.props.on_fps_change&&this.sraf.set_notify_fps_callback((t=>{this.props.on_fps_change(t)}));let t=[];t[0]=setInterval(this._maybe_save_state,625),t[1]=setInterval(this._maybe_update_selection_highlight,this.sraf.get_state().is_mobile_or_tablet?2e3:1e3),t[2]=setInterval(this._notify_export_state,this.super_state.get_state().export_state_every_ms);var e=document.createElement("style");e.innerHTML='body {touch-action:none;}.Canvas-Pixels, .Canvas-Wrapper-Overflow, .Canvas-Wrapper, .Canvas-Pixels-Cover {-ms-interpolation-mode: nearest-neighbor;\n            image-rendering: optimizeSpeed;\n            image-rendering: -o-pixelated;\n            image-rendering: -webkit-optimize-contrast;\n            image-rendering: -webkit-crisp-edges;\n            image-rendering: -moz-crisp-edges;\n            image-rendering: crisp-edges;\n            image-rendering: pixelated;touch-action: none;pointer-events: none;backface-visibility: hidden;mix-blend-mode: normal;background-blend-mode: normal;transition: none;}.Canvas-Wrapper-Overflow.Shown {\n                animation-name: canvanimation;\n                transform-origin: center center !important;\n                animation-fill-mode: both;\n                animation-duration: 350ms;\n                animation-delay: 0ms;\n                animation-timing-function: linear;\n            }\n            .Canvas-Wrapper-Overflow .Canvas-Wrapper::after {\n                content: "";\n                position: fixed;\n                width: 100%;\n                background: linear-gradient(to bottom, #ffffff00 0%, #1700ff14 14%, #1700ff57 21%, transparent);\n                height: 50%;\n                left: 0;\n                z-index: 2;\n                top: 100%;\n            }\n            .Canvas-Wrapper-Overflow.Shown .Canvas-Wrapper::after {\n                animation-name: canvanimationscan;\n                animation-fill-mode: both;\n                animation-duration: 450ms;\n                animation-delay: 350ms;\n                animation-timing-function: linear;\n            }\n            .Canvas-Wrapper-Overflow.Not-Shown {\n                animation-name: canvanimation;\n                transform-origin: center center !important;\n                animation-fill-mode: both;\n                animation-duration: 300ms;\n                animation-delay: 50ms;\n                animation-timing-function: linear;\n                animation-direction: reverse;\n            }\n            @keyframes canvanimation { \n                  0% { transform: matrix3d(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); filter: opacity(.0); will-change: transform, filter; }\n                  4.3% { transform: matrix3d(0.136, 0, 0, 0, 0, 0.271, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); filter: opacity(.2); will-change: transform, filter; }\n                  8.61% { transform: matrix3d(.729, 0, 0, 0, 0, .818, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); filter: opacity(.8); will-change: transform, filter; }\n                  12.91% { transform: matrix3d(1.146, 0, 0, 0, 0, 1.078, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); filter: opacity(.9); will-change: transform, filter; }\n                  17.22% { transform: matrix3d(1.22, 0, 0, 0, 0, 1.11, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); filter: opacity(1); will-change: transform, filter; }\n                  28.33% { transform: matrix3d(1.046, 0, 0, 0, 0, 1.031, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); filter: opacity(1); will-change: transform, filter; }\n                  39.44% { transform: matrix3d(.988, 0, 0, 0, 0, .991, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); filter: opacity(1); will-change: transform, filter; }\n                  61.66% { transform: matrix3d(1.002, 0, 0, 0, 0, 1.001, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); filter: opacity(1); will-change: transform, filter; }\n                  83.98% { transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); filter: opacity(1); will-change: transform, filter; }\n                  100% { transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); filter: opacity(1); will-change: initial; } \n            }\n            @keyframes canvanimationscan { \n                  0% { top: -50% }\n                  100% { top: 100% } \n            }.Canvas-Pixels-Cover::after {top: 0;\n                left: 0;\n                width: calc(60% - 12px);\n                content: ""attr(datatexttop)"";\n                padding: 0px 0px 8px 12px;\n                position: fixed;\n                transform: translate(0px, -100%);\n                line-height: 20px;\n                font-size: 14px;\n                font-family: "Industry Book";\n                color: #FAFAFAAA;}.Canvas-Pixels-Cover::before {bottom: 0;\n                right: 0;\n                width: calc(80% - 12px);\n                text-align: right;\n                content: ""attr(datatextbottom)"";\n                padding: 8px 12px 0px 0px;\n                position: fixed;\n                transform: translate(0px, 100%);\n                line-height: 20px;\n                font-size: 14px;\n                font-family: "Industry Book";\n                color: #FAFAFAAA;}.Canvas-Wrapper.MOVE:not(.Canvas-Focused), .Canvas-Wrapper.PICKER:not(.Canvas-Focused) {cursor: grab;}.Canvas-Wrapper.MOVE:active:not(.Canvas-Focused), .Canvas-Wrapper.PICKER:active:not(.Canvas-Focused) {cursor: grabbing;}',e.id="canvas-style",document.head.appendChild(e),this.super_state.set_state({_intervals:t}),this.super_master_meta.set_notifiers(this.props.onPositionChange,this.props.onSomethingSelectedChange,this.props.onCurrentColorChange,this.props.onRelevantActionEvent,this._request_force_update),this.canvas_pos.set_notifiers(this._request_force_update,this._handle_canvas_wrapper_overflow_context_menu,this._super_master_meta_handle_canvas_mouse_move,this._super_master_meta_handle_canvas_mouse_up,this._super_master_meta_handle_canvas_mouse_down,this._request_force_update,this.super_state.set_cursor,this._function_ripple),this.canvas_pos.init_speed_interval(),this.super_state.set_notifiers(this._request_force_update),this._update_canvas_container_size(),this._notify_image_load_complete(!0)}componentWillReceiveProps(t){var e=this.super_state.get_state();"MOVE"===t.tool&&0===e._imported_image_pxl_colors.length?this.canvas_pos.set_boolean_move_on_click(!0):this.canvas_pos.set_boolean_move_on_click(!1),e.perspective!==t.perspective&&this.canvas_pos.set_perspective(t.perspective||0),("NONE"!==e.pencil_mirror_mode&&"NONE"===t.pencil_mirror_mode||e.tool.includes("PENCIL")&&!t.tool.includes("PENCIL"))&&this.super_state.set_state({_pencil_mirror_index:-1}),e.tool===t.tool||t.tool.includes("SELECT")||(this.super_state.get_state()._pxl_indexes_of_selection.clear(),this._request_force_update(),this._notify_is_something_selected());let{hide_canvas_content:s,show_original_image_in_background:_,show_transparent_image_in_background:i,pencil_mirror_mode:a,tool:n,select_mode:o}=e;s!==t.hide_canvas_content||_!==t.show_original_image_in_background||i!==t.show_transparent_image_in_background||a!==t.pencil_mirror_mode||n!==t.tool||o!==t.select_mode?this.super_state.set_state(t,!0).then((()=>{this._request_force_update(!1,!1).then((()=>this.super_master_meta.update_canvas()))})):this.super_state.set_state(t,!0)}componentWillUnmount(){document.querySelectorAll("#canvas-style").forEach((function(t){t.remove()}));try{window.removeEventListener("resize",this._update_canvas_container_size)}catch(t){}try{const{_canvas_wrapper_overflow:t}=this.super_state.get_state();t.removeEventListener("wheel",this._canvas_pos_handle_wheel),t.removeEventListener("pointerdown",this._canvas_pos_handle_pointer_down),t.removeEventListener("pointermove",this._canvas_pos_handle_pointer_move),t.removeEventListener("pointerup",this._canvas_pos_handle_pointer_up),t.removeEventListener("pointercancel",this._canvas_pos_handle_pointer_up),t.removeEventListener("pointerout",this._canvas_pos_handle_pointer_up),t.removeEventListener("pointerleave",this._canvas_pos_handle_pointer_up)}catch(t){}this.super_state.get_state()._intervals.forEach((t=>{clearInterval(t)})),delete this.hasnt_been_mount}render(){const{className:t,canvas_wrapper_background_color:e,canvas_wrapper_background_color_focused:s,canvas_wrapper_border_radius:_,tool:i,cursor:a,_mouse_inside:n,perspective:r,cached_background_image:l,pxl_width:p,pxl_height:c}=this.super_state.get_state(),d=this.super_master_meta.is_there_new_dimension(),{canvas_wrapper:m,device_pixel_ratio:u,scale:g,canvas_event_target:f}=this.canvas_pos.get_state(),y=this.canvas_pos.get_screen_zoom_ratio(),{box_shadow:x,will_change:v}=this.canvas_pos.get_style(),{background_image:w,transform_rotate:b,filter:M}=r?this.canvas_pos.get_perspective_state():{},I=(this.sraf.get_state().is_mobile_or_tablet,p*y*g.current+.5|0),z=c*y*g.current+.5|0,C=m.padding/u*g.current|0;return o.default.createElement("div",{onContextMenu:function(t){t.preventDefault()},ref:this._set_canvas_container_ref,draggable:"false",style:{zIndex:11,boxSizing:"border-box",position:"relative",pointerEvents:"none",overflow:"hidden",touchAction:"none",userSelect:"none",display:"block"},className:t},o.default.createElement("div",{ref:this._set_canvas_wrapper_overflow_ref,className:"Canvas-Wrapper-Overflow"+(d?" Not-Shown ":" Shown "),draggable:"false",style:{display:"block",height:"100%",width:"100%",contain:"layout style size paint",overflow:"hidden",position:"absolute",boxSizing:"border-box",touchAction:"none",pointerEvents:"all",userSelect:"none",perspective:Math.round(Math.max(Math.floor(p),Math.floor(c)))+"px",zIndex:9}},o.default.createElement("div",{ref:this._set_canvas_wrapper_ref,className:"Canvas-Wrapper "+(n?" Canvas-Focused ":" "+i),draggable:"false",style:{display:"inline-block",position:"fixed",contain:"layout style size paint",overflow:"hidden",left:0,top:0,borderWidth:m.border_width,borderStyle:"solid",borderColor:"#fff",background:r?"linear-gradient(115deg,#4fcf70,#fad648,#a767e5,#12bcfe,#44ce7b,#4fcf70,#fad648,#a767e5,#12bcfe,#44ce7b)":"CANVAS"===f?s:e,transition:"background, filter cubic-bezier(0.4, 0, 0.2, 1) 225ms",margin:0,borderRadius:_,padding:C,width:0|I,height:0|z,boxShadow:x,filter:`opacity(${d?"0":"1"}) ${r?M:""}`,WebkitFilter:`opacity(${d?"0":"1"}) ${r?M:""}`,transform:`translate(${0|g.move_x}px, ${0|g.move_y}px) ${r?b:""}`,willChange:v?"transform, box-shadow":"",transformOrigin:"center middle",mixBlendMode:r?"screen":"inherit",boxSizing:"content-box",touchAction:"none",pointerEvents:"none",userSelect:"none",zIndex:4}},o.default.createElement("canvas",{draggable:"false",style:{display:"block",zIndex:2,position:"absolute",overflow:"hidden",contain:"layout style size paint",touchAction:"none",pointerEvents:"none",userSelect:"none",width:0|p,height:0|c,minWidth:y*g.current*p|0,maxWidth:y*g.current*p+1|0,minHeight:y*g.current*c|0,maxHeight:y*g.current*c+1|0,transformOrigin:"left top",boxSizing:"content-box",borderWidth:0,background:l},className:"Canvas-Pixels",ref:this._set_canvas_ref,width:0|p,height:0|c}),!!r&&o.default.createElement("div",{className:"Canvas-Pixels-Cover",draggable:"false",style:{display:"block",backgroundImage:w,zIndex:3,borderRadius:_,padding:0,left:0,top:0,borderWidth:0,position:"absolute",width:(0|p)*(y*g.current)+2*C+.5|0,height:(0|c)*(y*g.current)+2*C+.5|0,boxSizing:"content-box",touchAction:"none",pointerEvents:"none",userSelect:"none",willChange:"background-image"}})),o.default.createElement("div",{style:{display:"block",left:0,top:0,position:"absolute",cursor:a,height:"100%",width:"100%",boxSizing:"border-box",touchAction:"none",pointerEvents:"visible",userSelect:"none",contain:"layout size style paint",zIndex:10},onContextMenu:function(t){t.preventDefault()}}),o.default.createElement("div",{style:{display:"block",zIndex:1,color:e,textAlign:"center",position:"fixed",bottom:0,left:0,width:"100%",height:"100px",backgroundImage:'url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1NzU4LjY2NyAyNDAiIHdpZHRoPSI3Njc4LjIyMyIgaGVpZ2h0PSIzMjAiPjxkZWZzPjxjbGlwUGF0aCBpZD0iQSI+PHBhdGggZD0iTTAgMGg1NzU4LjY2N3YyNDBIMHoiLz48L2NsaXBQYXRoPjwvZGVmcz48ZyBjbGlwLXBhdGg9InVybCgjQSkiIGZpbGw9IiM3NzciPjxwYXRoIGQ9Ik05MjEgMTgwaDMwdjYwaC0zMHptLTIzMiAwaDMwdjYwaC0zMHptLTIyOSAwaDMwdjYwaC0zMHptLTIyOSAwaDMwdjYwaC0zMHpNMCAwaDMwdjI0MEgwem0yMDczIDE4MGgzMHY2MGgtMzB6bS0yMzIgMGgzMHY2MGgtMzB6bS0yMjkgMGgzMHY2MGgtMzB6bS0yMjkgMGgzMHY2MGgtMzB6TTExNTIgMGgzMHYyNDBoLTMwem0yMDczIDE4MGgzMHY2MGgtMzB6bS0yMzIgMGgzMHY2MGgtMzB6bS0yMjkgMGgzMHY2MGgtMzB6bS0yMjkgMGgzMHY2MGgtMzB6TTIzMDQgMGgzMHYyNDBoLTMwem0yMDczIDE4MGgzMHY2MGgtMzB6bS0yMzIgMGgzMHY2MGgtMzB6bS0yMjkgMGgzMHY2MGgtMzB6bS0yMjkgMGgzMHY2MGgtMzB6TTM0NTYgMGgzMHYyNDBoLTMwem0yMDczIDE4MGgzMHY2MGgtMzB6bS0yMzIgMGgzMHY2MGgtMzB6bS0yMjkgMGgzMHY2MGgtMzB6bS0yMjkgMGgzMHY2MGgtMzB6TTQ2MDggMGgzMHYyNDBoLTMweiIvPjwvZz48L3N2Zz4K")',backgroundPosition:"bottom",backgroundRepeat:"repeat-x",backgroundSize:(g.current*y*5*5|0)+"px",pointerEvents:"none",touchAction:"none"}},o.default.createElement("span",null,"[",(g.current*y*100|0)/100,"x]"))),o.default.createElement(h.default,{style:{color:"#050c4c4d"},ref:this._set_ripple_ref,center:!1}))}}F=function(){this.xxhashthat=t=>this.xxhash.base58_that(t),this._new_blank=(t=0,e=0)=>{this.super_state.set_state({_id:Date.now(),pxl_width:parseInt(t),pxl_height:parseInt(e),_pxl_indexes_of_selection:new i.SetFixed(t*e),_base64_original_images:[],_layers:[{id:Date.now(),name:"Layer 0",hidden:!1,opacity:1}],_json_state_history:{history_position:0,state_history:[]},_s_layers:[a.Layer.new_from_colors_and_indexes(new Uint32Array(1),new Uint16Array(parseInt(t)*parseInt(e)),parseInt(t),parseInt(e),!0)],_layer_index:0,_pxls_hovered:-1,_original_image_index:-1,_last_action_timestamp:Date.now()}).then((()=>{this._set_size()}))},this._set_size=(t=0,e=0)=>{t=t||this.super_state.get_state().pxl_width,e=e||this.super_state.get_state().pxl_height,this.super_state.set_state({pxl_width:t,pxl_height:e}).then((()=>{this.canvas_pos.set_sizes(t,e),this.canvas_pos.set_current_scale_default(),this._request_force_update(!1,!1).then((()=>{this.super_canvas.setDimensions(t,e).then((()=>{this.super_master_meta.update_canvas(!0).catch((()=>{this._set_size(t,e)}))})).catch((()=>{this.super_master_meta.update_canvas(!0).catch((()=>{this._set_size(t,e)}))}))})).catch((()=>{this._set_size(t,e)}))}))},this.export_state=()=>{this._notify_export_state()},this._notify_export_state=()=>{this.props.on_state_export&&this.props.on_state_export(),this.props.on_state_exported&&this.export_JS_state((t=>{this.props.on_state_exported(t)}))},this._maybe_update_selection_highlight=()=>{const{tool:t,_select_shape_index_a:e,_selection_pair_highlight:s}=this.super_state.get_state();t.toUpperCase().includes("SELECT")&&parseInt(e)<0&&this.super_state.set_state({_selection_pair_highlight:!s}).then((()=>{this.super_master_meta.update_canvas(!1,Date.now())}))},this._set_props=t=>{this.componentWillReceiveProps(Object.assign(Object.assign({},this.props),t))},this.zoom_in=()=>{this.canvas_pos.set_zoom(1.33)},this.zoom_out=()=>{this.canvas_pos.set_zoom(.75)},this.current_layer_up=()=>{let{_layers:t,_layer_index:e,_s_layers:s}=this.super_state.get_state();e<t.length-1&&(t.splice(e+1,0,t.splice(e,1)[0]),s.splice(e+1,0,s.splice(e,1)[0]),this.super_state.set_state({_layers:t,_layer_index:parseInt(e+1),_s_layers:s,_last_action_timestamp:Date.now()}).then((()=>{this.super_master_meta.update_canvas(!0),this._maybe_save_state(null,!0)})))},this.current_layer_down=()=>{let{_layers:t,_layer_index:e,_s_layers:s}=this.super_state.get_state();e>0&&(t.splice(e-1,0,t.splice(e,1)[0]),s.splice(e-1,0,s.splice(e,1)[0]),this.super_state.set_state({_layers:t,_s_layers:s,_layer_index:parseInt(e-1),_last_action_timestamp:Date.now()}).then((()=>{this.super_master_meta.update_canvas(!0),this._maybe_save_state(null,!0)})))},this.new_layer=t=>{const{pxl_width:e,pxl_height:s}=this.super_state.get_state();let{_layers:_,_s_layers:i}=this.super_state.get_state();t=void 0===t?i.length:t,i.splice(t+1,0,a.Layer.new_from_colors_and_indexes(Uint32Array.of(0),new Uint8Array(e*s),e,s,!0)),_.splice(t+1,0,{id:Date.now(),hash:"",name:"Layer "+(t+1),hidden:!1,opacity:1,colors:["#00000000"],number_of_colors:1}),this.super_state.set_state({_layers:_,_s_layers:i,_layer_index:t+1,_last_action_timestamp:Date.now()}).then((()=>{this.super_master_meta.update_canvas(!0),this._maybe_save_state(null,!0)}))},this.duplicate_layer=t=>{let{_layers:e,_s_layers:s,pxl_width:_,pxl_height:i}=this.super_state.get_state();t=void 0===t?s.length:t,s.splice(t+1,0,a.Layer.new_from_colors_and_indexes(s[t].colors_copy,s[t].indexes_copy,_,i,!0)),e.splice(t+1,0,{id:Date.now(),hash:e[t].hash,name:e[t].name+" (copy)",hidden:!!e[t].hidden,opacity:parseFloat(e[t].opacity),colors:Array.from(e[t].colors||[]),number_of_colors:parseInt(e[t].number_of_colors),thumbnail:e[t].thumbnail}),this.super_state.set_state({_layers:e,_layer_index:t+1,_s_layers:s,_last_action_timestamp:Date.now()}).then((()=>{this.super_master_meta.update_canvas(!0),this._maybe_save_state(null,!0)}))},this.delete_layer=t=>{let{_layers:e,_s_layers:s,_layer_index:_}=this.super_state.get_state();e.length>1&&(s.splice(t,1),e.splice(t,1),_=t-1,_=_<0?0:_,this.super_state.set_state({_layers:e,_layer_index:_,_s_layers:s,_last_action_timestamp:Date.now()}).then((()=>{this.super_master_meta.update_canvas(!0),this._maybe_save_state(null,!0)})))},this.change_active_layer=t=>{this.super_state.get_state()._layers.length>t&&0<=t&&this.super_state.set_state({_layer_index:t,_last_action_timestamp:1/0}).then((()=>{this._maybe_save_state(null,!0)}))},this.toggle_layer_visibility=t=>{let e=Array.from(this.super_state.get_state()._layers);e[parseInt(t)].hidden=!e[parseInt(t)].hidden,this.super_state.set_state({_layers:e,_last_action_timestamp:Date.now()}).then((()=>this.super_master_meta.update_canvas(!0)))},this.change_layer_opacity=(t,e)=>{let s=Array.from(this.super_state.get_state()._layers);s[parseInt(t)].opacity=parseFloat(e),this.super_state.set_state({_layers:s,_last_action_timestamp:Date.now()}).then((()=>this.super_master_meta.update_canvas(!0)))},this.merge_down_layer=t=>{let{_layers:e,_s_layers:s,pxl_width:_,pxl_height:i}=this.super_state.get_state();if(void 0!==e[t]&&void 0!==e[t-1]){const n=s[t].indexes,o=s[t-1].indexes,r=s[t].colors,h=s[t-1].colors,l=255&Math.round(255*parseFloat(e[t].opacity)),p=255&Math.round(255*parseFloat(e[t-1].opacity)),c=0|n.length,d={id:Date.now(),name:`Merged layers ${t}+${t-1}`,hidden:!(!e[t].hidden||!e[t-1].hidden),opacity:parseFloat(1)},m=I.default.init(2,c,Uint8Array.of(p,l));for(let t=0;(0|t)<(0|c);t=(t+1|0)>>>0)m.for(t,0),m.stack(0,h[o[0|t]]),m.stack(1,r[n[0|t]]),m.next();m.blend(!1,!1).then((([n,o])=>{const r=new Uint32Array(new ArrayBuffer(i*_*4));let h=0|n.length;for(let t=0;O.simdops.int_less(t,h);t=O.simdops.plus_uint(t,1))r[n[t]]=o[0|t];const l=new ImageData(new Uint8ClampedArray(r.buffer),_,i),{new_pxl_colors:p,new_pxls:c}=this._get_pixels_palette_and_list_from_image_data(l,!0);m.clear(),e.splice(t-1,2,d),s.splice(t-1,2,a.Layer.new_from_colors_and_indexes(p,c,_,i,!0)),this.super_state.set_state({_layer_index:t-1,_layers:e,_s_layers:s,_old_pxl_colors:new Uint32Array(s[0].indexes.length),_last_action_timestamp:Date.now()}).then((()=>{this.super_master_meta.update_canvas(!0),this._maybe_save_state(null,!0)}))}))}},this.compute_filters_preview=()=>{this._notify_filters_change(1)},this._notify_filters_change=(t=1)=>{if(this.props.onFiltersThumbnailChange){const{_processing_filters:e,_layer_index:s,_last_filters_hash:_,_s_layers:i,_filter_thumbnails:a}=this.super_state.get_state();i[s].hash_hex_async().then((n=>{if(_!==n||!1===e){let e=a||new Map,_=0,o=0;this.super_state.set_state({_last_filters_hash:n,_processing_filters:!0}).then((()=>{this.filters.names.forEach(((a,r,h)=>{this.filters.use(a,i[s],t,!0).bitmap_async().then((t=>{o++;var s=e.get(a);void 0!==s&&void 0!==s.destroy&&s.destroy(),e.set(a,t),_=Math.round(o/h.length*100).toString(),this.props.onFiltersThumbnailChange(e,n,_),e.size===h.length&&this.super_state.set_state({_filter_thumbnails:e,_processing_filters:!1})}))}))}))}}))}},this.get_pixel_color_from_pos=(t,e)=>this.super_master_meta.get_pixel_color_from_pos(t,e),this.get_layer_bitmap_image=(t,e,s,_,i)=>{this.bmp_layer.render(t,e,s,_,i)},this.set_png_compressors=(t,e)=>{this.png_quant=t||this.png_quant,this.oxi_png=e||this.oxi_png},this.get_base64_png_data_url=(t=1,e=!1,s=1,_=30,i=35)=>this._get_base64_png_data_url(t,e,s,_,i),this._get_base64_png_data_url=(t=1,e=!1,s=1,_=30,i=35)=>{const{pxl_width:a,pxl_height:n,_s_layers:o,_layers:r}=this.super_state.get_state();return new Promise(((e,h)=>{d.default.from(p.default,parseInt(a),parseInt(n),o.map((function(t){return t.indexes})),o.map((function(t){return t.colors})),r,parseInt(t),!0).render().then((t=>{this.png_quant&&0!==s&&t.colors.length<=256?this.png_quant(""+t.url,_,i,s,p.default).then((s=>{t.url=s,e(t)})).catch((function(t){this.props.set_compressor(),h(t)})):this.oxi_png&&0!==s&&t.colors.length>256?this.oxi_png(""+t.url,Math.floor(i/30),!1,p.default).then((s=>{t.url=s,e(t)})).catch((function(a){this.png_quant(""+t.url,_,i,s,p.default).then((s=>{t.url=s,e(t)})).catch((function(t){this.props.set_compressor(),h(t)}))})):e(t)})).catch((function(t){h(t)}))}))},this._get_pixels_palette_and_list_from_image_data=(t,e=!1)=>{const{max_size:s,_lazy_lazy_compute_time_ms:_,pxl_width:i,pxl_height:a}=this.super_state.get_state(),n=t.data.length/4>s*s;let o,r=[],h=new Set;if(!n||e){o=new Uint16Array(t.width*t.height).fill(0);for(let e=0;e<t.data.length;e+=4){const s=new O.Color(Uint8ClampedArray.of(t.data[e+0],t.data[e+1],t.data[e+2],t.data[e+3])).uint32;let _=h.has((0|s)>>>0)?r.indexOf((0|s)>>>0):-1;-1===_&&(_=(r.push((0|s)>>>0)-1|0)>>>0,h.add((0|s)>>>0)),o[(e/4|0)>>0]=(0|_)>>>0}}else{let e=Date.now();o=new Uint16Array(t.width*(s+1)).fill(0);let i=0;for(let a=0;a<=s&&!(e+_<Date.now());a++){const e=Math.round(i)*t.width*4;for(let s=0;s<4*t.width;s+=4){let _=s+e;const i=new O.Color(Uint8ClampedArray.of(t.data[_+0],t.data[_+1],t.data[_+2],t.data[_+3])).uint32;r.includes(i)||r.push(i);const n=r.indexOf(i);o[a*t.width+s/4]=n}i+=t.height/s}}const l=this.color_conversion.clean_duplicate_colors(o,r);return{too_much_pixel_cpu_would_go_brrrrr:n,ratio_pixel_per_color:l[0].length/l[1].length,new_pxl_colors:l[1],new_pxls:l[0]}},this._get_new_ctx_from_canvas=(t,e,s=!0,_="high")=>{let i=document.createElement("canvas");i.width=t,i.height=e;let a=i.getContext("2d");return s?(a.mozImageSmoothingEnabled=!1,a.webkitImageSmoothingEnabled=!1,a.msImageSmoothingEnabled=!1,a.imageSmoothingEnabled=!1):_.length&&(a.imageSmoothingQuality=_),[a,i]},this.copy_selection=()=>{this.import_image_on_canvas_from_selection()},this.cut_selection=()=>{this.import_image_on_canvas_from_selection(),this.erase_selection(),this.to_selection_none()},this.erase_selection=()=>{let{_s_layers:t,_layer_index:e,_pxl_indexes_of_selection:s,pxl_width:_,pxl_height:i}=this.super_state.get_state(),a=Array.from(t[e].colors);s.size>0&&(a.includes(0)||(a.push(0),t[e].set_colors(a)),s.forEach((s=>{t[e].set_uint32(s,0)})),this.super_state.set_state({_s_layers:t,_last_action_timestamp:Date.now()}).then((()=>{this.super_master_meta.update_canvas()})))},this.import_image_on_canvas_from_selection=()=>{let{_s_layers:t,_layer_index:e,_pxl_indexes_of_selection:s,pxl_width:_,pxl_height:i}=this.super_state.get_state();if(s.size>0){let a=[_,i],n=[-1,-1];s.forEach((t=>{const e=t%_,s=(t-e)/_;e<a[0]&&(a[0]=e),s<a[1]&&(a[1]=s),e>n[0]&&(n[0]=e),s>n[1]&&(n[1]=s)}));const o=1+n[0]-a[0],r=1+n[1]-a[1];let h=t[e].indexes,l=new Uint16Array(o*r),p=Array.from(t[e].colors);for(let t=0;t<o*r;t++){let e=t%o,i=(t-e)/o;e+=a[0],i+=a[1];const n=i*_+e;s.has(n)?l[t]=h[n]:(p.includes(0)||p.push(0),l[t]=p.indexOf(0))}[l,p]=this.color_conversion.clean_duplicate_colors(l,p),this.super_state.set_state({_imported_image_start_x:a[0],_imported_image_start_y:a[1],_imported_image_scale_delta_x:0,_imported_image_scale_delta_y:0,_imported_image_pxls:l,_imported_image_width:o,_imported_image_height:r,_imported_image_pxl_colors:p}).then((()=>{this._notify_image_import_complete(),this._notify_is_image_import_mode(),this.super_master_meta.update_canvas()}))}},this.import_image_on_canvas=t=>{this.props.onImageImport&&this.props.onImageImport(),setTimeout((()=>{const{pxl_width:e,pxl_height:s}=this.super_state.get_state();let _=t.width,i=t.height;{let[e,s]=this._get_new_ctx_from_canvas(_,i,!0);e.drawImage(t,0,0,_,i);let a=e.getImageData(0,0,_,i);e=null,s=null;const{new_pxl_colors:n,new_pxls:o}=this._get_pixels_palette_and_list_from_image_data(a,!0);a=null,this.super_state.set_state({_imported_image_start_x:0,_imported_image_start_y:0,_imported_image_scale_delta_x:0,_imported_image_scale_delta_y:0,_imported_image_pxls:o,_imported_image_width:_,_imported_image_height:i,_imported_image_pxl_colors:n}).then((()=>{this._notify_image_import_complete(),this._notify_is_image_import_mode(),this.super_master_meta.update_canvas(),this._maybe_save_state(null,!0)}))}}),50)},this.set_canvas_from_image=(t=null,e="",s={},_=!1)=>{if(this.props.onLoad&&this.props.onLoad("image_load"),s.id){const t=0;this.super_state.set_state({_id:Date.now(),pxl_width:parseInt(s.width),pxl_height:parseInt(s.height),_pxl_indexes_of_selection:new i.SetFixed(s.width*s.height),_base64_original_images:[e],_s_layers:[a.Layer.new_from_colors_and_indexes(s.pxl_colors,s.pxls,parseInt(s.width),parseInt(s.height),!0)],_layers:[{id:Date.now(),name:"Layer 0",hidden:!1,opacity:1}],_layer_index:t,_pxls_hovered:-1,_original_image_index:0,_last_action_timestamp:Date.now(),_json_state_history:{history_position:0,state_history:[]}}).then((()=>{this._set_size(),this._notify_image_load_complete(),this._notify_export_state()}))}else setTimeout((()=>{const{default_size:s,max_size:n,ideal_size:o,_base64_original_images:r,dont_change_img_size_onload:h,dont_compute_base64_original_image:l}=this.super_state.get_state();let p=t.naturalWidth,c=t.naturalHeight,[d,m]=this._get_new_ctx_from_canvas(p,c,!0);d.drawImage(t,0,0,p,c);let u=d.getImageData(0,0,p,c);const g=l?"":e.length>0?e:m.toDataURL("image/jpeg");d=null,m=null;let f,y,x=!1,v=1;if(!1===h){let{new_pxls:e,new_pxl_colors:i}=this._get_pixels_palette_and_list_from_image_data(u,!0);u=null;let a=e.length/i.length,r=n*n>c*p;if(!r){let s=1/0,_=[],i=0,a=-1;_[1]=0,e.forEach(((t,e)=>{a===t||0===e?i++:(i<s&&(s=i),_[i]=void 0!==_[i]?_[i]+1:1,i=1),a=t}));let n=1,h=1,l=1,d=1;const m=Math.sqrt(p*c/(o*o)),u=32;Object.entries(_).forEach(((t,e)=>{let[s,_]=t;if(s=parseInt(s),s>u)return;const i=s>u?1:(u+10)/(s+10),a=s>u?0:(s>u?1:i*m)*Math.pow(s,1-1/i+1);1!==s&&h<_*s+a&&(l=s,d=_,n=_*s,h=_*s+a)}));let g=n*m*4>_[1]?l:1;if(_[1]<_.length){let t=0;for(;;){if(void 0!==_[t]&&0!==_[t]){t>_[1]&&(g=t,r=!0);break}t++}}let f=g;if(Object.entries(_).forEach(((t,e)=>{let[s,i]=t;s=parseInt(s),e>1&&i>_[f]&&s<g&&(f=s)})),t.naturalWidth%f!=0){let e=1;for(;t.naturalWidth%(f+e)!=0&&t.naturalWidth%(f-e)!=0&&t.naturalHeight%(f+e)!=0&&t.naturalHeight%(f-e)!=0&&e<16;)t.naturalWidth%(f-e)==0&&t.naturalHeight%(f-e)==0?f-=e:t.naturalWidth%(f+e)==0&&t.naturalHeight%(f+e)==0&&(f+=e),e++}v=1/f}const h=c*v*(p*v),l=a>16*Math.sqrt(h)&&h<=s*s*4||a>9*Math.sqrt(h)&&h<=s*s*3||a>4*Math.sqrt(h)&&h<=s*s*2||a>1*Math.sqrt(h)&&h<=s*s*1,d=h>i.length;if((l||r)&&h<n*n&&d&&!0!==_)c*p>s*s&&(p*=v,c*=v,x=!0);else{let t=1;for(;Math.round(p*t)*Math.round(c*t)>s*s;)t-=.01;p*=t,c*=t}}let w=null;if(x&&!1===h){let e=1/v;const s=p/v,_=c/v,i=s-s%e,a=_-_%e,n=Math.floor(i/e),o=Math.floor(a/e),r=i,h=a,l=Math.floor((s-i)/2),d=Math.floor((_-a)/2);p=Math.floor(n),c=Math.floor(o),[y,f]=this._get_new_ctx_from_canvas(p,c,!0),y.drawImage(t,l,d,r,h,0,0,p,c),w=y.getImageData(0,0,p,c)}else!1===h?(p=Math.floor(p),c=Math.floor(c),[y,f]=this._get_new_ctx_from_canvas(p,c,!0),y.drawImage(t,0,0,p,c),w=y.getImageData(0,0,p,c)):w=u;let b=this._get_pixels_palette_and_list_from_image_data(w,!0);y=null,f=null,u=null,w=null;let M=r;M.includes(g)||M.push(g);const[I,z]=this.color_conversion.clean_duplicate_colors(b.new_pxls,b.new_pxl_colors);this.super_state.set_state({_id:Date.now(),pxl_width:parseInt(p),pxl_height:parseInt(c),_pxl_indexes_of_selection:new i.SetFixed(p*c),_base64_original_images:M,_layers:[{id:Date.now(),name:"Layer 0",hidden:!1,opacity:1}],_json_state_history:{history_position:0,state_history:[]},_s_layers:[a.Layer.new_from_colors_and_indexes(z,I,parseInt(p),parseInt(c),!0)],_layer_index:0,_pxls_hovered:-1,_original_image_index:M.indexOf(g),_last_action_timestamp:Date.now()}).then((()=>{this._set_size(),this._notify_image_load_complete(),this._notify_export_state()}))}),50)},this._set_canvas_ref=t=>{if(void 0===t)return this._set_size();if(null===t)return this._set_size();if(void 0===t.width)return this._set_size();if(null===t.width)return this._set_size();let{pxl_width:e,pxl_height:s}=this.super_state.get_state();this.super_canvas.new(t,e,s).then((()=>{this._maybe_save_state()}))},this._set_canvas_container_ref=t=>{null!==t&&this.super_state.set_state({_canvas_container:t}).then((()=>{this._update_canvas_container_size()}))},this._set_canvas_wrapper_ref=t=>{null!==t&&this.super_state.set_state({_canvas_wrapper:t})},this._set_canvas_wrapper_overflow_ref=t=>{null!==t&&(t.addEventListener("wheel",this._canvas_pos_handle_wheel,{passive:!1}),t.addEventListener("pointerdown",this._canvas_pos_handle_pointer_down,{passive:!1}),t.addEventListener("pointermove",this._canvas_pos_handle_pointer_move,{passive:!1}),t.addEventListener("pointerup",this._canvas_pos_handle_pointer_up,{passive:!1}),t.addEventListener("pointercancel",this._canvas_pos_handle_pointer_up,{passive:!1}),t.addEventListener("pointerout",this._canvas_pos_handle_pointer_up,{passive:!1}),t.addEventListener("pointerleave",this._canvas_pos_handle_pointer_up,{passive:!1}),this.super_state.set_state({_canvas_wrapper_overflow:t}))},this._super_master_meta_handle_canvas_mouse_move=t=>{this.super_master_meta._handle_canvas_mouse_move(t)},this._super_master_meta_handle_canvas_mouse_up=t=>{this.super_master_meta._handle_canvas_mouse_up(t)},this._super_master_meta_handle_canvas_mouse_down=t=>{this.super_master_meta._handle_canvas_mouse_down(t)},this._function_ripple=t=>{this._ripple.start(t),setTimeout((()=>{this._ripple.stop(t)}),75)},this._canvas_pos_handle_wheel=t=>{this.canvas_pos.handle_wheel(t)},this._canvas_pos_handle_pointer_down=t=>{this.canvas_pos.handle_pointer_down(t)},this._canvas_pos_handle_pointer_move=t=>{this.canvas_pos.handle_pointer_move(t)},this._canvas_pos_handle_pointer_up=t=>{this.canvas_pos.handle_pointer_up(t)},this.write_text=(t,e)=>{const s=this.super_state.get_state()._layer_index;this.new_layer(s),this.change_active_layer(s+1);const _=this.super_state.create_shape().from_text(t,e);this.super_state.paint_shape(_,this.super_state.get_state().pxl_current_color_uint32)},this._match_color=(t,e,s)=>{if(1===(s=void 0===s?null:s))return!0;if(0===s)return t===e;{const _=Math.round(255*s),[i,a,n,o]=this.color_conversion.to_rgba_from_uint32(t),[r,h,l,p]=this.color_conversion.to_rgba_from_uint32(e),c=Math.abs(o-p),d=Math.abs(i-r),m=Math.abs(a-h),u=Math.abs(n-l),g=Math.abs(1-c/255);return null!==s?!!(d<_&&m<_&&u<_&&c<_):parseFloat(parseInt(d+m+u)/parseInt(765))*g}},this.exchange_pixel_color=(t,e,s)=>{let{pxl_width:_,_s_layers:i,_layer_index:a}=this.super_state.get_state();const n=i[a].colors[i[a].indexes[e*_+t]];(""+s).startsWith("#")&&(s=new O.Color.new_hex(s).uint32),this._exchange_pixel_color(n,s)},this._exchange_pixel_color=(t,e)=>{this.super_master_meta.exchange_pixel_color(t,e)},this.set_selection_by_colors=(t,e)=>{const{_s_layers:s,_layer_index:_}=this.super_state.get_state();let{_pxl_indexes_of_selection:i}=this.super_state.get_state();const a=s[_].indexes;i.clear(),s[_].colors.forEach(((s,_)=>{this._match_color(t,s,e)&&a.forEach(((t,e)=>{t===_&&i.add(e)}))})),this.super_state.set_state({_pxl_indexes_of_selection:i,_last_action_timestamp:Date.now()}).then((()=>{this.super_master_meta.update_canvas(),this._notify_is_something_selected()}))},this._handle_canvas_wrapper_overflow_context_menu=t=>{const[e,s]=this.canvas_pos.get_canvas_pos_from_event(t.pageX,t.pageY),_=this.super_master_meta.get_pixel_color_from_pos(e,s);this.props.onRightClick&&this.props.onRightClick(t,{pos_x:e,pos_y:s,pxl_color:_}),this.props.onRelevantActionEvent&&this.props.onRelevantActionEvent(t,_,1,!1),this.props.setCursorFuckYou&&(this.props.setCursorFuckYou(!0),setTimeout(this.props.setCursorFuckYou,2500,!1))},this.maybe_set_layers=(t,e,s,_,i)=>{const a=!(void 0===t._layers),n=!!(s>this.super_state.get_state()._layers_defined_at);let o=Object.assign({},t);o._layers=Array.from(t._layers.map((function(t){return{id:0|t.id,hash:t.hash+"",name:t.name+"",hidden:t.hidden&&!0,opacity:parseFloat(t.opacity),colors:Array.from(t.colors),number_of_colors:0|t.number_of_colors}}))),i&&n&&a?this.super_state.set_state({_layer_index:parseInt(t._layer_index),_layers:Array.from(t._layers),_layers_defined_at:s}).then((()=>{this.props.onLayersChange&&this.props.onLayersChange(this.super_state.get_state()._layer_index,Array.from(t._layers)),null!==e&&e(this.super_state.get_state()._layers,this.super_state.get_state()._layer_index,i,o)})):(this.props.onLayersChange&&this.props.onLayersChange(this.super_state.get_state()._layer_index,Array.from(t._layers)),(i||_)&&a?null!==e&&e(this.super_state.get_state()._layers,this.super_state.get_state()._layer_index,i,o):null!==e&&e(this.super_state.get_state()._layers,this.super_state.get_state()._layer_index,i,{}))},this._get_most_used_color_sorted=(t,e,s)=>{var _,i;s=Math.min(e.length,s||256);let a=new O.Colors(new O.Colors(e.buffer).get_deduplicated_sorted_uint32a(s).buffer);for(_=Array(s),i=0;i<s;i++)_[i]=a.get_element(i).hex;return _},this._notify_layers_and_compute_thumbnails_change=(t,e,s,_)=>{_=_||Date.now();let i=0;const a=parseInt(t._timestamp)||Date.now(),n=parseInt(e._timestamp),o=e._layers.length;let r=parseInt(a),h=!1,l=!1;for(let p=0;p<o;p++)e._s_layers[p].bitmap_async(!0).then((a=>{const c=""+a.hash,d=Object.assign({},(t._layers||[])[p]),m=d.thumbnail,u=d.hash;u===c&&u&&m&&e._s_layers[p].thumbnail?(e._layers[p].hash=c,e._layers[p].thumbnail=m,0!==e._layers[p].colors.length&&e._layers[p].colors.length===e._layers[p].number_of_colors||(e._layers[p].colors=this._get_most_used_color_sorted(e._s_layers[p].indexes,e._s_layers[p].colors,256),e._layers[p].number_of_colors=parseInt(e._s_layers[p].colors.length)),i++,i===o&&(e._timestamp=parseInt(r),this.maybe_set_layers(e,s,_,l,h))):(l=!0,u===c&&u||(h=!0,r=n),e._layers[p].hash=c,e._layers[p].thumbnail=a,e._layers[p].colors=this._get_most_used_color_sorted(e._s_layers[p].indexes,e._s_layers[p].colors,256),e._layers[p].number_of_colors=parseInt(e._s_layers[p].colors.length),i++,i===o&&(e._timestamp=parseInt(r),this.maybe_set_layers(e,s,_,l,h)))}))},this._maybe_save_state=(t,e,s)=>{e=e||!1,s=s||Date.now();let _=this.canvas_pos.get_style().will_change,i=this.super_state.get_state(),n=i._json_state_history;if(s>i._saving_json_state_history_ran_timestamp||e)if(i._last_action_timestamp+625<=Date.now()||e||0===n.state_history.length)if(i._saving_json_state_history_running||_&&!e)setTimeout((()=>{this._maybe_save_state(t,e,s)}),125);else{this.super_state.set_state({_saving_json_state_history_running:!0});const{_id:e,_layers:s,pxl_width:_,pxl_height:o,_s_layers:r,_original_image_index:h,_layer_index:l,_pxl_indexes_of_selection:p,_pencil_mirror_index:c}=i,d=parseInt(n.history_position),m=0===n.state_history.length?{}:n.state_history[d-1];let u={};u._timestamp=parseInt(Date.now()),u._id=e.toString(),u.pxl_width=parseInt(_),u.pxl_height=parseInt(o),u._original_image_index=parseInt(h),u._layers=Array.from(s.map((function(t){return{id:parseInt(t.id),hash:t.hash+"",name:t.name+"",hidden:!!t.hidden,opacity:parseFloat(t.opacity||1),thumbnail:t.thumbnail||null,colors:Array.from(t.colors||[]),number_of_colors:parseInt(t.number_of_colors||0)}}))),u._layer_index=parseInt(l),u._s_layers=Array.from(r.map((function(t){return a.Layer.new_from_colors_and_indexes(t.colors_copy,t.indexes_copy,parseInt(_),parseInt(o),!0)}))),u._pxl_indexes_of_selection=p.export,u._pencil_mirror_index=parseInt(c),this._notify_layers_and_compute_thumbnails_change(Object.assign({},m),Object.assign({},u),((e,s,_)=>{let{_state_history_length:a,_saving_json_state_history_ran_timestamp:o}=i;const r=!(0!==n.state_history.length),h=parseInt(n.history_position),l=u._timestamp||0,p=Date.now();if(r&&0!==l)n.state_history=[],n.state_history.push(Object.assign({},u)),n.history_position=1,o=p;else if(_){if(n.state_history.length-h>0){let t=0,e=n.state_history.splice(h);for(;e.length;)n.state_history.push(Object.assign({},e.shift())),t++}n.state_history.length>=a&&n.state_history.splice(1,1),n.state_history.push(Object.assign({},u)),n.history_position=parseInt(n.state_history.length),o=p}else for(let t=0;t<n.state_history.length;t++)(0|n.state_history[t]._timestamp)===l&&(n.state_history[t]=Object.assign({},u),o=p,t=n.state_history.length);this.super_state.set_state({_json_state_history:Object.assign({},n),_saving_json_state_history_running:!1,_saving_json_state_history_ran_timestamp:o}).then((()=>{this._notify_can_undo_redo_change(),t&&t(Object.assign({},n),!(o!==p))}))}))}else t&&t(Object.assign({},n),!1);else t&&t(Object.assign({},n),!1)},this._notify_is_something_selected=()=>{const{_pxl_indexes_of_selection:t,_previous_pxl_indexes_of_selection:e}=this.super_state.get_state();!!e.size!=!!t.size&&this.super_state.set_state({_is_something_selected:!!t.size,_previous_pxl_indexes_of_selection:i.SetFixed.import(t.export)}).then((()=>{this.props.onSomethingSelectedChange&&this.props.onSomethingSelectedChange(!!t.size)}))},this._notify_image_load_complete=(t=!1)=>{const{_s_layers:e,pxl_width:s,pxl_height:_}=this.super_state.get_state();let i={width:s,height:_,number_of_colors:e[0].colors.length,only_scan:t};this.props.onLoadComplete&&this.props.onLoadComplete("image_load",i)},this._notify_image_import_complete=()=>{this.props.onImageImportComplete&&this.props.onImageImportComplete()},this._notify_can_undo_redo_change=()=>{this.props.onCanUndoRedoChange&&this.props.onCanUndoRedoChange(this._can_undo(),this._can_redo())},this._notify_size_change=()=>{const{pxl_width:t,pxl_height:e}=this.super_state.get_state();this.props.onSizeChange&&this.props.onSizeChange(t,e)},this.import_JSON_state=t=>{this.import_JS_state(t)},this.import_JS_state=(t,e)=>{console.log(t);var s=Array.from(t._base64_original_images);Promise.all(s.map((t=>(0,k.bytesToBase64)(t[1])))).then((_=>{_.forEach((function(t,e){s[e]=s[e][0]+","+t}));let n={history_position:parseInt(t._json_state_history.history_position),state_history:t._json_state_history.state_history.map((function(t){return Object.assign({},{_original_image_index:parseInt(t._original_image_index),pxl_width:parseInt(t.pxl_width),pxl_height:parseInt(t.pxl_height),_pxl_indexes_of_selection:i.SetFixed.import(t._pxl_indexes_of_selection),_s_layers:Array(t._s_pxls.length).fill({}).map((function(e,s){return a.Layer.new_from_colors_and_indexes(t._s_pxl_colors[s],t._s_pxls[s],parseInt(t.pxl_width),parseInt(t.pxl_height),!0)})),_layers:Array.from(t._layers.map((function(t){return Object.assign({},{id:parseInt(t.id),hash:t.hash+"",name:t.name+"",hidden:!!t.hidden,opacity:parseFloat(t.opacity)})}))),_layer_index:parseInt(t._layer_index),_pencil_mirror_index:parseInt(t._pencil_mirror_index),_id:t._id.toString()})}))};t=null;let o=n.state_history[n.history_position-1];this.super_state.set_state({_id:o._id.toString(),pxl_width:parseInt(o.pxl_width),pxl_height:parseInt(o.pxl_height),_base64_original_images:Array.from(s),_original_image_index:parseInt(o._original_image_index)||0,_layers:Array.from(o._layers.map((function(t){return{id:parseInt(t.id),hash:t.hash+"",name:t.name+"",hidden:!!t.hidden,opacity:parseFloat(t.opacity)}}))),_layer_index:parseInt(o._layer_index)||0,_s_layers:Array.from(o._s_layers),_pxl_indexes_of_selection:i.SetFixed.import(o._pxl_indexes_of_selection),_pencil_mirror_index:parseInt(o._pencil_mirror_index),_json_state_history:n,_pxls_hovered:-1,_last_action_timestamp:1/0}).then((()=>{this._set_size(),this._notify_image_load_complete(),this._notify_is_something_selected(),this._notify_can_undo_redo_change(),e()}))}))},this.export_JS_state=t=>{this._maybe_save_state((e=>{var s=this.super_state.get_state()._base64_original_images.map((function(t){return t.split(",")}));Promise.all([Promise.all(s.map((t=>(0,k.base64ToBytes)(t[1])))),this.get_base64_png_data_url(1,!1,9,30,50)]).then((_=>{Array.from(_[0]).forEach((function(t,e){s[e][1]=t})),e={history_position:parseInt(e.history_position),state_history:e.state_history.map((function(t){return Object.assign({},{_original_image_index:parseInt(t._original_image_index),pxl_width:parseInt(t.pxl_width),pxl_height:parseInt(t.pxl_height),_pxl_indexes_of_selection:t._pxl_indexes_of_selection.export,_s_pxls:Array.from(t._s_layers).map((function(t){return t.indexes_copy})),_s_pxl_colors:Array.from(t._s_layers).map((function(t){return t.colors_copy})),_layers:Array.from(t._layers.map((function(t){return{id:parseInt(t.id),hash:t.hash+"",name:t.name+"",hidden:!!t.hidden,opacity:parseFloat(t.opacity)}}))),_layer_index:parseInt(t._layer_index),_pencil_mirror_index:parseInt(t._pencil_mirror_index),_id:t._id.toString()})}))};const i=3*Math.ceil(_[1].url.length/4);t({id:this.super_state.get_state()._id.toString(),kb:i/1024,preview:_[1].url,timestamp:Date.now(),_base64_original_images:s,_json_state_history:e})}))}))},this._can_undo=t=>(t||(t=this.super_state.get_state()._json_state_history),parseInt(t.history_position-1)),this.undo=()=>{this._maybe_save_state((t=>{if(this._can_undo(t)>0){t.history_position=parseInt(t.history_position-1);const e=t.state_history[t.history_position-1],s=!(e.pxl_width===this.super_state.get_state().pxl_width&&e.pxl_height===this.super_state.get_state().pxl_height);this.super_state.set_state({_id:e._id.toString(),pxl_width:parseInt(e.pxl_width),pxl_height:parseInt(e.pxl_height),_original_image_index:parseInt(e._original_image_index),_layers:Array.from(e._layers.map((function(t){return{id:parseInt(t.id),hash:t.hash+"",name:t.name+"",hidden:!!t.hidden,opacity:parseFloat(t.opacity)}}))),_layer_index:parseInt(e._layer_index),_s_layers:Array.from(e._s_layers.map((function(t){return a.Layer.new_from_colors_and_indexes(t.colors_copy,t.indexes_copy,parseInt(e.pxl_width),parseInt(e.pxl_height),!0)}))),_pxl_indexes_of_selection:i.SetFixed.import(e._pxl_indexes_of_selection),_pencil_mirror_index:parseInt(e._pencil_mirror_index),_json_state_history:t,_last_action_timestamp:Date.now()}).then((()=>{s?this._set_size():this.super_master_meta.update_canvas(!0),this._notify_is_something_selected(),this._notify_can_undo_redo_change()}))}}),!0)},this._can_redo=t=>(t||(t=this.super_state.get_state()._json_state_history),t.state_history.length-parseInt(t.history_position-1)-1|0),this.redo=()=>{this._maybe_save_state((t=>{if(this._can_redo(t)>0){t.history_position=parseInt(t.history_position+1);const e=t.state_history[t.history_position-1],s=!(e.pxl_width===this.super_state.get_state().pxl_width&&e.pxl_height===this.super_state.get_state().pxl_height);this.super_state.set_state({_id:e._id.toString(),pxl_width:parseInt(e.pxl_width),pxl_height:parseInt(e.pxl_height),_original_image_index:parseInt(e._original_image_index),_layers:Array.from(e._layers.map((function(t){return{id:parseInt(t.id),hash:t.hash+"",name:t.name+"",hidden:!!t.hidden,opacity:parseFloat(t.opacity)}}))),_layer_index:parseInt(e._layer_index),_s_layers:Array.from(e._s_layers.map((function(t){return a.Layer.new_from_colors_and_indexes(t.colors_copy,t.indexes_copy,parseInt(e.pxl_width),parseInt(e.pxl_height),!0)}))),_pxl_indexes_of_selection:i.SetFixed.import(e._pxl_indexes_of_selection),_pencil_mirror_index:parseInt(e._pencil_mirror_index),_json_state_history:t,_last_action_timestamp:Date.now()}).then((()=>{s?this._set_size():this.super_master_meta.update_canvas(!0),this._notify_is_something_selected(),this._notify_can_undo_redo_change()}))}}),!0)},this.to_selection_border=()=>{const{pxl_current_color_uint32:t,_pxl_indexes_of_selection:e,_s_layers:s,_layer_index:_,pxl_current_opacity:i}=this.super_state.get_state();let a=s[_].indexes_copy,n=Array.from(s[_].colors_copy);this._get_border_from_selection(e).forEach((e=>{const s=a[e],_=n[s],o=this.color_conversion.blend_colors(_,t,i,!1,!1);n.includes(o)||n.push(o);const r=n.indexOf(o);a[e]=r})),s[_].set_colors_and_indexes(n,a),this.super_state.set_state({_s_layers:s,_last_action_timestamp:Date.now()}).then((()=>this.super_master_meta.update_canvas()))},this.to_selection_bucket=()=>{const{_s_layers:t,_pxl_indexes_of_selection:e,_layer_index:s,pxl_current_opacity:_,pxl_current_color_uint32:i}=this.super_state.get_state();let a=Array.from(t[s].indexes),n=Array.from(t[s].colors);e.forEach((t=>{const e=a[t],s=n[e],o=this.color_conversion.blend_colors(s,i,_,!1,!1);n.includes(o)||n.push(o);const r=n.indexOf(o);a[t]=r})),t[s].set_colors_and_indexes(n,a),this.super_state.set_state({_s_layers:t,_last_action_timestamp:Date.now()}).then((()=>this.super_master_meta.update_canvas()))},this.to_selection_invert=()=>{const{_s_layers:t,_pxl_indexes_of_selection:e,_layer_index:s,pxl_width:_,pxl_height:a}=this.super_state.get_state(),n=e;let o=new i.SetFixed(_*a);for(let i=0;i<t[s].indexes.length;i++)n.has(i)||o.add(i);this.super_state.set_state({_pxl_indexes_of_selection:o,_last_action_timestamp:Date.now()}).then((()=>this.super_master_meta.update_canvas()))},this.get_average_color_of_selection=()=>this.color_conversion.to_hex_from_uint32(this._get_average_color_of_selection()),this._get_average_color_of_selection=(t,e,s)=>{const{_s_layers:_,_layer_index:a,pxl_width:n,pxl_height:o}=this.super_state.get_state();e=e||_[a].indexes,s=s||_[a].colors;let r=new i.SetFixed(n*o),h=[];r.forEach((t=>{h[t]=1})),(t=t||this.super_state.get_state()._pxl_indexes_of_selection).forEach((t=>{h[e[t]]++}));let l=0;Object.entries(h).forEach((t=>{l+=t[1]}));let p=0;return Object.entries(h).forEach((t=>{const[e,_]=t;p=this.color_conversion.blend_colors(p,s[e],_/l,!1,!1)})),p},this.to_selection_changes=(t,e=!1)=>{const[s,_,i,a]=this.color_conversion.to_rgba_from_uint32(t);let[n,o,r,h]=this.color_conversion.to_hsla_from_rgba(Uint8ClampedArray.of(s,_,i,a));const{_s_layers:l,_pxl_indexes_of_selection:p,_layer_index:c}=this.super_state.get_state();let d=Array.from(l[c].indexes),m=Array.from(l[c].colors);const u=this._get_average_color_of_selection(),[g,f,y,x]=this.color_conversion.to_rgba_from_uint32(u),[v,w,b,M]=this.color_conversion.to_hsla_from_rgba(Uint8ClampedArray.of(g,f,y,x)),I=v-n;p.forEach(((t,s,_)=>{const i=d[t],a=m[i],[n,h,l,p]=this.color_conversion.to_rgba_from_uint32(a);let[c,u,g,f]=this.color_conversion.to_hsla_from_rgba(Uint8ClampedArray.of(n,h,l,p));const y=c+I<0?(360+c+I)%360:(c+I)%360;let x=[o,r,1],v=[u,g,1],w=[];0!==p&&e?(w[2]=1-(1-x[2])*(1-v[2]),w[0]=Math.round(x[0]*x[2]/w[2]+v[0]*v[2]*(1-x[2])/w[2]),w[1]=Math.round(x[1]*x[2]/w[2]+v[1]*v[2]*(1-x[2])/w[2])):w=[u,g];const[b,M,z,C]=this.color_conversion.to_rgba_from_hsla(Array.of(y,w[0],w[1],f));let A=0;0!==p&&(A=this.color_conversion.to_uint32_from_rgba(Uint8ClampedArray.of(b,M,z,C))),m.includes(A)||m.push(A),d[t]=m.indexOf(A)})),l[c].set_colors_and_indexes(m,d),this.super_state.set_state({_s_layers:l,_last_action_timestamp:Date.now()}).then((()=>this.super_master_meta.update_canvas()))},this._get_border_from_selection=(t,e=!0,s=!1)=>{const{pxl_width:_,pxl_height:a}=this.super_state.get_state();let n=new i.SetFixed(_*a);return t.forEach(((i,o)=>{let r,h,l,p,c,d,m,u;r=i-_,r=r<0?-1:r,h=i+1,h=h%_==0?-1:h,l=i+_,l=l>_*a?-1:l,p=i-1,p=p%_==_-1?-1:p,c=r-1,c=-1===r||-1===p?-1:c,d=r+1,d=-1===r||-1===h?-1:d,m=l-1,m=-1===l||-1===p?-1:m,u=l+1,u=-1===l||-1===h?-1:u,e?(t.has(r)&&-1!==r&&t.has(h)&&-1!==h&&t.has(l)&&-1!==l&&t.has(p)&&-1!==p||n.add(i),s&&(t.has(c)&&-1!==c&&t.has(d)&&-1!==d&&t.has(m)&&-1!==m&&t.has(u)&&-1!==u||n.add(i))):(t.has(r)||n.add(r),t.has(h)||n.add(h),t.has(l)||n.add(l),t.has(p)||n.add(p),s&&(t.has(c)||n.add(c),t.has(d)||n.add(d),t.has(m)||n.add(m),t.has(u)||n.add(u)))})),n},this._to_selection_crop=()=>{let{_s_layers:t,_layer_index:e,_pxl_indexes_of_selection:s,pxl_width:_,pxl_height:n,_base64_original_images:o,_original_image_index:r}=this.super_state.get_state();if(s.size>0){let e=[_,n],h=[-1,-1];s.forEach((t=>{const s=t%_,i=(t-s)/_;s<e[0]&&(e[0]=s),i<e[1]&&(e[1]=i),s>h[0]&&(h[0]=s),i>h[1]&&(h[1]=i)}));const l=1+h[0]-e[0],p=1+h[1]-e[1];for(let s=0;s<t.length;s++){let i=t[s].indexes,n=new Uint16Array(l*p);for(let t=0;t<l*p;t++){let s=t%l,a=(t-s)/l;s+=e[0],a+=e[1];const o=a*_+s;n[t]=i[o]}t[s]=a.Layer.new_from_colors_and_indexes(t[s].colors,n,l,p)}if(void 0!==o[r]){let s=new Image;s.onload=()=>{const a=s.width*(l/_)|0,r=s.height*(p/n)|0;let[h,c]=this._get_new_ctx_from_canvas(a,r);h.drawImage(s,s.width*(e[0]/_)|0,s.height*(e[1]/n)|0,a,r,0,0,a,r);let d=s.src.includes("image/webp")?c.toDataURL("image/webp"):s.src.includes("image/png")?c.toDataURL("image/png"):c.toDataURL("image/jpeg");const m=o.includes(d)?o:o.concat([d]);this.super_state.set_state({_s_layers:t,pxl_width:l,pxl_height:p,_pxl_indexes_of_selection:new i.SetFixed(l*p),_base64_original_images:m,_original_image_index:m.indexOf(d),_last_action_timestamp:Date.now()}).then((()=>{this._notify_image_load_complete(!0),this._set_size()}))},s.src=o[r]}else this.super_state.set_state({_s_layers:t,pxl_width:l,pxl_height:p,_pxl_indexes_of_selection:new i.SetFixed(l*p),_last_action_timestamp:Date.now()}).then((()=>{this._notify_image_load_complete(!0),this._set_size()}))}},this.to_selection_size=t=>{let{_pxl_indexes_of_selection:e}=this.super_state.get_state();e=this._to_selection_size(t,e),this.super_state.set_state({_pxl_indexes_of_selection:e}).then((()=>this.super_master_meta.update_canvas()))},this._to_selection_size=(t,e)=>{for(let s=1;s<=Math.abs(t);s++){const s=this._get_border_from_selection(e,t<0,!1);t<0?s.forEach((function(t){e.delete(t)})):s.forEach((function(t){e.add(t)}))}return e},this.to_selection_none=()=>{this.super_state.get_state()._pxl_indexes_of_selection.clear(),this._notify_is_something_selected(),this.super_master_meta.update_canvas()},this.confirm_import=()=>{this._merge_import()},this._merge_import=()=>{const{imported_image_pxls_positioned:t,imported_image_pxl_colors:e}=this.super_state.get_imported_image_data();let{_s_layers:s,_layer_index:_}=this.super_state.get_state(),i=s[_];Object.entries(t).forEach((t=>{const[s,_]=t;i.set_uint32(s,e[_])})),this.super_state.set_state({_s_layers:s,_imported_image_start_x:0,_imported_image_start_y:0,_imported_image_scale_delta_x:0,_imported_image_scale_delta_y:0,_imported_image_pxls:[],_imported_image_width:0,_imported_image_height:0,_imported_image_pxl_colors:[],_imported_image_move_from:[0,0],_last_action_timestamp:Date.now()}).then((()=>{this.super_master_meta.update_canvas(!0),this._notify_is_image_import_mode()}))},this._notify_is_image_import_mode=()=>{const{_imported_image_pxls:t}=this.super_state.get_state(),e=t.length>0;this.super_state.set_state({_is_image_import_mode:e}),this.props.onImageImportModeChange&&this.props.onImageImportModeChange(e)},this.to_selection_crop=()=>{this._to_selection_crop()},this.to_rotation=(t=!0)=>{this._to_rotation(t)},this.to_greyscale=()=>{this._to_colorized("greyscale")},this.to_sepia=()=>{this._to_colorized("sepia")},this.to_opacity=(t=0)=>{this._to_colorized(null,t)},this.to_color=(t=0,e=0,s=null,_=null)=>{this._to_colorized(t,e,s,_)},this.to_vignette=(t,e)=>{this._to_vignette(t,e)},this.less_colors_stepped=(t=1,e=(()=>{}))=>{let s=0,_=t;const i=()=>{this.to_less_color(_/64,(a=>{s=a.colors_removed,_+=t,t-=s>0?1:0,s<1?i():e(a)}))};i()},this.to_less_color=(t=1/16,e=(()=>{}))=>{this.props.onLoad&&("auto"===t?this.props.onLoad("less_color_auto"):this.props.onLoad("less_color")),this._to_less_color(t,(s=>{this.props.onLoadComplete&&("auto"===t?this.props.onLoadComplete&&this.props.onLoadComplete("less_color_auto",s):this.props.onLoadComplete&&this.props.onLoadComplete("less_color",s)),e(s)}))},this.auto_adjust_contrast=(t=1)=>{this._auto_adjust_contrast(t)},this.auto_adjust_saturation=(t=1.5)=>{this._auto_adjust_saturation(t)},this.smooth_adjust=(t=1)=>{this._auto_adjust_smoothness()},this.to_alpha=(t="#00000000",e=1)=>{this._to_alpha(this.color_conversion.to_uint32_from_hex(this.color_conversion.format_hex_color(t)),e)},this.to_filter=(t="1997",e)=>{this._to_filter(t,parseFloat(e))},this.to_mirror=(t=!0)=>{this._invert_pixel(t?"HORIZONTAL":"VERTICAL")},this.to_dutone=(t=.8,e="#ffffffff",s="#000000ff")=>{this._to_dutone(t,this.color_conversion.to_uint32_from_hex(this.color_conversion.format_hex_color(e)),this.color_conversion.to_uint32_from_hex(this.color_conversion.format_hex_color(s)))},this._invert_pixel=t=>{let{_s_layers:e,pxl_width:s,pxl_height:_,_base64_original_images:a,_original_image_index:n,_pxl_indexes_of_selection:o,_shape_index_a:r,_select_shape_index_a:h,_layer_index:l}=this.super_state.get_state(),{_imported_image_pxls:p,_imported_image_width:c,_imported_image_height:d}=this.super_state.get_state(),m=Array.from(e[l].indexes),u=new i.SetFixed(m.length),g=r,f=h,y=1,x=1;if("HORIZONTAL"===t)if(p.length){let t=new Uint16Array(p.length);p.forEach((function(e,s){let _=s%c,i=(s-_)/c;_=c-1-_,t[i*c+_]=e})),p=t}else e[l].indexes.forEach((function(t,e){let _=e%s,i=(e-_)/s;_=s-1-_;let a=i*s+_;m[a]=t,o.has(e)&&u.add(a),r===e&&(g=a),h===e&&(f=a)})),e[l].set_indexes(m),y=-1;else if(p.length){let t=new Uint16Array(p.length);p.forEach((function(e,s){let _=s%c,i=(s-_)/c;i=d-1-i,t[i*c+_]=e})),p=t}else e[l].indexes.forEach((function(t,e){let i=e%s,a=(e-i)/s;a=_-1-a;let n=a*s+i;m[n]=t,o.has(e)&&u.add(n),r===e&&(g=n),h===e&&(f=n)})),x=-1,e[l].set_indexes(m);if(void 0===a[n]||0!==l||p.length)this.super_state.set_state({_shape_index_a:g,_select_shape_index_a:f,_pxl_indexes_of_selection:u,_s_layers:e,_last_action_timestamp:Date.now(),_imported_image_pxls:p}).then((()=>this.super_master_meta.update_canvas()));else{let t=new Image;t.onload=()=>{let[s,_]=this._get_new_ctx_from_canvas(t.naturalWidth,t.naturalHeight);s.save(),s.scale(y,x),s.drawImage(t,0,0,t.naturalWidth*y,t.naturalHeight*x),s.restore();const i=t.src.includes("image/png")?_.toDataURL("image/png"):_.toDataURL("image/jpeg");a.includes(i)||(a.push(i),n++),this.super_state.set_state({_shape_index_a:g,_select_shape_index_a:f,_pxl_indexes_of_selection:u,_s_layers:e,_base64_original_images:a,_original_image_index:n,_imported_image_pxls:p,_last_action_timestamp:Date.now()}).then((()=>this.super_master_meta.update_canvas()))},t.src=a[n]}},this._get_darkest_color=t=>{let e=this.color_conversion.to_rgba_from_hex(t[0]);return t.forEach((t=>{const s=this.color_conversion.to_rgba_from_hex(t);s[0]+s[1]+s[2]<e[0]+e[1]+e[2]&&(e=s)})),this.color_conversion.to_hex_from_rgba(Uint8ClampedArray.of(e[0],e[1],e[2],255))},this._to_alpha=(t=0,e=1)=>{const{_s_layers:s,_layer_index:_}=this.super_state.get_state(),[i,a]=this._pxl_colors_to_alpha(s[_].indexes,s[_].colors,t,e);s[_].set_colors_and_indexes(a,i),this.super_state.set_state({_layer_index:_,_last_action_timestamp:Date.now()}).then((()=>this.super_master_meta.update_canvas(!0)))},this._to_less_color=(t,e=(()=>{}))=>{const{_layer_index:s}=this.super_state.get_state();let{_s_layers:_}=this.super_state.get_state();const i=_[s].colors.length;this._remove_close_pxl_colors(_[s].image_data,t).then((([t,a])=>{_[s].set_colors_and_indexes(a,t);const n=_[s].colors.length;let o={colors_removed:i-n,colors_remaining:n};this.super_state.set_state({_s_layers:_,_last_action_timestamp:Date.now()}).then((()=>{this.super_master_meta.update_canvas(!0),e(o)}))}))},this._auto_adjust_contrast=(t=1)=>{const{_layer_index:e,_s_layers:s}=this.super_state.get_state();var _=this._pxl_adjust_contrast(s[e].indexes_copy,s[e].colors_copy,t);s[e].set_colors_and_indexes(_[1],_[0]),this.super_state.set_state({_s_layers:s,_last_action_timestamp:Date.now()}).then((()=>this.super_master_meta.update_canvas(!0)))},this._auto_adjust_saturation=(t=1)=>{const{_s_layers:e,_layer_index:s}=this.super_state.get_state();var _=this._pxl_adjust_saturation(e[s].indexes_copy,e[s].colors_copy,t);e[s].set_colors_and_indexes(_[1],_[0]),this.super_state.set_state({_s_layers:e,_last_action_timestamp:Date.now()}).then((()=>this.super_master_meta.update_canvas(!0)))},this._pxl_adjust_saturation=(t,e,s)=>{let _=100,i=0;s=0|Math.round(255*parseFloat(s));let a,n,o=0,r=new O.Colors(e),h=r.length;for(let c=0;(0|c)<(0|h);c=(c+1|0)>>>0)a=r.get_element(c),o=a.hsla[1],(0|a.a)>0&&((0|o)>(0|i)&&(i=0|o),(0|o)<(0|_)&&(_=0|o));const l=100/Math.max(1,i-_),p=-_*l|0;for(let c=0;(0|c)<(0|h);c=(c+1|0)>>>0)a=r.get_element(c),n=a.hsla,a.blend_with(O.Color.new_hsla(n[0],n[1]*l+p|0,n[2],n[3]),s,!1,!1);return[t,e=r.slice_uint32(0,h),l,p]},this._selection_pxl_adjust_sat_lum=(t=0,e=0)=>{const{_layer_index:s,_s_layers:_,_pxl_indexes_of_selection:i}=this.super_state.get_state();let a=_[s].indexes,n=Array.from(_[s].colors);i.forEach((s=>{const _=n[a[s]],[i,o,r,h]=this.color_conversion.to_hsla_from_rgba(this.color_conversion.to_rgba_from_uint32(_)),l=Math.min(100,Math.max(0,o+t)),p=Math.min(100,Math.max(0,r+e)),c=this.color_conversion.to_uint32_from_rgba(this.color_conversion.to_rgba_from_hsla(Array.of(i,l,p,h)));-1===n.indexOf(c)&&n.push(c),a[s]=n.indexOf(c)})),_[s].set_colors_and_indexes(n,a),this.super_state.set_state({_s_layers:_})},this._auto_adjust_smoothness=()=>{let{_layer_index:t,_s_layers:e,pxl_width:s,pxl_height:_}=this.super_state.get_state();var i=this._pxl_adjust_smoothness(e[t].indexes,e[t].colors,s,_);e[t].set_colors_and_indexes(i[1],i[0]),this.super_state.set_state({_s_layers:e,_last_action_timestamp:Date.now()}).then((()=>this.super_master_meta.update_canvas(!0)))},this._pxl_to_vignette=(t,e,s,_,i)=>{const{pxl_current_color_uint32:a}=this.super_state.get_state(),{pxl_width:n,pxl_height:o}=this.super_state.get_state();let[r,h]=this._get_new_ctx_from_canvas(n,o);const l=Math.max(n,o),p=this.color_conversion.invert_uint32(a);let c=r.createRadialGradient(n/2,o/2,0,n/2,o/2,l/2);c.addColorStop(1,this.color_conversion.to_hex_from_uint32(a)),c.addColorStop(.8,this.color_conversion.to_hex_from_uint32(this.color_conversion.blend_colors(a,p,.6))),c.addColorStop(0,this.color_conversion.to_hex_from_uint32(p)),r.fillStyle=c,r.fillRect(0,0,n,o);let d=r.getImageData(0,0,n,o);this._remove_close_pxl_colors(d,18).then((([s,n])=>{[s,n]=this._pxl_colors_to_alpha(s,n,p,1);const[o,r,h]=this.color_conversion.to_rgba_from_uint32(a);n=n.map((t=>{t|=0;const e=this.color_conversion.to_rgba_from_uint32(t)[3];return 0|this.color_conversion.to_uint32_from_rgba(Uint8ClampedArray.of(o,r,h,e))}));let l=[];s=s.map(((s,i)=>{i|=0;const a=0|n[s|=0],o=0|e[t[i]],r=this.color_conversion.blend_colors(o,a,_,!1,!1);return-1===l.indexOf(r)&&l.push(r),l.indexOf(r)})),i(Array.of(s,n=l))}))},this._to_vignette=(t,e)=>{if(e>0){const{_layer_index:s}=this.super_state.get_state();let{_s_layers:_}=this.super_state.get_state();this._pxl_to_vignette(_[s].indexes,_[s].colors,t,e,(t=>{_[s].set_colors_and_indexes(t[1],t[0]),this.super_state.set_state({_s_layers:_,_last_action_timestamp:Date.now()}).then((()=>this.super_master_meta.update_canvas(!0)))}))}},this._to_colorized=(t=null,e=null,s=null,_=null)=>{const{_s_layers:i,_layer_index:a}=this.super_state.get_state();e=null===e?1:e;const n=i[a].colors.map((i=>{const[a,n,o,r]=this.color_conversion.to_rgba_from_uint32(i);let[h,l,p,c]=this.color_conversion.to_hsla_from_rgba(Uint8ClampedArray.of(a,n,o,r)),d=[s,_,e],m=[l,p,c/100],u=[];0!==e?(u[2]=1-(1-d[2])*(1-m[2]),u[0]=Math.round(d[0]*d[2]/u[2]+Math.round(m[0]*m[2]*(1-d[2])/u[2])),u[1]=Math.round(d[1]*d[2]/u[2]+Math.round(m[1]*m[2]*(1-d[2])/u[2]))):u=[l,p];const[g,f,y,x]=this.color_conversion.to_rgba_from_hsla(Array.of(t,u[0],u[1],100*u[2]));return 0===r?0:this.color_conversion.to_uint32_from_rgba(Uint8ClampedArray.of(g,f,y,x))}));i[a].set_colors(n),this.super_state.set_state({_s_layers:i,_last_action_timestamp:Date.now()}).then((()=>this.super_master_meta.update_canvas(!0)))},this.get_filter_names=()=>this.filters.names,this._dutone_pixels=(t,e,s,_,i)=>(i=i.map((_=>{const i=this.color_conversion.to_hsla_from_rgba(this.color_conversion.to_rgba_from_uint32(_))[2];return this.color_conversion.blend_colors(e,s,parseFloat(i/100)/t,!1,!1)})),this.color_conversion.clean_duplicate_colors(_,i)),this._to_dutone=(t=.8,e="#ffffffff",s="#000000ff")=>{const{_layer_index:_,_s_layers:i}=this.super_state.get_state();var a=this._dutone_pixels(t,e,s,i[_].indexes,i[_].colors);i[_].set_indexes(a[0]),i[_].set_colors(a[1]),this.super_state.set_state({_s_layers:i,_pxls_hovered:-1,_last_action_timestamp:Date.now()}).then((()=>this.super_master_meta.update_canvas(!0)))},this._to_filter=(t,e)=>{let{_s_layers:s,_layer_index:_}=this.super_state.get_state();this.filters.use(t,s[_],e),this.super_state.set_state({_s_layers:s,_pxls_hovered:-1,_last_action_timestamp:Date.now()}).then((()=>this.super_master_meta.update_canvas(!0)))},this._to_rotation=(t=!0)=>{let{_imported_image_pxls:e,_imported_image_width:s,_imported_image_height:_,pxl_width:a,pxl_height:n,_s_layers:o,_pxl_indexes_of_selection:r,_select_shape_index_a:h,_shape_index_a:l,_base64_original_images:p,_original_image_index:c,_layer_index:d}=this.super_state.get_state();const m=_,u=s;let g=new Uint16Array(m*u);const f=n,y=a;let x=new i.SetFixed(f*y),v=h,w=l,b=0,M=0,I=0,z=0,C=0;if(e.length)e.forEach((function(e,_){b=_%s,M=(_-b)/s,z=t?b:u-1-b,I=t?m-1-M:M,C=I+z*m,g[C]=e,r.has(_)&&x.add(C)}));else{for(let e=0,s=o[0].indexes.length;e<s;e++)b=e%a,M=(e-b)/a,z=t?b:y-1-b,I=t?f-1-M:M,C=I+z*f,r.has(e)&&x.add(C),h===e&&(v=C),l===e&&(w=C);for(let e=0;e<o.length;e++){let s=new Uint16Array(f*y);o[e].indexes.forEach((function(e,_){b=_%a,M=(_-b)/a,z=t?b:y-1-b,I=t?f-1-M:M,C=I+z*f,s[C]=e})),o[e].set_indexes(s)}}if(e.length)this.super_state.set_state({_imported_image_width:m,_imported_image_height:u,_imported_image_pxls:g,_pxl_indexes_of_selection:x,_last_action_timestamp:Date.now()}).then((()=>{this.super_master_meta.update_canvas(!0)}));else if(void 0===p[c]||e.length)this.super_state.set_state({pxl_width:f,pxl_height:y,_s_layers:o,_pxl_indexes_of_selection:x,_select_shape_index_a:v,_shape_index_a:w,_last_action_timestamp:Date.now()}).then((()=>{this._set_size()}));else{const e=t?90:-90;let s=new Image;s.onload=()=>{let[t,_]=this._get_new_ctx_from_canvas(s.naturalHeight,s.naturalWidth);t.clearRect(0,0,_.width,_.height),t.save(),t.translate(_.width/2,_.height/2),t.rotate(e*Math.PI/180),t.drawImage(s,-s.naturalWidth/2,-s.naturalHeight/2),t.restore();let i=s.src.includes("image/png")?_.toDataURL("image/png"):_.toDataURL("image/jpeg");p.includes(i)||(p.push(i),c++),this.super_state.set_state({pxl_width:f,pxl_height:y,_s_layers:o,_pxl_indexes_of_selection:x,_select_shape_index_a:v,_shape_index_a:w,_base64_original_images:p,_original_image_index:c,_last_action_timestamp:Date.now()}).then((()=>{this._set_size()}))},s.src=p[c]}},this._pxl_colors_to_alpha=(t,e,s,_)=>[t,e=e.map((t=>{const e=this._match_color(s,t);let[i,a,n,o]=this.color_conversion.to_rgba_from_uint32(t);return o-=o*(1-e)*_,this.color_conversion.to_uint32_from_rgba(Uint8ClampedArray.of(i,a,n,o))}))],this._pxl_adjust_contrast=(t,e,s=1)=>{let _=255,i=0;s=0|Math.round(255*parseFloat(s));let a=0,n=new O.Color(new ArrayBuffer(4)),o=(0,O.Colors)(e),{clamp_int:r}=O.simdops,h=o.length;for(let c=0;(0|c)<(0|h);c=(c+1|0)>>>0)n=o.get_element(0|c,n),a=n.sum_rgb()/3*n.a/255|0,(0|n.a)>0&&((0|a)>(0|i)&&(i=0|a),(0|a)<(0|_)&&(_=0|a));const l=255/Math.max(1,i-_),p=-_*l|0;for(let c=0;(0|c)<(0|h);c=(c+1|0)>>>0)n=o.get_element(0|c,n),n.blend_with(O.Color.new_of(r(n.r*l+p|0,0,255),r(n.g*l+p|0,0,255),r(n.b*l+p|0,0,255),n.a),s,!1,!1);return[t,e=o.subarray_uint32(0,h),l,p]},this._pxl_adjust_smoothness=(t,e,s,_,i)=>{s|=0,_|=0,i=i||1;for(let a=0;a<i;a++)t.forEach(((t,i,a)=>{let n,o,r,h,l,p,c,d;n=i-s,n=n<0?-1:n,o=i+1,o=o%s==0?-1:o,r=i+s,r=r>s*_?-1:r,h=i-1,h=h%s==s-1?-1:h,l=n-1,l=-1===n||-1===h?-1:l,p=n+1,p=-1===n||-1===o?-1:p,c=r-1,c=-1===r||-1===h?-1:c,d=r+1,d=-1===r||-1===o?-1:d;const m=[a[n],a[o],a[r],a[h],a[l],a[p],a[c],a[d]];let u=[];m.forEach((t=>{u[t]=void 0===u[t]?1:u[t]+1}));let g=-1,f=-1;Object.entries(u).forEach((t=>{const[e,s]=t;f<s&&(f=s,g=e)}));let y=-1,x=-1;Object.entries(u).forEach((t=>{const[e,s]=t;x<s&&e!==g&&(x=s,y=e)})),(f>=6&&-1!==g||f+x>=8&&f>=5&&O.Color.new_uint32(e[a[i]]).match_with(O.Color.new_uint32(e[g]).blend_with(O.Color.new_uint32(e[y]),128,!1,!1),24))&&(a[i]=g)}));return this.color_conversion.clean_duplicate_colors(t,e)},this._set_ripple_ref=t=>{null!==t&&null===this._ripple&&(this._ripple=t)},this._remove_close_pxl_colors=(t,e)=>new Promise((function(s,_){(0,g.QuantiMatGlobal)(t,e).then((function(t){const e=t[1],_=t[2];return s([e,_])}))})),this._request_force_update=(t,e)=>(t=void 0===t||t,e=void 0===e||e,this.sraf.run_frame((()=>new Promise(((t,e)=>{this.forceUpdate(t)}))),!t,!e,Date.now(),"inner_pixel_page").catch((()=>this._request_force_update(t,e)))),this._update_canvas_container_size=()=>{const t=this.super_state.get_state()._canvas_container?this.super_state.get_state()._canvas_container.getBoundingClientRect():null;if(t){const e=t.width||0,s=t.height||0,_=t.left||0,i=t.top||0;this.canvas_pos.set_canvas_container(i,_,s,e)}else setTimeout((()=>{this._update_canvas_container_size()}),50)}},e.default=U},956:function(t,e,s){e.UINT32=s(957),e.UINT64=s(958)},957:function(t,e,s){var _;!function(e){function s(t,e){return this instanceof s?(this._low=0,this._high=0,this.remainder=null,void 0===e?a.call(this,t):"string"==typeof t?n.call(this,t,e):void i.call(this,t,e)):new s(t,e)}function i(t,e){return this._low=0|t,this._high=0|e,this}function a(t){return this._low=65535&t,this._high=t>>>16,this}function n(t,e){var s=parseInt(t,e||10);return this._low=65535&s,this._high=s>>>16,this}s(60466176),s(268435456),s(1e9),s(1073741824),s(36),s(16),s(10),s(2),s.prototype.fromBits=i,s.prototype.fromNumber=a,s.prototype.fromString=n,s.prototype.toNumber=function(){return 65536*this._high+this._low},s.prototype.toString=function(t){return this.toNumber().toString(t||10)},s.prototype.add=function(t){var e=this._low+t._low,s=e>>>16;return s+=this._high+t._high,this._low=65535&e,this._high=65535&s,this},s.prototype.subtract=function(t){return this.add(t.clone().negate())},s.prototype.multiply=function(t){var e=this._high,s=this._low,_=t._high,i=t._low,a=s*i,n=a>>>16;return n+=e*i,n&=65535,n+=s*_,this._low=65535&a,this._high=65535&n,this},s.prototype.div=function(t){var e,_;if(0==t._low&&0==t._high)throw Error("division by zero");if(0==t._high&&1==t._low)return this.remainder=new s(0),this;if(t.gt(this))return this.remainder=this.clone(),this._low=0,this._high=0,this;if(this.eq(t))return this.remainder=new s(0),this._low=1,this._high=0,this;for(e=t.clone(),_=-1;!this.lt(e);)e.shiftLeft(1,!0),_++;for(this.remainder=this.clone(),this._low=0,this._high=0;_>=0;_--)e.shiftRight(1),this.remainder.lt(e)||(this.remainder.subtract(e),_>=16?this._high|=1<<_-16:this._low|=1<<_);return this},s.prototype.negate=function(){var t=1+(65535&~this._low);return this._low=65535&t,this._high=~this._high+(t>>>16)&65535,this},s.prototype.equals=s.prototype.eq=function(t){return this._low==t._low&&this._high==t._high},s.prototype.greaterThan=s.prototype.gt=function(t){return this._high>t._high||!(this._high<t._high)&&this._low>t._low},s.prototype.lessThan=s.prototype.lt=function(t){return this._high<t._high||!(this._high>t._high)&&this._low<t._low},s.prototype.or=function(t){return this._low|=t._low,this._high|=t._high,this},s.prototype.and=function(t){return this._low&=t._low,this._high&=t._high,this},s.prototype.not=function(){return this._low=65535&~this._low,this._high=65535&~this._high,this},s.prototype.xor=function(t){return this._low^=t._low,this._high^=t._high,this},s.prototype.shiftRight=s.prototype.shiftr=function(t){return t>16?(this._low=this._high>>t-16,this._high=0):16==t?(this._low=this._high,this._high=0):(this._low=this._low>>t|this._high<<16-t&65535,this._high>>=t),this},s.prototype.shiftLeft=s.prototype.shiftl=function(t,e){return t>16?(this._high=this._low<<t-16,this._low=0,e||(this._high&=65535)):16==t?(this._high=this._low,this._low=0):(this._high=this._high<<t|this._low>>16-t,this._low=this._low<<t&65535,e||(this._high&=65535)),this},s.prototype.rotateLeft=s.prototype.rotl=function(t){var e=this._high<<16|this._low;return e=e<<t|e>>>32-t,this._low=65535&e,this._high=e>>>16,this},s.prototype.rotateRight=s.prototype.rotr=function(t){var e=this._high<<16|this._low;return e=e>>>t|e<<32-t,this._low=65535&e,this._high=e>>>16,this},s.prototype.clone=function(){return new s(this._low,this._high)},void 0===(_=s)||(t.exports=_)}()},958:function(t,e,s){var _;!function(e){function s(t,e,_,o){return this instanceof s?(this.remainder=null,"string"==typeof t?n.call(this,t,e):void 0===e?a.call(this,t):void i.apply(this,arguments)):new s(t,e,_,o)}function i(t,e,s,_){return void 0===s?(this._a00=65535&t,this._a16=t>>>16,this._a32=65535&e,this._a48=e>>>16,this):(this._a00=0|t,this._a16=0|e,this._a32=0|s,this._a48=0|_,this)}function a(t){return this._a00=65535&t,this._a16=t>>>16,this._a32=0,this._a48=0,this}function n(t,e){var _,i,a,n,r;for(e=e||10,this._a00=0,this._a16=0,this._a32=0,this._a48=0,_=o[e]||new s(Math.pow(e,5)),i=0,a=t.length;i<a;i+=5)n=Math.min(5,a-i),r=parseInt(t.slice(i,i+n),e),this.multiply(n<5?new s(Math.pow(e,n)):_).add(new s(r));return this}var o={16:s(1048576),10:s(1e5),2:s(32)},r={16:s(16),10:s(10),2:s(2)};s.prototype.fromBits=i,s.prototype.fromNumber=a,s.prototype.fromString=n,s.prototype.toNumber=function(){return 65536*this._a16+this._a00},s.prototype.toString=function(t){var e,_,i,a;if(e=r[t=t||10]||new s(t),!this.gt(e))return this.toNumber().toString(t);for(_=this.clone(),i=Array(64),a=63;a>=0&&(_.div(e),i[a]=_.remainder.toNumber().toString(t),_.gt(e));a--);return i[a-1]=_.toNumber().toString(t),i.join("")},s.prototype.add=function(t){var e,s,_=this._a00+t._a00,i=_>>>16;return e=(i+=this._a16+t._a16)>>>16,s=(e+=this._a32+t._a32)>>>16,s+=this._a48+t._a48,this._a00=65535&_,this._a16=65535&i,this._a32=65535&e,this._a48=65535&s,this},s.prototype.subtract=function(t){return this.add(t.clone().negate())},s.prototype.multiply=function(t){var e,s,_=this._a00,i=this._a16,a=this._a32,n=this._a48,o=t._a00,r=t._a16,h=t._a32,l=_*o,p=l>>>16;return e=(p+=_*r)>>>16,p&=65535,e+=(p+=i*o)>>>16,s=(e+=_*h)>>>16,e&=65535,s+=(e+=i*r)>>>16,e&=65535,s+=(e+=a*o)>>>16,s+=_*t._a48,s&=65535,s+=i*h,s&=65535,s+=a*r,s&=65535,s+=n*o,this._a00=65535&l,this._a16=65535&p,this._a32=65535&e,this._a48=65535&s,this},s.prototype.div=function(t){var e,_;if(0==t._a16&&0==t._a32&&0==t._a48){if(0==t._a00)throw Error("division by zero");if(1==t._a00)return this.remainder=new s(0),this}if(t.gt(this))return this.remainder=this.clone(),this._a00=0,this._a16=0,this._a32=0,this._a48=0,this;if(this.eq(t))return this.remainder=new s(0),this._a00=1,this._a16=0,this._a32=0,this._a48=0,this;for(e=t.clone(),_=-1;!this.lt(e);)e.shiftLeft(1,!0),_++;for(this.remainder=this.clone(),this._a00=0,this._a16=0,this._a32=0,this._a48=0;_>=0;_--)e.shiftRight(1),this.remainder.lt(e)||(this.remainder.subtract(e),_>=48?this._a48|=1<<_-48:_>=32?this._a32|=1<<_-32:_>=16?this._a16|=1<<_-16:this._a00|=1<<_);return this},s.prototype.negate=function(){var t=1+(65535&~this._a00);return this._a00=65535&t,t=(65535&~this._a16)+(t>>>16),this._a16=65535&t,t=(65535&~this._a32)+(t>>>16),this._a32=65535&t,this._a48=~this._a48+(t>>>16)&65535,this},s.prototype.equals=s.prototype.eq=function(t){return this._a48==t._a48&&this._a00==t._a00&&this._a32==t._a32&&this._a16==t._a16},s.prototype.greaterThan=s.prototype.gt=function(t){return this._a48>t._a48||!(this._a48<t._a48)&&(this._a32>t._a32||!(this._a32<t._a32)&&(this._a16>t._a16||!(this._a16<t._a16)&&this._a00>t._a00))},s.prototype.lessThan=s.prototype.lt=function(t){return this._a48<t._a48||!(this._a48>t._a48)&&(this._a32<t._a32||!(this._a32>t._a32)&&(this._a16<t._a16||!(this._a16>t._a16)&&this._a00<t._a00))},s.prototype.or=function(t){return this._a00|=t._a00,this._a16|=t._a16,this._a32|=t._a32,this._a48|=t._a48,this},s.prototype.and=function(t){return this._a00&=t._a00,this._a16&=t._a16,this._a32&=t._a32,this._a48&=t._a48,this},s.prototype.xor=function(t){return this._a00^=t._a00,this._a16^=t._a16,this._a32^=t._a32,this._a48^=t._a48,this},s.prototype.not=function(){return this._a00=65535&~this._a00,this._a16=65535&~this._a16,this._a32=65535&~this._a32,this._a48=65535&~this._a48,this},s.prototype.shiftRight=s.prototype.shiftr=function(t){return(t%=64)>=48?(this._a00=this._a48>>t-48,this._a16=0,this._a32=0,this._a48=0):t>=32?(t-=32,this._a00=65535&(this._a32>>t|this._a48<<16-t),this._a16=this._a48>>t&65535,this._a32=0,this._a48=0):t>=16?(t-=16,this._a00=65535&(this._a16>>t|this._a32<<16-t),this._a16=65535&(this._a32>>t|this._a48<<16-t),this._a32=this._a48>>t&65535,this._a48=0):(this._a00=65535&(this._a00>>t|this._a16<<16-t),this._a16=65535&(this._a16>>t|this._a32<<16-t),this._a32=65535&(this._a32>>t|this._a48<<16-t),this._a48=this._a48>>t&65535),this},s.prototype.shiftLeft=s.prototype.shiftl=function(t,e){return(t%=64)>=48?(this._a48=this._a00<<t-48,this._a32=0,this._a16=0,this._a00=0):t>=32?(t-=32,this._a48=this._a16<<t|this._a00>>16-t,this._a32=this._a00<<t&65535,this._a16=0,this._a00=0):t>=16?(t-=16,this._a48=this._a32<<t|this._a16>>16-t,this._a32=65535&(this._a16<<t|this._a00>>16-t),this._a16=this._a00<<t&65535,this._a00=0):(this._a48=this._a48<<t|this._a32>>16-t,this._a32=65535&(this._a32<<t|this._a16>>16-t),this._a16=65535&(this._a16<<t|this._a00>>16-t),this._a00=this._a00<<t&65535),e||(this._a48&=65535),this},s.prototype.rotateLeft=s.prototype.rotl=function(t){var e,s,_,i,a;if(0==(t%=64))return this;if(t>=32){if(e=this._a00,this._a00=this._a32,this._a32=e,e=this._a48,this._a48=this._a16,this._a16=e,32==t)return this;t-=32}return i=(s=this._a48<<16|this._a32)<<t|(_=this._a16<<16|this._a00)>>>32-t,a=_<<t|s>>>32-t,this._a00=65535&a,this._a16=a>>>16,this._a32=65535&i,this._a48=i>>>16,this},s.prototype.rotateRight=s.prototype.rotr=function(t){var e,s,_,i,a;if(0==(t%=64))return this;if(t>=32){if(e=this._a00,this._a00=this._a32,this._a32=e,e=this._a48,this._a48=this._a16,this._a16=e,32==t)return this;t-=32}return i=(s=this._a48<<16|this._a32)>>>t|(_=this._a16<<16|this._a00)<<32-t,a=_>>>t|s<<32-t,this._a00=65535&a,this._a16=a>>>16,this._a32=65535&i,this._a48=i>>>16,this},s.prototype.clone=function(){return new s(this._a00,this._a16,this._a32,this._a48)},void 0===(_=s)||(t.exports=_)}()},959:function(t,e,s){"use strict";var _,i=(_=s(730))&&_.__esModule?_:{default:_},a=s(619);const n={_create_state:function(t,e,s,_,i,a,n,o){let r=Array.from(_.map((function(t){return Uint16Array.from(t)}))),h=Array.from(i.map((function(t){return Uint32Array.from(t)}))),l=Array.from(a.map((function(t){return Object.assign({},t)})));return Object.assign({},{w:e|=0,h:s|=0,sp:r,spc:h,l,s:n,wp:o})},from:function(t,e,s,_,n,o,r,h){let l=this._create_state,p=l(t,e,s,_,n,o,r,h);return{new(t,e,s,_,i,a,n,o){p=l(t,e,s,_,i,a,n,o)},destroy(t=function(){}){null!==p?(p=null,t()):t("ok")},render:()=>null!==p?function(t,e,s,_,n,o,r){return new Promise((function(h,l){o|=0;const p=(t|=0)*(e|=0)|0,c=0|_.length,d=i.default.init(c,p,Uint8Array.from(n.map((function(t){return t.hidden?0:Math.round(255*parseFloat(t.opacity))}))));let m=0,u=0;for(;(0|m)<(0|p);m=(m+1|0)>>>0){for(d.for(m,0),u=0;(0|u)<(0|c);u=(u+1|0)>>>0)d.stack(0|u,_[0|u][s[0|u][0|m]]);d.next()}d.blend(!1,!1).then((([s,_])=>{let i=new a.Colors(_),n=[];if(r){let t=new a.Colors(i.get_deduplicated_uint32a());n=Array(t.length).fill("");let e=new a.Color(new ArrayBuffer(4));for(let s=0;s<t.length;s++)n[s]=t.get_element(s,e).hex}(function(t,e){var s="image/png";try{return new Promise((function(_,i){createImageBitmap(t,{premultiplyAlpha:"premultiply",resizeQuality:"pixelated",resizeHeight:t.height*e|0,resizeWidth:t.width*e|0}).then((t=>{var e=new OffscreenCanvas(t.width,t.height),i=e.getContext("bitmaprenderer");i.imageSmoothingEnabled=!1,i.transferFromImageBitmap(t),e.convertToBlob({type:s}).then((t=>{try{_((new FileReaderSync).readAsDataURL(t))}catch(s){var e=new FileReader;e.onload=function(){_(e.result)},e.onerror=function(){l()},e.readAsDataURL(t)}}))}))}))}catch(_){return new Promise((function(_,i){var a,n,o=document.createElement("canvas"),r=document.createElement("canvas");o.width=t.width,o.height=t.height,r.width=t.width*e|0,r.height=t.height*e|0,(a=o.getContext("2d")).imageSmoothingEnabled=!1,(n=r.getContext("2d")).imageSmoothingEnabled=!1,a.putImageData(t,0,0),n.drawImage(o,0,0,r.width,r.height),_(r.toDataURL(s))}))}})(new ImageData(new Uint8ClampedArray(i.get_image_data().buffer),t,e),o).then((function(t){h(Object.assign({},r?{url:t,colors:Array.from(n)}:{url:t}))}))}))}))}(p.w,p.h,p.sp,p.spc,p.l,p.s,p.wp):Promise.reject()}}};t.exports=n},962:function(t,e,s){"use strict";var _=s(963),i=Set.prototype;t.exports={Set,add:_(i.add),has:_(i.has),remove:_(i.delete),proto:i}},963:function(t,e,s){"use strict";var _=s(964),i=Function.prototype,a=i.call,n=_&&i.bind.bind(a,a);t.exports=_?n:function(t){return function(){return a.apply(t,arguments)}}},964:function(t,e,s){"use strict";var _=s(965);t.exports=!_((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")}))},965:function(t,e,s){"use strict";t.exports=function(t){try{return!!t()}catch(e){return!0}}}}]);