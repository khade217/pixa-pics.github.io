/*! For license information please see chunk_12.min.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{649:function(t,e,n){"use strict";var r,i;Object.defineProperty(e,"__esModule",{value:!0}),r=function(){function t(t,e){var n,r;for(n=0;n<e.length;n++)(r=e[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.rgba_=e}return r(t,[{key:"setRGBA",value:function(t){this.rgba_[0]=t[0],this.rgba_[1]=t[1],this.rgba_[2]=t[2],this.rgba_[3]=t[3]}},{key:"setUint32",value:function(t){t=(0|t)>>>0,this.rgba_[3]=t>>24&255,this.rgba_[2]=t>>16&255,this.rgba_[1]=t>>8&255,this.rgba_[0]=255&t}},{key:"r",get:function(){return this.rgba_[0]}},{key:"g",get:function(){return this.rgba_[1]}},{key:"b",get:function(){return this.rgba_[2]}},{key:"a",get:function(){return this.rgba_[3]}},{key:"rgba",get:function(){return this.rgba_.subarray(0,4)}},{key:"uint32",get:function(){return(this.r<<24|this.g<<16|this.b<<8|this.a)>>>0}}],[{key:"createUint32",value:function(e){return new t(new Uint8Array(Uint32Array.of((0|e)>>>0).buffer))}}]),t}(),e.default=i},650:function(t,e,n){"use strict";var r,i,a,o,s;Object.defineProperty(e,"__esModule",{value:!0}),r=function(){function t(t,e){var n,r;for(n=0;n<e.length;n++)(r=e[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=n(649),a=(s=i)&&s.__esModule?s:{default:s},o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return r(t,null,[{key:"colorDifference",value:function(t,e){return Math.sqrt(Math.pow(t.r-e.r,2)+Math.pow(t.g-e.g,2)+Math.pow(t.b-e.b,2)+Math.pow(t.a-e.a,2))}},{key:"averageColor",value:function(t){var e,n=new Uint32Array(4);return t.forEach((function(t){var e=t.rgba;n[0]=(n[0]+e[0]|0)>>>0,n[1]=(n[1]+e[1]|0)>>>0,n[2]=(n[2]+e[2]|0)>>>0,n[3]=(n[3]+e[3]|0)>>>0})),e=t.length,new a.default(Uint8Array.of(n[0]/e|0,n[1]/e|0,n[2]/e|0,n[3]/e|0))}}]),t}(),e.default=o},652:function(t,e,n){"use strict";var r,i=n(651),a=n(645),o=(0,a.SIMDopeCreateConfAdd)({create:{new_of:!0},properties:{uint32:!0,laba:!0,rgbaon4bits:!0,rgbaon6bits:!0,rgbaon8bits:!0,rgbaon12bits:!0,rgbaon16bits:!0,skin:!0},methods:{simplify:!0,get_new_element:!0,get_use_element:!0,set_tail:!0,is_dark:!0,blend_first_with:!0,blend_first_with_tails:!0,blend_all:!0,manhattan_match_with:!0,copy:!0}}),s=Math.fround,u=s(1),c=s(.777),l=(0,a.SIMDopeCreate)(o),h=l.simdops,f=l.Color,d=l.Colors,p=(h.minus_int,h.int_not_equal,h.plus_int,h.plus_uint,h.minus_uint,h.multiply_int,h.multiply_uint,h.multiply_uint_4),g=(h.divide_uint,h.clamp_uint8,h.clamp_uint32,h.int_equal,h.uint_less,h.int_less,h.int_greater_equal,h.uint_not_equal,h.uint_less_equal,h.min_uint,function t(e){if(e=e||{},!(this instanceof t))return new t(e);e.pxl_colors=e.pxl_colors||new Uint32Array(0),e.pxls=e.pxls||new Uint32Array(0),this.new_pxls_="buffer"in e.pxls?new Uint32Array(e.pxls.buffer):Uint32Array.from(e.pxls),this.new_pxl_colors_="buffer"in e.pxl_colors?new d(e.pxl_colors.buffer):new d(Uint32Array.from(e.pxl_colors).buffer),this.original_pxls_=this.new_pxls_.slice(0,this.new_pxls_.length),this.original_pxl_colors_=this.new_pxl_colors_.slice_uint32(0,this.new_pxl_colors_.length);var n=0|this.new_pxl_colors_.length;this.new_pxl_colors_is_skin_mask_=new i.SetFixed(0|n),this.set_new_pxl_skin_mask(),this.best_color_number_=e.number_of_color,this.max_cluster_=n>65536?65537:n>16384?4097:n>8192?257:n>512?17:1,this.index_clusters_=Array(this.max_cluster_),this.length_clusters_=new Uint32Array(this.max_cluster_),this.pxl_colors_usage_=new Uint32Array(n),this.all_index_clusters_=new Uint32Array(n),this.clean_pxl_colors_=new Uint32Array(n),this.clean_pxl_colors_lookup_={},this.is_skin_ops_=0,this.match_ops_=0,this.blend_ops_=0,this.remove_duplicate_ops_=0,this.simplify_ops_=0,this.classify_on_x_bits_ops_=0});Object.defineProperty(g.prototype,"set_is_skin_ops",{get:function(){return function(t){this.is_skin_ops_=(0|t)>>>0}}}),Object.defineProperty(g.prototype,"set_match_ops",{get:function(){return function(t){this.match_ops_=(0|t)>>>0}}}),Object.defineProperty(g.prototype,"set_blend_ops",{get:function(){return function(t){this.blend_ops_=(0|t)>>>0}}}),Object.defineProperty(g.prototype,"set_remove_duplicate_ops",{get:function(){return function(t){this.remove_duplicate_ops_=(0|t)>>>0}}}),Object.defineProperty(g.prototype,"set_simplify_ops",{get:function(){return function(t){this.simplify_ops_=t}}}),Object.defineProperty(g.prototype,"set_classify_on_x_bits_ops",{get:function(){return function(t){this.classify_on_x_bits_ops_=t}}}),Object.defineProperty(g.prototype,"get_is_skin_ops",{get:function(){return function(){return 0|this.is_skin_ops_}}}),Object.defineProperty(g.prototype,"get_match_ops",{get:function(){return function(){return 0|this.match_ops_}}}),Object.defineProperty(g.prototype,"get_blend_ops",{get:function(){return function(){return 0|this.blend_ops_}}}),Object.defineProperty(g.prototype,"get_remove_duplicate_ops",{get:function(){return function(){return 0|this.remove_duplicate_ops_}}}),Object.defineProperty(g.prototype,"get_simplify_ops",{get:function(){return function(){return this.simplify_ops_}}}),Object.defineProperty(g.prototype,"get_classify_on_x_bits_ops",{get:function(){return function(){return this.classify_on_x_bits_ops_}}}),Object.defineProperty(g.prototype,"reset_deduplicate",{get:function(){return function(t){this.clean_pxl_colors_lookup_={},this.pxl_colors_usage_.fill(0,0,0|t),this.clean_pxl_colors_.fill(0,0,0|t)}}}),Object.defineProperty(g.prototype,"index_of_color_within_cleaned",{get:function(){return function(t){return(0|this.clean_pxl_colors_lookup_[(0|t)>>>0])-1|0}}}),Object.defineProperty(g.prototype,"set_cleaned_pxl_colors",{get:function(){return function(t,e){this.clean_pxl_colors_[(0|t)>>>0]=(0|e)>>>0,this.clean_pxl_colors_lookup_[(0|e)>>>0]=(t+1|0)>>>0}}}),Object.defineProperty(g.prototype,"increase_color_usage",{get:function(){return function(t){this.pxl_colors_usage_[(0|t)>>>0]=(this.pxl_colors_usage_[(0|t)>>>0]+1|0)>>>0}}}),Object.defineProperty(g.prototype,"set_new_pxls",{get:function(){return function(t,e){this.new_pxls_[(0|t)>>>0]=(0|e)>>>0}}}),Object.defineProperty(g.prototype,"set_new_pxl_colors",{get:function(){return function(t){this.new_pxl_colors_=new d(this.clean_pxl_colors_.buffer.slice(0,p(0|t))),this.set_new_pxl_skin_mask()}}}),Object.defineProperty(g.prototype,"set_new_pxl_skin_mask",{get:function(){return function(){var t=new f(new ArrayBuffer(4)),e=0|this.new_pxl_colors_.length,n=0;for(this.new_pxl_colors_is_skin_mask_=new i.SetFixed(0|e);(0|n)<(0|e);n=n+1|0)this.new_pxl_colors_.get_use_element(0|n,t).skin&&this.new_pxl_colors_is_skin_mask_.add(0|n);this.set_is_skin_ops(this.get_is_skin_ops()+n|0)}}}),Object.defineProperty(g.prototype,"get_a_new_pxl_color_from_pxl_index",{get:function(){return function(t){return 4294967295&this.new_pxl_colors_.buffer_getUint32(this.new_pxls_[0|t])}}}),Object.defineProperty(g.prototype,"reset_cluster",{get:function(){return function(){this.max_cluster_=this.new_pxl_colors_.length>65536?65537:this.new_pxl_colors_.length>16384?4097:this.new_pxl_colors_.length>8192?257:this.new_pxl_colors_.length>512?17:1,this.length_clusters_.fill(0,0,0|this.max_cluster);for(var t=0;(0|t)<(0|this.max_cluster);t=(t+1|0)>>>0)this.index_clusters_[0|t]=[]}}}),Object.defineProperty(g.prototype,"reset_original_data",{get:function(){return function(){this.new_pxl_colors_=new d(this.original_pxl_colors_.slice(0,this.original_pxl_colors_.length).buffer),this.new_pxls_=this.original_pxls_.slice(0,this.original_pxls_.length)}}}),Object.defineProperty(g.prototype,"add_in_indexes_cluster",{get:function(){return function(t,e){this.index_clusters_[(0|t)>>>0].push((0|e)>>>0)}}}),Object.defineProperty(g.prototype,"set_all_cluster_indexes",{get:function(){return function(){for(var t=0,e=0;(0|t)<(0|this.max_cluster);t=(t+1|0)>>>0)this.all_index_clusters_.set(this.index_clusters_[(0|t)>>>0],(0|e)>>>0),e=(e+this.get_length_in_index_clusters(0|t)|0)>>>0}}}),Object.defineProperty(g.prototype,"get_length_in_index_clusters",{get:function(){return function(t){return(0|this.index_clusters_[(0|t)>>>0].length)>>>0}}}),Object.defineProperty(g.prototype,"get_in_cluster_lengths",{get:function(){return function(t){return(0|this.length_clusters_[(0|t)>>>0])>>>0}}}),Object.defineProperty(g.prototype,"get_an_index_in_clusters",{get:function(){return function(t){return(0|this.all_index_clusters_[0|t])>>>0}}}),Object.defineProperty(g.prototype,"get_a_color_usage",{get:function(){return function(t){return(0|this.pxl_colors_usage_[0|t])>>>0}}}),Object.defineProperty(g.prototype,"set_a_color_usage",{get:function(){return function(t,e){return this.pxl_colors_usage_[0|t]=(0|e)>>>0}}}),Object.defineProperty(g.prototype,"get_a_color_usage_percent",{get:function(){return function(t){return s(this.pxl_colors_usage_[0|t]/this.new_pxls_.length)}}}),Object.defineProperty(g.prototype,"get_average_color_usage_percent",{get:function(){return function(t,e){var n,r,i;for(e=0|((e|=0)<(t|=0)?this.pxl_colors_usage_.length:e),n=0,r=0,i=0,r=0|t;(0|r)<(0|e);r=(r+1|0)>>>0)i=(0|this.get_an_index_in_clusters((0|r)>>>0))>>>0,n+=this.pxl_colors_usage_[0|i]/this.new_pxls_.length;return n/(e-t|0)}}}),Object.defineProperty(g.prototype,"get_a_new_pxl_color",{get:function(){return function(t){return this.new_pxl_colors_.get_new_element(0|t)}}}),Object.defineProperty(g.prototype,"is_pxl_color_skin",{get:function(){return function(t){return this.new_pxl_colors_is_skin_mask_.has(0|t)}}}),Object.defineProperty(g.prototype,"max_cluster",{get:function(){return 0|this.max_cluster_}}),Object.defineProperty(g.prototype,"new_pxls_length",{get:function(){return 0|this.new_pxls_.length}}),Object.defineProperty(g.prototype,"new_pxl_colors_length",{get:function(){return 0|this.new_pxl_colors_.length}}),Object.defineProperty(g.prototype,"best_color_number",{get:function(){return 0|this.best_color_number_}}),Object.defineProperty(g.prototype,"get_data",{get:function(){return function(){return Array.of(this.new_pxls_,this.new_pxl_colors_.slice_uint32(0,this.new_pxl_colors_.length),{deduplicate:this.get_remove_duplicate_ops(),simplify:this.get_simplify_ops(),classify:this.get_classify_on_x_bits_ops(),skin:this.get_is_skin_ops(),blend:this.get_blend_ops(),match:this.get_match_ops()})}}}),g.prototype.output=function(t){var e,n;return t=t||"heap",e=this.get_data(),"heap"==t?((n=new Uint32Array(2+e[0].length+e[1].length))[0]=0|e[0].length,n[1]=0|e[1].length,n.set(e[0],2),n.set(e[1],2+e[0].length),n.buffer):e},g.prototype.deduplicate=function(){var t,e,n,r,i;for(this.set_remove_duplicate_ops(this.get_remove_duplicate_ops()+1|0),this.reset_deduplicate(0|this.new_pxl_colors_length),t=0,e=0,n=0,r=0,i=0|this.new_pxls_length;(0|r)<(0|i);r=(r+1|0)>>>0)e=0|this.get_a_new_pxl_color_from_pxl_index(0|r),-1==(0|(n=0|this.index_of_color_within_cleaned(0|e)))&&(this.set_cleaned_pxl_colors(0|t,0|e),n=0|t,t=t+1|0),this.increase_color_usage(0|n),this.set_new_pxls(0|r,0|n);this.set_new_pxl_colors(t)},g.prototype.clusterize=function(){this.reset_cluster();var t=0;if(65537===this.max_cluster)for(;(0|t)<(0|this.new_pxl_colors_length);t=(t+1|0)>>>0)this.add_in_indexes_cluster((0|this.get_a_new_pxl_color((0|t)>>>0).rgbaon16bits)>>>0,(0|t)>>>0);else if(4097===this.max_cluster)for(;(0|t)<(0|this.new_pxl_colors_length);t=(t+1|0)>>>0)this.add_in_indexes_cluster((0|this.get_a_new_pxl_color((0|t)>>>0).rgbaon12bits)>>>0,(0|t)>>>0);else if(257===this.max_cluster)for(;(0|t)<(0|this.new_pxl_colors_length);t=(t+1|0)>>>0)this.add_in_indexes_cluster((0|this.get_a_new_pxl_color((0|t)>>>0).rgbaon8bits)>>>0,(0|t)>>>0);else if(17===this.max_cluster)for(;(0|t)<(0|this.new_pxl_colors_length);t=(t+1|0)>>>0)this.add_in_indexes_cluster((0|this.get_a_new_pxl_color((0|t)>>>0).rgbaon4bits)>>>0,(0|t)>>>0);else for(;(0|t)<(0|this.new_pxl_colors_length);t=(t+1|0)>>>0)this.add_in_indexes_cluster(0,(0|t)>>>0);this.max_cluster>1&&this.set_classify_on_x_bits_ops(this.get_classify_on_x_bits_ops()+this.new_pxl_colors_length),this.set_all_cluster_indexes()},g.prototype.process_threshold=function(t){var e,n,r,i,a,o,l,h,d,p,g,_,y,v,m,w,b,x,k,O,M,E,P,C,j,D;for(n=function(t,n){return s(Math.pow(t,e)/n)}(t=(0|t)>>>0,Math.pow(100,e=1.5)),r=!1,i=[],a=[],o=0,l=0,p=!1,g=!1,_=0,y=0,v=0,m=0,w=0,b=0,M=0,E=0,P=0,C=0,j=0,D=0,O=s((x=n)*c),k=s(x*u);(0|j)<(0|this.max_cluster);j=(j+1|0)>>>0){for(l=(o+((0|this.get_length_in_index_clusters(0|j))>>>0)|0)>>>0,w=this.get_average_color_usage_percent(0|o,0|l),P=0|o;(0|P)<(0|l);P=(P+1|0)>>>0){if(M=(0|this.get_an_index_in_clusters((0|P)>>>0))>>>0,h=this.get_a_new_pxl_color((0|M)>>>0),p=this.is_pxl_color_skin((0|M)>>>0),(0|(_=(0|this.get_a_color_usage((0|M)>>>0))>>>0))>0)for(i=[],C=0|o;(0|C)<(0|l);C=(C+1|0)>>>0)E=(0|this.get_an_index_in_clusters((0|C)>>>0))>>>0,d=this.get_a_new_pxl_color((0|E)>>>0),g=this.is_pxl_color_skin((0|E)>>>0),0|(y=(0|this.get_a_color_usage((0|E)>>>0))>>>0)&&(0|M)!=(0|E)&&(0|p)==(0|g)&&(v=this.get_a_color_usage_percent((0|M)>>>0)/w,m=this.get_a_color_usage_percent((0|E)>>>0)/w,D=s((D=p&&g?O:p||g?k:x)*(0*Math.abs(v-m)+.14*(2-(v+m))/2+.88)/1.02),h.manhattan_match_with(d,D)&&(b=s(y/_),r=!0,this.set_a_color_usage(0|E,0),i.push(d),a.push(b)));(0|i.length)>0&&(f.blend_all(h,i,a),i=[],a=[])}o=0|l}return r},g.prototype.round=function(){var t,e;if(this.new_pxl_colors_length>2048){for(t=0|(this.new_pxl_colors_length>6e4?4:this.new_pxl_colors_length>32e3?3:this.new_pxl_colors_length>16e3?2:this.new_pxl_colors_length>8192?1.5:this.new_pxl_colors_length>4096?1.25:1),e=0;(0|e)<(0|this.new_pxl_colors_length);e=(e+1|0)>>>0)this.get_a_new_pxl_color((0|e)>>>0).simplify(t);this.set_simplify_ops(this.get_simplify_ops()+this.new_pxl_colors_length)}},g.prototype.init=function(){return this.round(),this.deduplicate(),this.clusterize(),this},g.prototype.reset_original=function(){return this.reset_original_data(),this},g.prototype.run=function(){var t=0|(this.new_pxl_colors_length>6e4?12:this.new_pxl_colors_length>32e3?8:this.new_pxl_colors_length>16e3?4:this.new_pxl_colors_length>8192?3:this.new_pxl_colors_length>4096?2:1);if(this.new_pxl_colors_length<=this.best_color_number)return this.deduplicate(),this.clusterize(),this;for(;this.new_pxl_colors_length>this.best_color_number;)this.process_threshold(0|t)&&(this.deduplicate(),this.clusterize()),t=t+(this.new_pxl_colors_length>6e4?12:this.new_pxl_colors_length>32e3?8:this.new_pxl_colors_length>16e3?4:this.new_pxl_colors_length>8192?3:this.new_pxl_colors_length>4096?2:1)|0;return this.reset_original(),this.deduplicate(),this.clusterize(),this.process_threshold(0|t),this.deduplicate(),this.clusterize(),this},g.split_image_data=function(t){var e,n,r=new Uint32Array(t.data.buffer),i=Uint32Array.from(new Set(r)),a={},o=i.length,s=new Uint32Array(r.length);for(e=0,n=0|o;(0|e)<(0|n);e=(e+1|0)>>>0)a[i[0|e]]=(0|e)>>>0;for(e=0,n=0|r.length;(0|e)<(0|n);e=(e+1|0)>>>0)s[0|e]=(0|a[r[0|e]])>>>0;return[s,i,r,o]},r=function(t,e){return new Promise((function(n){var r,i=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n,r,i=[],a=!0,o=!1,s=void 0;try{for(n=t[Symbol.iterator]();!(a=(r=n.next()).done)&&(i.push(r.value),4!==i.length);a=!0);}catch(u){o=!0,s=u}finally{try{!a&&n.return&&n.return()}finally{if(o)throw s}}return i}(t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}(g.split_image_data(t)),a=i[0],o=i[1],s=i[2],u=i[3],c=Date.now(),l=g({pxls:a,pxl_colors:o,number_of_color:"auto"===e?u/1.314|0:parseFloat(e)<1?u-Math.ceil(u/25):e,width:t.width,height:t.height}).init().run().output("split"),h=Date.now(),f=l[0],d=0|f.length,p=l[1];for(r=0;(0|r)<(0|d);r=(r+1|0)>>>0)s[0|r]=(0|p[(0|f[0|r])>>>0])>>>0;n([t=new ImageData(new Uint8ClampedArray(s.buffer),t.width,t.height),f,p,u-p.length,p.length,h-c])}))},t.exports={QuantiMatGlobal:r,QuantiMat:g}},653:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function t(e,n,r,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.strength=e,this.tilesManager=n,this.tiles=n.getTiles(),this.width=r,this.height=i}},655:function(t,e,n){"use strict";var r,i;Object.defineProperty(e,"__esModule",{value:!0}),r=(i=n(668))&&i.__esModule?i:{default:i},e.default=r.default.pool({minWorkers:0,maxWorkers:3})},657:function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function i(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var a,o,s,u,c,l;Object.defineProperty(e,"__esModule",{value:!0}),a=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n,r,i=[],a=!0,o=!1,s=void 0;try{for(n=t[Symbol.iterator]();!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(u){o=!0,s=u}finally{try{!a&&n.return&&n.return()}finally{if(o)throw s}}return i}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=function(){function t(t,e){var n,r;for(n=0;n<e.length;n++)(r=e[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),r(n(649)),r(n(650)),n(651),s=n(652),u=Math.abs,c=Math.imul,l=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.contextSource=e}return o(t,[{key:"computePaletteData",value:function(){var e=this.contextSource.getImageData(0,0,this.contextSource.canvas.width,this.contextSource.canvas.height),n=Date.now(),r=t.quantizeImageData(this.contextSource,256),i=r.centroids.length,a=Date.now(),o=t._calculateDistortions(r,e),s=Date.now(),u=t._findElbowPoint(o.clustersDistortion),c=Date.now(),l=t._calculateElbowStrength(o.clustersDistortion,u),h=Date.now(),f=0===u?this.contextSource.getImageData(0,0,this.contextSource.canvas.width,this.contextSource.canvas.height):t.quantizeImageData(this.contextSource,u).imageData,d=Date.now();return console.log({quantizeImageData1:a-n,_calculateDistortions:s-a,_findElbowPoint:c-s,"_calculateElbowStrength+updateThreshold":h-c,quantizeImageData2:d-h}),{colorNumber:0===u?i:u,colorNumberCertainty:l,colorData:f}}},{key:"analyzeImageForTileSize",value:function(t){function e(t){for(var e,n,r,i=0,a=4,o=1;a>=4&&a<=32;)e=t[a],t[2*a-1],t[2*a],t[2*a+1],t[4*a-1],t[4*a],t[4*a+1],i<(n=e*a*(1+.1*a))&&(i=n,o=a),a++;return r=0,t.forEach((function(t,e){r+=t*e})),{tileSize:o,certainty:Math.fround(o*t[o]/r)}}var n,r,i,a,o,s,u,c=t.width,l=t.height,h=new Uint32Array(t.data.buffer),f=256,d=new Uint32Array(f),p=new Uint32Array(f),g=0,_=new Uint32Array(2);for(n=0;n<l;n++){for(g=0,r=1;r<c;r++)_[0]=n*c+r|0,_[1]=_[0]-1|0,h[_[0]]==h[_[1]]?g++:(g>1&&g<f&&(d[g]=d[g]+1|0),g=1);g>0&&g<f&&(d[g]=d[g]+1|0)}for(i=0;i<c;i++){for(g=0,a=1;a<l;a++)_[0]=a*c+i|0,_[1]=_[0]-c|0,h[_[0]]==h[_[1]]?g++:(g>1&&g<f&&(p[g]=p[g]+1|0),g=1);g>0&&g<f&&(p[g]=p[g]+1|0)}return o=e(d),s=e(p),{tileSize:(u=100*Math.max(o.certainty,s.certainty))===o.certainty?o.tileSize:s.tileSize,certainty:u}}}],[{key:"colorDifference",value:function(t,e){var n=Uint8Array.of(u((t>>24&255)-(e>>24&255)),u((t>>16&255)-(e>>16&255)),u((t>>8&255)-(e>>8&255))),r=Uint16Array.of(c(n[0],n[0]),c(n[1],n[1]),c(n[2],n[2]));return(0|Math.sqrt((((r[0]<<1)+r[0]|0)+(r[1]<<2)+(r[2]<<1)|0)/10))>>>0}},{key:"quantizeImageData",value:function(t,e){var n,r,i,o,u=t.getImageData(0,0,t.canvas.width,t.canvas.height),c=Date.now(),l=s.QuantiMat.split_image_data(u),h=a(l,2),f=h[0],d=h[1],p=Date.now(),g=(0,s.QuantiMat)({pxls:f,pxl_colors:d,number_of_color:Math.min(d.length,e),width:u.width,height:u.height}).init().run().output("split"),_=Date.now();for(console.log(p-c,_-p),n=g[0],r=g[1],i=new Uint32Array(n.length),o=0;o<n.length;o++)i[o]=r[n[o]];return u.data.set(new Uint8ClampedArray(i.buffer)),{imageData:u,clusterAssignments:n,centroids:r}}},{key:"_calculateDistortions",value:function(e,n){var r,i=e.imageData,a=e.clusterAssignments,o=e.centroids,s=Math.imul,u=0,c=new Uint32Array(n.data.buffer),l=new Uint32Array(i.data.buffer),h=new BigUint64Array(o.length),f=0;for(r=0;r<l.length;r++)u+=f=0|s(f=0|t.colorDifference(l[r],c[r]),f),h[a[r]]+=BigInt(f);return{totalDistortion:u,clustersDistortion:Array.from(h).map((function(t){return Number(t)})).sort((function(t,e){return e-t}))}}},{key:"_findElbowPoint",value:function(t){var e,n,r,i,a,o,s,u=[];for(t.forEach((function(t){t&&u.push(t)})),e=[],n=1;n<t.length;n++)r=t[n]-t[n-1],0!==(i=t[n-1])?e.push(r/i):e.push(0);for(a=0,o=e[0],s=1;s<e.length;s++)e[s]>o&&(a=s,o=e[s]);return a}},{key:"_calculateElbowStrength",value:function(t,e){var n,r,a,o=t.map((function(e,n){return n/(t.length-1)})),s=Math.max.apply(Math,i(t)),u=Math.min.apply(Math,i(t)),c=t.map((function(t){return(t-u)/(s-u)})),l=[0,c[0]],h=[1,c[c.length-1]],f=[o[e],c[e]],d=Math.sqrt(Math.pow(h[0]-l[0],2)+Math.pow(h[1]-l[1],2)),p=Math.abs(((a=h)[1]-(r=l)[1])*(n=f)[0]-(a[0]-r[0])*n[1]+a[0]*r[1]-a[1]*r[0])/Math.sqrt(Math.pow(a[1]-r[1],2)+Math.pow(a[0]-r[0],2));return Math.fround(p/d)}}]),t}(),e.default=l},658:function(t,e,n){"use strict";var r,i,a;Object.defineProperty(e,"__esModule",{value:!0}),r=function(){function t(t,e){var n,r;for(n=0;n<e.length;n++)(r=e[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=n(645),a=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.data=e,this.k=Math.min(n,Math.ceil(Math.sqrt(this.data.length))),this.centroids=Array(this.k),this.clusters=new Uint32Array(this.data.length),this.c1=new i.Color(new ArrayBuffer(4)),this.c2=new i.Color(new ArrayBuffer(4))}return r(t,[{key:"initializeCentroids",value:function(){var t,e,n=new Set,r=[];for(t=0;t<this.k;t++){e=void 0;do{e=Math.floor(Math.random()*this.data.length)}while(n.has(e));n.add(e),r.push(Uint8Array.from(this.data[e]))}this.centroids=r}},{key:"assignClusters",value:function(){var t=this;this.data.forEach((function(e,n){var r=Number.MAX_VALUE,i=0;t.centroids.forEach((function(n,a){var o=t.distance(e,n);o<r&&(r=o,i=a)})),t.clusters[n]=i}))}},{key:"updateCentroids",value:function(){var t=this,e=Array.from({length:this.k},(function(){return new Uint32Array(t.data[0].length)})),n=new Uint32Array(this.k);return this.data.forEach((function(r,i){var a=t.clusters[i];e[a]=e[a].map((function(t,e){return t+r[e]})),n[a]++})),n}},{key:"findFarthestPointFromCentroids",value:function(){var t=this,e=0,n=0;return this.data.forEach((function(r,i){var a=Number.MAX_VALUE;t.centroids.forEach((function(e){var n=t.distance(r,e);n<a&&(a=n)})),a>e&&(e=a,n=i)})),n}},{key:"distance",value:function(t,e){return this.c1.set_from_array(t),this.c2.set_from_array(e),16192*this.c1.fast_match_with(this.c2)|0}},{key:"reassignCentroids",value:function(t){for(var e=0;e<t.length;e++)0===t[e]&&(this.centroids[e]=this.findFarthestPointFromCentroids())}},{key:"run",value:function(){var t,e,n,r,i,a,o=this,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.initializeCentroids(),t=0,e=!1,n=void 0,r=function(){var r=o.centroids.map((function(t){return Uint32Array.from(t)}));o.assignClusters(),n=o.updateCentroids(),t++,e=o.centroids.every((function(t,e){return o.distance(t,r[e])<2})),u&&!e&&o.reassignCentroids(n)};!e&&t<s;)r();return i=this.getCentroidsPopulationCount(this.centroids,this.clusters),a=Array.from(this.centroids).map((function(t,e){return{data:Uint8ClampedArray.from(t),count:i[e]}})).sort((function(t,e){return e.count-t.count})),{centroids:this.centroids,clusters:this.clusters,centroidsSorted:a}}},{key:"getCentroidsPopulationCount",value:function(t,e){var n=new Uint32Array(t.length);return e.forEach((function(t){n[t]++})),n}}]),t}(),e.default=a},659:function(t,e,n){"use strict";var r,i;Object.defineProperty(e,"__esModule",{value:!0}),r=function(){function t(t,e){var n,r;for(n=0;n<e.length;n++)(r=e[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return r(t,null,[{key:"initializeCanvas",value:function(t,e,n){e=(t=t||{width:0,height:0}).width||e||1,n=t.height||n||1;var r=void 0,i=void 0;try{i=(r=new OffscreenCanvas(e,n)).getContext("2d",{willReadFrequently:!0,desynchronized:!0})}catch(a){(r=document.createElement("canvas")).width=e,r.height=n,i=r.getContext("2d",{willReadFrequently:!0})}return t instanceof ImageData?i.putImageData(t,0,0):t.width&&i.drawImage(t,0,0,e,n),{canvas:r,context:i}}},{key:"canvasContextToImageData",value:function(t){return t.getImageData(0,0,t.canvas.width,t.canvas.height)}}]),t}(),e.default=i},660:function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}var i=r(n(661)),a=r(n(662));t.exports=function(t){var e,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=(0,i.default)(t);return n&&(e=/(?:#)[0-9a-f]{8}|(?:#)[0-9a-f]{6}|(?:#)[0-9a-f]{4}|(?:#)[0-9a-f]{3}/gi,r.match(e).forEach((function(t){var e=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n,r,i=[],a=!0,o=!1,s=void 0;try{for(n=t[Symbol.iterator]();!(a=(r=n.next()).done)&&(i.push(r.value),3!==i.length);a=!0);}catch(u){o=!0,s=u}finally{try{!a&&n.return&&n.return()}finally{if(o)throw s}}return i}(t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}(t.match(/\w\w/g).map((function(t){return parseInt(t,16)}))),n=e[0],i=e[1],a=e[2],o=Math.round((n+i+a)/3),s=function(t,e,n){return t=t.toString(16),e=e.toString(16),n=n.toString(16),1==t.length&&(t="0"+t),1==e.length&&(e="0"+e),1==n.length&&(n="0"+n),"#"+t+e+n}(o,o,o);r=r.replace(t,s)}))),(0,a.default)(r)}},665:function(t,e,n){"use strict";var r=n(666);t.exports={createLocalBlob:function(t){var e,n,i,a,o=(t.match(/(data\:([a-z]+\/[a-z\+]+)\;base64\,)([a-zA-Z0-9\/\+]+\(\=+)?/)||[,,])[1];return o?(n=(e=o.match(/data\:([a-z]+\/[a-z\+]+)\;base64\,/)[1]).match(/[a-z]+\/([a-z\+]+)/)[1],t=t.replace(o,""),i=(0,r.base64ToBytes)(t),a=new File([i],"name."+n,{type:e}),URL.createObjectURL(a)):""}}},666:function(t,e,n){"use strict";var r=new(n(266).B64chromium);t.exports={bytesToBase64:r.bytesToBase64.bind(r),base64ToBytes:r.base64ToBytes.bind(r)}},674:function(t,e,n){"use strict";var r,i=n(675),a=Object.getPrototypeOf((r=regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t,this)})),function(){var t=r.apply(this,arguments);return new Promise((function(e,n){return function r(i,a){var o,s;try{s=(o=t[i](a)).value}catch(u){return void n(u)}if(!o.done)return Promise.resolve(s).then((function(t){r("next",t)}),(function(t){r("throw",t)}));e(s)}("next")}))})).constructor,o=Object.getPrototypeOf((function(){})).constructor,s=new o('var t = function(file) {\n    "use strict";\n    \n    try {\n        \n        return new Promise(function(resolve, _) {\n            resolve(new FileReaderSync().readAsDataURL(file));\n        });\n        \n    } catch(error) {\n    \n        return new Promise(function(resolve, _) {\n            var reader = new FileReader();\n            reader.onload = function(){ resolve(reader.result)};\n            reader.readAsDataURL(file);\n        });\n    }\n    \n}; return t;')(),u=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null!==n?n.exec(s,[t]).catch((function(e){return s(t)})).timeout(5e3).then((function(t){e(t)})):s(t).then((function(t){e(t)}))},c=new a('var t = async function(base64) {\n\n    "use strict";\n\n    return fetch(base64).then(function(res) {\n\n        return res.blob().then(function(blb){\n\n            return createImageBitmap(blb, {\n                resizeQuality: "pixelated",\n                premultiplyAlpha: \'premultiply\'\n            });\n        });\n    });\n\n}; return t;')(),l=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null!==n?n.exec(c,[t]).catch((function(e){return c(t)})).timeout(5e3).then((function(t){e(t)})):c(t).then((function(t){e(t)}))},h=function(t){for(var e,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2073600,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},a=1;Math.round(t.width*a)*Math.round(t.height*a)>r;)a-=.01;try{createImageBitmap(t,0,0,t.width,t.height,{resizeWidth:Math.round(t.width*a),resizeHeight:Math.round(t.height*a),resizeQuality:"pixelated",premultiplyAlpha:"premultiply"}).then((function(t){var e,n=void 0;try{n=new OffscreenCanvas(t.width,t.height)}catch(r){(n=document.createElement("canvas")).width=t.width,n.height=t.height}(e=n.getContext("2d")).imageSmoothingEnabled=!1,e.drawImage(t,0,0,t.width,t.height),i(e.getImageData(0,0,t.width,t.height))}))}catch(o){e=void 0;try{e=new OffscreenCanvas(Math.round(t.width*a),Math.round(t.height*a))}catch(s){(e=document.createElement("canvas")).width=Math.round(t.width*a),e.height=Math.round(t.height*a)}(n=e.getContext("2d")).imageSmoothingEnabled=!1,n.drawImage(t,0,0,e.width,e.height),i(n.getImageData(0,0,e.width,e.height))}},f=new o('var t = function(imagedata, type) {\n\n    "use strict"\n    type = type || "image/png";\n    var quality = type.includes("webp") ? 1: type.includes("png") ? undefined: 0.7;\n    try {\n    \n        return new Promise(function(resolve, _) {\n\n            createImageBitmap(imagedata, 0, 0, imagedata.width, imagedata.height, {\n                premultiplyAlpha: \'premultiply\',\n                resizeQuality: \'pixelated\'\n            }).then((bmp) => {\n            \n                var canvas;\n                    canvas = new OffscreenCanvas(imagedata.width, imagedata.height);\n                var ctx = canvas.getContext("bitmaprenderer");\n                    ctx.imageSmoothingEnabled = false;\n                    ctx.transferFromImageBitmap(bmp);\n                \n                canvas.convertToBlob({type: type, quality: quality}).then((blb) => {\n                    try {\n                        resolve(new FileReaderSync().readAsDataURL(blb));\n                    } catch(e2) {\n                        var reader = new FileReader();\n                        reader.onload = function(){ resolve(reader.result)};\n                        reader.readAsDataURL(blb);\n                    }\n                });\n            });\n        });\n       \n    }catch (e) {\n    \n        return new Promise(function(resolve, _) {\n            var canvas = document.createElement("canvas");\n            canvas.width = imagedata.width;\n            canvas.height = imagedata.height;\n            var ctx = canvas.getContext("2d");\n            ctx.imageSmoothingEnabled = false;\n            ctx.putImageData(imagedata, 0, 0);\n            \n            var base64 = canvas.toDataURL(type, quality);\n            canvas = null;\n            resolve(base64);\n        });\n    }\n\n}; return t;')();t.exports={file_to_imagedata_resized:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;Date.now(),t.type,"image/jpg"!==t.type&&t.type,t.type,u(t,(function(t){l(t,(function(t){h(t,e,(function(t){n(t)}),r)}),r)}),r)},file_to_base64:u,base64_to_bitmap:l,bitmap_to_imagedata:h,imagedata_to_base64:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/png",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;null!==r?r.exec(f,[t,e]).catch((function(n){return f(t,e)})).timeout(5e3).then((function(t){n(t)})):f(t,e).then((function(t){n(t)}))},base64_sanitize:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};(function(t,e,n){return n=n||"pixelize",new Promise((function(r,a){var o=new Image,s=t.startsWith("data:image/png;");o.onload=function(){var t,a,u=o.naturalWidth*e,c=o.naturalHeight*e,l=function(t,e,n,r){var a,o,s,u,c=void 0;if("pixelize"===r||"normal"===r){a=void 0,o=void 0;try{a=new OffscreenCanvas(t.width,t.height),o=new OffscreenCanvas(e,n)}catch(l){a=document.createElement("canvas"),o=document.createElement("canvas"),a.width=t.width,a.height=t.height,o.width=e,o.height=n}s=a.getContext("2d"),u=o.getContext("2d"),s.imageSmoothingEnabled=!("normal"!==r),u.imageSmoothingEnabled=!("normal"!==r),s.drawImage(t,0,0,t.width,t.height),u.drawImage(a,0,0,a.width,a.height,0,0,o.width,o.height),c=u}else"doppel"===r&&(c=i.scaler.processImage(t,e,n));return c}(o,0|u,0|c,n);try{t=l.getImageData(0,0,l.canvas.width,l.canvas.height),createImageBitmap(t).then((function(t){var e,n;try{e=new OffscreenCanvas(t.width,t.height)}catch(i){(e=document.createElement("canvas")).height=t.height,e.width=t.width}(n=e.getContext("bitmaprenderer")).imageSmoothingEnabled=!1,n.transferFromImageBitmap(t),e.convertToBlob({type:s?"image/png":"image/jpeg"}).then((function(t){try{r((new FileReaderSync).readAsDataURL(t))}catch(n){var e=new FileReader;e.onload=function(){r(e.result)},e.readAsDataURL(t)}}))}))}catch(h){a=l.canvas,r(a.toDataURL(s?"image/png":"image/jpeg"))}},o.onerror=function(){a()},o.src=t}))})(t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,arguments[4]).then((function(t){e(t)}))},file_to_bitmap:function(t,e){createImageBitmap(t).then(e)}}},675:function(t,e,n){"use strict";var r,i=(r=n(676))&&r.__esModule?r:{default:r},a=new i.default({strength:1,overlapFactor:1,despeckleStrength:.88});t.exports={scaler:a,ImageProcessor:i.default}},676:function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}var i,a,o,s,u,c,l,h,f,d,p,g;Object.defineProperty(e,"__esModule",{value:!0}),i=function(){function t(t,e){var n,r;for(n=0;n<e.length;n++)(r=e[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=n(657),o=r(a),s=n(677),u=r(s),c=n(679),l=r(c),h=n(659),f=r(h),d=n(650),p=r(d),g=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.o=e||{},this.canvas=f.default.initializeCanvas(void 0,1,1).canvas,this.targetCanvas=f.default.initializeCanvas(void 0,1,1).canvas,this.options={despeckleStrength:this.o.despeckleStrength||this.o.strength||1,quantizeStrength:this.o.quantizeStrength||this.o.strength||1,mergeStrength:this.o.mergeStrength||this.o.strength||1,overlapFactor:this.o.overlapFactor||this.o.strength||1}}return i(t,[{key:"updateFilters",value:function(t){this.filters=new l.default(this.options,this.tilesManager,t,this.finalWidth,this.finalHeight)}},{key:"computeSmartParameters",value:function(){var t,e,n,r,i,a,s,u;this.imageManager=new o.default(this.context),e=(t=this.imageManager.computePaletteData()).colorNumber,n=t.colorNumberCertainty,r=t.colorData,n>.25&&(this.options.quantizeStrength=e,a=(i=this.imageManager.analyzeImageForTileSize(r)).tileSize,s=i.certainty,u=Math.sqrt(this.tileWidth*this.tileHeight),console.log(s,a),4*a>u&&a<4*u&&(console.log("changeFinalCanvasParameters: "+(this.canvas.width/a|0)+"/"+(this.canvas.height/a|0)),this.changeFinalCanvasParameters(this.canvas.width/a|0,this.canvas.height/a|0)))}},{key:"updateTiles",value:function(){this.tilesManager=new u.default(this.context,this.targetContext,this.targetImageData,this.sizes),this.tilesManager.createTiles(),this.tilesManager.computeTiles()}},{key:"paintTiles",value:function(){this.tilesManager.paintTiles()}},{key:"filterTiles",value:function(){this.filters.applyFilters()}},{key:"setCanvas",value:function(t,e,n){var r,i;t=0|t||1,e=0|e||1,n=n||{width:0,height:0},r=f.default.initializeCanvas(n),this.canvas=r.canvas,this.context=r.context,i=f.default.initializeCanvas(void 0,t,e),this.targetCanvas=i.canvas,this.targetContext=i.context,this.targetImageData=this.targetContext.getImageData(0,0,t,e),this.finalWidth=t,this.finalHeight=e,this.tileWidth=Math.fround(this.canvas.width/this.targetCanvas.width),this.tileHeight=Math.fround(this.canvas.height/this.targetCanvas.height)}},{key:"changeFinalCanvasParameters",value:function(t,e){t=0|t||1,e=0|e||1;var n=f.default.initializeCanvas(void 0,t,e);this.targetCanvas=n.canvas,this.targetContext=n.context,this.targetImageData=this.targetContext.getImageData(0,0,t,e),this.finalWidth=t,this.finalHeight=e,this.tileWidth=Math.fround(this.canvas.width/this.targetCanvas.width),this.tileHeight=Math.fround(this.canvas.height/this.targetCanvas.height)}},{key:"updateThreshold",value:function(){var t,e,n,r,i,a=this,o=this.tilesManager.getTiles(),s=[];for(t=0;t<this.finalHeight;t++)for(e=function(e){var n=o[e+t*a.finalWidth];a.tilesManager.getExtendedNeighbors(e,t,1).forEach((function(t){s.push(p.default.colorDifference(n.meanColor,t.meanColor))}))},n=0;n<this.finalWidth;n++)e(n);return r=s.reduce((function(t,e){return t+e}),0)/s.length,i=Math.sqrt(s.map((function(t){return Math.pow(t-r,2)})).reduce((function(t,e){return t+e}))/s.length),(r+i)/25}},{key:"processImage",value:function(t,e,n){var r,i,a,o,s,u,c,l=Date.now();return this.setCanvas(e,n,t),t.width<=e&&t.height<=n?this.context:(r=Date.now(),this.computeSmartParameters(),i=Date.now(),this.updateTiles(),a=Date.now(),this.updateFilters(this.updateThreshold()),o=Date.now(),this.filterTiles(),s=Date.now(),this.paintTiles(),u=Date.now(),console.log({setCanvas:r-l,updateTilesManager:i-r,initializeTiles:a-i,"updateFilters+updateThreshold":o-a,filterTiles:s-o,paintTiles:u-o}),c=this.targetContext,this.reset(),c)}},{key:"reset",value:function(){var t=this;Array.of("targetContext","tileHeight","tileWidth","finalWidth","finalHeight","targetImageData","targetContext","targetCanvas","context","canvas","tilesManager","filters","imageManager").forEach((function(e){delete t[e]})),this.canvas=f.default.initializeCanvas(void 0,1,1).canvas,this.targetCanvas=f.default.initializeCanvas(void 0,1,1).canvas}},{key:"sizes",get:function(){return{finalWidth:this.finalWidth,finalHeight:this.finalHeight,tileWidth:this.tileWidth,tileHeight:this.tileHeight,overlapFactor:this.options.overlapFactor}}}]),t}(),e.default=g},677:function(t,e,n){"use strict";var r,i,a,o,s;Object.defineProperty(e,"__esModule",{value:!0}),r=function(){function t(t,e){var n,r;for(n=0;n<e.length;n++)(r=e[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=n(678),a=(s=i)&&s.__esModule?s:{default:s},o=function(){function t(e,n,r,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.contextSource=e,this.contextDestination=n,this.imageData=r,this.overlapFactor=i.overlapFactor,this.finalWidth=i.finalWidth,this.finalHeight=i.finalHeight,this.tileWidth=i.tileWidth,this.tileHeight=i.tileHeight,this.tiles=Array(this.finalWidth*this.finalHeight).fill(null),this.tilesColorUint32a=new Uint32Array(this.finalWidth*this.finalHeight),this.tilesColorUint8a=new Uint8ClampedArray(this.tilesColorUint32a.buffer),this.extendedTileWidth=this.tileWidth*this.overlapFactor|0,this.extendedTileHeight=this.tileHeight*this.overlapFactor|0,this.tilePaddingWidth=(this.extendedTileWidth-this.tileWidth)/2+1|0,this.tilePaddingHeight=(this.extendedTileHeight-this.tileHeight)/2+1|0}return r(t,[{key:"getTiles",value:function(){return this.tiles}},{key:"extractTileData",value:function(t,e){var n=Math.max(0,t*this.tileWidth-this.tilePaddingWidth|0),r=Math.max(0,e*this.tileHeight-this.tilePaddingHeight|0);return this.contextSource.getImageData(0|n,0|r,0|this.extendedTileWidth,0|this.extendedTileHeight)}},{key:"createTiles",value:function(){var t,e,n,r;for(t=0;t<this.finalHeight;t++)for(e=0;e<this.finalWidth;e++)r=4*(n=e+t*this.finalWidth),this.tiles[n]=new a.default(this.extractTileData(e,t),this.tilesColorUint8a.subarray(r,r+4),e,t)}},{key:"computeTiles",value:function(){for(var t=0;t<this.tiles.length;t++)this.tiles[t].calculateMeanColor()}},{key:"getExtendedNeighbors",value:function(t,e,n){var r,i,a,o,s=[];for(r=-n;r<=n;r++)for(i=-n;i<=n;i++)a=t+r,o=e+i,0===r&&0===i||a<0||o<0||a>=this.finalWidth||o>=this.finalHeight||s.push(this.tiles[a+o*this.finalWidth]);return s}},{key:"paintTiles",value:function(){this.imageData.data.set(this.tilesColorUint8a),this.contextDestination.putImageData(this.imageData,0,0)}}]),t}(),e.default=o},678:function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}var i,a,o,s,u,c;Object.defineProperty(e,"__esModule",{value:!0}),i=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n,r,i=[],a=!0,o=!1,s=void 0;try{for(n=t[Symbol.iterator]();!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(u){o=!0,s=u}finally{try{!a&&n.return&&n.return()}finally{if(o)throw s}}return i}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},a=function(){function t(t,e){var n,r;for(n=0;n<e.length;n++)(r=e[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(649),s=r(o),r(n(658)),u=n(652),c=function(){function t(e,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.imageData=e,this.meanColor=new s.default(n),this.coordinates=Uint16Array.of(i,a),r=this.imageData.data.length,this.k=r>=64?8:r>=16?6:r>=9?4:r>=2?3:1}return a(t,[{key:"extractColorData",value:function(t){var e,n=Array(t.length/4);for(e=0;e<t.length;e+=4)n[e/4]=t.subarray(e,e+4);return n}},{key:"quantizeColors",value:function(){var t,e=u.QuantiMat.split_image_data(this.imageData),n=i(e,2),r=n[0],a=n[1],o=(0,u.QuantiMat)({pxls:r,pxl_colors:a,number_of_color:Math.min(a.length,this.k),width:this.imageData.width,height:this.imageData.height}).init().run().output("split"),s=o[0],c=o[1],l=new Uint32Array(c.length);for(t=0;t<s.length;t++)l[c.indexOf(c[s[t]])]++;return[l,c]}},{key:"calculateMeanColor",value:function(){var t=this.quantizeColors(),e=i(t,2),n=e[0],r=e[1][n.indexOf(Math.max.apply(Math,function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(Array.from(n))))];this.meanColor.setUint32(r)}},{key:"x",get:function(){return this.coordinates[0]}},{key:"y",get:function(){return this.coordinates[1]}}]),t}(),e.default=c},679:function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}var i,a,o,s,u,c,l,h;Object.defineProperty(e,"__esModule",{value:!0}),i=function(){function t(t,e){var n,r;for(n=0;n<e.length;n++)(r=e[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=n(680),o=r(a),s=n(681),u=r(s),c=n(682),l=r(c),h=function(){function t(e,n,r,i,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.mergeFilter=new o.default(r*e.mergeStrength,n,i,a),this.despeckleFilter=new u.default(r*e.despeckleStrength,n,i,a),this.quantizeFilter=new l.default(e.quantizeStrength,n,i,a)}return i(t,[{key:"applyFilters",value:function(){this.quantizeFilter.apply()}}]),t}(),e.default=h},680:function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}var i,a,o,s,u;Object.defineProperty(e,"__esModule",{value:!0}),i=function(){function t(t,e){var n,r;for(n=0;n<e.length;n++)(r=e[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=r(n(653)),o=n(650),s=r(o),u=function(t){function e(t,n,r,i){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,r,i))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"apply",value:function(){var t,e,n,r=this,i=Array(this.width*this.height).fill(!1);for(t=0;t<this.height;t++)for(e=function(e){var n,a,o,u,c=e+t*r.width;if(i[c])return"continue";n=r.tiles[c],o=(a=r.tilesManager.getExtendedNeighbors(e,t,1)).length,(u=a.filter((function(t){return s.default.colorDifference(n.meanColor,t.meanColor)<r.strength}))).length>=o-2&&(u.forEach((function(t){t.meanColor.setRGBA(n.meanColor.rgba);var e=t.x+t.y*r.width;i[e]=!0})),i[c]=!0)},n=0;n<this.width;n++)e(n)}}]),e}(a.default),e.default=u},681:function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}var i,a,o,s,u,c,l,h,f;Object.defineProperty(e,"__esModule",{value:!0}),i=function(){function t(t,e){var n,r;for(n=0;n<e.length;n++)(r=e[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=r(n(653)),o=n(650),s=r(o),u=n(649),c=r(u),l=n(658),h=r(l),f=function(t){function e(t,n,r,i){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,r,i))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"apply",value:function(){var t,e;for(t=0;t<this.height;t++)for(e=0;e<this.width;e++)this.adaptiveDespeckleTile(e,t,this.strength)}},{key:"adaptiveDespeckleTile",value:function(t,e,n){var r,i,a,o,u,l,f,d,p=this.tiles[t+e*this.width].meanColor,g=this.tilesManager.getExtendedNeighbors(t,e,4),_=this.tilesManager.getExtendedNeighbors(t,e,1),y=g.length,v=g.map((function(t){return t.meanColor})),m=new h.default(v.map((function(t){return t.rgba})),4).run(y),w=(m.centroids,m.centroidsSorted);switch(m.clusters,this.determineClassification(w,y)){case"AREA":r=new c.default(w[0].data),(i=s.default.colorDifference(r,p))>0&&i<60&&p.setRGBA(r.rgba);break;case"EDGE":a=new c.default(w[0].data),o=new c.default(w[1].data),u=s.default.colorDifference(a,o),l=s.default.colorDifference(a,p),f=s.default.colorDifference(o,p),5*Math.abs(l-f)>=u&&(d=new c.default(new h.default(_.map((function(t){return t.meanColor.rgba})),4).run(4).centroidsSorted[0].data),p.setRGBA(d.rgba))}}},{key:"determineClassification",value:function(t,e){return t[0].count>=.75*e?"AREA":Math.abs(t[0].count-t[1].count)*Math.abs(t[2].count-t[3].count)<25?"SHAPE":Math.abs(t[0].count-t[1].count)<.75*Math.abs(t[1].count-t[2].count)?"EDGE":"COMPLEX"}}]),e}(a.default),e.default=f},682:function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}var i,a,o,s,u,c,l;Object.defineProperty(e,"__esModule",{value:!0}),i=function(){function t(t,e){var n,r;for(n=0;n<e.length;n++)(r=e[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=r(n(653)),o=n(657),s=r(o),u=n(659),c=r(u),l=function(t){function e(t,n,r,i){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,r,i))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"apply",value:function(){var t=this.strength,e=new ImageData(this.tilesManager.tilesColorUint8a,this.width,this.height),n=c.default.initializeCanvas(e).context,r=s.default.quantizeImageData(n,t).imageData;this.tilesManager.tilesColorUint8a.set(r.data)}}]),e}(a.default),e.default=l},689:function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}var i=r(n(732)),a=r(n(259));t.exports={UJS:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"COMPRESS_OBJECT";return new Promise((function(n,r){"COMPRESS_OBJECT"===e?n(new Uint8ClampedArray(i.default.compress(a.default.pack(t)).buffer)):"DECOMPRESS_UINT8A"===e&&n(a.default.unpack(i.default.uncompress(t)))}))}}},820:function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}var i=r(n(655)),a=r(n(155)),o=r(n(821));t.exports={base64png_to_xbrz_svg:function(t,e,r,s){var u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"xbrz",l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],h=arguments.length>7&&void 0!==arguments[7]&&arguments[7],f=arguments.length>8&&void 0!==arguments[8]&&arguments[8],d=new Image;d.onload=function(){var t,p,g,_,y,v,m,w,b,x,k=document.createElement("canvas"),O=k.getContext("2d"),M=d.width,E=d.height;k.width=M,k.height=E,O.drawImage(d,0,0,M,E),t=O.getImageData(0,0,M,E),p=function(t,e){return new Promise((function(e,r){(0,a.default)((function(){return n.e(3).then(n.t.bind(null,717,7))})).then((function(n){(0,n.crt)(t,1).then(e).catch(r)}))}))},g=function(t,e,r,o,s){l?(0,a.default)((function(){return n.e(1).then(n.t.bind(null,663,7))})).then((function(u){(0,u.oxi_png)(t,3,!1,i.default).then((function(t){s(t,e,r,o)})).catch((function(){(0,a.default)((function(){return n.e(0).then(n.t.bind(null,654,7))})).then((function(n){(0,n.png_quant)(t,100,100,1,i.default).then((function(t){s(t,e,r,o)})).catch((function(){s(t,e,r,o)}))})).catch((function(){s(t,e,r,o)}))}))})).catch((function(){s(t,e,r,o)})):s(t,e,r,o)},_=function(t,e){h?(0,a.default)((function(){return n.e(22).then(n.t.bind(null,937,7))})).then((function(o){(0,o.image_tracer)(t,{pal:u.map((function(t){return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16),a:parseInt(t.slice(7,9),16)}})),corsenabled:!1,ltres:e,qtres:e,pathomit:e,rightangleenhance:!1,colorsampling:2,numberofcolors:512,mincolorratio:0,colorquantcycles:1,layering:0,strokewidth:Math.ceil(e/2),linefilter:!0,scale:1,roundcoords:2,viewbox:!0,desc:!1,lcpr:0,qcpr:0,blurradius:e,blurdelta:4*e},i.default).then((function(t){l?(0,a.default)((function(){return n.e(2).then(n.bind(null,687))})).then((function(n){var i=n.optimize;t=i(t,{path:"path-to.svg",multipass:!0,mergePaths:!0,mergeStyles:!0,collapseGroups:!0,reusePaths:!0,plugin:["multipass","mergePaths","collapseGroups","reusePaths","mergeStyles"]}).data,r("data:image/svg+xml;base64,"+window.btoa(t),e)})):r("data:image/svg+xml;base64,"+window.btoa(t),e)}))})):r("",0)},"depixelize"===c?(v=(y=(0,o.default)(t,h))[0],m=y[1],(w=document.createElement("canvas")).width=v.width,w.height=v.height,(b=w.getContext("2d")).putImageData(v,0,0),x=b.canvas.toDataURL("image/png"),f&&p(v).then((function(t){var e,n=document.createElement("canvas");n.width=t.width,n.height=t.height,n.getContext("2d").putImageData(t,0,0),e=n.toDataURL("image/png"),g(e,10,t.width,t.height,s)})),h&&(l?(0,a.default)((function(){return n.e(2).then(n.bind(null,687))})).then((function(t){var e=t.optimize;m=e(m,{path:"path-to.svg",multipass:!0,plugin:["mergePaths"]}).data,r("data:image/svg+xml;base64,"+window.btoa(m),10)})):r("data:image/svg+xml;base64,"+window.btoa(m),10)),g(x,10,v.width,v.height,e)):"omniscale"===c?(0,a.default)((function(){return n.e(23).then(n.t.bind(null,938,7))})).then((function(n){(0,n.omniscale)(t,8,i.default).then((function(t){var n,r,i=document.createElement("canvas");i.width=t.width,i.height=t.height,(n=i.getContext("2d")).putImageData(t,0,0),r=n.canvas.toDataURL("image/png"),f&&p(t).then((function(t){var e,n=document.createElement("canvas");n.width=t.width,n.height=t.height,n.getContext("2d").putImageData(t,0,0),e=n.toDataURL("image/png"),g(e,8,t.width,t.height,s)})),_(t,8),g(r,8,t.width,t.height,e)}))})):"hexagon"===c?(0,a.default)((function(){return n.e(6).then(n.t.bind(null,718,7))})).then((function(n){(0,n.hexagonrender)(t,16).then((function(t){var n,r,i=document.createElement("canvas");i.width=t.width,i.height=t.height,(n=i.getContext("2d")).putImageData(t,0,0),r=n.canvas.toDataURL("image/png"),f&&p(t).then((function(t){var e,n=document.createElement("canvas");n.width=t.width,n.height=t.height,n.getContext("2d").putImageData(t,0,0),e=n.toDataURL("image/png"),g(e,16,t.width,t.height,s)})),_(t,32/6),g(r,32,t.width,t.height,e)}))})):"kikko"===c?(0,a.default)((function(){return n.e(41).then(n.t.bind(null,939,7))})).then((function(n){(0,n.kikkorender)(t,24,i.default).then((function(t){var n,r,i=document.createElement("canvas");i.width=t.width,i.height=t.height,(n=i.getContext("2d")).putImageData(t,0,0),r=n.canvas.toDataURL("image/png"),f&&p(t).then((function(t){var e,n=document.createElement("canvas");n.width=t.width,n.height=t.height,n.getContext("2d").putImageData(t,0,0),e=n.toDataURL("image/png"),g(e,24,t.width,t.height,s)})),_(t,6),g(r,48,t.width,t.height,e)}))})):"hqnx"===c?(0,a.default)((function(){return n.e(21).then(n.t.bind(null,940,7))})).then((function(n){(0,n.hqnx)(t,4,i.default).then((function(t){var n,r,i=document.createElement("canvas");i.width=t.width,i.height=t.height,(n=i.getContext("2d")).putImageData(t,0,0),r=n.canvas.toDataURL("image/png"),f&&p(t).then((function(t){var e,n=document.createElement("canvas");n.width=t.width,n.height=t.height,n.getContext("2d").putImageData(t,0,0),e=n.toDataURL("image/png"),g(e,4,t.width,t.height,s)})),_(t,4),g(r,4,t.width,t.height,e)}))})):"epx"===c?(0,a.default)((function(){return n.e(20).then(n.t.bind(null,941,7))})).then((function(n){(0,n.epx)(t,4,i.default).then((function(t){var n,r,i=document.createElement("canvas");i.width=t.width,i.height=t.height,(n=i.getContext("2d")).putImageData(t,0,0),r=n.canvas.toDataURL("image/png"),f&&p(t).then((function(t){var e,n=document.createElement("canvas");n.width=t.width,n.height=t.height,n.getContext("2d").putImageData(t,0,0),e=n.toDataURL("image/png"),g(e,4,t.width,t.height,s)})),_(t,4),g(r,4,t.width,t.height,e)}))})):(0,a.default)((function(){return n.e(4).then(n.t.bind(null,719,7))})).then((function(n){n.default(t,6,i.default).then((function(t){var n,r,i=document.createElement("canvas");i.width=t.width,i.height=t.height,(n=i.getContext("2d")).putImageData(t,0,0),r=n.canvas.toDataURL("image/png"),f&&p(t).then((function(t){var e,n=document.createElement("canvas");n.width=t.width,n.height=t.height,n.getContext("2d").putImageData(t,0,0),e=n.toDataURL("image/png"),g(e,6,t.width,t.height,s)})),_(t,6),g(r,6,t.width,t.height,e)}))}))},d.src=t}}},821:function(t,e,n){"use strict";function r(t){return r="function"==typeof Symbol&&"symbol"==v(Symbol.iterator)?function(t){return void 0===t?"undefined":v(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":void 0===t?"undefined":v(t)},r(t)}function i(){function t(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}function e(t,e,n,r){var i=e&&e.prototype instanceof a?e:a,o=Object.create(i.prototype),s=new p(r||[]);return w(o,"_invoke",{value:l(t,n,s)}),o}function n(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(r){return{type:"throw",arg:r}}}function a(){}function o(){}function s(){}function u(e){["next","throw","return"].forEach((function(n){t(e,n,(function(t){return this._invoke(n,t)}))}))}function c(t,e){function i(a,o,s,u){var c,l,h=n(t[a],t,o);if("throw"!==h.type)return(l=(c=h.arg).value)&&"object"==r(l)&&m.call(l,"__await")?e.resolve(l.__await).then((function(t){i("next",t,s,u)}),(function(t){i("throw",t,s,u)})):e.resolve(l).then((function(t){c.value=t,s(c)}),(function(t){return i("throw",t,s,u)}));u(h.arg)}var a;w(this,"_invoke",{value:function(t,n){function r(){return new e((function(e,r){i(t,n,e,r)}))}return a=a?a.then(r,r):r()}})}function l(t,e,r){var i="suspendedStart";return function(a,o){var s,u,c;if("executing"===i)throw Error("Generator is already running");if("completed"===i){if("throw"===a)throw o;return{value:void 0,done:!0}}for(r.method=a,r.arg=o;;){if((s=r.delegate)&&(u=h(s,r))){if(u===M)continue;return u}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===i)throw i="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);if(i="executing","normal"===(c=n(t,e,r)).type){if(i=r.done?"completed":"suspendedYield",c.arg===M)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i="completed",r.method="throw",r.arg=c.arg)}}}function h(t,e){var r,i,a=e.method,o=t.iterator[a];return void 0===o?(e.delegate=null,"throw"===a&&t.iterator.return&&(e.method="return",e.arg=void 0,h(t,e),"throw"===e.method)||"return"!==a&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+a+"' method")),M):"throw"===(r=n(o,t.iterator,e.arg)).type?(e.method="throw",e.arg=r.arg,e.delegate=null,M):(i=r.arg)?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,M):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,M)}function f(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function d(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function p(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(f,this),this.reset(!0)}function g(t){var e,n,r;if(t){if(e=t[x])return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return n=-1,(r=function e(){for(;++n<t.length;)if(m.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e}).next=r}return{next:_}}function _(){return{value:void 0,done:!0}}var y,v,m,w,b,x,k,O,M,E,P,C,j;i=function(){return y},y={},m=(v=Object.prototype).hasOwnProperty,w=Object.defineProperty||function(t,e,n){t[e]=n.value},b="function"==typeof Symbol?Symbol:{},x=b.iterator||"@@iterator",k=b.asyncIterator||"@@asyncIterator",O=b.toStringTag||"@@toStringTag";try{t({},"")}catch(D){t=function(t,e,n){return t[e]=n}}return y.wrap=e,M={},t(E={},x,(function(){return this})),(C=(P=Object.getPrototypeOf)&&P(P(g([]))))&&C!==v&&m.call(C,x)&&(E=C),j=s.prototype=a.prototype=Object.create(E),o.prototype=s,w(j,"constructor",{value:s,configurable:!0}),w(s,"constructor",{value:o,configurable:!0}),o.displayName=t(s,O,"GeneratorFunction"),y.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===o||"GeneratorFunction"===(e.displayName||e.name))},y.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,t(e,O,"GeneratorFunction")),e.prototype=Object.create(j),e},y.awrap=function(t){return{__await:t}},u(c.prototype),t(c.prototype,k,(function(){return this})),y.AsyncIterator=c,y.async=function(t,n,r,i,a){void 0===a&&(a=Promise);var o=new c(e(t,n,r,i),a);return y.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},u(j),t(j,O,"Generator"),t(j,x,(function(){return this})),t(j,"toString",(function(){return"[object Generator]"})),y.keys=function(t){var e,n=Object(t),r=[];for(e in n)r.push(e);return r.reverse(),function t(){for(;r.length;){var e=r.pop();if(e in n)return t.value=e,t.done=!1,t}return t.done=!0,t}},y.values=g,p.prototype={constructor:p,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(d),!t)for(var e in this)"t"===e.charAt(0)&&m.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){function e(e,r){return a.type="throw",a.arg=t,n.next=e,r&&(n.method="next",n.arg=void 0),!!r}var n,r,i,a,o,s;if(this.done)throw t;for(n=this,r=this.tryEntries.length-1;r>=0;--r){if(i=this.tryEntries[r],a=i.completion,"root"===i.tryLoc)return e("end");if(i.tryLoc<=this.prev)if(o=m.call(i,"catchLoc"),s=m.call(i,"finallyLoc"),o&&s){if(this.prev<i.catchLoc)return e(i.catchLoc,!0);if(this.prev<i.finallyLoc)return e(i.finallyLoc)}else if(o){if(this.prev<i.catchLoc)return e(i.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return e(i.finallyLoc)}}},abrupt:function(t,e){var n,r,i,a;for(n=this.tryEntries.length-1;n>=0;--n)if((r=this.tryEntries[n]).tryLoc<=this.prev&&m.call(r,"finallyLoc")&&this.prev<r.finallyLoc){i=r;break}return i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null),(a=i?i.completion:{}).type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,M):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),M},finish:function(t){var e,n;for(e=this.tryEntries.length-1;e>=0;--e)if((n=this.tryEntries[e]).finallyLoc===t)return this.complete(n.completion,n.afterLoc),d(n),M},catch:function(t){var e,n,r,i;for(e=this.tryEntries.length-1;e>=0;--e)if((n=this.tryEntries[e]).tryLoc===t)return"throw"===(r=n.completion).type&&(i=r.arg,d(n)),i;throw Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:g(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),M}},y}function a(t,e){var n,r,i,a,o,s="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!s){if(Array.isArray(t)||(s=f(t))||e&&t&&"number"==typeof t.length)return s&&(t=s),n=0,{s:r=function(){},n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return i=!0,a=!1,{s:function(){s=s.call(t)},n:function(){var t=s.next();return i=t.done,t},e:function(t){a=!0,o=t},f:function(){try{i||null==s.return||s.return()}finally{if(a)throw o}}}}function o(t){var e="function"==typeof Map?new Map:void 0;return o=function(t){function n(){return s(t,arguments,l(this).constructor)}if(null===t||(r=t,-1===Function.toString.call(r).indexOf("[native code]")))return t;var r;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),c(n,t)},o(t)}function s(t,e,n){return s=u()?Reflect.construct.bind():function(t,e,n){var r,i=[null];return i.push.apply(i,e),r=new(Function.bind.apply(t,i)),n&&c(r,n.prototype),r},s.apply(null,arguments)}function u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function c(t,e){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},c(t,e)}function l(t){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},l(t)}function h(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n,r,i,a,o,s,u,c=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=c){o=[],s=!0,u=!1;try{if(i=(c=c.call(t)).next,0===e){if(Object(c)!==c)return;s=!1}else for(;!(s=(n=i.call(c)).done)&&(o.push(n.value),o.length!==e);s=!0);}catch(l){u=!0,r=l}finally{try{if(!s&&null!=c.return&&(a=c.return(),Object(a)!==a))return}finally{if(u)throw r}}return o}}(t,e)||f(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(t,e){if(t){if("string"==typeof t)return d(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(t,e):void 0}}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function p(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function g(t,e){var n,i,a;for(n=0;n<e.length;n++)(i=e[n]).enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(a=function(t,e){var n,i;if("object"!==r(t)||null===t)return t;if(void 0!==(n=t[Symbol.toPrimitive])){if("object"!==r(i=n.call(t,"string")))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return t+""}(i.key),"symbol"===r(a)?a:a+""),i)}function _(t,e,n){return e&&g(t.prototype,e),n&&g(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function y(t){var e=t.length;return t.forEach((function(t,n,r){t.addEdge(r[(n+1)%e])})),t}var v,m,w;Object.defineProperty(e,"__esModule",{value:!0}),v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m=function(){function t(t,e,n){return[f(t,e,n),d(t,e,n),f(t,e+1,n),d(t,e,n+1)]}function e(t,e,n,r,i){var a,o=Array(i);for(a=0;a<i;++a)o[a]=t[a+n].slice(e,e+r);return o}function n(){this.vertices=[]}var s,f,d,g,y,v,m,w,b,x=function(){function t(e){var n,r=h(e,3),i=r[0],a=r[1],o=r[2];p(this,t),n=.299*i+.587*a+.114*o,this.y=Math.round(n),this.u=Math.round(.492*(o-n)),this.v=Math.round(.877*(i-n)),this.r=i,this.g=a,this.b=o,this.rgb=[i,a,o]}return _(t,[{key:"dissimilar",value:function(t){return Math.abs(this.r-t.r)+Math.abs(this.g-t.g)+Math.abs(this.b-t.b)>=1}},{key:"toString",value:function(){return"rgb("+this.rgb.join()+")"}}]),t}(),k=function(){function t(e,n){p(this,t),this.x=e,this.y=n,this.edges=[]}return _(t,[{key:"split",value:function(e){return new t((this.x+e.x)/2,(this.y+e.y)/2)}},{key:"adjust",value:function(t,e){return this.x+=t,this.y+=e,this}},{key:"clone",value:function(){return new t(this.x,this.y)}},{key:"equals",value:function(t){return this.x===t.x&&this.y===t.y}},{key:"addEdge",value:function(t){-1==this.edges.indexOf(t)&&(this.edges.push(t),t.addEdge(this))}}]),t}(),O=function(t){function e(t){var n;return p(this,e),(n=o.call(this,1))[0]=t,n.circular=!1,n}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&c(t,e)}(e,t);var n,i,o=(n=e,i=u(),function(){var t,e,a=l(n);return i?(e=l(this).constructor,t=Reflect.construct(a,arguments,e)):t=a.apply(this,arguments),function(t,e){if(e&&("object"===r(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});return _(e,[{key:"splitAt",value:function(t){var n,r,i,o,s;if(1!==this.length){if(this[0]===t)this.shift();else if(this[this.length-1]===t)this.pop();else if(this.circular)for(n=this.shift();n!==t;n=this.shift())this.push(n);else{r=this.indexOf(t),o=a(i=this.slice(r+1));try{for(o.s();!(s=o.n()).done;)s.value.curve=i}catch(u){o.e(u)}finally{o.f()}this.length=r}t.curve=new e(t)}}},{key:"merge",value:function(t){var e,n,r,i,a,o;if(this!==t)for(n=(e=h([this,t].sort((function(t,e){return t.length-e.length})),2))[0],-1!==(r=e[1])[0].edges.indexOf(n[0])?(i=this.shift,a=this.unshift):-1!==r[0].edges.indexOf(n[n.length-1])?(i=this.pop,a=this.unshift):-1!==r[r.length-1].edges.indexOf(n[0])?(i=this.shift,a=this.push):-1!==r[r.length-1].edges.indexOf(n[n.length-1])&&(i=this.pop,a=this.push);n.length;)o=i.call(n),a.call(r,o),o.curve=r;else this.circular=t.length>2}}],[{key:"curve",value:function(t,e){return t.curve===e.curve?t.curve.length:0}}]),e}(o(Array)),M=function(){function t(e,n,r,i){p(this,t),this.x=e,this.y=n,this.edges=[,,,,,,,,],this.vertices=i||[],this.color=r,this.marked=!1,this.curve=new O(this)}return _(t,[{key:"relativePosition",value:function(t){var e=t.x,n=t.y-this.y;return(e-this.x+3*n+8)%9}},{key:"invalidCurve",value:function(){return this.valence()>2&&this.curve.length>1}},{key:"updateCurves",value:function(){this.valence()>2&&this.curve.splitAt(this)}},{key:"equals",value:function(t){return this.x===t.x&&this.y===t.y}},{key:"removeEdge",value:function(e){t.removeEdge(this,e)}},{key:"canReach",value:function(t){return t&&!!this.edges[this.relativePosition(t)]}},{key:"valence",value:function(){return this.edges.filter((function(t){return t})).length}},{key:"toString",value:function(){return"("+[this.x,this.y].join()+") => "+this.edges.filter((function(t){return t})).map((function(t){return"("+[t.x,t.y].join()+")"})).join()}},{key:"edge",value:function(t,e){return this.edges[(t+3*e+8)%9]}},{key:"right",value:function(){return this.edges[0]}},{key:"left",value:function(){return this.edges[7]}},{key:"up",value:function(){return this.edges[5]}},{key:"down",value:function(){return this.edges[2]}},{key:"isEdge",value:function(){return this.edges.filter((function(t){return t})).length<4}},{key:"follow",value:i().mark((function t(e){var n,r,a;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=this;case 1:if(!(n.canReach(e)&&n.valence()<3)){t.next=14;break}return t.next=4,e;case 4:if(!(e.valence()>2)){t.next=6;break}return t.abrupt("break",14);case 6:if(r=e.edges.filter((function(t){return t})),a=r[0]!=n?r[0]:r[1],n=e,(e=a)!=this){t.next=12;break}return t.abrupt("break",14);case 12:t.next=1;break;case 14:case"end":return t.stop()}}),t,this)}))},{key:"square",value:function(){var t=h(this.edges,3),e=t[0],n=t[2],r=e&&n&&e.down()&&n.right();return[this,e,n,r].filter((function(t){return t}))}}],[{key:"addSimilarEdge",value:function(t,e){t.color&&e.color&&!t.color.dissimilar(e.color)&&(t.edges[t.relativePosition(e)]=e,e.edges[e.relativePosition(t)]=t,t.valence()>2&&t.curve.splitAt(t),e.valence()>2&&e.curve.splitAt(e),t.valence()<3&&e.valence()<3&&t.curve.merge(e.curve))}},{key:"removeEdge",value:function(t,e){t.edges[t.relativePosition(e)]=void 0,e.edges[e.relativePosition(t)]=void 0}}]),t}(),E=function(){function t(e,n,r){if(p(this,t),e.length!=n*r*4)throw Error("Wrong dimension of pixel buffer");this.width=n,this.height=r,this.pixels=e}return _(t,[{key:"create",value:i().mark((function t(){var e,n,r,a,o,s,u,c,l,h,f,d,p,g,_;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(e=this.width,n=this.height,r=Array(n),(a=Array(n+1))[0]=Array(e+1),o=0;o<e+1;++o)a[0][o]=new k(o,0);s=new M,u=Array(e).fill(s),o=0;case 9:if(!(o<n)){t.next=31;break}c=[s,s],l=r[o]=Array(e),h=a[o],(f=a[o+1]=Array(e+1))[0]=new k(0,o+1),d=0;case 16:if(!(d<e)){t.next=27;break}return f[d+1]=new k(d+1,o+1),p=[h[d],h[d+1],f[d+1],f[d]],g=l[d]=new M(d,o,this.pixel(d,o),p),_=[u[d],g],t.next=23,[c,_];case 23:c=_;case 24:++d,t.next=16;break;case 27:u=l;case 28:++o,t.next=9;break;case 31:this.nodes_old=r,this.vertices=r;case 33:case"end":return t.stop()}}),t,this)}))},{key:"createSimilarityGraph",value:function(){var t,e,n,r,i,o,s,u,c=a(this.create());try{for(c.s();!(t=c.n()).done;)e=h(t.value,2),r=(n=h(e[0],2))[0],i=n[1],s=(o=h(e[1],2))[0],u=o[1],M.addSimilarEdge(s,u),M.addSimilarEdge(i,u),4!==r.square().length&&(M.addSimilarEdge(s,i),M.addSimilarEdge(r,u))}catch(l){c.e(l)}finally{c.f()}return this}},{key:"graph",value:function(){this.height,this.width}},{key:"nodes",value:i().mark((function(){var t,e,n,r,a;return i().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:n=this.width,r=this.height,a=this.nodes_old,e=0;case 2:if(!(e<r)){i.next=13;break}t=0;case 4:if(!(t<n)){i.next=10;break}return i.next=7,a[e][t];case 7:++t,i.next=4;break;case 10:++e,i.next=2;break;case 13:case"end":return i.stop()}}),a,this)}))},{key:"diagonals",value:i().mark((function t(){var e,n,r,a,o,s,u,c,l,h,f;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:o=this.width,s=this.height,u=this.nodes_old,n=1;case 2:if(!(n<s)){t.next=22;break}r=u[n-1],a=u[n],e=1;case 6:if(!(e<o)){t.next=19;break}if(c=r[e-1],l=r[e],h=a[e-1],f=a[e],!(c.canReach(l)||c.canReach(h)||f.canReach(l)||f.canReach(h))){t.next=13;break}return t.abrupt("continue",16);case 13:if(!c.canReach(f)||!l.canReach(h)){t.next=16;break}return t.next=16,[[c,f],[h,l]];case 16:++e,t.next=6;break;case 19:++n,t.next=2;break;case 22:case"end":return t.stop()}}),t,this)}))},{key:"pixel",value:function(t,e){var n=e*this.width*4+4*t;return new x(this.pixels.subarray(n,n+3))}}]),t}();return E.diagonals=function(t){return t[0][0].canReach(t[0][1])+t[1][0].canReach(t[1][1])},f=(s=function(t,e){var n=t,r=e;return function(t,e,i){return[t[i][e],t[i+r][e+n]]}})(0,1),d=s(1,0),g=s(1,1),y=s(1,-1),E.prototype.getDiagonals=function(t,e){return[g(this.nodes_old,t,e),y(this.nodes_old,t,e+1)]},v=function(t){return t[0].canReach(t[1])},m=function(t){return!t},w=function(t,e,n,r){return function(i){var a,o;for(i=i[0].edges.filter((function(t){return t})),a=[];i.length>0;)o=i.pop(),-1==a.indexOf(o)&&o.x>t&&o.x<e&&o.y>n&&o.y<r&&(a.push(o),i=i.concat(o.edges.filter((function(t){return t}))));return a}},E.prototype.linearize=function(){var e,n,r,i,a,o,s,u,c;for(e=1;e<this.width;++e)for(n=1;n<this.height;++n)t(this.nodes_old,e-1,n-1).map(v).every(m)&&(i=[0,0],a=(r=this.getDiagonals(e-1,n-1)).map(w(e-3,e+2,n-3,n+2)),(s=(o=r.map((function(t){return O.curve(t[0],t[1])})))[0]-o[1])>0?i[0]+=s:i[1]-=s,(u=a[0].length-a[1].length)>0?i[1]+=u:i[0]-=u,(c=r.map((function(t){return 1==t[0].valence()||1==t[1].valence()})))[0]&&!c[1]?i[0]+=5:!c[0]&&c[1]&&(i[1]+=5),i[0]>i[1]?M.removeEdge(r[1][0],r[1][1]):i[0]<i[1]?M.removeEdge(r[0][0],r[0][1]):(M.removeEdge(r[0][0],r[0][1]),M.removeEdge(r[1][0],r[1][1])));return this},b=function(t){var e,n,r,i=t[0][1];i.edge(-1,1)&&(r=(n=(e=i.vertices)[3]).clone(),i.down()||n.adjust(.25,.25),i.left()||r.adjust(-.25,-.25),t[0][0].vertices[2]=r,e.splice(4,0,r),r=(e=t[1][0].vertices).splice(0,1,r).pop(),e.push(r)),i.edge(1,1)&&(r=(n=(e=i.vertices)[2]).clone(),i.down()||n.adjust(-.25,.25),i.right()||r.adjust(.25,-.25),t[0][2].vertices[3]=r,e.splice(2,0,r),r=(e=t[1][2].vertices).splice(0,1,r).pop(),e.push(r))},E.prototype.createVoronoiDiagram=function(){var t,n,r,i=this.width-2,a=this.height-1,o=this.nodes_old;for(t=0;t<a;++t){for((n=e(o,0,t,2,2))[0].unshift(new M),n[1].unshift(new M),b(n),r=0;r<i;++r)b(e(o,r,t,3,2));(n=e(o,r,t,2,2))[0].push(new M),n[1].push(new M),b(n)}return this},E.prototype.contour=function(t){var e,n,r,i,a,o,s,u,c,l,h=t,f=[];if(0===h.valence())return h.vertices.slice();if(h.marked||!h.isEdge()||[[-1,-1],[0,-1],[1,-1]].some((function(t){return null!=this.edge.apply(this,t)}),h))return f;for(n=[],r=1,i=0,h.vertices[0],o=null;;){switch(h.marked=!0,n.push(h),e=void 0,r){case 1:if(e=h.edge(1,-1)){r=7;break}case 2:if(e=h.edge(1,0)){r=0;break}case 3:if(e=h.edge(1,1)){r=1;break}case 4:if(e=h.edge(0,1)){r=2;break}case 5:if(e=h.edge(-1,1)){r=3;break}case 6:if(e=h.edge(-1,0)){r=4;break}case 7:if(e=h.edge(-1,-1)){r=5;break}case 0:r=(e=h.edge(0,-1))?6:1}if(e){for(s=i,u=h.vertices.length,o&&e.equals(o)&&(a=h.vertices[s++%u],f.push(a));;){if(a=h.vertices[s++%u],-1!=(c=e.vertices.indexOf(a))){i=c;break}f.push(a)}if(t.equals(e)&&t.edges.filter((function(t){return t})).every((function(t){return t.marked||!t.isEdge()}))){for(s=i,u=e.vertices.length;s<u;)a=e.vertices[s++],f.push(a);break}o=h,h=e}}for(;0!=n.length;)(l=n.pop().edges.filter((function(t){return t&&!t.marked}))).forEach((function(t){t.marked=!0})),n.push.apply(n,l);return f},n.prototype=Object.create(null,{push:{enumerable:!1,value:function(t){this.vertices.push(t),t.addPath(this)}},splitAt:{enumerable:!1,value:function(t){var e=new n;e.vertices=this.vertices.slice(t),this.vertices.length=t+1,e.vertices.forEach((function(t){t.removePath(this),t.addPath(e)}))}}}),E.prototype.paths=function(t){new n},function(t,e,n){return new E(t,e,n)}}(),w=function(t,e,n){var r,i=m(t.data,t.width,t.height);return i.createSimilarityGraph(),i.createVoronoiDiagram(),i.linearize(),r=function(t,e){var n,r,i,a,o,s,u,c=t.width,l=t.height,h=t.nodes(),f=[],d=!0,p=!1,g=void 0;try{for(n=h[Symbol.iterator]();!(d=(r=n.next()).done);d=!0){for(i=r.value,a="L",s=(o=y(i.vertices))[0],u=0;u<o.length;++u)s=o[u],a+=Math.ceil(s.x*e)+","+Math.ceil(s.y*e)+" ";f.push('<path fill="'+i.color+'" d="M'+Math.ceil(o[0].x*e)+","+Math.ceil(o[0].y*e)+" "+a+'Z"/>')}}catch(_){p=!0,g=_}finally{try{!d&&n.return&&n.return()}finally{if(p)throw g}}return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 '+c*e+" "+l*e+'">'+f.join("\n\t")+"</svg>"}(i,e),r},e.default=w},822:function(t,e,n){"use strict";var r=n(823);t.exports={loadJSON:function(t,e){var n=new XMLHttpRequest;try{n=new XMLHttpRequest}catch(r){try{n=new ActiveXObject("Msxml2.XMLHTTP")}catch(r){try{n=new ActiveXObject("Microsoft.XMLHTTP")}catch(r){e("Cannot load data",null)}}}n.open("GET",t,!0),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status)try{var t=JSON.parse(n.responseText);e(null,t)}catch(r){e("Cannot understand response from network.",null)}else 4==n.readyState&&404==n.status&&e("Error 404",null)};try{n.send()}catch(r){e("Failed to fetch",null)}},postJSON:function(t,e,n){var i,a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"application/x-www-form-urlencoded",s=new Headers;s.append("Content-Type",o),i="multipart/form-data"===o?new FormData:new URLSearchParams,Object.entries(e).forEach((function(t){var e=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n,r,i=[],a=!0,o=!1,s=void 0;try{for(n=t[Symbol.iterator]();!(a=(r=n.next()).done)&&(i.push(r.value),2!==i.length);a=!0);}catch(u){o=!0,s=u}finally{try{!a&&n.return&&n.return()}finally{if(o)throw s}}return i}(t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}(t),n=e[0],r=e[1];i.append(n,r)})),a={method:"POST",redirect:"follow",headers:s,body:"application/text"===o?e:"application/json"===o?(0,r.clean_json_text)(JSON.stringify(e)):i},fetch(t,a).then((function(t){return t.text()})).then((function(t){return n(null,t)})).catch((function(t){return n(t,null)}))},postDATA:function(t,e,n){var r=new XMLHttpRequest;try{r=new XMLHttpRequest}catch(i){try{r=new ActiveXObject("Msxml2.XMLHTTP")}catch(i){try{r=new ActiveXObject("Microsoft.XMLHTTP")}catch(i){return void n("Cannot load data",null)}}}r.open("POST",t,!0),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){if(4==r.readyState&&200==r.status)try{var t=JSON.parse(r.responseText);n(null,t)}catch(i){n("Cannot understand response from network.",null)}else 4==r.readyState&&404==r.status&&n("Error 404",null)};try{r.send(e)}catch(i){n("Failed to post",null)}}}},823:function(t,e,n){"use strict";t.exports={clean_json_text:function(t){return(t=t.replace(/\\n/g,"\\n").replace(/\\'/g,"\\'").replace(/\\"/g,'\\"').replace(/\\&/g,"\\&").replace(/\\r/g,"\\r").replace(/\\t/g,"\\t").replace(/\\b/g,"\\b").replace(/\\f/g,"\\f")).replace(/[\u0000-\u0019]+/g,"")}}}}]);