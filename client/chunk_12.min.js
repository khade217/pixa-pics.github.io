/*! For license information please see chunk_12.min.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{599:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var n,o,r,s,l,_,c,d,u,h,p,f,m,g,w,y,b,v,x,k,E,C,S,I,M,D,T,O,P,A,z,j,N,L,R,U,F,q,B,H,W,$,X,G,K,Y,V,J,Q,Z,ee,te,ae,ie,ne,oe,re,se,le,_e,ce,de,ue,he,pe,fe,me,ge,we,ye,be,ve,xe,ke,Ee,Ce,Se,Ie,Me,De,Te,Oe,Pe,Ae,ze,je,Ne,Le,Re,Ue,Fe,qe,Be,He,We,$e,Xe,Ge,Ke,Ye,Ve,Je,Qe,Ze,et,tt,at,it,nt,ot,rt,st,lt,_t,ct,dt,ut,ht,pt,ft,mt,gt,wt,yt,bt,vt,xt,kt,Et,Ct,St,It,Mt,Dt,Tt,Ot,Pt,At,zt;Object.defineProperty(t,"__esModule",{value:!0}),n=Object.assign||function(e){var t,a,i;for(t=1;t<arguments.length;t++)for(i in a=arguments[t])Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i]);return e},o=a(690),r=i(o),s=a(691),l=a(155),_=i(l),c=a(0),d=i(c),u=a(259),h=i(u),p=a(281),f=i(p),m=a(77),g=i(m),w=a(54),y=i(w),b=i(a(52)),v=a(657),x=i(v),k=a(112),E=i(k),C=a(53),S=i(C),I=a(89),M=i(I),D=a(258),T=i(D),O=a(161),P=i(O),A=a(166),z=i(A),j=a(165),N=i(j),L=a(164),R=i(L),U=a(156),F=i(U),q=a(260),B=i(q),H=a(111),W=i(H),$=a(110),X=i($),G=a(692),K=i(G),Y=a(78),V=a(72),J=i(V),Q=a(694),Z=i(Q),ee=a(744),te=i(ee),ae=a(420),ie=i(ae),ne=a(745),oe=i(ne),re=a(417),se=i(re),le=a(746),_e=i(le),ce=a(815),de=i(ce),ue=a(159),he=i(ue),pe=a(709),fe=i(pe),me=a(711),ge=i(me),we=a(710),ye=i(we),be=a(705),ve=i(be),xe=a(703),ke=i(xe),Ee=a(702),Ce=i(Ee),Se=a(707),Ie=i(Se),Me=a(415),De=i(Me),Te=a(817),Oe=i(Te),Pe=a(708),Ae=i(Pe),ze=a(673),je=i(ze),Ne=a(701),Le=i(Ne),Re=a(699),Ue=i(Re),Fe=a(700),qe=i(Fe),Be=a(818),He=i(Be),We=a(706),$e=i(We),Xe=a(704),Ge=i(Xe),Ke=a(819),Ye=i(Ke),Ve=a(820),Je=i(Ve),Qe=a(422),Ze=i(Qe),et=a(821),tt=i(et),at=a(822),it=a(676),nt=a(824),ot=a(826),rt=i(ot),st=a(827),lt=i(st),_t=a(828),ct=i(_t),dt=a(698),ut=i(dt),ht=a(829),pt=i(ht),ft=a(830),mt=i(ft),gt=a(831),wt=i(gt),yt=a(667),bt=a(685),vt=i(bt),xt=a(662),kt=i(xt),Et=a(154),Ct=a(832),St=i(Ct),It=a(833),Mt=i(It),Dt=a(834),Tt=i(Dt),Ot=a(647),Pt=a(712),At=i(Pt),window.mobileAndTabletCheck=function(){let e=!1;var t;return t=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0),e};let jt=window.mobileAndTabletCheck();const Nt=d.default.lazy((()=>Promise.all([a.e(16),a.e(17)]).then(a.t.bind(null,923,7)))),{Color:Lt}=(0,Ot.SIMDopeCreate)({create:{new_of:!0,new_hex:!0},properties:{hsla:!0,hex:!0,rgb:!0}});class Rt extends d.default.PureComponent{constructor(e){super(e),zt.call(this),this.st4te={classes:e.classes,load_with:e.load_with+"",_history:Y.HISTORY,_perspective:!1,_library_dialog_open:!1,_library:{},_library_type:"open",_view_name_index:1,_handle_wheel_timestamp:Date.now(),_view_name_sub_index:0,_previous_view_name_index:1,_view_names:["palette","image","layers","tools","selection","effects","filters"],_canvas:null,_loading:!1,_loading_process:"",_can_undo:0,_can_redo:0,_current_color:"#ffffffff",_second_color:"#000000ff",_pxl_current_opacity:1,_width:32,_height:32,_import_size:"192",_import_colorize:"0",_hue:360,_slider_value:.25,_slider_value_width:192,_slider_value_height:96,_game_ended:!1,_tool:jt?"MOVE":"PENCIL",_memory_tool:jt?"MOVE":"PENCIL",_previous_tool_timestamp:1/0,_select_mode:"REPLACE",_pencil_mirror_mode:"NONE",_filters:[],_x:-1,_y:-1,_drag_file:!1,_is_something_selected:!1,_hide_canvas_content:!1,_show_original_image_in_background:!1,_show_transparent_image_in_background:!0,_is_image_import_mode:!1,_layers:[],_layer_index:0,_previous_layer_index:0,_mine_player_direction:"UP",_is_edit_drawer_open:!1,_kb:0,_saved_at:Date.now(),_fps:0,_prev_fps:0,_menu_mouse_y:null,_menu_mouse_x:null,_menu_data:{},_menu_event:null,_ripple:null,_ripple_color:"#ffffffff",_ripple_opacity:1,_is_pixel_dialog_post_edit_open:!1,_is_dialog_info_open:!1,_base64_url:"",_logged_account:{},_less_than_1280w:!1,_is_pixel_dialog_create_open:!1,_attachment_previews:{},_swipeable_drawer_handle_filters_thumbnail_change:function(){},_swipeable_drawer_set_props:function(){},_toolbox_container_ref:{},_files_waiting_download:[],_time_ago_initiated:!1,_fps_el:{},_xy_el:{},_settings:h.default.unpack(e.settings)},this.sraf=Object.create(At.default).init()}setSt4te(e,t){let a=Object.keys(e),i=0|a.length,n="";for(let o=0;(0|o)<(0|i);o=(o+1|0)>>>0)n=a[o],this.st4te[n]=e[n];"function"==typeof t&&t()}componentWillMount(){J.default.trigger_loading_update(0),J.default.trigger_page_render_complete(),setTimeout((()=>{J.default.trigger_loading_update(100)}),300)}componentDidMount(){J.default.trigger_snackbar("Awesome buddy! Welcome back to the laboratory.",3500),(0,Et.l)(null,(()=>{this._compute_menu_drawer(),this.setSt4te({_time_ago_initiated:!0})}),!0),setTimeout((()=>{this.st4te._is_pixel_dialog_create_open&&(J.default.trigger_snackbar("Right here! Let's upload a picture now to create a new artwork.",6e3),setTimeout((()=>{this.st4te._is_pixel_dialog_create_open&&(J.default.trigger_snackbar("By the way, ...",1e3),setTimeout((()=>{this.st4te._is_pixel_dialog_create_open&&(J.default.trigger_snackbar("Huh, let me take my breath! ...",1500),setTimeout((()=>{this.st4te._is_pixel_dialog_create_open&&J.default.trigger_snackbar("You can set the size of your artwork before uploading your picture.",1e4)}),3e3))}),1500))}),8500))}),9e3),J.default.jamy_update("happy"),window.addEventListener("resize",this._updated_dimensions),window.addEventListener("wheel",this._prevent_ctrl_zoom,{passive:!1}),document.addEventListener("keydown",this._handle_keydown),document.addEventListener("keyup",this._handle_keyup);try{document.getElementById("tabs-desktop").addEventListener("wheel",this._handle_wheel,{passive:!1})}catch(e){}f.default.register(this._handle_events.bind(this)),this.setSt4te({_h_svg:(0,yt.createLocalBlob)((0,kt.default)(d.default.createElement(vt.default,{color:"#e5e5e5"}))),_h_svg_size:"100px 115px"}),(0,_.default)((()=>a.e(39).then(a.t.bind(null,938,7)))).then((e=>{this.setSt4te({_library:e})})),this._set_saved_at_element(),this._try_load_with_payload(this.st4te.load_with),setTimeout((()=>{this._request_force_update(!1,!0).then((()=>{this._updated_dimensions()}))}),1e3)}componentWillReceiveProps(e){e.load_with!==this.st4te.load_with?this.setSt4te(n({_settings:h.default.unpack(e.settings)},e),(()=>{this._compute_menu_drawer(),this._request_force_update().then((()=>{this._try_load_with_payload(this.st4te.load_with)}))})):this.setSt4te(n({_settings:h.default.unpack(e.settings)},e))}_handle_events(e){if("TRIGGER_CANVAS_ACTION"===e.type)switch(e.data.name.toUpperCase()){case"CONTRAST":this._to_auto_medium_more_contrast();break;case"SATURATION":this._to_auto_medium_more_saturation();break;case"PALETTE":this._less_colors_auto();break;case"SMOOTH":this._smooth_adjust();break;case"FILTER":this._handle_edit_drawer_open(null,6);break;case"RENDER":this._handle_edit_drawer_open(null,1),setTimeout((()=>{this._handle_edit_drawer_open(null,1),setTimeout((()=>{this._handle_edit_drawer_open(null,1)}),100)}),100)}}componentWillUnmount(){this._backup_state(),J.default.stop_sound(),window.removeEventListener("resize",this._updated_dimensions),window.removeEventListener("wheel",this._prevent_ctrl_zoom);try{document.getElementById("tabs-desktop").removeEventListener("wheel",this._handle_wheel,{passive:!1})}catch(e){}document.removeEventListener("keydown",this._handle_keydown),document.removeEventListener("keyup",this._handle_keyup),clearInterval(this.st4te._saved_at_interval)}render(){const{classes:e,_canvas:t,_loading:a,_loading_process:i,_is_image_import_mode:n,_hide_canvas_content:o,_show_original_image_in_background:s,_show_transparent_image_in_background:l,_can_undo:_,_can_redo:u,_current_color:h,_slider_value:p,_tool:f,_import_size:m,_hue:w,_select_mode:b,_pencil_mirror_mode:v,_kb:x,_mine_player_direction:k,_menu_data:E,_ripple_color:C,_ripple_opacity:S,_library_dialog_open:I,_library:D,_is_pixel_dialog_create_open:T,_h_svg:O,_h_svg_size:P,_attachment_previews:A,_perspective:z,_files_waiting_download:j,_time_ago_initiated:N,_settings:L,_text_dialog_open:R,_drag_file:U}=this.st4te;return E.pos_x=-1===E.pos_x?"out":E.pos_x,E.pos_y=-1===E.pos_y?"out":E.pos_y,d.default.createElement("div",{style:{height:"100%",position:"relative",pointerEvents:"none",userSelect:"none"},ref:this._set_root_ref},d.default.createElement("div",{className:e.root},d.default.createElement("div",{className:e.contentInner,style:{backgroundColor:"#f7f7f7",backgroundImage:`url("${O}")`,backgroundRepeat:"repeat",backgroundSize:P,textRendering:"optimizespeed",imageRendering:"optimizespeed"}},d.default.createElement(c.Suspense,{fallback:d.default.createElement("div",{className:e.contentCanvas})},d.default.createElement(Nt,{set_compressor:this._set_png_compressors,perspective:z?2:0,on_state_export:this._handle_canvas_state_will_export,on_state_exported:this._handle_canvas_state_exported,on_fps_change:this._handle_fps_change,export_state_every_ms:jt?3e5:21e4,shadow_size:jt?0:1.5,key:"canvas",className:e.contentCanvas,ref:this._set_canvas_ref,tool:f,canvas_wrapper_padding:8,hide_canvas_content:o,show_original_image_in_background:s&&!0,show_transparent_image_in_background:l,select_mode:b,pencil_mirror_mode:v,hue:w,bucket_threshold:p,color_loss:p,pxl_current_opacity:1,onLoadComplete:this._handle_load_complete,onLoad:this._handle_load,onCanUndoRedoChange:this._handle_can_undo_redo_change,onSizeChange:this._handle_size_change,onCurrentColorChange:this._handle_current_color_change,onSomethingSelectedChange:this._handle_something_selected_change,onImageImportModeChange:this._handle_image_import_mode_change,onPositionChange:this._handle_position_change,onLayersChange:this._handle_layers_change,onFiltersThumbnailChange:this._handle_filters_thumbnail_change,onGameEnd:this._handle_game_end,onRelevantActionEvent:this._handle_relevant_action_event,setCursorFuckYou:this._set_cursor_fuck_you,onRightClick:this._handle_right_click,mine_player_direction:k,pxl_current_color:h,convert_scale:1,default_size:m,ideal_size:m,max_size:1.5*m,fast_drawing:!0,px_per_px:1})),this.drawer_desktop,this.menu)),d.default.createElement("div",{style:{pointerEvents:"all"}},d.default.createElement(y.default,{className:e.perspectiveButton,color:"primary",size:"small",onClick:this._toggle_perspective},z?d.default.createElement(Je.default,null):d.default.createElement(Ye.default,null)),d.default.createElement(g.default,{className:e.saveButton,variant:"text",color:"primary",onClick:this._backup_state},d.default.createElement("span",{id:"saved_at"},"?")," ",d.default.createElement(He.default,null)," ",x<.5?"?":Math.round(10*x)/10," kB"),d.default.createElement(g.default,{disabled:!n,className:e.confirmImportButton,color:"primary",size:"small",onClick:()=>{n?t.confirm_import():this._import_image_library()}},d.default.createElement(r.default,null)," ",n?"OK":"Import"),d.default.createElement(y.default,{className:e.zoomOutButton,color:"primary",size:"small",onClick:()=>{t.zoom_out()}},d.default.createElement(Mt.default,null)),d.default.createElement(y.default,{className:e.zoomInButton,color:"primary",size:"small",onClick:()=>{t.zoom_in()}},d.default.createElement(St.default,null)),d.default.createElement(g.default,{disabled:!u,variant:"text",color:"primary",size:"small",className:e.redoButton,onClick:e=>{this._redo()}},(-u||"")+" Redo"," ",d.default.createElement(Oe.default,{style:{transition:"ease-out 225ms transform 25m",transform:`rotate(+${360*u+90}deg)`}})),d.default.createElement(g.default,{disabled:!_,variant:"text",color:"primary",size:"small",className:e.undoButton,onClick:e=>{this._undo()}},d.default.createElement(Oe.default,{style:{transition:"ease-out 225ms transform 25ms",transform:`rotate(-${360*_+90}deg)`}}),(+_||"")+" Undo")),this.drawer_mobile,d.default.createElement(tt.default,{keepMounted:!1,open:!!I,object:D,onClose:this._close_library,onSelectImage:this._from_library}),d.default.createElement(Tt.default,{keepMounted:!1,open:!!R,onClose:this._close_text,onSuccess:this._draw_text}),d.default.createElement(de.default,{keepMounted:!1,theme_day:L._theme_day,open:!!T,pixel_arts:N?A:{},size:m,on_import_size_change:this._set_import_size,on_pixel_art_delete:this._delete_unsaved_pixel_art,import_JSON_state:this._handle_import_json_state_id,on_upload:this._handle_file_upload,onClose:this._handle_pixel_dialog_create_close}),d.default.createElement("div",{style:{position:"absolute",width:"100%",height:"100%",top:0,left:0,contain:"paint size style layout",visibility:"auto"}},d.default.createElement(K.default,{className:e.ripple,ref:this._set_ripple_ref,center:!1,style:{color:C,opacity:S,position:"fixed",width:"100%",height:"100%"}}),d.default.createElement(M.default,{style:{pointerEvents:"all",cursor:"pointer"},onDrag:this._handle_file_upload,className:e.backdrop,open:!!(a||j.length>0||U+1e3>Date.now())},d.default.createElement("div",{className:e.backdropTextContent,style:{fontFamily:'"Industry Book"',textTransform:"uppercase"},onClick:this._continue_download},!U&&!!(a||j.length>0)&&d.default.createElement("h1",null,d.default.createElement(Ze.default,{key:i||a,text:"browser"===i?"Laboratory in DANGER!":"LABORATORY PROCESSING",animation_delay_ms:0,animation_duration_ms:200})),!U&&j.length>0&&d.default.createElement("h3",null,d.default.createElement(Ze.default,{key:j[0].name,text:"ACTION REQUIRED... "+j[0].name,animation_delay_ms:300,animation_duration_ms:500})),!U&&j.length>0&&d.default.createElement("div",null,d.default.createElement("img",{src:"/src/images/labostration/DOWNLOAD.svg",className:e.imageBackdrop})),!U&&j.length>0&&d.default.createElement("h4",null,d.default.createElement(Ze.default,{pre:"[... ",app:" ...]",style:{textShadow:"0px 0px 16px white"},text:"CLICK ON THE SCREEN TO CONTINUE DOWNLOAD!",animation_delay_ms:jt?5e3:2500,animation_duration_ms:500})),!U&&0===j.length&&a&&"browser"===i&&d.default.createElement("h3",null,d.default.createElement(Ze.default,{text:"Doesn't feel like home for our dear code here.",animation_delay_ms:300,animation_duration_ms:500})),!U&&0===j.length&&a&&"browser"===i&&d.default.createElement("h4",null,d.default.createElement(Ze.default,{pre:"[... ",app:" ...]",text:"It can take a while, please download an advanced browser.",animation_delay_ms:jt?5e3:2500,animation_duration_ms:500})),!U&&0===j.length&&a&&"image_ai"===i&&d.default.createElement("h3",null,d.default.createElement(Ze.default,{text:"AI processing your image",animation_delay_ms:300,animation_duration_ms:500})),U&&d.default.createElement("div",null,d.default.createElement("img",{src:"/src/images/labostration/ABDUCTION.svg",className:e.imageBackdrop})),U&&d.default.createElement("h4",null,d.default.createElement(Ze.default,{pre:"[... ",app:" ...]",text:"Drop the file to the UFO.",animation_delay_ms:jt?5e3:2500,animation_duration_ms:500})),U&&d.default.createElement("h3",null,d.default.createElement(Ze.default,{text:"Ready for a new image abduction?",animation_delay_ms:300,animation_duration_ms:500})),!U&&0===j.length&&a&&"image_ai"===i&&d.default.createElement("div",null,d.default.createElement("img",{src:"/src/images/labostration/MOLECULE.svg",className:e.imageBackdrop})),!U&&0===j.length&&a&&"image_ai"===i&&d.default.createElement("h4",null,d.default.createElement(Ze.default,{pre:"[... ",app:" ...]",text:"It can take a while, please wait ~10sec.",animation_delay_ms:jt?5e3:2500,animation_duration_ms:500})),!U&&0===j.length&&a&&"image_preload"===i&&d.default.createElement("h3",null,d.default.createElement(Ze.default,{text:"Preparing laboratory",animation_delay_ms:300,animation_duration_ms:500})),!U&&0===j.length&&a&&"image_preload"===i&&d.default.createElement("div",null,d.default.createElement("img",{src:"/src/images/labostration/SCIENCE.svg",className:e.imageBackdrop})),!U&&0===j.length&&a&&"image_preload"===i&&d.default.createElement("h4",null,d.default.createElement(Ze.default,{pre:"[... ",app:" ...]",text:`It can take a while, please wait ~${parseInt(3*parseFloat(m/100))*(jt?3:1)}sec.`,animation_delay_ms:jt?5e3:2500,animation_duration_ms:500})),!U&&0===j.length&&a&&"image_load"===i&&d.default.createElement("h3",null,d.default.createElement(Ze.default,{text:"Abducting your image",animation_delay_ms:300,animation_duration_ms:500})),!U&&0===j.length&&a&&"image_load"===i&&d.default.createElement("div",null,d.default.createElement("img",{src:"/src/images/labostration/ABDUCTION.svg",className:e.imageBackdrop})),!U&&0===j.length&&a&&"image_load"===i&&d.default.createElement("h4",null,d.default.createElement(Ze.default,{pre:"[... ",app:" ...]",text:`It can take a while, please wait ~${parseInt(4*parseFloat(m/100))*(jt?3:1)}sec.`,animation_delay_ms:jt?5e3:2500,animation_duration_ms:500})),!U&&0===j.length&&a&&"image_render"===i&&d.default.createElement("div",null,d.default.createElement("img",{src:"/src/images/labostration/COMPUTING.svg",className:e.imageBackdrop})),!U&&0===j.length&&a&&"image_render"===i&&d.default.createElement("h3",null,d.default.createElement(Ze.default,{text:"Atomic rendering in process",animation_delay_ms:300,animation_duration_ms:500})),!U&&0===j.length&&a&&"image_render"===i&&d.default.createElement("h4",null,d.default.createElement(Ze.default,{pre:"[... ",app:" ...]",text:"It can take a while, please wait ~14sec.",animation_delay_ms:jt?5e3:2500,animation_duration_ms:500})),!U&&0===j.length&&a&&"less_color"===i&&d.default.createElement("h3",null,d.default.createElement(Ze.default,{text:"Coupling few color DNA",animation_delay_ms:300,animation_duration_ms:500})),!U&&0===j.length&&a&&"less_color"===i&&d.default.createElement("div",null,d.default.createElement("img",{src:"/src/images/labostration/GENOMA.svg",className:e.imageBackdrop})),!U&&0===j.length&&a&&"less_color"===i&&d.default.createElement("h4",null,d.default.createElement(Ze.default,{pre:"[... ",app:" ...]",text:"It can take a while, please wait ~4sec.",animation_delay_ms:jt?5e3:2500,animation_duration_ms:500})),!U&&0===j.length&&a&&"less_color_auto"===i&&d.default.createElement("h3",null,d.default.createElement(Ze.default,{text:"Coupling the DNA of many color",animation_delay_ms:500,animation_duration_ms:500})),!U&&0===j.length&&a&&"less_color_auto"===i&&d.default.createElement("div",null,d.default.createElement("img",{src:"/src/images/labostration/GENOMA.svg",className:e.imageBackdrop})),!U&&0===j.length&&a&&"less_color_auto"===i&&d.default.createElement("h4",null,d.default.createElement(Ze.default,{pre:"[... ",app:" ...]",text:"It can take a while, please wait ~7sec.",animation_delay_ms:jt?5e3:2500,animation_duration_ms:500}))))))}}zt=function(){this._request_force_update=(e,t)=>(e=void 0===e||e,t=void 0!==t&&t,this.sraf.run_frame((()=>new Promise(((e,t)=>{this.forceUpdate(e)}))),!e,!t,Date.now(),"page_pixel").catch((()=>this._request_force_update(e,t)))),this._set_fps_and_xy_elements=()=>{setTimeout((()=>{this.st4te._less_than_1280w?this.setSt4te({_fps_el:{},_xy_el:{}}):this.setSt4te({_fps_el:document.getElementById("fps_el")||{},_xy_el:document.getElementById("xy_el")||{}})}),1e3)},this._prevent_ctrl_zoom=e=>{e.ctrlKey&&e.preventDefault()},this._set_saved_at_element=()=>{this.st4te._saved_at_el||this.setSt4te({_saved_at_el:document.getElementById("saved_at")},(()=>{let e=setInterval((()=>{this.st4te._saved_at_el.innerText=(0,Et.t)(this.st4te._saved_at||Date.now(),{mini:!0})}),1e3);this.setSt4te({_saved_at_interval:e})}))},this._try_load_with_payload=e=>{if(0===e.length)he.default.get_settings(this._process_settings_info_result),setTimeout((()=>{this.setSt4te({_is_pixel_dialog_create_open:!(0!==e.length)},(()=>{this._compute_menu_drawer(),this._request_force_update()}))}),725);else{const t=e.startsWith("data:image/png;base64,")?"image/png":"image/jpeg",{_import_size:i}=this.st4te;this._handle_load("image_preload"),(0,it.base64_to_bitmap)(e,(e=>{J.default.trigger_voice("data_upload");const n=jt?960:1440;let o=jt?512:1024;const r=parseInt(n*n),s=Math.min(parseInt(262144),Math.max(parseInt(i*i),parseInt(o*o))),l=Math.min(parseInt(262144),parseInt(i*i));(0,it.bitmap_to_imagedata)(e,r,(e=>{(0,_.default)((()=>Promise.resolve().then(a.t.bind(null,654,7)))).then((({QuantiMatGlobal:a})=>{(0,it.imagedata_to_base64)(e,t,(e=>{(0,it.base64_to_bitmap)(e,(t=>{(0,it.bitmap_to_imagedata)(t,s,(t=>{a(t,256).then((([t,a,i,n,o,r])=>{null===t?(window.dispatchEvent(new Event("art-upload-browsererror")),this._handle_load_complete("image_preload",{}),this._handle_load("browser"),J.default.trigger_sfx("alert_high-intensity",.6),J.default.jamy_update("flirty"),J.default.trigger_snackbar("That's our end my little buddy! My instinctive dwelling require a browser I am supporting.",6e3),setTimeout((()=>{J.default.trigger_sfx("alert_high-intensity",.7),J.default.jamy_update("sad"),J.default.trigger_snackbar("Abandon, misfortune, sadness... I can't live in this strange place.",7e3),setTimeout((()=>{J.default.trigger_sfx("alert_high-intensity",.8),J.default.jamy_update("suspicious"),J.default.trigger_snackbar("Ho no! I just can't, but someone needs to give me back my usual laboratory environment!",7e3),setTimeout((()=>{J.default.trigger_sfx("alert_high-intensity",.9),J.default.jamy_update("shocked"),J.default.trigger_snackbar("Yes my enjoyable smartness, gladly you hear me now! Everything gonna be alright to look at me!",9e3),setTimeout((()=>{J.default.jamy_update("happy"),J.default.trigger_sfx("alert_high-intensity",1),setTimeout((()=>{J.default.trigger_sfx("alert_high-intensity",1)}),750)}),4e3)}),8e3)}),8e3)}),7e3)):(setTimeout((function(){J.default.trigger_snackbar(`I am really awesome, within ${parseFloat(r/1e3).toFixed(3)}sec. I've made disappears ${n} colors, now there are ${o} colors!`,5700),setTimeout((function(){J.default.jamy_update("happy")}),2e3)}),15e3),(0,it.imagedata_to_base64)(t,"image/png",(t=>{(0,it.base64_to_bitmap)(t,(t=>{(0,it.bitmap_to_imagedata)(t,l,(t=>{(0,it.imagedata_to_base64)(t,"image/png",(t=>{let a=new Image;a.addEventListener("load",(()=>{this._handle_load_complete("image_preload",{}),this.setSt4te({_kb:0,_saved_at:1/0}),this.st4te._canvas.set_canvas_from_image(a,e,{},!1)}),{once:!0,capture:!0}),a.src=t}))}))}))}),x.default))}),x.default)}))}),x.default)}),x.default)})).catch((e=>{this._handle_load_complete("image_preload",{}),J.default.trigger_snackbar("Be sure to have a recent browser or install Google Chrome for using it.",5700),J.default.jamy_update("angry")}))}))}),x.default)}},this._handle_canvas_state_will_export=()=>{J.default.trigger_loading_update(0),J.default.jamy_update("suspicious"),J.default.trigger_snackbar("Ok buddy! Saving yours.",1500),window.onbeforeunload=function(e){return"Your content that was being saved will be lost."}},this._handle_canvas_state_exported=e=>{if(J.default.trigger_loading_update(75),J.default.jamy_update("flirty"),J.default.trigger_snackbar("Hold on! Compressing...",1e3),e.kb>.5){let t={};t["json_state-ID"+e.id+".json.lz"]=e,this.setSt4te({_kb:e.kb,_saved_at:Date.now()},(()=>{this._compute_menu_drawer(),this._request_force_update(),he.default.set_settings({},((e,t)=>{e&&(J.default.trigger_loading_update(100),J.default.trigger_snackbar("Looks like I can't save your file as our compression module can't load.",5700),J.default.jamy_update("angry"))}),t,s.UJS,x.default,((e,t)=>{J.default.trigger_loading_update(100),e?(window.onbeforeunload=function(e){},J.default.trigger_snackbar("Laboratory artwork failed to save.",2e3),J.default.jamy_update("sad")):(window.onbeforeunload=function(e){},setTimeout((()=>{setTimeout((()=>{J.default.jamy_update("happy")}),500),J.default.trigger_snackbar("Success! Laboratory's artwork saved!",2e3)}),1e3))}))}))}else J.default.trigger_loading_update(100),window.onbeforeunload=function(e){},setTimeout((()=>{J.default.trigger_snackbar("Huh, we don't store nearly empty file up here, buddy.",2e3)}),2e3)},this._handle_import_json_state_id=e=>{(0,_.default)((()=>Promise.resolve().then(a.t.bind(null,691,7)))).then((({UJS:t})=>{this._handle_load("image_preload"),J.default.trigger_voice("accessing_memory"),he.default.get_settings((()=>{}),["json_state-ID"+e+".json.lz"],this._process_settings_attachment_result,t,x.default)})).catch((()=>{J.default.trigger_snackbar("Looks like I can't get your file as our compression module can't load.",5700),J.default.jamy_update("angry")}))},this._delete_unsaved_pixel_art=e=>{const t={};t["json_state-ID"+e+".json.lz"]="delete",he.default.set_settings({},this._process_settings_info_result,t,null,null,((t,a)=>{if(t)J.default.trigger_snackbar("DELETION, Failed!",2e3);else{J.default.trigger_snackbar("DELETION, Successful!",2e3),J.default.trigger_sfx("alert_high-intensity");let t=Object.assign({},this.st4te._attachment_previews);delete t["json_state-ID"+e+".json.lz"],this.setSt4te({_attachment_previews:t},(()=>{this._request_force_update()}))}}))},this._updated_dimensions=()=>{let e=document.documentElement,t=document.body||document.getElementsByTagName("body")[0],a=window.innerWidth||e.clientWidth||t.clientWidth;window.innerHeight||e.clientHeight||t.clientHeight;const i=!!(a<1280);this.setSt4te({_less_than_1280w:i},(()=>{this._compute_menu_drawer(),this._compute_menu_drawer(),this._request_force_update(!1,!1).then((()=>{this._set_fps_and_xy_elements()}))}))},this._handle_wheel=e=>{const t=e.deltaY;if(this.st4te._handle_wheel_timestamp+150<Date.now()){let e=0===t?0:t>0?1:-1,a=this.st4te._view_name_index+e|0;a<0?a=this.st4te._view_name_index=this.st4te._view_names.length-1|0:a%=this.st4te._view_names.length+1|0,this._handle_view_name_change(a,this.st4te._view_name_index,(()=>{this.setSt4te({_handle_wheel_timestamp:Date.now()})}))}},this._handle_menu_close=()=>{this.setSt4te({_menu_mouse_x:null,_menu_mouse_y:null},(()=>{this._compute_menu_right_click(),this._request_force_update()}))},this._handle_right_click=(e,t)=>{t.pxl_color=this.st4te._canvas.get_pixel_color_from_pos(t.pos_x,t.pos_y),this.setSt4te({_menu_mouse_x:e.clientX-2,_menu_mouse_y:e.clientY-4,_menu_data:t,_menu_event:e},(()=>{this._compute_menu_right_click(),this._request_force_update()}))},this._set_cursor_fuck_you=e=>{J.default.jamy_update("happy",2500)},this._process_settings_info_result=(e,t)=>{if(!e&&void 0!==t){const e=void 0!==t.attachment_previews?t.attachment_previews:{};this.setSt4te({_attachment_previews:e},(()=>{this._request_force_update()}))}},this._process_settings_attachment_result=(e,t)=>{const{import_JS_state:a}=this.st4te._canvas;this._handle_load_complete("image_preload",{}),e?(J.default.trigger_snackbar("Looks like I can't get your file as something was erroneous.",5700),J.default.jamy_update("angry"),this._handle_pixel_dialog_create_open()):(this.setSt4te({_kb:t.kb,_saved_at:Date.now()},(()=>{this._request_force_update()})),a(t,(()=>{this.setSt4te({_is_pixel_dialog_create_open:!1,_attachment_previews:{}},(()=>{this._request_force_update()}))})))},this._handle_view_name_change=(e,t=null,a=function(){})=>{const{_view_names:i,_toolbox_container_ref:o}=this.st4te;t=null===t?this.st4te._view_name_index:t;const r=i[e]||i[0],s=-1===i.indexOf(r)?0:i.indexOf(r);t>s?J.default.trigger_sfx("navigation_transition-left"):t<s&&J.default.trigger_sfx("navigation_transition-right"),o.scrollTop=0,this.setSt4te(n({},{_view_name_sub_index:0},{_previous_view_name_index:t||this.st4te._view_name_index,_view_name_index:s}),(()=>{this._set_props_bypass_this(),this._compute_menu_drawer(),this._request_force_update(),a()}))},this._handle_view_name_switch=(e,t,a=null)=>{if("mouse"===e.pointerType&&0===e.button||"mouse"!==e.pointerType){const{_view_names:e,_toolbox_container_ref:i}=this.st4te;a=null===a?this.st4te._view_name_index:a;const o=e[t]||e[0],r=-1===e.indexOf(o)?0:e.indexOf(o);a>r?J.default.trigger_sfx("navigation_transition-left"):J.default.trigger_sfx("navigation_transition-right");let s={};a!==r&&(s._view_name_sub_index=0,i.scrollTop=0),this.setSt4te(n({},s,{_previous_view_name_index:a||this.st4te._view_name_index,_view_name_index:r}),(()=>{this._set_props_bypass_this(),this._compute_menu_drawer(),this._request_force_update()}))}},this._handle_keydown=e=>{const{_tool:t,_view_name_index:a,_view_names:i,_is_pixel_dialog_post_edit_open:n}=this.st4te;if(e&&!n){if(e.preventDefault(),e.stopPropagation(),"MINE"===t)switch(e.preventDefault(),e.keyCode){case 38:this.setSt4te({_mine_player_direction:"UP"});break;case 40:this.setSt4te({_mine_player_direction:"DOWN"});break;case 37:this.setSt4te({_mine_player_direction:"LEFT"});break;case 39:this.setSt4te({_mine_player_direction:"RIGHT"})}else switch(e.keyCode){case 37:this._handle_view_name_change(a-1<0?i.length-1:a-1);break;case 39:this._handle_view_name_change(a+1>i.length-1?0:a+1);break;case 38:this._scroll_to_drawer(-1);break;case 40:this._scroll_to_drawer(1)}if("1"===e.key)this._handle_view_name_change(0);else if("2"===e.key)this._handle_view_name_change(1);else if("3"===e.key)this._handle_view_name_change(2);else if("4"===e.key)this._handle_view_name_change(3);else if("5"===e.key)this._handle_view_name_change(4);else if("6"===e.key)this._handle_view_name_change(5);else if("7"===e.key)this._handle_view_name_change(6);else if(e.ctrlKey&&"z"===e.key)this._undo();else if(e.ctrlKey&&"y"===e.key)this._redo();else if(e.ctrlKey&&"m"===e.key)this._set_tool("MINE");else if(e.ctrlKey&&"o"===e.key)this._upload_image();else if(e.ctrlKey&&"i"===e.key)this._handle_file_import();else if(e.ctrlKey||"o"!==e.key)if(e.ctrlKey||"b"!==e.key)if(e.ctrlKey||"h"!==e.key)if(e.ctrlKey||"x"!==e.key)if(e.ctrlKey||"u"!==e.key)if(e.ctrlKey||"r"!==e.key)if(e.ctrlKey&&"r"===e.key)this._set_tool("SELECT RECTANGLE");else if(e.ctrlKey||"e"!==e.key)if(e.ctrlKey&&"e"===e.key)this._set_tool("SELECT ELLIPSE");else if(e.ctrlKey||"l"!==e.key)if(e.ctrlKey&&"l"===e.key)this._set_tool("SELECT LINE");else if(e.ctrlKey||"p"!==e.key)if(e.ctrlKey||"n"!==e.key)if(e.ctrlKey&&"p"===e.key)this._set_tool("SELECT PIXEL");else if(e.ctrlKey&&"n"===e.key)this._set_tool("SELECT PENCIL PERFECT");else if(e.ctrlKey||"m"!==e.key)if(e.ctrlKey||"f"!==e.key)if(e.ctrlKey&&"f"===e.key)this._set_tool("SELECT PATH");else if(e.ctrlKey&&"k"===e.key)this._set_tool("SELECT COLOR THRESHOLD");else if(e.ctrlKey&&"g"===e.key)this._set_tool("SELECT COLOR");else if(e.ctrlKey&&"q"===e.key)this._download_image(1);else if(e.ctrlKey&&"s"===e.key)this._download_image(32);else if("Enter"===e.key){const{confirm_import:e}=this.st4te._canvas;e()}else e.ctrlKey?t.includes("SELECT")?(this.setSt4te({_previous_tool_timestamp:Date.now()}),this._set_select_mode("REMOVE")):(this.setSt4te({_previous_tool_timestamp:Date.now()}),this._set_tool("PICKER",!1)):"Shift"===e.key&&(t.includes("SELECT")?(this.setSt4te({_previous_tool_timestamp:Date.now()}),this._set_select_mode("ADD")):(this.setSt4te({_previous_tool_timestamp:Date.now()}),this._set_tool("MOVE",!1)));else this._set_tool("CONTOUR");else this._set_tool("SET PENCIL MIRROR");else this._set_tool("PENCIL PERFECT");else this._set_tool("PENCIL");else this._set_tool("LINE");else this._set_tool("ELLIPSE");else this._set_tool("RECTANGLE");else this._set_tool("BORDER");else this._set_tool("EXCHANGE");else this._set_tool("HUE BUCKET");else this._set_tool("BUCKET");else this._set_tool("PICKER")}},this._undo=()=>{(100*Math.random()|0)>90&&J.default.trigger_snackbar("That was a nice undo!"),this.st4te._canvas.undo()},this._redo=()=>{(100*Math.random()|0)>95&&(J.default.jamy_update("suspicious"),J.default.trigger_snackbar("Even nicer redo! Doo,doo,doo...",2500),setTimeout((()=>{J.default.jamy_update("annoyed"),J.default.trigger_snackbar("Did I already said that today? I won't feel much smarter today.",3500),setTimeout((()=>{J.default.jamy_update("shocked"),J.default.trigger_snackbar("No, huh!? I have feelings.",2500),setTimeout((()=>{J.default.jamy_update("flirty"),J.default.trigger_snackbar("I am a real booooy! Yuhhh!")}),3e3)}),4e3)}),3e3)),this.st4te._canvas.redo()},this._set_png_compressors=()=>{const{set_png_compressors:e}=this.st4te._canvas;(0,_.default)((()=>a.e(0).then(a.t.bind(null,656,7)))).then((({png_quant:t})=>{(0,_.default)((()=>a.e(1).then(a.t.bind(null,665,7)))).then((({oxi_png:a})=>{e(t,a)}))}))},this._backup_state=()=>{const{export_state:e,set_png_compressors:t}=this.st4te._canvas;(0,_.default)((()=>a.e(0).then(a.t.bind(null,656,7)))).then((({png_quant:i})=>{(0,_.default)((()=>a.e(1).then(a.t.bind(null,665,7)))).then((({oxi_png:a})=>{t(i,a),e()}))}))},this._download_image=e=>{const{get_base64_png_data_url:t,xxhashthat:i,set_png_compressors:n}=this.st4te._canvas;window.dispatchEvent(new Event("art-download-raster"+e)),void 0!==t&&void 0!==i&&void 0!==n&&(0,_.default)((()=>a.e(0).then(a.t.bind(null,656,7)))).then((({png_quant:o})=>{(0,_.default)((()=>a.e(1).then(a.t.bind(null,665,7)))).then((({oxi_png:a})=>{n(o,a),t(e,!1,1,100,100).then((({url:t})=>{const a=i(t);let n=document.createElement("a");n.download=`PIXAPICS-${a}-PIXELATED-${e}x_RAS.png`,n.href=t,n.click(),n.remove(),this._propose_selling_nft()}))}))}))},this._download_svg=(e="xbrz",t=!1,i=!1,n=!1,o=!1)=>{const{get_base64_png_data_url:r,set_png_compressors:s,xxhashthat:l}=this.st4te._canvas;window.dispatchEvent(new Event("art-download-vector"+e.toLowerCase())),J.default.trigger_voice("please_wait"),J.default.trigger_snackbar("Please wait... Files will download in a few seconds.",5700),J.default.jamy_update("happy"),this.setSt4te({_loading:!0,_loading_process:"image_render"},(()=>{(0,_.default)((()=>a.e(0).then(a.t.bind(null,656,7)))).then((({png_quant:c})=>{(0,_.default)((()=>a.e(1).then(a.t.bind(null,665,7)))).then((({oxi_png:a})=>{s(c,a),r(1,!0,1,100,100).then((({url:a,colors:r})=>{const s=l(a);let{_files_waiting_download:_}=this.st4te;_.push({name:`PIXAPICS-${s}-PIXELATED-1x_RAS.png`,url:a}),this.setSt4te({_files_waiting_download:_},(()=>{this._request_force_update()})),J.default.trigger_voice("processing"),(0,at.base64png_to_xbrz_svg)(a,((t,a,i,n)=>{let{_files_waiting_download:r}=this.st4te;r.push({name:`PIXAPICS-${s}-${e.toUpperCase()}-${a}x_RAS.png`,url:""+t}),this.setSt4te({_files_waiting_download:r},(()=>{this._request_force_update(),o?(0,nt.postJSON)("https://real-life-image.pixa-pics.workers.dev/init",""+t,((e,t)=>{t&&(0,nt.postJSON)("https://real-life-image.pixa-pics.workers.dev/get",""+t,((e,t)=>{t&&t.split(" ").forEach((e=>{fetch(e).then((e=>{e.blob().then(((e,t)=>{new Promise((function(t,a){var i=new FileReader;i.onload=function(){t(i.result)},i.onerror=function(){var a=URL.createObjectURL(e);t(a)},i.readAsDataURL(e)})).then((e=>{r.push({name:`PIXAPICS-${s}-PHOTO-REAL-BIG+AI_RAS-#${t}.jpg`,url:""+e}),this.setSt4te({_files_waiting_download:r},this._request_force_update)}))}))}))}))}),"application/text")}),"application/text"):(J.default.trigger_snackbar("Looks like we had an unexpected issue",5700),J.default.jamy_update("angry"))}))}),((t,a)=>{if(t.length>0){let{_files_waiting_download:i}=this.st4te;i.push({name:`PIXAPICS-${s}-${e.toUpperCase()}-${a}x_VEC.svg`,url:t}),this.setSt4te({_files_waiting_download:i},(()=>{this._request_force_update()}))}this.setSt4te({_loading:!1,_loading_process:""},(()=>{this._propose_selling_nft()}))}),((t,a)=>{if(t.length>0){let{_files_waiting_download:i}=this.st4te;i.push({name:`PIXAPICS-${s}-${e.toUpperCase()}-${a}+CRT.png`,url:t}),this.setSt4te({_files_waiting_download:i},(()=>{this._request_force_update()}))}}),Array.from(r),e,!!t,!!i,!!n)}))}))}))}))},this._propose_selling_nft=()=>{J.default.trigger_voice("complete"),J.default.trigger_sfx("hero_decorative-celebration-02"),J.default.trigger_snackbar("Fantastic!",1500),setTimeout((()=>{J.default.trigger_share(),window.dispatchEvent(new Event("home-action-tryshare")),setTimeout((()=>{J.default.trigger_sfx("alert_high-intensity"),J.default.trigger_snackbar("Your unique and stunning pixel art can now be turned into a valuable digital asset through the power of blockchain technology.",7e3),setTimeout((()=>{J.default.trigger_sfx("hero_decorative-celebration-02"),J.default.trigger_snackbar("Sell your pixel art as an NFT on your favourite platform and become a part of the growing NFT community.",9e3)}),8e3)}),2e3)}),2e3)},this._continue_download=()=>{let{_files_waiting_download:e}=this.st4te;if(e.length>0){let t=e.shift(),a=document.createElement("a");a.download=""+t.name,a.href=""+t.url,a.click(),delete t.url,delete t.name,a.remove(),this.setSt4te({_files_waiting_download:e},(()=>{this._request_force_update()}))}},this._handle_keyup=e=>{const{_is_pixel_dialog_post_edit_open:t}=this.st4te;if(e&&!t){e.preventDefault(),e.stopPropagation();const{_tool:t,_memory_tool:a,_previous_tool_timestamp:i}=this.st4te;a&&a!==t&&Date.now()-1e4<i?(this.setSt4te({_previous_tool_timestamp:1/0}),this._set_tool(a)):i<Date.now()&&t.includes("SELECT")&&(this.setSt4te({_previous_tool_timestamp:1/0}),this._set_select_mode("REPLACE"))}},this._upload_image=e=>{this._handle_file_upload(e)},this._upload_image_library=()=>{this.setSt4te({_library_dialog_open:!0,_library_type:"open"},(()=>{this._request_force_update()}))},this._close_library=()=>{this.setSt4te({_library_dialog_open:!1},(()=>{this._request_force_update()}))},this._from_library=e=>{const{_library_type:t}=this.st4te,{set_canvas_from_image:a,import_image_on_canvas:i}=this.st4te._canvas;let n=new Image;n.src=e,n.onload=()=>{"open"===t?(this.setSt4te({_kb:0,_saved_at:1/0},(()=>{this._request_force_update()})),a(n)):"import"===t&&i(n,e),this._close_library()}},this._handle_file_upload=e=>{"dataTransfer"in e&&e.dataTransfer.files.length>0&&(e.preventDefault(),e.stopPropagation()),this.st4te._drag_file&&this.setSt4te({_drag_file:0},(()=>{this._request_force_update()}));const t=(e.target||{}).files||(e.srcElement||{}).files||(e.currentTarget||{}).files||((e.path||[])[0]||{}).files||(e.dataTransfer||{}).files||[],a=t[0]||null;let i=null;for(let n=0;n<t.length;n++)i=t[n],i.type.startsWith("image/")&&(n=t.length);if(null===i&&null===a)J.default.trigger_snackbar("Looks like I can't get your file as something is erroneous.",5700),J.default.jamy_update("angry");else if(null!==i){const e="image/png"===i.type?"image/png":i.type,{_import_colorize:t,_import_size:a}=this.st4te,{set_canvas_from_image:n}=this.st4te._canvas,o=jt?623.5382907247958:881.8163074019441,r=512,s=parseInt(o*o),l=Math.min(parseInt(r*r),parseInt(a*a));let _=1;this._handle_load("image_preload"),J.default.trigger_voice("data_upload"),(0,it.file_to_imagedata_resized)(i,s,(t=>{(0,it.imagedata_to_base64)(t,e,(e=>{for(;Math.round(t.width*_)*Math.round(t.height*_)>l;)_-=.01;(0,it.base64_sanitize)(e,(t=>{(0,it.base64_to_bitmap)(t,(t=>{(0,it.bitmap_to_imagedata)(t,t.width*t.height|0,(t=>{(0,it.imagedata_to_base64)(t,"image/png",(t=>{let a=new Image;a.addEventListener("load",(()=>{this._handle_load_complete("image_preload",{}),this.setSt4te({_kb:0,_saved_at:1/0}),n(a,e,{},!1),setTimeout((function(){J.default.trigger_snackbar("I am really awesome, here is your pixel art!",5700),setTimeout((function(){J.default.jamy_update("happy")}),2e3)}),1e3)}),{once:!0,capture:!0}),a.src=t}),x.default)}),x.default)}),x.default)}),null,_,"doppel")}),x.default)}),x.default)}},this._handle_file_import=e=>{const t=(e.target||{}).files||(e.srcElement||{}).files||(e.currentTarget||{}).files||((e.path||[])[0]||{}).files||[];t[0];let a=null;for(let i=0;i<t.length;i++){const e=t[i];e.type.startsWith("image/")&&(a=e)}if(null!==a){let e=new Image;const{import_image_on_canvas:t}=this.st4te._canvas;(0,it.file_to_base64)(a,(a=>{e.onload=()=>{t(e,a),this._handle_menu_close()},e.src=a}),x.default)}},this._import_image_library=()=>{this.setSt4te({_library_dialog_open:!0,_library_type:"import"},(()=>{this._request_force_update()}))},this._handle_load=e=>{J.default.trigger_loading_update(0),this.setSt4te({_loading:!0,_loading_process:e},(()=>{this._request_force_update()})),"image_preload"===e&&(this._handle_edit_drawer_close(),this._handle_menu_close(),this._handle_pixel_dialog_create_close())},this._handle_load_complete=(e,t)=>{J.default.trigger_loading_update(100),this.setSt4te({_loading:!1,_loading_process:e},(()=>{this._request_force_update().then((()=>{this.st4te._saved_at>Date.now()-60&&this._backup_state(),this._updated_dimensions()}))})),"less_color"===e||"less_color_auto"===e?0!==t.colors_removed&&(J.default.trigger_snackbar(`I am a magician! And ${t.colors_removed} colors are now gone, only ${t.colors_remaining} remaining.`),J.default.trigger_sfx("navigation_selection-complete-celebration"),J.default.jamy_update("happy")):"image_load"===e&&(t.only_scan?J.default.trigger_sfx("ui_scan"):(J.default.trigger_sfx("ui_scan"),J.default.trigger_snackbar(`DONE! We've imported an image with my now ${t.number_of_colors} colors.`),setTimeout((()=>{J.default.trigger_voice("complete")}),1e3),J.default.jamy_update("happy"),this._handle_edit_drawer_close(),this._handle_menu_close(),this._handle_pixel_dialog_create_close()))},this._set_ripple_ref=e=>{null!=e&&this.setSt4te({_ripple:e})},this._set_canvas_ref=e=>{null!=e&&this.setSt4te({_canvas:e,_filters:e.get_filter_names()},(()=>{this._request_force_update()}))},this._handle_position_change=e=>{if(void 0!==this.st4te._xy_el){let t=-1===e.x?"out":e.x+1,a=-1===e.y?"out":e.y+1;this.st4te._xy_el.textContent=` | X: ${t}, Y: ${a} `}},this._handle_fps_change=e=>{void 0!==this.st4te._fps_el&&(this.st4te._fps_el.textContent="FPS: "+e)},this._handle_can_undo_redo_change=(e,t)=>{e=parseInt(e),t=parseInt(t);const a=!(this.st4te._can_undo===e&&this.st4te._can_redo===t);this.setSt4te({_can_undo:e,_can_redo:t},(()=>{a&&this._request_force_update()}))},this._handle_size_change=(e,t)=>{const a=!(this.st4te._width===e&&this.st4te._height===t);this.setSt4te({_width:e,_height:t},(()=>{a&&(this._compute_menu_drawer(),this._request_force_update())}))},this._handle_current_color_change=(e,t)=>{e=void 0!==e.rgb?Lt.new_of(e.rgb.r,e.rgb.g,e.rgb.b,Math.round(parseInt(255*e.rgb.a))).hex:Lt.new_hex(e).hex;const a=Lt.new_hex(e).hsla[0];this.setSt4te({_current_color:e,_hue:a})},this._handle_relevant_action_event=(e,t="#ffffff",a=0)=>{const i=this.st4te._ripple;e&&i&&(J.default.trigger_sfx("navigation_selection-complete-celebration"),0!==a&&this.setSt4te({_ripple_color:t,_ripple_opacity:a},(function(){setTimeout((function(){i.start(e)}),25),setTimeout((function(){i.stop(e)}),200)})))},this._handle_something_selected_change=e=>{const t=!(this.st4te._is_something_selected===e);this.setSt4te({_is_something_selected:e},(()=>{t&&(this._compute_menu_right_click(),this._request_force_update())}))},this._set_value_from_slider_with_update=(e,t)=>{this.setSt4te({_slider_value:t||e.target.value},(()=>{this._set_props_bypass_this()}))},this._set_width_from_slider=(e,t)=>{this.setSt4te({_slider_value_width:t||e.target.value},(()=>{this._set_props_bypass_this()}))},this._set_height_from_slider=(e,t)=>{this.setSt4te({_slider_value_height:t||e.target.value},(()=>{this._set_props_bypass_this()}))},this._set_import_size=(e,t)=>{this.setSt4te({_import_size:t||e.target.value})},this._set_import_colorize=(e,t)=>{this.setSt4te({_import_colorize:t||e.target.value})},this._revert_tool=()=>{this.setSt4te({_tool:this.st4te._memory_tool})},this._set_tool=(e,t=!0)=>{this.setSt4te({_tool:e.toUpperCase()},(()=>{this._set_props_bypass_this()})),t&&this.setSt4te({_memory_tool:e.toUpperCase()})},this._set_select_mode=e=>{this.setSt4te({_select_mode:e.toUpperCase()},(()=>{this._set_props_bypass_this()}))},this._set_pencil_mirror_mode=e=>{this.setSt4te({_pencil_mirror_mode:e.toUpperCase()},(()=>{this._set_props_bypass_this()}))},this._switch_with_second_color=()=>{const{_current_color:e,_second_color:t}=this.st4te;this.setSt4te({_current_color:t,_second_color:e},(()=>{this._set_props_bypass_this()}))},this._show_hide_canvas_content=()=>{this.setSt4te({_hide_canvas_content:!this.st4te._hide_canvas_content},(()=>{this._set_props_bypass_this(),this.forceUpdate()}))},this._show_hide_background_image=()=>{this.setSt4te({_show_original_image_in_background:!this.st4te._show_original_image_in_background},(()=>{this._set_props_bypass_this()}))},this._show_hide_transparent_image=()=>{this.setSt4te({_show_transparent_image_in_background:!this.st4te._show_transparent_image_in_background},(()=>{this._set_props_bypass_this()}))},this._handle_image_import_mode_change=e=>{this.setSt4te({_is_image_import_mode:e},(()=>{this._set_props_bypass_this(),this._request_force_update()}))},this._handle_layers_change=(e,t)=>{this.setSt4te({_previous_layer_index:parseInt(this.st4te._layer_index),_layer_index:parseInt(e),_layers:t},(()=>{this._set_props_bypass_this()}))},this._handle_filters_thumbnail_change=(e,t,a)=>{this.st4te._swipeable_drawer_handle_filters_thumbnail_change(e,t,a)},this._set_filters_callback=e=>{this.setSt4te({_swipeable_drawer_handle_filters_thumbnail_change:e})},this._set_props_callback=e=>{this.setSt4te({_swipeable_drawer_set_props:e},(()=>{this._set_props_bypass_this(),this._request_force_update()}))},this._set_props_bypass_this=()=>{const{_view_name_index:e,_previous_view_name_index:t,_layers:a,_layer_index:i,_hide_canvas_content:n,_show_original_image_in_background:o,_show_transparent_image_in_background:r,_hue:s,_current_color:l,_second_color:_,_slider_value:c,_tool:d,_width:u,_height:h,_filters:p,_select_mode:f,_pencil_mirror_mode:m,_is_something_selected:g,_is_image_import_mode:w,_import_size:y,_import_colorize:b,_slider_value_width:v,_slider_value_height:x}=this.st4te;this.st4te._canvas&&this.st4te._canvas._set_props({tool:d,hide_canvas_content:n,show_original_image_in_background:o&&!0,show_transparent_image_in_background:r,select_mode:f,pencil_mirror_mode:m,hue:s,bucket_threshold:c,color_loss:c,pxl_current_color:l,default_size:y,ideal_size:y,max_size:1.5*y}),this.st4te._swipeable_drawer_set_props({view_name_index:e%7,previous_view_name_index:t%7,layers:a,layer_index:i,hide_canvas_content:n,show_original_image_in_background:o,show_transparent_image_in_background:r,hue:s,current_color:l,second_color:_,slider_value:parseFloat(c),slider_value_width:v,slider_value_height:x,tool:d,width:parseInt(u),height:parseInt(h),filters:p,select_mode:f,pencil_mirror_mode:m,is_something_selected:g,is_image_import_mode:w,import_size:y,import_colorize:b})},this._handle_game_end=()=>{this.setSt4te({_game_ended:!0},(()=>{setTimeout((()=>{this.setSt4te({_game_ended:!1})}),5e3)}))},this._handle_edit_drawer_open=(e,t)=>{t=void 0!==t?t:this.st4te._view_name_index;const a=!(this.st4te._view_name_index!==t)&&this.st4te._is_edit_drawer_open,{_toolbox_container_ref:i}=this.st4te;let n,o=!0;if(a&&null!==i){n=this.st4te._view_name_sub_index||0;const e=`swipetoolbox_i_${t}_${n}`,a=(document.getElementsByClassName(e)||[])[0]||null;n++,null!==a?i.scrollTop=a.offsetTop:(n=0,i.scrollTop=0)}else n=0,i.scrollTop=0;const r=!(this.st4te._is_edit_drawer_open===o&&this.st4te._view_name_index===t);this.setSt4te({_is_edit_drawer_open:o,_view_name_index:t,_view_name_sub_index:n},(()=>{r&&(this._compute_menu_drawer(),this._request_force_update())}))},this._handle_edit_drawer_close=()=>{const e=!!this.st4te._is_edit_drawer_open;this.setSt4te({_is_edit_drawer_open:!1},(()=>{e&&(this._compute_menu_drawer(),this._request_force_update())}))},this._set_current_color=e=>{this._handle_menu_close(),this.setSt4te({_current_color:e},(()=>{this._set_props_bypass_this()}))},this._exchange_pixel_colors=(e,t,a)=>{const{exchange_pixel_color:i}=this.st4te._canvas;let{_menu_data:n}=this.st4te;i(e,t,a),n.pxl_color=a,this._handle_menu_close(),this.setSt4te({_menu_data:n})},this._to_auto_medium_more_contrast=()=>{const{auto_adjust_contrast:e}=this.st4te._canvas;e(.2),J.default.trigger_voice("enhanced")},this._to_auto_medium_more_saturation=()=>{const{auto_adjust_saturation:e}=this.st4te._canvas;e(.2),J.default.trigger_voice("enhanced")},this._less_colors_auto=()=>{const{_layers:e,_layer_index:t}=this.st4te,{to_less_color:a}=this.st4te._canvas;J.default.trigger_voice("please_wait"),(e[t]||{}).number_of_colors,a("auto")},this._get_average_color_of_selection=()=>{const{get_average_color_of_selection:e}=this.st4te._canvas,t=e();this._handle_current_color_change(t)},this._handle_pixel_dialog_create_close=()=>{this.setSt4te({_is_pixel_dialog_create_open:!1,_attachment_previews:{}},(()=>{this._request_force_update()}))},this._handle_pixel_dialog_create_open=()=>{!1===this.st4te._is_pixel_dialog_create_open&&J.default.trigger_sfx("hero_decorative-celebration-02"),he.default.get_settings(this._process_settings_info_result),setTimeout((()=>{this.setSt4te({_is_pixel_dialog_create_open:!0},(()=>{this._request_force_update()}))}),725)},this._set_toolbox_container_ref=e=>{null!=e&&this.setSt4te({_toolbox_container_ref:e})},this._set_root_ref=e=>{null!=e&&this.setSt4te({_root_ref:e},(()=>{this.st4te._root_ref.addEventListener("drop",this._handle_file_upload,{capture:!0}),this.st4te._root_ref.addEventListener("dragenter",this._drop_start),this.st4te._root_ref.addEventListener("dragover",this._drop_start),this.st4te._root_ref.addEventListener("dragleave",this._drop_end)}))},this._drop_start=e=>{e.preventDefault(),e.stopPropagation(),this.setSt4te({_drag_file:Date.now()},(()=>{this._request_force_update()}))},this._drop_end=e=>{e.preventDefault(),e.stopPropagation(),this.st4te._drag_file&&this.setSt4te({_drag_file:0},(()=>{this._request_force_update()}))},this._scroll_to_drawer=e=>{if((""+e).startsWith("swipetoolbox_i_")){const t=(document.getElementsByClassName(e)||[])[0]||null;this.st4te._toolbox_container_ref.scrollTop=null!==t?t.offsetTop:0}else{const t=this.st4te._toolbox_container_ref.scrollTop;let a=(document.getElementsByClassName(`swipetoolbox_i_${this.st4te._view_name_index}_0`)||[])[0]||{},i=1;for(;a;){if(!(t>a.offsetTop)){a=(document.getElementsByClassName(`swipetoolbox_i_${this.st4te._view_name_index}_${i-1+e}`)||[])[0]||{};break}a=(document.getElementsByClassName(`swipetoolbox_i_${this.st4te._view_name_index}_${i++}`)||[])[0]||{}}this.st4te._toolbox_container_ref.scrollTop=a.offsetTop||0}},this._toggle_perspective=()=>{const e=!this.st4te._perspective;e?(J.default.trigger_voice("vision_activated"),this._set_tool("MOVE",!1)):(J.default.trigger_voice("vision_deactivated"),this._revert_tool()),this.setSt4te({_perspective:e},(()=>{this._request_force_update()}))},this._smooth_adjust=(e=1)=>{const{smooth_adjust:t}=this.st4te._canvas;t(e)},this._close_text=()=>{this.setSt4te({_text_dialog_open:!1},(()=>{this._request_force_update()}))},this._open_text=()=>{this.setSt4te({_text_dialog_open:!0},(()=>{this._request_force_update()}))},this._draw_text=(e,t)=>{this._close_text();const{write_text:a}=this.st4te._canvas;a(e,t)},this._resume_video=()=>{try{document.getElementById("labintro-video").play()}catch(e){}},this._compute_menu_right_click=()=>{const{classes:e,_canvas:t,_current_color:a,_tool:i,_width:n,_height:o,_pencil_mirror_mode:r,_is_something_selected:s,_menu_mouse_y:l,_menu_mouse_x:_,_menu_data:c,_menu_event:u}=this.st4te;c.pos_x=-1===c.pos_x?"out":c.pos_x,c.pos_y=-1===c.pos_y?"out":c.pos_y,this.menu=d.default.createElement(F.default,{className:e.contextMenuFuckYouDisable,PaperProps:{style:{maxHeight:380,width:240,overflowY:"overlay",contain:"paint style layout",scrollBehavior:"smooth",userSelect:"none",pointerEvents:l||_?"all":"none"}},onContextMenu:function(e){e.preventDefault()},MenuListProps:{dense:!0},transitionDuration:{enter:125,exit:250},open:!!l||!!_,onClose:this._handle_menu_close,disablePortal:!1,keepMounted:!0,anchorReference:"anchorPosition",anchorPosition:{top:0|l,left:0|_}},d.default.createElement("span",{style:{textAlign:"left",padding:"12px 8px",color:"#666"}},"X: ",c.pos_x,", Y: ",c.pos_y),d.default.createElement("div",{style:"SET PENCIL MIRROR"===i||"NONE"!==r?{}:{display:"none"}},d.default.createElement(B.default,{className:e.contextMenuSubheader},"Tools"),d.default.createElement(E.default,{button:!0,divider:!0,disabled:"PENCIL"===i,onClick:()=>{this._set_tool("PENCIL")}},d.default.createElement(X.default,null,d.default.createElement(Ue.default,null)),d.default.createElement(W.default,{primary:"Pencil"})),d.default.createElement(E.default,{button:!0,divider:!0,disabled:"PENCIL PERFECT"===i,onClick:()=>{this._set_tool("PENCIL PERFECT")}},d.default.createElement(X.default,null,d.default.createElement(qe.default,null)),d.default.createElement(W.default,{primary:"Pencil perfect"})),d.default.createElement(B.default,{className:e.contextMenuSubheader},"Mirror mode"),[{icon:d.default.createElement(Le.default,null),disabled:"NONE"===r,text:"None",on_click:()=>{this._set_pencil_mirror_mode("NONE")}},{icon:d.default.createElement(Le.default,null),disabled:"VERTICAL"===r,text:"Vertical",on_click:()=>{this._set_pencil_mirror_mode("VERTICAL")}},{icon:d.default.createElement(Le.default,null),disabled:"HORIZONTAL"===r,text:"Horizontal",on_click:()=>{this._set_pencil_mirror_mode("HORIZONTAL")}},{icon:d.default.createElement(Le.default,null),disabled:"BOTH"===r,text:"Both",on_click:()=>{this._set_pencil_mirror_mode("BOTH")}}].map((e=>d.default.createElement(E.default,{key:e.text,button:!0,divider:!0,disabled:e.disabled,onClick:e.on_click},d.default.createElement(X.default,null,e.icon),d.default.createElement(W.default,{primary:e.text}))))),d.default.createElement("div",{style:s?{}:{display:"none"}},d.default.createElement(B.default,{className:e.contextMenuSubheader},"Apply to selection"),[{icon:d.default.createElement(Ge.default,null),text:"Unselect",on_click:()=>{t.to_selection_none()}},{icon:d.default.createElement(Ce.default,null),text:"Colorize dynamical",on_click:()=>{t.to_selection_changes(a,!1)}},{icon:d.default.createElement($e.default,null),text:"Get average color",on_click:()=>{this._get_average_color_of_selection()}},{icon:d.default.createElement(ve.default,null),text:"Shrink",on_click:()=>{t.to_selection_size(-1)}},{icon:d.default.createElement(ve.default,null),text:"Grow",on_click:()=>{t.to_selection_size(1)}},{icon:d.default.createElement(ke.default,null),text:"Border",on_click:()=>{t.to_selection_border()}},{icon:d.default.createElement(Ce.default,null),text:"Bucket",on_click:()=>{t.to_selection_bucket()}},{icon:d.default.createElement(ve.default,null),text:"Crop",on_click:()=>{t.to_selection_crop()}},{icon:d.default.createElement(Ie.default,null),text:"Invert",on_click:()=>{t.to_selection_invert()}},{icon:d.default.createElement(De.default,null),text:"Copy",on_click:()=>{t.copy_selection()}},{icon:d.default.createElement(Ae.default,null),text:"Cut",on_click:()=>{t.cut_selection()}},{icon:d.default.createElement(je.default,null),text:"Erase",on_click:()=>{t.erase_selection()}}].map((e=>d.default.createElement(E.default,{key:e.text,button:!0,divider:!0,onClick:e.on_click},d.default.createElement(X.default,null,e.icon),d.default.createElement(W.default,{primary:e.text}))))),d.default.createElement(B.default,{style:null===c.pxl_color?{display:"none"}:{},className:e.contextMenuSubheader},"Color"),d.default.createElement(E.default,{button:!0,divider:!0,style:null===c.pxl_color?{display:"none"}:{},disabled:c.pxl_color===a||null===c.pxl_color,onClick:e=>{this._set_current_color(c.pxl_color),this._handle_relevant_action_event(u,c.pxl_color,1,!0)}},d.default.createElement(X.default,null,d.default.createElement(te.default,{style:{color:c.pxl_color,background:`repeating-conic-gradient(#80808055 0% 25%, #00000000 0% 50%) 50% / calc(200% / ${n}) calc(200% / ${o})`}})),d.default.createElement(W.default,{primary:"Pick color"})),d.default.createElement(E.default,{button:!0,divider:!0,style:null===c.pxl_color?{display:"none"}:{},disabled:c.pxl_color===a||null===c.pxl_color,onClick:e=>{this._exchange_pixel_colors(c.pos_x,c.pos_y,a+""),this._handle_relevant_action_event(u,a,1,!0)}},d.default.createElement(X.default,null,d.default.createElement(te.default,{style:{color:a,background:`repeating-conic-gradient(#80808055 0% 25%, #00000000 0% 50%) 50% / calc(200% / ${n}) calc(200% / ${o})`}})),d.default.createElement(W.default,{primary:"Replace color"})),d.default.createElement(B.default,{className:e.contextMenuSubheader},"Effect"),d.default.createElement(E.default,{button:!0,divider:!0,onClick:e=>this._to_auto_medium_more_contrast()},d.default.createElement(X.default,null,d.default.createElement(fe.default,null)),d.default.createElement(W.default,{primary:"Increase contrast"})),d.default.createElement(E.default,{button:!0,divider:!0,onClick:e=>this._to_auto_medium_more_saturation()},d.default.createElement(X.default,null,d.default.createElement(fe.default,null)),d.default.createElement(W.default,{primary:"Increase saturation"})),d.default.createElement(E.default,{button:!0,divider:!0,onClick:e=>this._handle_edit_drawer_open(null,6)},d.default.createElement(X.default,null,d.default.createElement(Z.default,null)),d.default.createElement(W.default,{primary:"Add a filter"})),d.default.createElement(E.default,{button:!0,divider:!0,onClick:e=>{t.less_colors_stepped()}},d.default.createElement(X.default,null,d.default.createElement(ge.default,null)),d.default.createElement(W.default,{primary:"Reduce color number"})),d.default.createElement(E.default,{button:!0,divider:!0,onClick:this._less_colors_auto},d.default.createElement(X.default,null,d.default.createElement(ge.default,null)),d.default.createElement(W.default,{primary:"To auto colors number"})),d.default.createElement(E.default,{button:!0,divider:!0,onClick:e=>this._smooth_adjust(1)},d.default.createElement(X.default,null,d.default.createElement(ye.default,null)),d.default.createElement(W.default,{primary:"Smooth a bit"})))},this._compute_menu_drawer=()=>{const{classes:e,_canvas:t,_view_name_index:a,_previous_view_name_index:i,_view_names:n,_layers:o,_layer_index:r,_is_image_import_mode:s,_hide_canvas_content:l,_show_original_image_in_background:_,_show_transparent_image_in_background:c,_can_undo:u,_can_redo:h,_current_color:p,_second_color:f,_slider_value:m,_tool:g,_width:w,_height:y,_import_size:b,_import_colorize:v,_hue:x,_filters:k,_select_mode:E,_pencil_mirror_mode:C,_is_something_selected:I,_is_edit_drawer_open:M,_menu_data:D,_less_than_1280w:O,_slider_value_width:A,_slider_value_height:j}=this.st4te;D.pos_x=-1===D.pos_x?"out":D.pos_x,D.pos_y=-1===D.pos_y?"out":D.pos_y,O?this.drawer_mobile=d.default.createElement(d.default.Fragment,null,d.default.createElement(P.default,{className:e.contentDrawer,disableBackdropTransition:!1,disableSwipeToOpen:!1,disableDiscovery:!1,disablePortal:!0,keepMounted:!0,hysteresis:.314,minFlingVelocity:314,swipeAreaWidth:128,open:!!M,onOpen:this._handle_edit_drawer_open,onClose:this._handle_edit_drawer_close,classes:{paper:e.swipeableDrawerPaper,modal:e.drawerModal},transitionDuration:{appear:5,enter:50,exit:75},ModalProps:{disablePortal:!0,BackdropProps:{classes:{root:e.drawerModalBackdropRoot}}},variant:"temporary",anchor:"bottom",style:{pointerEvents:"all"}},d.default.createElement("div",{className:e.mobileintrovideowrapper},d.default.createElement("video",{className:e.mobileintrovideo,id:"labintro-video",width:"56",height:"56",onClick:this._resume_video,style:{aspectRatio:"1",transform:"translateZ(10px)"}},d.default.createElement("source",{src:"/src/videos/labintro.mp4",type:"video/mp4"}))),d.default.createElement(ie.default,{onClick:this._handle_edit_drawer_close}),d.default.createElement("div",{style:{display:"grid",contain:"layout paint style"}},d.default.createElement("div",{style:{boxShadow:"rgb(0 0 0 / 20%) 0px 2px 4px -1px, rgb(0 0 0 / 14%) 0px 4px 5px 0px, rgb(0 0 0 / 12%) 0px 1px 10px 0px",zIndex:1}},d.default.createElement("div",{className:e.drawerHeader},d.default.createElement(S.default,{className:e.effectSliderText,id:"strength-slider",gutterBottom:!0},"Effect strength :"),d.default.createElement(T.default,{key:"slider-"+(255*m|0),className:e.effectSlider,defaultValue:parseFloat(m),step:1/255,min:0,max:1,onChangeCommitted:this._set_value_from_slider_with_update,"aria-labelledby":"strength-slider"}))),d.default.createElement("div",{className:e.drawerContainer,ref:this._set_toolbox_container_ref},d.default.createElement(_e.default,{should_update:M,slider_value_width:A,slider_value_height:j,onActionClose:this._handle_edit_drawer_close,canvas:t,is_mobile:jt,view_class:e.listOfTools,view_names:n,is_image_import_mode:s,can_undo:u,can_redo:h,view_name_index:a,previous_view_name_index:i,layers:o,layer_index:r,hide_canvas_content:l,show_original_image_in_background:_,show_transparent_image_in_background:c,hue:x,current_color:p,second_color:f,slider_value:m,tool:g,width:parseInt(w),height:parseInt(y),filters:k,select_mode:E,pencil_mirror_mode:C,is_something_selected:I,import_size:b,import_colorize:v,set_filters_callback:this._set_filters_callback,set_props_callback:this._set_props_callback,set_tool:this._set_tool,set_select_mode:this._set_select_mode,set_pencil_mirror_mode:this._set_pencil_mirror_mode,set_width_from_slider:this._set_width_from_slider,set_height_from_slider:this._set_height_from_slider,set_import_size:this._set_import_size,set_import_colorize:this._set_import_colorize,switch_with_second_color:this._switch_with_second_color,show_hide_canvas_content:this._show_hide_canvas_content,show_hide_background_image:this._show_hide_background_image,show_hide_transparent_image:this._show_hide_transparent_image,on_current_color_change:this._handle_current_color_change,on_view_name_change:this._handle_view_name_change,on_upload_image:e=>{window.dispatchEvent(new Event("art-upload-drawer")),this._upload_image(e)},on_upload_image_library:this._upload_image_library,on_import_image:e=>{window.dispatchEvent(new Event("art-import-drawer")),this._handle_file_import(e)},on_import_image_library:this._import_image_library,on_request_draw_text:this._open_text,on_download_image:this._download_image,on_download_svg:this._download_svg,on_scroll_to:this._scroll_to_drawer})))),d.default.createElement("div",{className:e.fatabs,style:M&&O?{transform:"translateY(24px)",backgroundColor:"#fff"}:{}},d.default.createElement(N.default,{className:e.tabs,style:{pointerEvents:"all"},variant:"fullWidth",scrollButtons:"off",indicatorColor:"primary",textColor:"primary",selectionFollowsFocus:!0,value:a,onChange:this._handle_edit_drawer_open},d.default.createElement(R.default,{className:e.tab,label:"colors",icon:d.default.createElement(rt.default,null)}),d.default.createElement(R.default,{className:e.tab,label:"image",icon:d.default.createElement(lt.default,null)}),d.default.createElement(R.default,{className:e.tab,label:"layers",icon:d.default.createElement(ct.default,null)}),d.default.createElement(R.default,{className:e.tab,label:"tools",icon:d.default.createElement(ut.default,null)}),d.default.createElement(R.default,{className:e.tab,label:"select",icon:d.default.createElement(pt.default,null)}),d.default.createElement(R.default,{className:e.tab,label:"effects",icon:d.default.createElement(mt.default,null)}),d.default.createElement(R.default,{className:e.tab,label:"filters",icon:d.default.createElement(wt.default,null)})))):this.drawer_desktop=d.default.createElement(z.default,{className:e.contentDrawerFixed,variant:"permanent",anchor:"right",classes:{paper:e.drawerPaper}},d.default.createElement("div",{style:{display:"contents",pointerEvents:"all"}},d.default.createElement("div",{style:{boxShadow:"rgb(0 0 0 / 20%) 0px 2px 4px -1px, rgb(0 0 0 / 14%) 0px 4px 5px 0px, rgb(0 0 0 / 12%) 0px 1px 10px 0px",zIndex:1}},d.default.createElement("div",{className:e.drawerHeader},d.default.createElement("div",{className:e.desktopintrovideowrapper},d.default.createElement("video",{className:e.desktopintrovideo,id:"labintro-video",width:"56",height:"56",onClick:this._resume_video,style:{aspectRatio:"1",transform:"translateZ(10px)"}},d.default.createElement("source",{src:"/src/videos/labintro.mp4",type:"video/mp4"}))),d.default.createElement("span",{className:e.coordinate},d.default.createElement("span",{id:"fps_el"},"FPS: 0"),d.default.createElement("span",{id:"xy_el"}," | X: out, Y: out ")),d.default.createElement(S.default,{className:e.effectSliderText,id:"strength-slider",gutterBottom:!0},"Effect strength :"),d.default.createElement(T.default,{key:"slider-"+(255*m|0),defaultValue:parseFloat(m),className:e.effectSlider,step:1/255,min:0,max:1,onChangeCommitted:this._set_value_from_slider_with_update,"aria-labelledby":"strength-slider"})),d.default.createElement(N.default,{id:"tabs-desktop",className:e.tabs,variant:"fullWidth",indicatorColor:"primary",textColor:"primary",selectionFollowsFocus:!1,value:a,onChange:(e,t)=>{this._handle_view_name_change(t)}},d.default.createElement(R.default,{className:e.tab,label:"colors",icon:d.default.createElement(rt.default,null)}),d.default.createElement(R.default,{className:e.tab,label:"image",icon:d.default.createElement(lt.default,null)}),d.default.createElement(R.default,{className:e.tab,label:"layers",icon:d.default.createElement(ct.default,null)}),d.default.createElement(R.default,{className:e.tab,label:"tools",icon:d.default.createElement(ut.default,null)}),d.default.createElement(R.default,{className:e.tab,label:"select",icon:d.default.createElement(pt.default,null)}),d.default.createElement(R.default,{className:e.tab,label:"effects",icon:d.default.createElement(mt.default,null)}),d.default.createElement(R.default,{className:e.tab,label:"filters",icon:d.default.createElement(wt.default,null)}))),d.default.createElement("div",{className:e.drawerContainer,ref:this._set_toolbox_container_ref},d.default.createElement(_e.default,{should_update:!jt,slider_value_width:A,slider_value_height:j,canvas:t,view_class:e.listOfTools,is_mobile:jt,view_names:n,is_image_import_mode:s,can_undo:u,can_redo:h,view_name_index:a,previous_view_name_index:i,layers:o,layer_index:r,hide_canvas_content:l,show_original_image_in_background:_,show_transparent_image_in_background:c,hue:x,current_color:p,second_color:f,slider_value:m,tool:g,width:parseInt(w),height:parseInt(y),filters:k,select_mode:E,pencil_mirror_mode:C,is_something_selected:I,import_size:b,import_colorize:v,set_filters_callback:this._set_filters_callback,set_props_callback:this._set_props_callback,set_tool:this._set_tool,set_select_mode:this._set_select_mode,set_pencil_mirror_mode:this._set_pencil_mirror_mode,set_width_from_slider:this._set_width_from_slider,set_height_from_slider:this._set_height_from_slider,set_import_size:this._set_import_size,set_import_colorize:this._set_import_colorize,switch_with_second_color:this._switch_with_second_color,show_hide_canvas_content:this._show_hide_canvas_content,show_hide_background_image:this._show_hide_background_image,show_hide_transparent_image:this._show_hide_transparent_image,on_current_color_change:this._handle_current_color_change,on_view_name_change:this._handle_view_name_change,on_upload_image:e=>{window.dispatchEvent(new Event("art-upload-drawer")),this._upload_image(e)},on_upload_image_library:this._upload_image_library,on_import_image:this._handle_file_import,on_import_image_library:this._import_image_library,on_request_draw_text:this._open_text,on_download_image:this._download_image,on_download_svg:this._download_svg,on_scroll_to:this._scroll_to_drawer}))))}},t.default=(0,b.default)((e=>({green:{color:oe.default[700]},red:{color:se.default[500]},root:{contain:"layout size style paint",contentVisibility:"auto",width:"100%",height:"100%",position:"relative",paddingBottom:72,[e.breakpoints.up("lg")]:{paddingBottom:0},background:"border-box"},contentInner:{height:"100%",width:"100%",maxHeight:"100%",position:"relative",display:"flex",contain:"paint style size layout"},contentCanvas:{width:"100%",height:"100%",maxHeight:"100%",display:"inline-block",contain:"paint style size layout !important"},contentDrawer:{overscrollBehavior:"none",display:"flex",zIndex:1400,[e.breakpoints.up("lg")]:{display:"none"}},drawerHeader:{[e.breakpoints.down("md")]:{padding:"16px 24px 8px 24px"},padding:"36px 24px 8px 24px",position:"relative",zIndex:-1,background:"#fff"},desktopintrovideowrapper:{cursor:"pointer",margin:"12px 24px",position:"absolute",right:0,top:0,"&:active, &:hover, &:active > video, &:hover > video":{height:96,width:96,transform:"scale(2)",zIndex:1},height:56,width:56,"&::after":{content:"''",background:"#fff !important",position:"absolute",right:0,top:0,width:"10%",height:"15%"}},desktopintrovideo:{position:"absolute",right:0,top:0,height:56,width:56},mobileintrovideowrapper:{zIndex:1,cursor:"pointer",margin:"16px 56px",position:"absolute",right:0,top:0,height:32,width:32,"&::after":{content:"''",background:"#fff !important",position:"absolute",right:0,top:0,width:"10%",height:"15%"}},mobileintrovideo:{position:"absolute",right:0,top:0,height:32,width:32},effectSliderText:{color:"#050c4c",fontWeight:"bold",textTransform:"uppercase"},effectSlider:{color:"#3729c1",padding:"16px 0px","& > .MuiSlider-track":{height:4}},coordinate:{padding:"6px 8px 6px 8px",display:"block",position:"absolute",top:0,left:"50%",transform:"translate(-50%, 0%)",borderRadius:"0px 0px 4px 4px",backgroundColor:"#ededffff",color:"#050c4c",boxShadow:"inset 0px 3px 6px #050c4c4d",whiteSpace:"nowrap"},drawerModalBackdropRoot:{contain:"layout size style paint"},drawerModal:{transform:"translateY(-32px)",marginTop:32,contain:"size layout style",overflow:"hidden"},contentDrawerFixed:{zIndex:20,contain:"style size paint layout",boxShadow:"-2px 0px 4px 0px rgb(0 0 0 / 20%), -4px 0px 5px 0px rgb(0 0 0 / 14%), -6px 0px 10px 0px rgb(0 0 0 / 12%)",maxHeight:"100%",height:"100%",[e.breakpoints.down("md")]:{display:"none"},width:480,overscrollBehavior:"none",display:"inline-block",animationFillMode:"both",animationName:"$drawer",animationDuration:"250ms",animationTimingFunction:"cubic-bezier(0.4, 0, 0.2, 1)",animationDirection:"alternate",animationIterationCount:"1",animationDelay:"0ms","& > div":{animationFillMode:"both",animationName:"$opacity",animationDuration:"125ms",animationTimingFunction:"cubic-bezier(0.4, 0, 0.2, 1)",animationDirection:"alternate",animationIterationCount:"1",animationDelay:"150ms"}},"@keyframes drawer":{"0%":{transform:"translateX(100%)"},"190%":{transform:"translateX(0%)"}},"@keyframes opacity":{"0%":{filter:"opacity(0)"},"190%":{filter:"opacity(1)"}},"@keyframes menu":{"0%":{transform:"translateY(100%)"},"190%":{transform:"translateY(0%)"}},drawerPaper:{width:480,overflowX:"overlay",background:"#fafafa",contain:"layout paint size style"},swipeableDrawerPaper:{maxWidth:"100%",overscrollBehavior:"none",overflow:"hidden",paddingBottom:"48px",borderBox:"content-box",height:"100%",contain:"layout paint size style"},drawerContainer:{transform:"translateZ(10px)",scrollBehavior:"smooth",contain:"size style paint layout",height:"100% !important",overflow:"overlay",[e.breakpoints.down("md")]:{height:"calc(100vh - 180px) !important"},[e.breakpoints.up("lg")]:{overflowX:"hidden"},"& > div":{overflowX:"hidden !important",overflowY:"overlay !important",display:"inline !important",width:"100% !important",height:"100% !important",contain:"size style paint layout !important"},"& div .react-swipeable-view-container > div":{overflow:"initial !important",alignItems:"normal",contain:"size style !important",height:"100%",[e.breakpoints.down("md")]:{height:"100% !important",paddingBottom:"24px",boxSizing:"border-box"}},"& div .react-swipeable-view-container > div[aria-hidden=true]":{[e.breakpoints.up("lg")]:{height:"16px"}},"& div .react-swipeable-view-container > div[aria-hidden=false]  > ul":{[e.breakpoints.down("md")]:{paddingBottom:0}},"& > div > .react-swipeable-view-container":{display:"flex !important",filter:"inherit !important",WebkitFilter:"inherit",willChange:"none !important",height:"100% !important",[e.breakpoints.up("lg")]:{width:480},[e.breakpoints.down("md")]:{width:"100%"}}},tabs:{contain:"paint size style layout",animationFillMode:"both",animationName:"$menu",animationDuration:"175ms",animationTimingFunction:"cubic-bezier(0.4, 0, 0.2, 1)",animationDirection:"alternate",animationIterationCount:"1",animationDelay:"0ms",height:72,display:"grid","& .MuiTabs-scroller":{overflowY:"hidden"},"& .MuiTab-root":{minWidth:"auto",flex:"auto"},"& .MuiTabs-indicator":{backgroundColor:"#050c4c"}},"@keyframes bounce":{"0%":{transform:"translate3d(0, 0px, 0) scaleY(1.00)"},"20%":{transform:"translate3d(0, 2px, 0) scaleY(0.95)"},"40%":{transform:"translate3d(0, 0px, 0) scaleY(1.00)"},"70%":{transform:"translate3d(0, -2px, 0) scaleY(1.10)"},"80%":{transform:"translate3d(0, 1px, 0) scaleY(0.95)"},"90%":{transform:"translate3d(0, 0px, 0) scaleY(1.00)"}},tab:{backgroundColor:"#fafafa",color:"#050c4c",transition:"color, background-color cubic-bezier(0.4, 0, 0.2, 1) .275s","&.Mui-selected":{fontWeight:"bold",backgroundColor:"#dfddf2",color:"#050c4c",transition:"color, background-color cubic-bezier(0.4, 0, 0.2, 1) .175s",borderRadius:"4px 4px 0px 0px","& .MuiTab-wrapper":{animationDuration:"375ms",animationTimingFunction:"linear",animationName:"$bounce",transformOrigin:"center bottom"}},"&:hover":{fontWeight:"bold",backgroundColor:"#e8e6f5",color:"#050c4c",transition:"color, background-color cubic-bezier(0.4, 0, 0.2, 1) .175s",borderRadius:"4px 4px 0px 0px","& .MuiTab-wrapper":{animationDuration:"375ms",animationTimingFunction:"linear",animationName:"$bounce",transformOrigin:"center bottom"}},"&:first-child":{borderRadius:"0px 4px 0px 0px"},"&:last-child":{borderRadius:"4px 0px 0px 0px"},"& .MuiTab-wrapper":{fontSize:"11px"},"& .MuiTab-wrapper svg":{width:32,height:32,contentVisibility:"auto"}},tabNoIcon:{backgroundColor:"white",color:"#050c4c",transition:"color, background-color ease-in .175s","&.Mui-selected":{fontWeight:"bold",backgroundColor:"#dfddf2",color:"#050c4c",borderRadius:"4px 4px 0px 0px"},"&.MuiTab-labelIcon":{minHeight:36},"& .MuiTab-wrapper":{fontSize:"11px"},"& .MuiTab-wrapper svg":{width:32,height:32,display:"none",color:"#181063"}},"@keyframes backdropanim":{"0%":{filter:"drop-shadow(0px, 0px, 20px, 20px, #131c955c)"}},backdrop:{zIndex:2e3,color:"#fff",filter:"brightness(1.1) contrast(1.2) drop-shadow(0 0 12px #070b32)",background:"radial-gradient(farthest-corner, #001856d1 20%, #636eff52 80%, #474e9b2b)",contain:"layout paint size style",userSelect:"none",animation:"$backdropanim 16s linear infinite both"},backdropTextContent:{display:"block",textAlign:"center"},fatabs:{transition:"transform 45ms cubic-bezier(0.4, 0, 0.2, 1) 5ms",backgroundColor:"#fafafa",boxShadow:"0px 2px 4px -1px rgb(0 0 0 / 20%), 0px 4px 5px 0px rgb(0 0 0 / 14%), 0px 1px 10px 0px rgb(0 0 0 / 12%)",contain:"paint size style layout",[e.breakpoints.up("lg")]:{display:"none"},[e.breakpoints.up("md")]:{width:"100%"},zIndex:1300,position:"fixed",bottom:0,right:0,width:"100%",height:72},listOfTools:{paddingTop:0,[e.breakpoints.down("md")]:{width:"100%"},width:360},contextMenuSubheader:{lineHeight:"24px",backgroundColor:"#eee",color:e.palette.secondary.light},contextMenuFuckYouActive:{cursor:'url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAApCAYAAAAiT5m3AAABXklEQVRYR+2XSxKCMAyGYSXqCdiJev8TqbjjBCqucMJMnDSk6QOKM0hXzPTxNemfB3n2o5GP4Z4OVYf7r/c66KygxfSSCL3Ut+xcHfupEPgoMEBxAHwFa/pZXe0dXaDqVVzLCyeaIkEMs7wxTZEAhUyVHMyhs4KpdTYwj0VNbF6Za7cpukf7Ms7lruaXcVWsZGC8iM3qHszVyhfHWIxg6qamabLnu+2ZXzC+IbqIFvZYsOb+AZgWdviGW5ZlaYSOLaG73p263wqWlEuBEkS6kC3eVbAG97FOi/fkYO4F7M0MVfMkQd/bNucq4KqrYbOk3NnAoF5edbjKYy2n50CeGGQu3tK4XBk6b7wx3ZwSTPO3aLHN3aHW8fX7YmumTL4gldX/A5YKj1iPaZkcGz62uqw2AlO9tfQLmxQsuRiF7ARjTeY9l09oaT/r0T3XssEgMmiBQgcUHbXLDD1wivUfqwJ8Oe4e4FEAAAAASUVORK5CYII=") 17 28, auto',"& .MuiList-padding":{padding:0}},contextMenuFuckYouDisable:{"& .MuiList-padding":{padding:0}},ripple:{contain:"layout paint size style",pointerEvents:"none",contentVisibility:"auto",mixBlendMode:"dodge"},infoIcon:{position:"absolute"},blueCenter:{color:e.palette.secondary.lighter,textAlign:"center",minWidth:"100%"},perspectiveButton:{position:"absolute",left:16,top:16,animationFillMode:"both",animationName:"$fadein",animationDuration:"225ms",animationTimingFunction:"cubic-bezier(0.4, 0, 0.2, 1)",animationDirection:"alternate",animationIterationCount:"1",animationDelay:"175ms"},saveButton:{backgroundColor:"#0037ff14 !important",position:"absolute",right:496,top:16,[e.breakpoints.down("md")]:{right:16},animationFillMode:"both",animationName:"$fadein",animationDuration:"225ms",animationTimingFunction:"cubic-bezier(0.4, 0, 0.2, 1)",animationDirection:"alternate",animationIterationCount:"1",animationDelay:"175ms"},confirmImportButton:{position:"absolute",left:16,bottom:16,[e.breakpoints.down("md")]:{bottom:88},animationFillMode:"both",animationName:"$fadein",animationDuration:"225ms",animationTimingFunction:"cubic-bezier(0.4, 0, 0.2, 1)",animationDirection:"alternate",animationIterationCount:"1",animationDelay:"175ms"},zoomInButton:{position:"absolute",left:16,bottom:104,[e.breakpoints.down("md")]:{bottom:176},animationFillMode:"both",animationName:"$fadein",animationDuration:"225ms",animationTimingFunction:"cubic-bezier(0.4, 0, 0.2, 1)",animationDirection:"alternate",animationIterationCount:"1",animationDelay:"175ms"},zoomOutButton:{position:"absolute",left:16,bottom:60,[e.breakpoints.down("md")]:{bottom:132},animationFillMode:"both",animationName:"$fadein",animationDuration:"225ms",animationTimingFunction:"cubic-bezier(0.4, 0, 0.2, 1)",animationDirection:"alternate",animationIterationCount:"1",animationDelay:"175ms"},redoButton:{backgroundColor:"#0037ff14 !important",position:"absolute",right:496,bottom:60,[e.breakpoints.down("md")]:{right:16,bottom:132},animationFillMode:"both",animationName:"$fadein",animationDuration:"225ms",animationTimingFunction:"cubic-bezier(0.4, 0, 0.2, 1)",animationDirection:"alternate",animationIterationCount:"1",animationDelay:"175ms"},undoButton:{backgroundColor:"#0037ff14 !important",position:"absolute",right:496,bottom:16,[e.breakpoints.down("md")]:{right:16,bottom:88},animationFillMode:"both",animationName:"$fadein",animationDuration:"225ms",animationTimingFunction:"cubic-bezier(0.4, 0, 0.2, 1)",animationDirection:"alternate",animationIterationCount:"1",animationDelay:"175ms"},"@keyframes fadein":{"0%":{filter:"opacity(0)"},"190%":{filter:"opacity(1)"}},imageBackdrop:{filter:"brightness(1.5) contrast(0.75) drop-shadow(2px 4px 6px black)",width:"min(75vw, 75vh)"}})))(Rt)},651:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(e){this.rgba_=e}static createUint32(e){return new i(new Uint8Array(Uint32Array.of((0|e)>>>0).buffer))}get r(){return this.rgba_[0]}get g(){return this.rgba_[1]}get b(){return this.rgba_[2]}get a(){return this.rgba_[3]}get rgba(){return this.rgba_.subarray(0,4)}get uint32(){return(this.r<<24|this.g<<16|this.b<<8|this.a)>>>0}setRGBA(e){this.rgba_[0]=e[0],this.rgba_[1]=e[1],this.rgba_[2]=e[2],this.rgba_[3]=e[3]}setUint32(e){this.rgba_[3]=e>>24&255,this.rgba_[2]=e>>16&255,this.rgba_[1]=e>>8&255,this.rgba_[0]=255&e}}t.default=i},652:function(e,t,a){"use strict";var i,n,o;Object.defineProperty(t,"__esModule",{value:!0}),i=a(651),n=(o=i)&&o.__esModule?o:{default:o},t.default=class{static colorDifference(e,t){return Math.sqrt(Math.pow(e.r-t.r,2)+Math.pow(e.g-t.g,2)+Math.pow(e.b-t.b,2)+Math.pow(e.a-t.a,2))}static averageColor(e){const t=new Uint32Array(4);e.forEach((e=>{const a=e.rgba;t[0]=(t[0]+a[0]|0)>>>0,t[1]=(t[1]+a[1]|0)>>>0,t[2]=(t[2]+a[2]|0)>>>0,t[3]=(t[3]+a[3]|0)>>>0}));const a=e.length;return new n.default(Uint8Array.of(t[0]/a|0,t[1]/a|0,t[2]/a|0,t[3]/a|0))}}},654:function(e,t,a){"use strict";var i,n,o=a(653),r=a(647),s=(0,r.SIMDopeCreateConfAdd)({create:{new_of:!0},properties:{uint32:!0,laba:!0,rgbaon4bits:!0,rgbaon6bits:!0,rgbaon8bits:!0,rgbaon12bits:!0,rgbaon16bits:!0,skin:!0},methods:{simplify:!0,get_new_element:!0,get_use_element:!0,set_tail:!0,is_dark:!0,blend_first_with:!0,blend_first_with_tails:!0,blend_all:!0,euclidean_match_with:!0,manhattan_match_with:!0,cie76_match_with:!0,copy:!0}}),l=Math.fround,_=l(1),c=l(.777);const{simdops:d,Color:u,Colors:h}=(0,r.SIMDopeCreate)(s),{minus_int:p,int_not_equal:f,plus_int:m,plus_uint:g,minus_uint:w,multiply_int:y,multiply_uint:b,multiply_uint_4:v,divide_uint:x,clamp_uint8:k,clamp_uint32:E,int_equal:C,uint_less:S,int_less:I,int_greater_equal:M,uint_not_equal:D,uint_less_equal:T,min_uint:O}=d;Object.defineProperty((i=function(e){if(e=e||{},!(this instanceof i))return new i(e);e.pxl_colors=e.pxl_colors||new Uint32Array(0),e.pxls=e.pxls||new Uint32Array(0),this.new_pxls_="buffer"in e.pxls?new Uint32Array(e.pxls.buffer):Uint32Array.from(e.pxls),this.new_pxl_colors_="buffer"in e.pxl_colors?new h(e.pxl_colors.buffer):new h(Uint32Array.from(e.pxl_colors).buffer);var t=0|this.new_pxl_colors_.length;this.new_pxl_colors_is_skin_mask_=new o.SetFixed(0|t),this.set_new_pxl_skin_mask(),this.best_color_number_=e.number_of_color,this.max_cluster_=t>65536?65537:t>16384?4097:t>8192?257:t>512?17:1,this.index_clusters_=Array(this.max_cluster_),this.length_clusters_=new Uint32Array(this.max_cluster_),this.pxl_colors_usage_=new Uint32Array(t),this.all_index_clusters_=new Uint32Array(t),this.clean_pxl_colors_=new Uint32Array(t),this.clean_pxl_colors_lookup_={},this.is_skin_ops_=0,this.match_ops_=0,this.blend_ops_=0,this.remove_duplicate_ops_=0,this.simplify_ops_=0,this.classify_on_x_bits_ops_=0}).prototype,"set_is_skin_ops",{get:function(){return function(e){this.is_skin_ops_=(0|e)>>>0}}}),Object.defineProperty(i.prototype,"set_match_ops",{get:function(){return function(e){this.match_ops_=(0|e)>>>0}}}),Object.defineProperty(i.prototype,"set_blend_ops",{get:function(){return function(e){this.blend_ops_=(0|e)>>>0}}}),Object.defineProperty(i.prototype,"set_remove_duplicate_ops",{get:function(){return function(e){this.remove_duplicate_ops_=(0|e)>>>0}}}),Object.defineProperty(i.prototype,"set_simplify_ops",{get:function(){return function(e){this.simplify_ops_=e}}}),Object.defineProperty(i.prototype,"set_classify_on_x_bits_ops",{get:function(){return function(e){this.classify_on_x_bits_ops_=e}}}),Object.defineProperty(i.prototype,"get_is_skin_ops",{get:function(){return function(){return 0|this.is_skin_ops_}}}),Object.defineProperty(i.prototype,"get_match_ops",{get:function(){return function(){return 0|this.match_ops_}}}),Object.defineProperty(i.prototype,"get_blend_ops",{get:function(){return function(){return 0|this.blend_ops_}}}),Object.defineProperty(i.prototype,"get_remove_duplicate_ops",{get:function(){return function(){return 0|this.remove_duplicate_ops_}}}),Object.defineProperty(i.prototype,"get_simplify_ops",{get:function(){return function(){return this.simplify_ops_}}}),Object.defineProperty(i.prototype,"get_classify_on_x_bits_ops",{get:function(){return function(){return this.classify_on_x_bits_ops_}}}),Object.defineProperty(i.prototype,"reset_deduplicate",{get:function(){return function(e){this.clean_pxl_colors_lookup_={},this.pxl_colors_usage_.fill(0,0,0|e),this.clean_pxl_colors_.fill(0,0,0|e)}}}),Object.defineProperty(i.prototype,"index_of_color_within_cleaned",{get:function(){return function(e){return(0|this.clean_pxl_colors_lookup_[(0|e)>>>0])-1|0}}}),Object.defineProperty(i.prototype,"set_cleaned_pxl_colors",{get:function(){return function(e,t){this.clean_pxl_colors_[(0|e)>>>0]=(0|t)>>>0,this.clean_pxl_colors_lookup_[(0|t)>>>0]=(e+1|0)>>>0}}}),Object.defineProperty(i.prototype,"increase_color_usage",{get:function(){return function(e){this.pxl_colors_usage_[(0|e)>>>0]=(this.pxl_colors_usage_[(0|e)>>>0]+1|0)>>>0}}}),Object.defineProperty(i.prototype,"set_new_pxls",{get:function(){return function(e,t){this.new_pxls_[(0|e)>>>0]=(0|t)>>>0}}}),Object.defineProperty(i.prototype,"set_new_pxl_colors",{get:function(){return function(e){this.new_pxl_colors_=new h(this.clean_pxl_colors_.buffer.slice(0,v(0|e))),this.set_new_pxl_skin_mask()}}}),Object.defineProperty(i.prototype,"set_new_pxl_skin_mask",{get:function(){return function(){var e=new u(new ArrayBuffer(4)),t=0|this.new_pxl_colors_.length,a=0;for(this.new_pxl_colors_is_skin_mask_=new o.SetFixed(0|t);(0|a)<(0|t);a=a+1|0)this.new_pxl_colors_.get_use_element(0|a,e).skin&&this.new_pxl_colors_is_skin_mask_.add(0|a);this.set_is_skin_ops(this.get_is_skin_ops()+a|0)}}}),Object.defineProperty(i.prototype,"get_a_new_pxl_color_from_pxl_index",{get:function(){return function(e){return 4294967295&this.new_pxl_colors_.buffer_getUint32(this.new_pxls_[0|e])}}}),Object.defineProperty(i.prototype,"reset_cluster",{get:function(){return function(){this.max_cluster_=this.new_pxl_colors_.length>65536?65537:this.new_pxl_colors_.length>16384?4097:this.new_pxl_colors_.length>8192?257:this.new_pxl_colors_.length>512?17:1,this.length_clusters_.fill(0,0,0|this.max_cluster);for(var e=0;(0|e)<(0|this.max_cluster);e=(e+1|0)>>>0)this.index_clusters_[0|e]=[]}}}),Object.defineProperty(i.prototype,"add_in_indexes_cluster",{get:function(){return function(e,t){this.index_clusters_[(0|e)>>>0].push((0|t)>>>0)}}}),Object.defineProperty(i.prototype,"set_all_cluster_indexes",{get:function(){return function(){for(var e=0,t=0;(0|e)<(0|this.max_cluster);e=(e+1|0)>>>0)this.all_index_clusters_.set(this.index_clusters_[(0|e)>>>0],(0|t)>>>0),t=(t+this.get_length_in_index_clusters(0|e)|0)>>>0}}}),Object.defineProperty(i.prototype,"get_length_in_index_clusters",{get:function(){return function(e){return(0|this.index_clusters_[(0|e)>>>0].length)>>>0}}}),Object.defineProperty(i.prototype,"get_in_cluster_lengths",{get:function(){return function(e){return(0|this.length_clusters_[(0|e)>>>0])>>>0}}}),Object.defineProperty(i.prototype,"get_an_index_in_clusters",{get:function(){return function(e){return(0|this.all_index_clusters_[0|e])>>>0}}}),Object.defineProperty(i.prototype,"get_a_color_usage",{get:function(){return function(e){return(0|this.pxl_colors_usage_[0|e])>>>0}}}),Object.defineProperty(i.prototype,"set_a_color_usage",{get:function(){return function(e,t){return this.pxl_colors_usage_[0|e]=(0|t)>>>0}}}),Object.defineProperty(i.prototype,"get_a_color_usage_percent",{get:function(){return function(e){return this.pxl_colors_usage_[0|e]/this.new_pxls_.length}}}),Object.defineProperty(i.prototype,"get_average_color_usage_percent",{get:function(){return function(e,t){var a,i,n;for(t=0|((t|=0)<(e|=0)?this.pxl_colors_usage_.length:t),a=0,i=0,n=0,i=0|e;(0|i)<(0|t);i=(i+1|0)>>>0)n=(0|this.get_an_index_in_clusters((0|i)>>>0))>>>0,a+=this.pxl_colors_usage_[0|n]/this.new_pxls_.length;return a/(t-e|0)}}}),Object.defineProperty(i.prototype,"get_a_new_pxl_color",{get:function(){return function(e){return this.new_pxl_colors_.get_new_element(0|e)}}}),Object.defineProperty(i.prototype,"is_pxl_color_skin",{get:function(){return function(e){return this.new_pxl_colors_is_skin_mask_.has(0|e)}}}),Object.defineProperty(i.prototype,"max_cluster",{get:function(){return 0|this.max_cluster_}}),Object.defineProperty(i.prototype,"new_pxls_length",{get:function(){return 0|this.new_pxls_.length}}),Object.defineProperty(i.prototype,"new_pxl_colors_length",{get:function(){return 0|this.new_pxl_colors_.length}}),Object.defineProperty(i.prototype,"best_color_number",{get:function(){return 0|this.best_color_number_}}),Object.defineProperty(i.prototype,"get_data",{get:function(){return function(){return Array.of(this.new_pxls_,this.new_pxl_colors_.subarray_uint32(0,this.new_pxl_colors_.length),{deduplicate:this.get_remove_duplicate_ops(),simplify:this.get_simplify_ops(),classify:this.get_classify_on_x_bits_ops(),skin:this.get_is_skin_ops(),blend:this.get_blend_ops(),match:this.get_match_ops()})}}}),i.prototype.output=function(e){var t,a;return e=e||"heap",t=this.get_data(),"heap"==e?((a=new Uint32Array(2+t[0].length+t[1].length))[0]=0|t[0].length,a[1]=0|t[1].length,a.set(t[0],2),a.set(t[1],2+t[0].length),a.buffer):t},i.prototype.deduplicate=function(){var e,t,a,i,n;for(this.set_remove_duplicate_ops(this.get_remove_duplicate_ops()+1|0),this.reset_deduplicate(0|this.new_pxl_colors_length),e=0,t=0,a=0,i=0,n=0|this.new_pxls_length;(0|i)<(0|n);i=(i+1|0)>>>0)t=0|this.get_a_new_pxl_color_from_pxl_index(0|i),-1==(0|(a=0|this.index_of_color_within_cleaned(0|t)))&&(this.set_cleaned_pxl_colors(0|e,0|t),a=0|e,e=e+1|0),this.increase_color_usage(0|a),this.set_new_pxls(0|i,0|a);this.set_new_pxl_colors(e)},i.prototype.clusterize=function(){this.reset_cluster();var e=0;if(65537===this.max_cluster)for(;(0|e)<(0|this.new_pxl_colors_length);e=(e+1|0)>>>0)this.add_in_indexes_cluster((0|this.get_a_new_pxl_color((0|e)>>>0).rgbaon16bits)>>>0,(0|e)>>>0);else if(4097===this.max_cluster)for(;(0|e)<(0|this.new_pxl_colors_length);e=(e+1|0)>>>0)this.add_in_indexes_cluster((0|this.get_a_new_pxl_color((0|e)>>>0).rgbaon12bits)>>>0,(0|e)>>>0);else if(257===this.max_cluster)for(;(0|e)<(0|this.new_pxl_colors_length);e=(e+1|0)>>>0)this.add_in_indexes_cluster((0|this.get_a_new_pxl_color((0|e)>>>0).rgbaon8bits)>>>0,(0|e)>>>0);else if(17===this.max_cluster)for(;(0|e)<(0|this.new_pxl_colors_length);e=(e+1|0)>>>0)this.add_in_indexes_cluster((0|this.get_a_new_pxl_color((0|e)>>>0).rgbaon4bits)>>>0,(0|e)>>>0);else for(;(0|e)<(0|this.new_pxl_colors_length);e=(e+1|0)>>>0)this.add_in_indexes_cluster(0,(0|e)>>>0);this.max_cluster>1&&this.set_classify_on_x_bits_ops(this.get_classify_on_x_bits_ops()+this.new_pxl_colors_length),this.set_all_cluster_indexes()},i.prototype.process_threshold=function(e){var t,a,i,n,o,r,s,d,h,p,f,m,g,w,y,b,v,x,k,E,C,S,I,M,D;for(t=function(e,t){return l((e/10+Math.pow(e,1.618))/1731.8685749860078)}(e=(0|e)>>>0),a=!1,i=[],n=[],o=0,r=0,h=!1,p=!1,f=0,m=0,g=0,w=0,y=0,b=0,E=0,C=0,S=0,I=0,M=0,D=0,k=l((v=t)*c),x=l(v*_);(0|M)<(0|this.max_cluster);M=(M+1|0)>>>0){for(r=(o+((0|this.get_length_in_index_clusters(0|M))>>>0)|0)>>>0,y=this.get_average_color_usage_percent(0|o,0|r),S=0|o;(0|S)<(0|r);S=(S+1|0)>>>0){if(E=(0|this.get_an_index_in_clusters((0|S)>>>0))>>>0,s=this.get_a_new_pxl_color((0|E)>>>0),h=this.is_pxl_color_skin((0|E)>>>0),(0|(f=(0|this.get_a_color_usage((0|E)>>>0))>>>0))>0)for(i=[],I=0|o;(0|I)<(0|r);I=(I+1|0)>>>0)C=(0|this.get_an_index_in_clusters((0|I)>>>0))>>>0,d=this.get_a_new_pxl_color((0|C)>>>0),p=this.is_pxl_color_skin((0|C)>>>0),0|(m=(0|this.get_a_color_usage((0|C)>>>0))>>>0)&&(0|E)!=(0|C)&&(0|h)==(0|p)&&(g=this.get_a_color_usage_percent((0|E)>>>0)/y,w=this.get_a_color_usage_percent((0|C)>>>0)/y,D=l((D=h&&p?k:h||p?x:v)*(3*Math.abs(g-w)+6*(2-(g+w))+12)/21),s.manhattan_match_with(d,D)&&(b=l(m/f),a=!0,this.set_a_color_usage(0|C,0),i.push(d),n.push(b)));(0|i.length)>0&&(u.blend_all(s,i,n),i=[],n=[])}o=0|r}return a},i.prototype.round=function(){var e,t;if(this.new_pxl_colors_length>1024){for(e=0|(this.new_pxl_colors_length>32768?24:this.new_pxl_colors_length>32768?20:this.new_pxl_colors_length>16384?16:this.new_pxl_colors_length>8192?12:this.new_pxl_colors_length>2048?8:this.new_pxl_colors_length>1024?4:1),t=0;(0|t)<(0|this.new_pxl_colors_length);t=(t+1|0)>>>0)this.get_a_new_pxl_color((0|t)>>>0).simplify(e);this.set_simplify_ops(this.get_simplify_ops()+this.new_pxl_colors_length)}},i.prototype.init=function(){return this.round(),this.deduplicate(),this.clusterize(),this},i.prototype.run=function(){var e=0|(this.new_pxl_colors_length>6e4?12:this.new_pxl_colors_length>32e3?8:this.new_pxl_colors_length>16e3?4:this.new_pxl_colors_length>8192?3:this.new_pxl_colors_length>4096?2:1);if(this.new_pxl_colors_length<=this.best_color_number)return this.deduplicate(),this.clusterize(),this;for(;this.new_pxl_colors_length>this.best_color_number;)this.process_threshold(0|e)&&(this.deduplicate(),this.clusterize()),e=e+(this.new_pxl_colors_length>6e4?12:this.new_pxl_colors_length>32e3?8:this.new_pxl_colors_length>16e3?4:this.new_pxl_colors_length>8192?3:this.new_pxl_colors_length>4096?2:1)|0;return this},i.split_image_data=function(e){var t,a,i=new Uint32Array(e.data.buffer),n=Uint32Array.from(new Set(i)),o={},r=n.length,s=new Uint32Array(i.length);for(t=0,a=0|r;(0|t)<(0|a);t=(t+1|0)>>>0)o[n[0|t]]=(0|t)>>>0;for(t=0,a=0|i.length;(0|t)<(0|a);t=(t+1|0)>>>0)s[0|t]=(0|o[i[0|t]])>>>0;return[s,n,i,r]},n=function(e,t){return new Promise((function(a){var n,o,r,s,l,_,c;const[d,u,h,p]=i.split_image_data(e);for(n=Date.now(),o=i({pxls:d,pxl_colors:u,number_of_color:"auto"===t?p/1.314|0:parseFloat(t)<1?p-Math.ceil(p/25):t,width:e.width,height:e.height}).init().run().output("split"),r=Date.now(),l=0|(s=o[0]).length,_=o[1],c=0;(0|c)<(0|l);c=(c+1|0)>>>0)h[0|c]=(0|_[(0|s[0|c])>>>0])>>>0;a([e=new ImageData(new Uint8ClampedArray(h.buffer),e.width,e.height),s,_,p-_.length,_.length,r-n])}))},e.exports={QuantiMatGlobal:n,QuantiMat:i}},655:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e,t,a,i){this.strength=e,this.tilesManager=t,this.tiles=t.getTiles(),this.width=a,this.height=i}}},657:function(e,t,a){"use strict";var i,n;Object.defineProperty(t,"__esModule",{value:!0}),i=(n=a(670))&&n.__esModule?n:{default:n},t.default=i.default.pool({minWorkers:0,maxWorkers:3})},659:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var n;Object.defineProperty(t,"__esModule",{value:!0}),i(a(651)),i(a(652)),a(653),n=a(654);class o{constructor(e){this.contextSource=e}static colorDifference(e,t){const a=(e>>24&255)-(t>>24&255),i=(e>>16&255)-(t>>16&255),n=(e>>8&255)-(t>>8&255);return 0|Math.sqrt(a*a+i*i+n*n)}static findNearestCentroid(e,t){let a=1/0,i=0;for(let n=0;n<t.length;n++){const r=o.colorDifference(e,t[n]);r<a&&(a=r,i=n)}return i}static updateCentroids(e,t,a,i){const n=new Uint32Array(4*i),o=new Uint32Array(i);for(let r=0;r<e.length;r++){const a=t[r],i=e[r];n[4*a]+=i>>24&255,n[4*a+1]+=i>>16&255,n[4*a+2]+=i>>8&255,n[4*a+3]+=255&i,o[a]++}for(let r=0;r<i;r++){if(0===o[r])continue;const e=n[4*r]/o[r]|0,t=n[4*r+1]/o[r]|0,i=n[4*r+2]/o[r]|0,s=n[4*r+3]/o[r]|0;a[r]=(e<<24|t<<16|i<<8|s)>>>0}return o}static findFarthestPixelIdFromCentroids(e,t){let a=0,i=0;return e.forEach((e=>{let n=Number.MAX_VALUE;t.forEach((t=>{const a=o.colorDifference(e,t);a<n&&(n=a)})),n>a&&(a=n,i=(0|e)>>>0)})),i}static reassignCentroids(e,t,a,i){for(var n=0;n<t.length;n++)0===t[n]&&(a[n]=i[n]||e[Math.floor(Math.random()*e.length)])}static quantizeImageData(e,t){var a,i,o,r;const s=e.getImageData(0,0,e.canvas.width,e.canvas.height);a=Date.now();const[l,_]=n.QuantiMat.split_image_data(s);i=Date.now();const c=(0,n.QuantiMat)({pxls:l,pxl_colors:_,number_of_color:Math.min(_.length,t),width:s.width,height:s.height}).init().run().output("split");o=Date.now(),console.log(i-a,o-i);const d=c[0],u=c[1],h=new Uint32Array(d.length),p=new Uint32Array(u.length);for(r=0;r<d.length;r++)p[d[r]]++,h[r]=u[d[r]];return s.data.set(new Uint8ClampedArray(h.buffer)),{imageData:s,clusterAssignments:d,centroids:u}}static _calculateDistortions(e,t){let{imageData:a,clusterAssignments:i,centroids:n}=e,r=Math.imul,s=0,l=new Uint32Array(t.data.buffer),_=new Uint32Array(a.data.buffer),c=new Uint32Array(n.length);for(let d=0;d<_.length;d++){let e=0|o.colorDifference(_[d],l[d]);e=r(e,e),s+=e,c[i[d]]+=e}return{totalDistortion:s,clustersDistortion:c.sort((function(e,t){return t-e}))}}static _findElbowPoint(e){const t=[];e.forEach((function(e){e&&t.push(e)}));const a=[];for(let o=1;o<e.length;o++){const t=e[o]-e[o-1],i=e[o-1];0!==i?a.push(t/i):a.push(0)}let i=0,n=a[0];for(let o=1;o<a.length;o++)a[o]>n&&(i=o,n=a[o]);return i}static _calculateElbowStrength(e,t){const a=e.map(((t,a)=>a/(e.length-1))),i=Math.max(...e),n=Math.min(...e),o=e.map((e=>(e-n)/(i-n))),r=[0,o[0]],s=[1,o[o.length-1]],l=[a[t],o[t]],_=Math.sqrt(Math.pow(s[0]-r[0],2)+Math.pow(s[1]-r[1],2)),c=Math.abs(((h=s)[1]-(u=r)[1])*(d=l)[0]-(h[0]-u[0])*d[1]+h[0]*u[1]-h[1]*u[0])/Math.sqrt(Math.pow(h[1]-u[1],2)+Math.pow(h[0]-u[0],2));var d,u,h;return Math.fround(c/_)}computePaletteData(){var e,t,a,i,n,r;const s=this.contextSource.getImageData(0,0,this.contextSource.canvas.width,this.contextSource.canvas.height);e=Date.now();const l=o.quantizeImageData(this.contextSource,192),_=l.centroids.length;t=Date.now();const c=o._calculateDistortions(l,s);a=Date.now();const d=o._findElbowPoint(c.clustersDistortion);i=Date.now();const u=o._calculateElbowStrength(c.clustersDistortion,d);n=Date.now();const h=0===d?this.contextSource.getImageData(0,0,this.contextSource.canvas.width,this.contextSource.canvas.height):o.quantizeImageData(this.contextSource,d).imageData;return r=Date.now(),console.log({quantizeImageData1:t-e,_calculateDistortions:a-t,_findElbowPoint:i-a,"_calculateElbowStrength+updateThreshold":n-i,quantizeImageData2:r-n}),{colorNumber:0===d?_:d,colorNumberCertainty:u,colorData:h}}analyzeImageForTileSize(e){function t(e){var t,a,i,n,o,r,s,l,_,c;const d=Object.entries(e).map((([e,t])=>({length:parseInt(e),count:t})));d.sort(((e,t)=>t.length*t.count-e.length*e.count));try{let e=0,u=0,h=d[u++].length;for(;h>=3&&h<=12;)t=d[u],a=d[2*u-1]||{},i=d[2*u]||{},n=d[2*u+1]||{},o=d[4*u-1]||{},r=d[4*u]||{},s=d[4*u+1]||{},e<(c=t.count+(l=Math.max(a.count,i.count,n.count))+(_=Math.max(o.count,r.count,s.count)))&&(e=c,h=t.length,h+=(2*u+[a.count,i.count,n.count].indexOf(l)-1)/2,h+=(4*u+[o.count,r.count,s.count].indexOf(_)-1)/4,h/=3),u++;const p=d.reduce(((e,t)=>e+t.count),0);return{tileSize:h,certainty:d[u-1].count/p}}catch(u){return{tileSize:0,certainty:0}}}const a=e.width,i=e.height,n=new Uint32Array(e.data.buffer),o={},r={};for(let _=0;_<i;_++){let e=1;for(let t=1;t<a;t++){const i=_*a+t|0,r=i-1|0;n[i]==n[r]?e++:(e>1&&(o[e]=(o[e]||0)+1|0),e=1)}e>1&&(o[e]=(o[e]||0)+1|0)}for(let _=0;_<a;_++){let e=1;for(let t=1;t<i;t++){const i=t*a+_|0,o=i-a|0;n[i]==n[o]?e++:(e>1&&(r[e]=(r[e]||0)+1|0),e=1)}e>1&&(r[e]=(r[e]||0)+1|0)}const s=t(o),l=t(r);return{tileSize:Math.round((s.tileSize+l.tileSize)/2),certainty:(s.certainty+l.certainty)/2}}}t.default=o},660:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(647);t.default=class{constructor(e,t){this.data=e,this.k=Math.min(t,Math.ceil(Math.sqrt(this.data.length))),this.centroids=Array(this.k),this.clusters=new Uint32Array(this.data.length),this.c1=new i.Color(new ArrayBuffer(4)),this.c2=new i.Color(new ArrayBuffer(4))}initializeCentroids(){let e=new Set,t=[];for(let a=0;a<this.k;a++){let a;do{a=Math.floor(Math.random()*this.data.length)}while(e.has(a));e.add(a),t.push(Uint8Array.from(this.data[a]))}this.centroids=t}assignClusters(){this.data.forEach(((e,t)=>{let a=Number.MAX_VALUE,i=0;this.centroids.forEach(((t,n)=>{const o=this.distance(e,t);o<a&&(a=o,i=n)})),this.clusters[t]=i}))}updateCentroids(){let e=Array.from({length:this.k},(()=>new Uint32Array(this.data[0].length))),t=new Uint32Array(this.k);return this.data.forEach(((a,i)=>{const n=this.clusters[i];e[n]=e[n].map(((e,t)=>e+a[t])),t[n]++})),t}findFarthestPointFromCentroids(){let e=0,t=0;return this.data.forEach(((a,i)=>{let n=Number.MAX_VALUE;this.centroids.forEach((e=>{const t=this.distance(a,e);t<n&&(n=t)})),n>e&&(e=n,t=i)})),t}distance(e,t){return this.c1.set_from_array(e),this.c2.set_from_array(t),16192*this.c1.cie76_match_with(this.c2)|0}reassignCentroids(e){for(var t=0;t<e.length;t++)0===e[t]&&(this.centroids[t]=this.findFarthestPointFromCentroids())}run(e=16,t=!1){var a,i;this.initializeCentroids();let n,o=0,r=!1;for(;!r&&o<e;){const e=this.centroids.map((e=>Uint32Array.from(e)));this.assignClusters(),n=this.updateCentroids(),o++,r=this.centroids.every(((t,a)=>this.distance(t,e[a])<2)),t&&!r&&this.reassignCentroids(n)}return a=this.getCentroidsPopulationCount(this.centroids,this.clusters),i=Array.from(this.centroids).map(((e,t)=>({data:Uint8ClampedArray.from(e),count:a[t]}))).sort(((e,t)=>t.count-e.count)),{centroids:this.centroids,clusters:this.clusters,centroidsSorted:i}}getCentroidsPopulationCount(e,t){let a=new Uint32Array(e.length);return t.forEach((e=>{a[e]++})),a}}},661:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{static initializeCanvas(e,t,a){let i,n;t=(e=e||{width:0,height:0}).width||t||1,a=e.height||a||1;try{i=new OffscreenCanvas(t,a),n=i.getContext("2d",{willReadFrequently:!0,desynchronized:!0})}catch(o){i=document.createElement("canvas"),i.width=t,i.height=a,n=i.getContext("2d",{willReadFrequently:!0})}return e instanceof ImageData?n.putImageData(e,0,0):e.width&&n.drawImage(e,0,0,t,a),{canvas:i,context:n}}static canvasContextToImageData(e){return e.getImageData(0,0,e.canvas.width,e.canvas.height)}}},662:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var n=i(a(663)),o=i(a(664));e.exports=function(e,t=!1){let a=(0,n.default)(e);if(t){const e=/(?:#)[0-9a-f]{8}|(?:#)[0-9a-f]{6}|(?:#)[0-9a-f]{4}|(?:#)[0-9a-f]{3}/gi;a.match(e).forEach((function(e){const[t,i,n]=e.match(/\w\w/g).map((e=>parseInt(e,16))),o=Math.round((t+i+n)/3),r=function(e,t,a){return e=e.toString(16),t=t.toString(16),a=a.toString(16),1==e.length&&(e="0"+e),1==t.length&&(t="0"+t),1==a.length&&(a="0"+a),"#"+e+t+a}(o,o,o);a=a.replace(e,r)}))}return(0,o.default)(a)}},667:function(e,t,a){"use strict";var i=a(668);e.exports={createLocalBlob:function(e){var t,a,n,o,r=(e.match(/(data\:([a-z]+\/[a-z\+]+)\;base64\,)([a-zA-Z0-9\/\+]+\(\=+)?/)||[,,])[1];return r?(a=(t=r.match(/data\:([a-z]+\/[a-z\+]+)\;base64\,/)[1]).match(/[a-z]+\/([a-z\+]+)/)[1],e=e.replace(r,""),n=(0,i.base64ToBytes)(e),o=new File([n],"name."+a,{type:t}),URL.createObjectURL(o)):""}}},668:function(e,t,a){"use strict";var i=new(a(266).B64chromium);e.exports={bytesToBase64:i.bytesToBase64.bind(i),base64ToBytes:i.base64ToBytes.bind(i)}},676:function(e,t,a){"use strict";var i,n=a(677);const o=Object.getPrototypeOf((i=function*(){},function(){var e=i.apply(this,arguments);return new Promise((function(t,a){return function i(n,o){var r,s;try{s=(r=e[n](o)).value}catch(l){return void a(l)}if(!r.done)return Promise.resolve(s).then((function(e){i("next",e)}),(function(e){i("throw",e)}));t(s)}("next")}))})).constructor,r=Object.getPrototypeOf((function(){})).constructor;window.file_to_base64_process_function=new r('var t = function(file) {\n    "use strict";\n    \n    try {\n        \n        return new Promise(function(resolve, _) {\n            resolve(new FileReaderSync().readAsDataURL(file));\n        });\n        \n    } catch(error) {\n    \n        return new Promise(function(resolve, _) {\n            var reader = new FileReader();\n            reader.onload = function(){ resolve(reader.result)};\n            reader.readAsDataURL(file);\n        });\n    }\n    \n}; return t;')();const s=(e,t=(()=>{}),a=null)=>{null!==a?a.exec(window.file_to_base64_process_function,[e]).catch((t=>window.file_to_base64_process_function(e))).timeout(5e3).then((e=>{t(e)})):window.file_to_base64_process_function(e).then((e=>{t(e)}))};window.base64_sanitize_process_function=function(e,t,a){return a=a||"pixelize",new Promise((function(i,o){var r=new Image,s=e.startsWith("data:image/png;");r.onload=function(){let e=r.naturalWidth*t,o=r.naturalHeight*t,l=function(e,t,a,i){let o;if("pixelize"===i||"normal"===i){let n,s;try{n=new OffscreenCanvas(e.width,e.height),s=new OffscreenCanvas(t,a)}catch(r){n=document.createElement("canvas"),s=document.createElement("canvas"),n.width=e.width,n.height=e.height,s.width=t,s.height=a}let l=n.getContext("2d"),_=s.getContext("2d");l.imageSmoothingEnabled=!("normal"!==i),_.imageSmoothingEnabled=!("normal"!==i),l.drawImage(e,0,0,e.width,e.height),_.drawImage(n,0,0,n.width,n.height,0,0,s.width,s.height),o=_}else"doppel"===i&&(o=n.scaler.processImage(e,t,a));return o}(r,0|e,0|o,a);try{let e=l.getImageData(0,0,l.canvas.width,l.canvas.height);createImageBitmap(e).then((function(e){var t,a;try{t=new OffscreenCanvas(e.width,e.height)}catch(n){(t=document.createElement("canvas")).height=e.height,t.width=e.width}(a=t.getContext("bitmaprenderer")).imageSmoothingEnabled=!1,a.transferFromImageBitmap(e),t.convertToBlob({type:s?"image/png":"image/jpeg"}).then((function(e){try{i((new FileReaderSync).readAsDataURL(e))}catch(a){var t=new FileReader;t.onload=function(){i(t.result)},t.readAsDataURL(e)}}))}))}catch(_){let e=l.canvas;i(e.toDataURL(s?"image/png":"image/jpeg"))}},r.onerror=function(){o()},r.src=e}))},window.base64_to_bitmap_process_function=new o('var t = async function(base64) {\n\n    "use strict";\n\n    return fetch(base64).then(function(res) {\n\n        return res.blob().then(function(blb){\n\n            return createImageBitmap(blb, {\n                resizeQuality: "pixelated",\n                premultiplyAlpha: \'premultiply\'\n            });\n        });\n    });\n\n}; return t;')();const l=(e,t=(()=>{}),a=null)=>{null!==a?a.exec(window.base64_to_bitmap_process_function,[e]).catch((t=>window.base64_to_bitmap_process_function(e))).timeout(5e3).then((e=>{t(e)})):window.base64_to_bitmap_process_function(e).then((e=>{t(e)}))},_=(e,t=2073600,a=(()=>{}))=>{let i=1;for(;Math.round(e.width*i)*Math.round(e.height*i)>t;)i-=.01;try{createImageBitmap(e,0,0,e.width,e.height,{resizeWidth:Math.round(e.width*i),resizeHeight:Math.round(e.height*i),resizeQuality:"pixelated",premultiplyAlpha:"premultiply"}).then((function(e){let t;try{t=new OffscreenCanvas(e.width,e.height)}catch(n){t=document.createElement("canvas"),t.width=e.width,t.height=e.height}let i=t.getContext("2d");i.imageSmoothingEnabled=!1,i.drawImage(e,0,0,e.width,e.height),a(i.getImageData(0,0,e.width,e.height))}))}catch(n){let t;try{t=new OffscreenCanvas(Math.round(e.width*i),Math.round(e.height*i))}catch(o){t=document.createElement("canvas"),t.width=Math.round(e.width*i),t.height=Math.round(e.height*i)}let r=t.getContext("2d");r.imageSmoothingEnabled=!1,r.drawImage(e,0,0,t.width,t.height),a(r.getImageData(0,0,t.width,t.height))}};window.imagedata_to_base64_process_function=new r('var t = function(imagedata, type) {\n\n    "use strict"\n    type = type || "image/png";\n    var quality = type.includes("webp") ? 1: type.includes("png") ? undefined: 0.7;\n    try {\n    \n        return new Promise(function(resolve, _) {\n\n            createImageBitmap(imagedata, 0, 0, imagedata.width, imagedata.height, {\n                premultiplyAlpha: \'premultiply\',\n                resizeQuality: \'pixelated\'\n            }).then((bmp) => {\n            \n                var canvas;\n                    canvas = new OffscreenCanvas(imagedata.width, imagedata.height);\n                var ctx = canvas.getContext("bitmaprenderer");\n                    ctx.imageSmoothingEnabled = false;\n                    ctx.transferFromImageBitmap(bmp);\n                \n                canvas.convertToBlob({type: type, quality: quality}).then((blb) => {\n                    try {\n                        resolve(new FileReaderSync().readAsDataURL(blb));\n                    } catch(e2) {\n                        var reader = new FileReader();\n                        reader.onload = function(){ resolve(reader.result)};\n                        reader.readAsDataURL(blb);\n                    }\n                });\n            });\n        });\n       \n    }catch (e) {\n    \n        return new Promise(function(resolve, _) {\n            var canvas = document.createElement("canvas");\n            canvas.width = imagedata.width;\n            canvas.height = imagedata.height;\n            var ctx = canvas.getContext("2d");\n            ctx.imageSmoothingEnabled = false;\n            ctx.putImageData(imagedata, 0, 0);\n            \n            var base64 = canvas.toDataURL(type, quality);\n            canvas = null;\n            resolve(base64);\n        });\n    }\n\n}; return t;')(),e.exports={file_to_imagedata_resized:(e,t,a=(()=>{}),i=null)=>{Date.now(),e.type,"image/jpg"!==e.type&&e.type,e.type,s(e,(function(e){l(e,(function(e){_(e,t,(function(e){a(e)}))}),i)}),i)},file_to_base64:s,base64_to_bitmap:l,bitmap_to_imagedata:_,imagedata_to_base64:(e,t="image/png",a=(()=>{}),i=null)=>{null!==i?i.exec(window.imagedata_to_base64_process_function,[e,t]).catch((a=>window.imagedata_to_base64_process_function(e,t))).timeout(5e3).then((e=>{a(e)})):window.imagedata_to_base64_process_function(e,t).then((e=>{a(e)}))},base64_sanitize:(e,t=(()=>{}),a=null,i=1,n)=>{window.base64_sanitize_process_function(e,i,n).then((e=>{t(e)}))},file_to_bitmap:(e,t)=>{createImageBitmap(e).then(t)}}},677:function(e,t,a){"use strict";var i,n=(i=a(678))&&i.__esModule?i:{default:i},o=new n.default({strength:1,overlapFactor:1.25,despeckleStrength:.88});e.exports={scaler:o,ImageProcessor:n.default}},678:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var n,o,r,s,l,_,c,d,u,h;Object.defineProperty(t,"__esModule",{value:!0}),n=a(659),o=i(n),r=a(679),s=i(r),l=a(681),_=i(l),c=a(661),d=i(c),u=a(652),h=i(u),t.default=class{constructor(e){this.o=e||{},this.canvas=d.default.initializeCanvas(void 0,1,1).canvas,this.targetCanvas=d.default.initializeCanvas(void 0,1,1).canvas,this.options={despeckleStrength:this.o.despeckleStrength||this.o.strength||1,quantizeStrength:this.o.quantizeStrength||this.o.strength||1,mergeStrength:this.o.mergeStrength||this.o.strength||1,overlapFactor:this.o.overlapFactor||this.o.strength||1}}get sizes(){return{finalWidth:this.finalWidth,finalHeight:this.finalHeight,tileWidth:this.tileWidth,tileHeight:this.tileHeight,overlapFactor:this.options.overlapFactor}}updateFilters(e){this.filters=new _.default(this.options,this.tilesManager,e,this.finalWidth,this.finalHeight)}computeSmartParameters(){this.imageManager=new o.default(this.context);const{colorNumber:e,colorNumberCertainty:t,colorData:a}=this.imageManager.computePaletteData();if(console.log(e,t,a),this.options.quantizeStrength=e,t>=.25){const{tileSize:e,certainty:t}=this.imageManager.analyzeImageForTileSize(a),i=Math.sqrt(this.tileWidth*this.tileHeight),n=2.5;e*n>i&&e<i*n&&(console.log("changeFinalCanvasParameters: "+(this.canvas.width/e|0)+"/"+(this.canvas.height/e|0)),this.changeFinalCanvasParameters(this.canvas.width/e|0,this.canvas.height/e|0))}}updateTiles(){this.tilesManager=new s.default(this.context,this.targetContext,this.targetImageData,this.sizes),this.tilesManager.createTiles(),this.tilesManager.computeTiles()}paintTiles(){this.tilesManager.paintTiles()}filterTiles(){this.filters.applyFilters()}setCanvas(e,t,a){e=0|e||1,t=0|t||1,a=a||{width:0,height:0};const i=d.default.initializeCanvas(a);this.canvas=i.canvas,this.context=i.context;const n=d.default.initializeCanvas(void 0,e,t);this.targetCanvas=n.canvas,this.targetContext=n.context,this.targetImageData=this.targetContext.getImageData(0,0,e,t),this.finalWidth=e,this.finalHeight=t,this.tileWidth=Math.fround(this.canvas.width/this.targetCanvas.width),this.tileHeight=Math.fround(this.canvas.height/this.targetCanvas.height)}changeFinalCanvasParameters(e,t){e=0|e||1,t=0|t||1;const a=d.default.initializeCanvas(void 0,e,t);this.targetCanvas=a.canvas,this.targetContext=a.context,this.targetImageData=this.targetContext.getImageData(0,0,e,t),this.finalWidth=e,this.finalHeight=t,this.tileWidth=Math.fround(this.canvas.width/this.targetCanvas.width),this.tileHeight=Math.fround(this.canvas.height/this.targetCanvas.height)}updateThreshold(){const e=this.tilesManager.getTiles();let t=[];for(let n=0;n<this.finalHeight;n++)for(let a=0;a<this.finalWidth;a++){const i=e[a+n*this.finalWidth];this.tilesManager.getExtendedNeighbors(a,n,1).forEach((e=>{t.push(h.default.colorDifference(i.meanColor,e.meanColor))}))}const a=t.reduce(((e,t)=>e+t),0)/t.length,i=Math.sqrt(t.map((e=>Math.pow(e-a,2))).reduce(((e,t)=>e+t))/t.length);return(a+i)/25}processImage(e,t,a){const i=Date.now();if(this.setCanvas(t,a,e),e.width<=t&&e.height<=a)return this.context;const n=Date.now();this.computeSmartParameters();const o=Date.now();this.updateTiles();const r=Date.now();this.updateFilters(this.updateThreshold());const s=Date.now();this.filterTiles();const l=Date.now();this.paintTiles();const _=Date.now();console.log({setCanvas:n-i,updateTilesManager:o-n,initializeTiles:r-o,"updateFilters+updateThreshold":s-r,filterTiles:l-s,paintTiles:_-s});const c=this.targetContext;return this.reset(),c}reset(){Array.of("targetContext","tileHeight","tileWidth","finalWidth","finalHeight","targetImageData","targetContext","targetCanvas","context","canvas","tilesManager","filters","imageManager").forEach((e=>{delete this[e]})),this.canvas=d.default.initializeCanvas(void 0,1,1).canvas,this.targetCanvas=d.default.initializeCanvas(void 0,1,1).canvas}}},679:function(e,t,a){"use strict";var i,n,o;Object.defineProperty(t,"__esModule",{value:!0}),i=a(680),n=(o=i)&&o.__esModule?o:{default:o},t.default=class{constructor(e,t,a,i){this.contextSource=e,this.contextDestination=t,this.imageData=a,this.overlapFactor=i.overlapFactor,this.finalWidth=i.finalWidth,this.finalHeight=i.finalHeight,this.tileWidth=i.tileWidth,this.tileHeight=i.tileHeight,this.tiles=Array(this.finalWidth*this.finalHeight).fill(null),this.tilesColorUint32a=new Uint32Array(this.finalWidth*this.finalHeight),this.tilesColorUint8a=new Uint8ClampedArray(this.tilesColorUint32a.buffer),this.extendedTileWidth=this.tileWidth*this.overlapFactor|0,this.extendedTileHeight=this.tileHeight*this.overlapFactor|0,this.tilePaddingWidth=(this.extendedTileWidth-this.tileWidth)/2+1|0,this.tilePaddingHeight=(this.extendedTileHeight-this.tileHeight)/2+1|0}getTiles(){return this.tiles}extractTileData(e,t){const a=Math.max(0,e*this.tileWidth-this.tilePaddingWidth|0),i=Math.max(0,t*this.tileHeight-this.tilePaddingHeight|0);return this.contextSource.getImageData(0|a,0|i,0|this.extendedTileWidth,0|this.extendedTileHeight)}createTiles(){for(let e=0;e<this.finalHeight;e++)for(let t=0;t<this.finalWidth;t++){const a=t+e*this.finalWidth,i=4*a;this.tiles[a]=new n.default(this.extractTileData(t,e),this.tilesColorUint8a.subarray(i,i+4),t,e)}}computeTiles(){for(let e=0;e<this.tiles.length;e++)this.tiles[e].calculateMeanColor()}getExtendedNeighbors(e,t,a){const i=[];for(let n=-a;n<=a;n++)for(let o=-a;o<=a;o++){const a=e+n,r=t+o;0===n&&0===o||a<0||r<0||a>=this.finalWidth||r>=this.finalHeight||i.push(this.tiles[a+r*this.finalWidth])}return i}paintTiles(){this.imageData.data.set(this.tilesColorUint8a),this.contextDestination.putImageData(this.imageData,0,0)}}},680:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var n,o,r;Object.defineProperty(t,"__esModule",{value:!0}),n=a(651),o=i(n),i(a(660)),r=a(654),t.default=class{constructor(e,t,a=0,i=0){this.imageData=e,this.meanColor=new o.default(t),this.coordinates=Uint16Array.of(a,i);var n=this.imageData.data.length;this.k=n>=64?4:n>=16?3:n>=9||n>=2?2:1}get x(){return this.coordinates[0]}get y(){return this.coordinates[1]}extractColorData(e){let t=Array(e.length/4);for(let a=0;a<e.length;a+=4)t[a/4]=e.subarray(a,a+4);return t}quantizeColors(){const[e,t]=r.QuantiMat.split_image_data(this.imageData),a=(0,r.QuantiMat)({pxls:e,pxl_colors:t,number_of_color:Math.min(t.length,this.k),width:this.imageData.width,height:this.imageData.height}).init().run().output("split"),i=a[0],n=a[1],o=new Uint32Array(n.length);for(var s=0;s<i.length;s++)o[n.indexOf(n[i[s]])]++;return[o,n]}calculateMeanColor(){const[e,t]=this.quantizeColors(),a=t[e.indexOf(Math.max(...Array.from(e)))];this.meanColor.setUint32(a)}}},681:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var n,o,r,s,l,_;Object.defineProperty(t,"__esModule",{value:!0}),n=a(682),o=i(n),r=a(683),s=i(r),l=a(684),_=i(l),t.default=class{constructor(e,t,a,i,n){this.mergeFilter=new o.default(a*e.mergeStrength,t,i,n),this.despeckleFilter=new s.default(a*e.despeckleStrength,t,i,n),this.quantizeFilter=new _.default(e.quantizeStrength,t,i,n)}applyFilters(){}}},682:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var n,o,r,s;Object.defineProperty(t,"__esModule",{value:!0}),n=a(655),o=i(n),r=a(652),s=i(r);class l extends o.default{constructor(e,t,a,i){super(e,t,a,i)}apply(){const e=Array(this.width*this.height).fill(!1);for(let t=0;t<this.height;t++)for(let a=0;a<this.width;a++){const i=a+t*this.width;if(e[i])continue;const n=this.tiles[i],o=this.tilesManager.getExtendedNeighbors(a,t,1),r=o.length,l=o.filter((e=>s.default.colorDifference(n.meanColor,e.meanColor)<this.strength));l.length>=r-2&&(l.forEach((t=>{t.meanColor.setRGBA(n.meanColor.rgba);const a=t.x+t.y*this.width;e[a]=!0})),e[i]=!0)}}}t.default=l},683:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var n,o,r,s,l,_,c,d;Object.defineProperty(t,"__esModule",{value:!0}),n=a(655),o=i(n),r=a(652),s=i(r),l=a(651),_=i(l),c=a(660),d=i(c);class u extends o.default{constructor(e,t,a,i){super(e,t,a,i)}apply(){for(let e=0;e<this.height;e++)for(let t=0;t<this.width;t++)this.adaptiveDespeckleTile(t,e,this.strength)}adaptiveDespeckleTile(e,t,a){const i=this.tiles[e+t*this.width].meanColor,n=this.tilesManager.getExtendedNeighbors(e,t,4),o=this.tilesManager.getExtendedNeighbors(e,t,1),r=n.length,l=n.map((e=>e.meanColor)),{centroids:c,centroidsSorted:u,clusters:h}=new d.default(l.map((e=>e.rgba)),4).run(r);switch(this.determineClassification(u,r)){case"AREA":const e=new _.default(u[0].data),t=s.default.colorDifference(e,i);t>0&&t<60&&i.setRGBA(e.rgba);break;case"EDGE":const a=new _.default(u[0].data),n=new _.default(u[1].data),r=s.default.colorDifference(a,n),l=s.default.colorDifference(a,i),c=s.default.colorDifference(n,i);if(5*Math.abs(l-c)>=r){const e=new _.default(new d.default(o.map((e=>e.meanColor.rgba)),4).run(4).centroidsSorted[0].data);i.setRGBA(e.rgba)}}}determineClassification(e,t){return e[0].count>=.75*t?"AREA":Math.abs(e[0].count-e[1].count)*Math.abs(e[2].count-e[3].count)<25?"SHAPE":Math.abs(e[0].count-e[1].count)<.75*Math.abs(e[1].count-e[2].count)?"EDGE":"COMPLEX"}}t.default=u},684:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var n,o,r,s,l,_;Object.defineProperty(t,"__esModule",{value:!0}),n=a(655),o=i(n),r=a(659),s=i(r),l=a(661),_=i(l);class c extends o.default{constructor(e,t,a,i){super(e,t,a,i)}apply(){const e=this.strength,t=new ImageData(this.tilesManager.tilesColorUint8a,this.width,this.height),{context:a}=_.default.initializeCanvas(t),{imageData:i}=s.default.quantizeImageData(a,e);this.tilesManager.tilesColorUint8a.set(i.data)}}t.default=c},691:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var n=i(a(734)),o=i(a(259));e.exports={UJS:(e,t="COMPRESS_OBJECT",a=null)=>new Promise((function(a,i){"COMPRESS_OBJECT"===t?a(new Uint8ClampedArray(n.default.compress(o.default.pack(e)).buffer)):"DECOMPRESS_UINT8A"===t&&a(o.default.unpack(n.default.uncompress(e)))}))}},822:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var n=i(a(657)),o=i(a(155)),r=i(a(823));e.exports={base64png_to_xbrz_svg:(e,t,i,s,l=[],_="xbrz",c=!1,d=!1,u=!1)=>{let h=new Image;h.onload=()=>{var e,p,f;let m=document.createElement("canvas"),g=m.getContext("2d");const{width:w,height:y}=h;m.width=w,m.height=y,g.drawImage(h,0,0,w,y);let b=g.getImageData(0,0,w,y);const v=(e,t)=>new Promise((function(t,i){(0,o.default)((()=>a.e(3).then(a.t.bind(null,719,7)))).then((({crt:a})=>{a(e,1).then(t).catch(i)}))})),x=(e,t,i,r,s)=>{c?(0,o.default)((()=>a.e(1).then(a.t.bind(null,665,7)))).then((({oxi_png:l})=>{l(e,3,!1,n.default).then((e=>{s(e,t,i,r)})).catch((()=>{(0,o.default)((()=>a.e(0).then(a.t.bind(null,656,7)))).then((({png_quant:a})=>{a(e,100,100,1,n.default).then((e=>{s(e,t,i,r)})).catch((()=>{s(e,t,i,r)}))})).catch((()=>{s(e,t,i,r)}))}))})).catch((()=>{s(e,t,i,r)})):s(e,t,i,r)},k=(e,t)=>{d?(0,o.default)((()=>a.e(21).then(a.t.bind(null,939,7)))).then((({image_tracer:r})=>{r(e,{pal:l.map((e=>({r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16),a:parseInt(e.slice(7,9),16)}))),corsenabled:!1,ltres:t,qtres:t,pathomit:t,rightangleenhance:!1,colorsampling:2,numberofcolors:512,mincolorratio:0,colorquantcycles:1,layering:0,strokewidth:Math.ceil(t/2),linefilter:!0,scale:1,roundcoords:2,viewbox:!0,desc:!1,lcpr:0,qcpr:0,blurradius:t,blurdelta:4*t},n.default).then((e=>{c?(0,o.default)((()=>a.e(2).then(a.bind(null,689)))).then((({optimize:a})=>{e=a(e,{path:"path-to.svg",multipass:!0,mergePaths:!0,mergeStyles:!0,collapseGroups:!0,reusePaths:!0,plugin:["multipass","mergePaths","collapseGroups","reusePaths","mergeStyles"]}).data,i("data:image/svg+xml;base64,"+window.btoa(e),t)})):i("data:image/svg+xml;base64,"+window.btoa(e),t)}))})):i("",0)};if("depixelize"===_){const n=10;p=(e=(0,r.default)(b,d))[0],f=e[1];let l=document.createElement("canvas");l.width=p.width,l.height=p.height;let _=l.getContext("2d");_.putImageData(p,0,0);let h=_.canvas.toDataURL("image/png");u&&v(p).then((function(e){let t=document.createElement("canvas");t.width=e.width,t.height=e.height,t.getContext("2d").putImageData(e,0,0);let a=t.toDataURL("image/png");x(a,n,e.width,e.height,s)})),d&&(c?(0,o.default)((()=>a.e(2).then(a.bind(null,689)))).then((({optimize:e})=>{f=e(f,{path:"path-to.svg",multipass:!0,plugin:["mergePaths"]}).data,i("data:image/svg+xml;base64,"+window.btoa(f),n)})):i("data:image/svg+xml;base64,"+window.btoa(f),n)),x(h,n,p.width,p.height,t)}else"omniscale"===_?(0,o.default)((()=>a.e(22).then(a.t.bind(null,940,7)))).then((({omniscale:e})=>{e(b,8,n.default).then((e=>{let a=document.createElement("canvas");a.width=e.width,a.height=e.height;let i=a.getContext("2d");i.putImageData(e,0,0);let n=i.canvas.toDataURL("image/png");u&&v(e).then((function(e){let t=document.createElement("canvas");t.width=e.width,t.height=e.height,t.getContext("2d").putImageData(e,0,0);let a=t.toDataURL("image/png");x(a,8,e.width,e.height,s)})),k(e,8),x(n,8,e.width,e.height,t)}))})):"hexagon"===_?(0,o.default)((()=>a.e(6).then(a.t.bind(null,720,7)))).then((({hexagonrender:e})=>{e(b,16).then((e=>{let a=document.createElement("canvas");a.width=e.width,a.height=e.height;let i=a.getContext("2d");i.putImageData(e,0,0);let n=i.canvas.toDataURL("image/png");u&&v(e).then((function(e){let t=document.createElement("canvas");t.width=e.width,t.height=e.height,t.getContext("2d").putImageData(e,0,0);let a=t.toDataURL("image/png");x(a,16,e.width,e.height,s)})),k(e,32/6),x(n,32,e.width,e.height,t)}))})):"kikko"===_?(0,o.default)((()=>a.e(38).then(a.t.bind(null,941,7)))).then((({kikkorender:e})=>{e(b,24,n.default).then((e=>{let a=document.createElement("canvas");a.width=e.width,a.height=e.height;let i=a.getContext("2d");i.putImageData(e,0,0);let n=i.canvas.toDataURL("image/png");u&&v(e).then((function(e){let t=document.createElement("canvas");t.width=e.width,t.height=e.height,t.getContext("2d").putImageData(e,0,0);let a=t.toDataURL("image/png");x(a,24,e.width,e.height,s)})),k(e,6),x(n,48,e.width,e.height,t)}))})):"hqnx"===_?(0,o.default)((()=>a.e(20).then(a.t.bind(null,942,7)))).then((({hqnx:e})=>{e(b,4,n.default).then((e=>{let a=document.createElement("canvas");a.width=e.width,a.height=e.height;let i=a.getContext("2d");i.putImageData(e,0,0);let n=i.canvas.toDataURL("image/png");u&&v(e).then((function(e){let t=document.createElement("canvas");t.width=e.width,t.height=e.height,t.getContext("2d").putImageData(e,0,0);let a=t.toDataURL("image/png");x(a,4,e.width,e.height,s)})),k(e,4),x(n,4,e.width,e.height,t)}))})):"epx"===_?(0,o.default)((()=>a.e(19).then(a.t.bind(null,943,7)))).then((({epx:e})=>{e(b,4,n.default).then((e=>{let a=document.createElement("canvas");a.width=e.width,a.height=e.height;let i=a.getContext("2d");i.putImageData(e,0,0);let n=i.canvas.toDataURL("image/png");u&&v(e).then((function(e){let t=document.createElement("canvas");t.width=e.width,t.height=e.height,t.getContext("2d").putImageData(e,0,0);let a=t.toDataURL("image/png");x(a,4,e.width,e.height,s)})),k(e,4),x(n,4,e.width,e.height,t)}))})):(0,o.default)((()=>a.e(4).then(a.t.bind(null,721,7)))).then((e=>{e.default(b,6,n.default).then((e=>{let a=document.createElement("canvas");a.width=e.width,a.height=e.height;let i=a.getContext("2d");i.putImageData(e,0,0);let n=i.canvas.toDataURL("image/png");u&&v(e).then((function(e){let t=document.createElement("canvas");t.width=e.width,t.height=e.height,t.getContext("2d").putImageData(e,0,0);let a=t.toDataURL("image/png");x(a,6,e.width,e.height,s)})),k(e,6),x(n,6,e.width,e.height,t)}))}))},h.src=e}}},823:function(e,t,a){"use strict";function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function n(){function e(e,t,a){return Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}),e[t]}function t(e,t,a,i){var n=t&&t.prototype instanceof o?t:o,r=Object.create(n.prototype),s=new p(i||[]);return b(r,"_invoke",{value:c(e,a,s)}),r}function a(e,t,a){try{return{type:"normal",arg:e.call(t,a)}}catch(i){return{type:"throw",arg:i}}}function o(){}function r(){}function s(){}function l(t){["next","throw","return"].forEach((function(a){e(t,a,(function(e){return this._invoke(a,e)}))}))}function _(e,t){function n(o,r,s,l){var _,c,d=a(e[o],e,r);if("throw"!==d.type)return(c=(_=d.arg).value)&&"object"==i(c)&&y.call(c,"__await")?t.resolve(c.__await).then((function(e){n("next",e,s,l)}),(function(e){n("throw",e,s,l)})):t.resolve(c).then((function(e){_.value=e,s(_)}),(function(e){return n("throw",e,s,l)}));l(d.arg)}var o;b(this,"_invoke",{value:function(e,a){function i(){return new t((function(t,i){n(e,a,t,i)}))}return o=o?o.then(i,i):i()}})}function c(e,t,i){var n="suspendedStart";return function(o,r){var s,l,_;if("executing"===n)throw Error("Generator is already running");if("completed"===n){if("throw"===o)throw r;return{value:void 0,done:!0}}for(i.method=o,i.arg=r;;){if((s=i.delegate)&&(l=d(s,i))){if(l===C)continue;return l}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===n)throw n="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);if(n="executing","normal"===(_=a(e,t,i)).type){if(n=i.done?"completed":"suspendedYield",_.arg===C)continue;return{value:_.arg,done:i.done}}"throw"===_.type&&(n="completed",i.method="throw",i.arg=_.arg)}}}function d(e,t){var i,n,o=t.method,r=e.iterator[o];return void 0===r?(t.delegate=null,"throw"===o&&e.iterator.return&&(t.method="return",t.arg=void 0,d(e,t),"throw"===t.method)||"return"!==o&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+o+"' method")),C):"throw"===(i=a(r,e.iterator,t.arg)).type?(t.method="throw",t.arg=i.arg,t.delegate=null,C):(n=i.arg)?n.done?(t[e.resultName]=n.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,C):n:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,C)}function u(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function h(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function p(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(u,this),this.reset(!0)}function f(e){var t,a,i;if(e){if(t=e[x])return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return a=-1,(i=function t(){for(;++a<e.length;)if(y.call(e,a))return t.value=e[a],t.done=!1,t;return t.value=void 0,t.done=!0,t}).next=i}return{next:m}}function m(){return{value:void 0,done:!0}}var g,w,y,b,v,x,k,E,C,S,I,M,D;n=function(){return g},g={},y=(w=Object.prototype).hasOwnProperty,b=Object.defineProperty||function(e,t,a){e[t]=a.value},v="function"==typeof Symbol?Symbol:{},x=v.iterator||"@@iterator",k=v.asyncIterator||"@@asyncIterator",E=v.toStringTag||"@@toStringTag";try{e({},"")}catch(T){e=function(e,t,a){return e[t]=a}}return g.wrap=t,C={},e(S={},x,(function(){return this})),(M=(I=Object.getPrototypeOf)&&I(I(f([]))))&&M!==w&&y.call(M,x)&&(S=M),D=s.prototype=o.prototype=Object.create(S),r.prototype=s,b(D,"constructor",{value:s,configurable:!0}),b(s,"constructor",{value:r,configurable:!0}),r.displayName=e(s,E,"GeneratorFunction"),g.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===r||"GeneratorFunction"===(t.displayName||t.name))},g.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,e(t,E,"GeneratorFunction")),t.prototype=Object.create(D),t},g.awrap=function(e){return{__await:e}},l(_.prototype),e(_.prototype,k,(function(){return this})),g.AsyncIterator=_,g.async=function(e,a,i,n,o){void 0===o&&(o=Promise);var r=new _(t(e,a,i,n),o);return g.isGeneratorFunction(a)?r:r.next().then((function(e){return e.done?e.value:r.next()}))},l(D),e(D,E,"Generator"),e(D,x,(function(){return this})),e(D,"toString",(function(){return"[object Generator]"})),g.keys=function(e){var t,a=Object(e),i=[];for(t in a)i.push(t);return i.reverse(),function e(){for(;i.length;){var t=i.pop();if(t in a)return e.value=t,e.done=!1,e}return e.done=!0,e}},g.values=f,p.prototype={constructor:p,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(h),!e)for(var t in this)"t"===t.charAt(0)&&y.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){function t(t,i){return o.type="throw",o.arg=e,a.next=t,i&&(a.method="next",a.arg=void 0),!!i}var a,i,n,o,r,s;if(this.done)throw e;for(a=this,i=this.tryEntries.length-1;i>=0;--i){if(n=this.tryEntries[i],o=n.completion,"root"===n.tryLoc)return t("end");if(n.tryLoc<=this.prev)if(r=y.call(n,"catchLoc"),s=y.call(n,"finallyLoc"),r&&s){if(this.prev<n.catchLoc)return t(n.catchLoc,!0);if(this.prev<n.finallyLoc)return t(n.finallyLoc)}else if(r){if(this.prev<n.catchLoc)return t(n.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return t(n.finallyLoc)}}},abrupt:function(e,t){var a,i,n,o;for(a=this.tryEntries.length-1;a>=0;--a)if((i=this.tryEntries[a]).tryLoc<=this.prev&&y.call(i,"finallyLoc")&&this.prev<i.finallyLoc){n=i;break}return n&&("break"===e||"continue"===e)&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null),(o=n?n.completion:{}).type=e,o.arg=t,n?(this.method="next",this.next=n.finallyLoc,C):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),C},finish:function(e){var t,a;for(t=this.tryEntries.length-1;t>=0;--t)if((a=this.tryEntries[t]).finallyLoc===e)return this.complete(a.completion,a.afterLoc),h(a),C},catch:function(e){var t,a,i,n;for(t=this.tryEntries.length-1;t>=0;--t)if((a=this.tryEntries[t]).tryLoc===e)return"throw"===(i=a.completion).type&&(n=i.arg,h(a)),n;throw Error("illegal catch attempt")},delegateYield:function(e,t,a){return this.delegate={iterator:f(e),resultName:t,nextLoc:a},"next"===this.method&&(this.arg=void 0),C}},g}function o(e,t){var a,i,n,o,r,s="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!s){if(Array.isArray(e)||(s=u(e))||t&&e&&"number"==typeof e.length)return s&&(e=s),a=0,{s:i=function(){},n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:i};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return n=!0,o=!1,{s:function(){s=s.call(e)},n:function(){var e=s.next();return n=e.done,e},e:function(e){o=!0,r=e},f:function(){try{n||null==s.return||s.return()}finally{if(o)throw r}}}}function r(e){var t="function"==typeof Map?new Map:void 0;return r=function(e){function a(){return s(e,arguments,c(this).constructor)}if(null===e||(i=e,-1===Function.toString.call(i).indexOf("[native code]")))return e;var i;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,a)}return a.prototype=Object.create(e.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),_(a,e)},r(e)}function s(e,t,a){return s=l()?Reflect.construct.bind():function(e,t,a){var i,n=[null];return n.push.apply(n,t),i=new(Function.bind.apply(e,n)),a&&_(i,a.prototype),i},s.apply(null,arguments)}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _(e,t){return _=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_(e,t)}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a,i,n,o,r,s,l,_=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=_){r=[],s=!0,l=!1;try{if(n=(_=_.call(e)).next,0===t){if(Object(_)!==_)return;s=!1}else for(;!(s=(a=n.call(_)).done)&&(r.push(a.value),r.length!==t);s=!0);}catch(c){l=!0,i=c}finally{try{if(!s&&null!=_.return&&(o=_.return(),Object(o)!==o))return}finally{if(l)throw i}}return r}}(e,t)||u(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){if(e){if("string"==typeof e)return h(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?h(e,t):void 0}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=Array(t);a<t;a++)i[a]=e[a];return i}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){var a,n,o;for(a=0;a<t.length;a++)(n=t[a]).enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=function(e,t){var a,n;if("object"!==i(e)||null===e)return e;if(void 0!==(a=e[Symbol.toPrimitive])){if("object"!==i(n=a.call(e,"string")))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return e+""}(n.key),"symbol"===i(o)?o:o+""),n)}function m(e,t,a){return t&&f(e.prototype,t),a&&f(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function g(e){var t=e.length;return e.forEach((function(e,a,i){e.addEdge(i[(a+1)%t])})),e}Object.defineProperty(t,"__esModule",{value:!0});var w=function(){function e(e,t,a){return[u(e,t,a),h(e,t,a),u(e,t+1,a),h(e,t,a+1)]}function t(e,t,a,i,n){var o,r=Array(n);for(o=0;o<n;++o)r[o]=e[o+a].slice(t,t+i);return r}function a(){this.vertices=[]}var s,u,h,f,g,w,y,b,v,x=function(){function e(t){var a,i=d(t,3),n=i[0],o=i[1],r=i[2];p(this,e),a=.299*n+.587*o+.114*r,this.y=Math.round(a),this.u=Math.round(.492*(r-a)),this.v=Math.round(.877*(n-a)),this.r=n,this.g=o,this.b=r,this.rgb=[n,o,r]}return m(e,[{key:"dissimilar",value:function(e){return Math.abs(this.r-e.r)+Math.abs(this.g-e.g)+Math.abs(this.b-e.b)>=1}},{key:"toString",value:function(){return"rgb("+this.rgb.join()+")"}}]),e}(),k=function(){function e(t,a){p(this,e),this.x=t,this.y=a,this.edges=[]}return m(e,[{key:"split",value:function(t){return new e((this.x+t.x)/2,(this.y+t.y)/2)}},{key:"adjust",value:function(e,t){return this.x+=e,this.y+=t,this}},{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"equals",value:function(e){return this.x===e.x&&this.y===e.y}},{key:"addEdge",value:function(e){-1==this.edges.indexOf(e)&&(this.edges.push(e),e.addEdge(this))}}]),e}(),E=function(e){function t(e){var a;return p(this,t),(a=r.call(this,1))[0]=e,a.circular=!1,a}!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_(e,t)}(t,e);var a,n,r=(a=t,n=l(),function(){var e,t,o=c(a);return n?(t=c(this).constructor,e=Reflect.construct(o,arguments,t)):e=o.apply(this,arguments),function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});return m(t,[{key:"splitAt",value:function(e){var a,i,n,r,s;if(1!==this.length){if(this[0]===e)this.shift();else if(this[this.length-1]===e)this.pop();else if(this.circular)for(a=this.shift();a!==e;a=this.shift())this.push(a);else{i=this.indexOf(e),r=o(n=this.slice(i+1));try{for(r.s();!(s=r.n()).done;)s.value.curve=n}catch(l){r.e(l)}finally{r.f()}this.length=i}e.curve=new t(e)}}},{key:"merge",value:function(e){var t,a,i,n,o,r;if(this!==e)for(a=(t=d([this,e].sort((function(e,t){return e.length-t.length})),2))[0],-1!==(i=t[1])[0].edges.indexOf(a[0])?(n=this.shift,o=this.unshift):-1!==i[0].edges.indexOf(a[a.length-1])?(n=this.pop,o=this.unshift):-1!==i[i.length-1].edges.indexOf(a[0])?(n=this.shift,o=this.push):-1!==i[i.length-1].edges.indexOf(a[a.length-1])&&(n=this.pop,o=this.push);a.length;)r=n.call(a),o.call(i,r),r.curve=i;else this.circular=e.length>2}}],[{key:"curve",value:function(e,t){return e.curve===t.curve?e.curve.length:0}}]),t}(r(Array)),C=function(){function e(t,a,i,n){p(this,e),this.x=t,this.y=a,this.edges=[,,,,,,,,],this.vertices=n||[],this.color=i,this.marked=!1,this.curve=new E(this)}return m(e,[{key:"relativePosition",value:function(e){var t=e.x,a=e.y-this.y;return(t-this.x+3*a+8)%9}},{key:"invalidCurve",value:function(){return this.valence()>2&&this.curve.length>1}},{key:"updateCurves",value:function(){this.valence()>2&&this.curve.splitAt(this)}},{key:"equals",value:function(e){return this.x===e.x&&this.y===e.y}},{key:"removeEdge",value:function(t){e.removeEdge(this,t)}},{key:"canReach",value:function(e){return e&&!!this.edges[this.relativePosition(e)]}},{key:"valence",value:function(){return this.edges.filter((function(e){return e})).length}},{key:"toString",value:function(){return"("+[this.x,this.y].join()+") => "+this.edges.filter((function(e){return e})).map((function(e){return"("+[e.x,e.y].join()+")"})).join()}},{key:"edge",value:function(e,t){return this.edges[(e+3*t+8)%9]}},{key:"right",value:function(){return this.edges[0]}},{key:"left",value:function(){return this.edges[7]}},{key:"up",value:function(){return this.edges[5]}},{key:"down",value:function(){return this.edges[2]}},{key:"isEdge",value:function(){return this.edges.filter((function(e){return e})).length<4}},{key:"follow",value:n().mark((function e(t){var a,i,o;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=this;case 1:if(!(a.canReach(t)&&a.valence()<3)){e.next=14;break}return e.next=4,t;case 4:if(!(t.valence()>2)){e.next=6;break}return e.abrupt("break",14);case 6:if(i=t.edges.filter((function(e){return e})),o=i[0]!=a?i[0]:i[1],a=t,(t=o)!=this){e.next=12;break}return e.abrupt("break",14);case 12:e.next=1;break;case 14:case"end":return e.stop()}}),e,this)}))},{key:"square",value:function(){var e=d(this.edges,3),t=e[0],a=e[2],i=t&&a&&t.down()&&a.right();return[this,t,a,i].filter((function(e){return e}))}}],[{key:"addSimilarEdge",value:function(e,t){e.color&&t.color&&!e.color.dissimilar(t.color)&&(e.edges[e.relativePosition(t)]=t,t.edges[t.relativePosition(e)]=e,e.valence()>2&&e.curve.splitAt(e),t.valence()>2&&t.curve.splitAt(t),e.valence()<3&&t.valence()<3&&e.curve.merge(t.curve))}},{key:"removeEdge",value:function(e,t){e.edges[e.relativePosition(t)]=void 0,t.edges[t.relativePosition(e)]=void 0}}]),e}(),S=function(){function e(t,a,i){if(p(this,e),t.length!=a*i*4)throw Error("Wrong dimension of pixel buffer");this.width=a,this.height=i,this.pixels=t}return m(e,[{key:"create",value:n().mark((function e(){var t,a,i,o,r,s,l,_,c,d,u,h,p,f,m;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=this.width,a=this.height,i=Array(a),(o=Array(a+1))[0]=Array(t+1),r=0;r<t+1;++r)o[0][r]=new k(r,0);s=new C,l=Array(t).fill(s),r=0;case 9:if(!(r<a)){e.next=31;break}_=[s,s],c=i[r]=Array(t),d=o[r],(u=o[r+1]=Array(t+1))[0]=new k(0,r+1),h=0;case 16:if(!(h<t)){e.next=27;break}return u[h+1]=new k(h+1,r+1),p=[d[h],d[h+1],u[h+1],u[h]],f=c[h]=new C(h,r,this.pixel(h,r),p),m=[l[h],f],e.next=23,[_,m];case 23:_=m;case 24:++h,e.next=16;break;case 27:l=c;case 28:++r,e.next=9;break;case 31:this.nodes_old=i,this.vertices=i;case 33:case"end":return e.stop()}}),e,this)}))},{key:"createSimilarityGraph",value:function(){var e,t,a,i,n,r,s,l,_=o(this.create());try{for(_.s();!(e=_.n()).done;)t=d(e.value,2),i=(a=d(t[0],2))[0],n=a[1],s=(r=d(t[1],2))[0],l=r[1],C.addSimilarEdge(s,l),C.addSimilarEdge(n,l),4!==i.square().length&&(C.addSimilarEdge(s,n),C.addSimilarEdge(i,l))}catch(c){_.e(c)}finally{_.f()}return this}},{key:"graph",value:function(){this.height,this.width}},{key:"nodes",value:n().mark((function(){var e,t,a,i,o;return n().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:a=this.width,i=this.height,o=this.nodes_old,t=0;case 2:if(!(t<i)){n.next=13;break}e=0;case 4:if(!(e<a)){n.next=10;break}return n.next=7,o[t][e];case 7:++e,n.next=4;break;case 10:++t,n.next=2;break;case 13:case"end":return n.stop()}}),o,this)}))},{key:"diagonals",value:n().mark((function e(){var t,a,i,o,r,s,l,_,c,d,u;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=this.width,s=this.height,l=this.nodes_old,a=1;case 2:if(!(a<s)){e.next=22;break}i=l[a-1],o=l[a],t=1;case 6:if(!(t<r)){e.next=19;break}if(_=i[t-1],c=i[t],d=o[t-1],u=o[t],!(_.canReach(c)||_.canReach(d)||u.canReach(c)||u.canReach(d))){e.next=13;break}return e.abrupt("continue",16);case 13:if(!_.canReach(u)||!c.canReach(d)){e.next=16;break}return e.next=16,[[_,u],[d,c]];case 16:++t,e.next=6;break;case 19:++a,e.next=2;break;case 22:case"end":return e.stop()}}),e,this)}))},{key:"pixel",value:function(e,t){var a=t*this.width*4+4*e;return new x(this.pixels.subarray(a,a+3))}}]),e}();return S.diagonals=function(e){return e[0][0].canReach(e[0][1])+e[1][0].canReach(e[1][1])},u=(s=function(e,t){var a=e,i=t;return function(e,t,n){return[e[n][t],e[n+i][t+a]]}})(0,1),h=s(1,0),f=s(1,1),g=s(1,-1),S.prototype.getDiagonals=function(e,t){return[f(this.nodes_old,e,t),g(this.nodes_old,e,t+1)]},w=function(e){return e[0].canReach(e[1])},y=function(e){return!e},b=function(e,t,a,i){return function(n){var o,r;for(n=n[0].edges.filter((function(e){return e})),o=[];n.length>0;)r=n.pop(),-1==o.indexOf(r)&&r.x>e&&r.x<t&&r.y>a&&r.y<i&&(o.push(r),n=n.concat(r.edges.filter((function(e){return e}))));return o}},S.prototype.linearize=function(){var t,a,i,n,o,r,s,l,_;for(t=1;t<this.width;++t)for(a=1;a<this.height;++a)e(this.nodes_old,t-1,a-1).map(w).every(y)&&(n=[0,0],o=(i=this.getDiagonals(t-1,a-1)).map(b(t-3,t+2,a-3,a+2)),(s=(r=i.map((function(e){return E.curve(e[0],e[1])})))[0]-r[1])>0?n[0]+=s:n[1]-=s,(l=o[0].length-o[1].length)>0?n[1]+=l:n[0]-=l,(_=i.map((function(e){return 1==e[0].valence()||1==e[1].valence()})))[0]&&!_[1]?n[0]+=5:!_[0]&&_[1]&&(n[1]+=5),n[0]>n[1]?C.removeEdge(i[1][0],i[1][1]):n[0]<n[1]?C.removeEdge(i[0][0],i[0][1]):(C.removeEdge(i[0][0],i[0][1]),C.removeEdge(i[1][0],i[1][1])));return this},v=function(e){var t,a,i,n=e[0][1];n.edge(-1,1)&&(i=(a=(t=n.vertices)[3]).clone(),n.down()||a.adjust(.25,.25),n.left()||i.adjust(-.25,-.25),e[0][0].vertices[2]=i,t.splice(4,0,i),i=(t=e[1][0].vertices).splice(0,1,i).pop(),t.push(i)),n.edge(1,1)&&(i=(a=(t=n.vertices)[2]).clone(),n.down()||a.adjust(-.25,.25),n.right()||i.adjust(.25,-.25),e[0][2].vertices[3]=i,t.splice(2,0,i),i=(t=e[1][2].vertices).splice(0,1,i).pop(),t.push(i))},S.prototype.createVoronoiDiagram=function(){var e,a,i,n=this.width-2,o=this.height-1,r=this.nodes_old;for(e=0;e<o;++e){for((a=t(r,0,e,2,2))[0].unshift(new C),a[1].unshift(new C),v(a),i=0;i<n;++i)v(t(r,i,e,3,2));(a=t(r,i,e,2,2))[0].push(new C),a[1].push(new C),v(a)}return this},S.prototype.contour=function(e){var t,a,i,n,o,r,s,l,_,c,d=e,u=[];if(0===d.valence())return d.vertices.slice();if(d.marked||!d.isEdge()||[[-1,-1],[0,-1],[1,-1]].some((function(e){return null!=this.edge.apply(this,e)}),d))return u;for(a=[],i=1,n=0,d.vertices[0],r=null;;){switch(d.marked=!0,a.push(d),t=void 0,i){case 1:if(t=d.edge(1,-1)){i=7;break}case 2:if(t=d.edge(1,0)){i=0;break}case 3:if(t=d.edge(1,1)){i=1;break}case 4:if(t=d.edge(0,1)){i=2;break}case 5:if(t=d.edge(-1,1)){i=3;break}case 6:if(t=d.edge(-1,0)){i=4;break}case 7:if(t=d.edge(-1,-1)){i=5;break}case 0:i=(t=d.edge(0,-1))?6:1}if(t){for(s=n,l=d.vertices.length,r&&t.equals(r)&&(o=d.vertices[s++%l],u.push(o));;){if(o=d.vertices[s++%l],-1!=(_=t.vertices.indexOf(o))){n=_;break}u.push(o)}if(e.equals(t)&&e.edges.filter((function(e){return e})).every((function(e){return e.marked||!e.isEdge()}))){for(s=n,l=t.vertices.length;s<l;)o=t.vertices[s++],u.push(o);break}r=d,d=t}}for(;0!=a.length;)(c=a.pop().edges.filter((function(e){return e&&!e.marked}))).forEach((function(e){e.marked=!0})),a.push.apply(a,c);return u},a.prototype=Object.create(null,{push:{enumerable:!1,value:function(e){this.vertices.push(e),e.addPath(this)}},splitAt:{enumerable:!1,value:function(e){var t=new a;t.vertices=this.vertices.slice(e),this.vertices.length=e+1,t.vertices.forEach((function(e){e.removePath(this),e.addPath(t)}))}}}),S.prototype.paths=function(e){new a},function(e,t,a){return new S(e,t,a)}}();t.default=function(e,t,a){var i,n=w(e.data,e.width,e.height);return n.createSimilarityGraph(),n.createVoronoiDiagram(),n.linearize(),i=function(e,t){var a,i,n,o,r=e.width,s=e.height,l=e.nodes(),_=[];for(let c of l){for(a="L",n=(i=g(c.vertices))[0],o=0;o<i.length;++o)n=i[o],a+=`${Math.ceil(n.x*t)},${Math.ceil(n.y*t)} `;_.push(`<path fill="${c.color}" d="M${Math.ceil(i[0].x*t)},${Math.ceil(i[0].y*t)} ${a}Z"/>`)}return`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${r*t} ${s*t}">${""+_.join("\n\t")}</svg>`}(n,t),i}},824:function(e,t,a){"use strict";var i=a(825);e.exports={loadJSON:function(e,t){let a=new XMLHttpRequest;try{a=new XMLHttpRequest}catch(i){try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(i){try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(i){t("Cannot load data",null)}}}a.open("GET",e,!0),a.onreadystatechange=function(){if(4==a.readyState&&200==a.status)try{let e=JSON.parse(a.responseText);t(null,e)}catch(i){t("Cannot understand response from network.",null)}else 4==a.readyState&&404==a.status&&t("Error 404",null)};try{a.send()}catch(i){t("Failed to fetch",null)}},postJSON:function(e,t,a,n="application/x-www-form-urlencoded"){let o=new Headers;o.append("Content-Type",n);let r="multipart/form-data"===n?new FormData:new URLSearchParams;Object.entries(t).forEach((e=>{const[t,a]=e;r.append(t,a)}));let s={method:"POST",redirect:"follow",headers:o,body:"application/text"===n?t:"application/json"===n?(0,i.clean_json_text)(JSON.stringify(t)):r};fetch(e,s).then((e=>e.text())).then((e=>a(null,e))).catch((e=>a(e,null)))},postDATA:function(e,t,a){let i=new XMLHttpRequest;try{i=new XMLHttpRequest}catch(n){try{i=new ActiveXObject("Msxml2.XMLHTTP")}catch(n){try{i=new ActiveXObject("Microsoft.XMLHTTP")}catch(n){return void a("Cannot load data",null)}}}i.open("POST",e,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){if(4==i.readyState&&200==i.status)try{let e=JSON.parse(i.responseText);a(null,e)}catch(n){a("Cannot understand response from network.",null)}else 4==i.readyState&&404==i.status&&a("Error 404",null)};try{i.send(t)}catch(n){a("Failed to post",null)}}}},825:function(e,t,a){"use strict";e.exports={clean_json_text:function(e){return(e=e.replace(/\\n/g,"\\n").replace(/\\'/g,"\\'").replace(/\\"/g,'\\"').replace(/\\&/g,"\\&").replace(/\\r/g,"\\r").replace(/\\t/g,"\\t").replace(/\\b/g,"\\b").replace(/\\f/g,"\\f")).replace(/[\u0000-\u0019]+/g,"")}}}}]);