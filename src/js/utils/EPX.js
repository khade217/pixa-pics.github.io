"use strict";

import {load as LZEL_92} from "./LZEL_92_loader";
var epx_process_function = LZEL_92(`UraniumJS! H~=2;EgLwbkh9kw§s.*Psa>5Bp]&3+^prjIe:{<bw]?Yg{garAf<5jZcTIf_% h}O0e|M7YGWGtn+^)C*x§DHvJio_&XDmbZx~CU) I,Gz5%2#GlT9H+(U,H¡[S%NDfJ)VAqc##Lxup0M@r(sG2#~fk#vFQ]OI¡#OeE1vqOtqpv9qQi+UBqm¡dUu{fhDrow=F6dB<P_AT0qplm!Z,;qQZ3rTWC0NjQ)KpBoc§¡T]XrHcF§BcV0U>aI<qY3]:EiM*W+xpE0YLpxzDAp F<HU|B_&eD~v-ztL%J=hRHJ~9w2g4_G4j=Iu!]*Qz%CX?NUz#X{WS%o8Gs8K6&*C@S=11rN:~FBm 1HQRDC* t=Q<EQU|bgYJ>J¡b^x5a?FtLxo*3%4pBS* ]P  3~B*tEENvMv{=Mi@?m&Rub:#HM6uNt1X-WDg#LL?OCb* k,.T7jm66]@N8uAJL1IXjB p{?=:4EadT4fRnxNu1<81DU)jbxsF[RY%Uan5l- !&-rE_?QH:G+NosZZ@rMRPj >QbMC-htu_Bmb3,%d*w1++n&&@4(Vs65>@4Gi~vk]T#q>*tEI|vm7XI_>8D??T&l>7IVrBHM?@?1QML{nm-J}q zZ6InlGa2?UzSOzU8*H@]d(@JAg:|D[1 RywWqOB~b0Jw7[%a<x@+J=e6&qzS¡^70u9aLt&Zi]Hw.PsMKPBs{OdA;dS5rsh=Z:o=G.2V1XG2V310XK[Yy2+Vq*&QkD.¡dEBNY=&U<rH34N:Er ov]c%x5Hb6sO5qWf^pr!6nj^hRfQ[wEj78PLpj¡ET02J2nv^i+-,Sw[*-w^K6>XChk70cU{,eWr**B%>_Z(dxB^;ibE8%D}![DNU3MZ[i}G&9[+pp=Fr|%+I{Ugu+2xj?&LLZ-,Iz[d*kJ_q:a4EZs§s,yTd=r[433Ba!,>|^*yCt7bvg+sn.B)xZ%.)Nor4mY3L&Jbfb8FIq,F<*A5R;dW#US2!:.!§j[ tqq:8KX=AMhX6>6R?rIE3b9r-1§q[TmM%>++1BERqurg)O7Nka#d+~x9GKip1w5;o+>F*6W=tjbVxal2JLA1!=5c&)§8F-deH4f;f~v6df}fq7;Rce{|QGJg*w(?llPZd&;E(%ZM.,dpJa:)l#B(my6y{A<¡bG&^*K#y[NR[]4wXcSdRitq+g|[sebnSW=^Q ,?#BLO29peb7N%+kBOMA%C!W¡§_Rkn+e*9o>gW2wSekwXdWtLqlX@,&Y1Lv83Rc59.Pe6)s3.@?cpJ~WPJ6{+])7ckL,*§ =5SP-O#_0wWzwxzE@O;u1¡wz7a>xxt*oIn¡7%ydL!Yy{R&S[8tL*:jzD-E?hf EcAsjDo82@QmoT%o7#OSZ<V9%?.XzgEocg[vMQW9y |lXIw^:2}Y§{(TM-[v5|l@O_uPb_ImkN-o2cZ|¡&5FMkYR,TkY{){tQV8Aw0b6kxoDG|~w}GHl-g*>42]iys%+:TX^IFd1.zSU{6]e|wx)4Vo>] 3djkABfA%8>q?.*0tqG^@ kfp:_w0pY%?=ou6[p|!I,5jcdvN§n{P~ViB#[ TBk8^^E#6~m[VmNgd~M%{Hj<:ySB4H}+|@@2lIT_7dfrq[m(0eY6|uz6iE}BkqTfwVW[.%NA(:; (1~hBp;sLm>tqn6A ,xwe_6kV2_q *k~L*09pl]u:txTlB5(T0[q3vS^JvEUc-Nh*P~§l]_@LDb*B%p,F,|W;]7otm6Xs* ?}!8r[|<qmOD[_2X_.za=D¡*eG+|=2EFUoh]K5:G@gGTbSCWk-Tglf]?LXbbmZG?B yP4K=ThO@dI45sR04Fk6L1rp|[>&xj2gQ?(|I%,T?zeYQ<oxtz2@#e[gAb>e.MJwR?MoLwh|UJzVr+E+<¡{o~HW0x*!+@waM¡Pz+bw^}eV|D g(.biXGI4;iaiQt*a@f?dc_#[tN<&84,6O}Xgyi]Nx5QN-WOq6AIGl Gv.Qm*DwfA=H!AJ1%VB8fWQY*.ee@>TQQGW^tPUuN5E++Ko3!<b} Rt50&J.]¡s8kBHqf O*VHh5c%h|:Pdufzr?BM4q:B0f_f3JA36t+yO:?C=6XvQya?{DEQ:7BB&MOi2LF¡.~bkh2UMqdSlPJLA~[+Wc<|{0BKH5t&h;+OAY, H%atO.F)B;!Iw[?aaYZ;m¡YeCvhcx|K]X7B)a%Wbe38&8?]{l4p2istQ=KVow> §Ime5}5}~ ijhEGcZz&{#Vs6!%Od`);
// return function(a,b){return new Promise(function(e,f){var c=function(){function a(a,b){a instanceof ImageData?(this.data=new Uint32Array(a.data.buffer),this.width=a.width,this.height=a.height):typeof a==='number'&&b!==void 0&&typeof b!==null&&(this.data=new Uint32Array(a),this.width=b);}return a.prototype.setDistSize=function(a){this.dist=new Uint32Array(this.data.length*Math.pow(a,2)),this.targetScale=a;},a.prototype.getSourcePoint=function(b,c,a){return(b+a<this.width*Math.floor(b/this.width)||b+a>this.width*Math.floor(b/this.width+1)-1)&&(a+=a===0?0:a>0?-1:1),b+this.width*c+a<0||b+this.width*c+a>=this.data.length?(c+=c===0?0:c>0?-1:1,a===0&&c===0?this.data[b+this.width*c+a]:this.getSourcePoint(b,c,a)):this.data[b+this.width*c+a];},a.prototype.setDistPoint=function(a,b,c,d){this.dist[a+this.width*this.targetScale*b+c]=d;},a.prototype.getDistPoint=function(a){return this.dist[a];},a.prototype.outImageData=function(){var a=new Uint8ClampedArray(this.dist.buffer);return new ImageData(a,this.width*this.targetScale);},a.prototype.outImageDataURL=function(){var a=this.outImageData();try{var b=new OffscreenCanvas(a.width,a.height);var c=b.getContext('2d');return c?(c.putImageData(a,0,0),b.toDataURL()):'';}catch(e){var canvas=document.createElement('canvas');var ctx=canvas.getContext('2d');if(ctx){ctx.canvas.width=id.width;ctx.canvas.height=id.height;ctx.putImageData(id,0,0);return canvas.toDataURL();}else{return'';}}},a.getR=function(a){return a&255;},a.getG=function(a){return a>>8&255;},a.getB=function(a){return a>>16&255;},a.getA=function(a){return a>>24;},a.Interpolate=function(g,h,a,b){var i=g>>24;var j=g>>16&255;var k=g>>8&255;var l=g&255;var m=h>>24;var n=h>>16&255;var o=h>>8&255;var p=h&255;if(a!==undefined&&b!==undefined){var c=a>>24;var d=a>>16&255;var e=a>>8&255;var f=a&255;var q=b>>24;var r=b>>16&255;var s=b>>8&255;var t=b&255;return i+m+c+q>>2<<24|j+n+d+r>>2<<16|k+o+e+s>>2<<8|l+p+f+t>>2;}else if(a!==undefined&&b===undefined){var c=a>>24;var d=a>>16&255;var e=a>>8&255;var f=a&255;return Math.floor((i+m+c)/3)<<24|Math.floor((j+n+d)/3)<<16|Math.floor((k+o+e)/3)<<8|Math.floor((l+p+f)/3);}else return i+m>>1<<24|j+n>>1<<16|k+o>>1<<8|l+p>>1;},a.InterpolateWeighted2=function(d,e,a,b){var c=a+b;var f=d>>24;var g=d>>16&255;var h=d>>8&255;var i=d&255;var j=e>>24;var k=e>>16&255;var l=e>>8&255;var m=e&255;return Math.floor((f*a+j*b)/c)<<24|Math.floor((g*a+k*b)/c)<<16|Math.floor((h*a+l*b)/c)<<8|Math.floor((i*a+m*b)/c);},a.InterpolateWeighted3=function(e,f,g,a,b,c){var d=a+b+c;var h=e>>24;var i=e>>16&255;var j=e>>8&255;var k=e&255;var l=f>>24;var m=f>>16&255;var n=f>>8&255;var o=f&255;var p=g>>24;var q=g>>16&255;var r=g>>8&255;var s=g&255;return Math.floor((h*a+l*b+p*c)/d)<<24|Math.floor((i*a+m*b+q*c)/d)<<16|Math.floor((j*a+n*b+r*c)/d)<<8|Math.floor((k*a+o*b+s*c)/d);},a.InterpolateWeighted4=function(f,g,h,i,a,b,c,d){var e=a+b+c+d;var j=f>>24;var k=f>>16&255;var l=f>>8&255;var m=f&255;var n=g>>24;var o=g>>16&255;var p=g>>8&255;var q=g&255;var r=h>>24;var s=h>>16&255;var t=h>>8&255;var u=h&255;var v=i>>24;var w=i>>16&255;var x=i>>8&255;var y=i&255;return Math.floor((j*a+n*b+r*c+v*d)/e)<<24|Math.floor((k*a+o*b+s*c+w*d)/e)<<16|Math.floor((l*a+p*b+t*c+x*d)/e)<<8|Math.floor((m*a+q*b+u*c+y*d)/e);},a;}();var d=function(){function a(){}return a.EPX=function(A,j){var v=!1;j===4&&(v=!0,j=2);var a=new c(A);a.setDistSize(j);for(var o=0;o<a.height;o++)for(var p=0;p<a.width;p++){var i=o*a.width+p;var g=a.getSourcePoint(i,-1,0);var d=a.getSourcePoint(i,0,-1);var b=a.getSourcePoint(i,0,0);var e=a.getSourcePoint(i,0,1);var h=a.getSourcePoint(i,1,0);var f=o*a.width*Math.pow(j,2)+p*j;var k=void 0,l=void 0,m=void 0,n=void 0;if(j===2)g!==h&&d!==e?(k=d===g?d:b,l=g===e?e:b,m=d===h?d:b,n=h===e?e:b):k=l=m=n=b,a.setDistPoint(f,0,0,k),a.setDistPoint(f,0,1,l),a.setDistPoint(f,1,0,m),a.setDistPoint(f,1,1,n);else if(j===3){var w=a.getSourcePoint(i,-1,-1);var x=a.getSourcePoint(i,-1,1);var y=a.getSourcePoint(i,1,-1);var z=a.getSourcePoint(i,1,1);var q=void 0,r=void 0,s=void 0,t=void 0,u=void 0;g!==h&&d!==e?(k=d===g?d:b,l=d===g&&b!==x||g===e&&b!==w?g:b,q=g===e?e:b,m=d===g&&b!==y||d===h&&b!==w?d:b,n=b,r=g===e&&b!==z||h===e&&b!==x?e:b,s=d===h?d:b,t=d===h&&b!==z||h===e&&b!==y?h:b,u=h===e?e:b):k=l=q=m=n=r=s=t=u=b,a.setDistPoint(f,0,0,k),a.setDistPoint(f,0,1,l),a.setDistPoint(f,0,2,q),a.setDistPoint(f,1,0,m),a.setDistPoint(f,1,1,n),a.setDistPoint(f,1,2,r),a.setDistPoint(f,2,0,s),a.setDistPoint(f,2,1,t),a.setDistPoint(f,2,2,u);}}return v?this.EPX(a.outImageData(),2):a.outImageData();},a;}();e(d.EPX(a,b));});};
// Pixel Art Scaler: jsPixelFilter
/*
   jsPixelFilter
   Copyright (C) 2020 Kitsune Gadget
   Copyright (C) 2022 Matias Affolter
   This program is free software: you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
   the Free Software Foundation, either version 3 of the License, or
   (at your option) any later version.

   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.

   You should have received a copy of the GNU General Public License
   along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/

/*
var fu = function(image_data, scale) {

    return new Promise(function (resolve, reject){


        var PixelData = (function () {
            function PixelData(obj, width) {
                if (obj instanceof ImageData) {
                    this.data = new Uint32Array(obj.data.buffer);
                    this.width = obj.width;
                    this.height = obj.height;
                }
                else if (typeof obj === 'number') {
                    if (typeof width !== 'undefined' && typeof width !== null) {
                        this.data = new Uint32Array(obj);
                        this.width = width;
                    }
                }
            }
            PixelData.prototype.setDistSize = function (scale) {
                this.dist = new Uint32Array(this.data.length * Math.pow(scale, 2));
                this.targetScale = scale;
            };
            PixelData.prototype.getSourcePoint = function (x, v, u) {
                if ((x + u) < this.width * Math.floor(x / this.width)
                    || (x + u) > this.width * Math.floor((x / this.width) + 1) - 1) {
                    // データは横方向に連続なので左右ボーダーを超えるときはuを1つ戻す
                    u += u === 0 ? 0 : u > 0 ? -1 : 1;
                }
                if ((x + this.width * v + u) < 0 || (x + this.width * v + u) >= this.data.length) {
                    // データ範囲外
                    v += v === 0 ? 0 : v > 0 ? -1 : 1;
                    if (u === 0 && v === 0) {
                        return this.data[x + this.width * v + u];
                    }
                    return this.getSourcePoint(x, v, u);
                    //
                }
                else {
                    return this.data[x + this.width * v + u];
                }
            };
            PixelData.prototype.setDistPoint = function (topleft, v, u, value) {
                this.dist[topleft + this.width * this.targetScale * v + u] = value;
            };
            PixelData.prototype.getDistPoint = function (trg) {
                return this.dist[trg];
            };
            PixelData.prototype.outImageData = function () {
                var outData = new Uint8ClampedArray(this.dist.buffer);
                // console.log(this.targetScale)
                return new ImageData(outData, this.width * this.targetScale);
            };
            PixelData.prototype.outImageDataURL = function () {
                var id = this.outImageData();

                try {
                    var canvas = new OffscreenCanvas(id.width, id.height);
                    var ctx = canvas.getContext('2d');
                    if (ctx) {
                        ctx.putImageData(id, 0, 0);
                        return canvas.toDataURL();
                    }else {
                        return "";
                    }

                } catch(e) {

                    var canvas = document.createElement('canvas');
                    var ctx = canvas.getContext('2d');
                    if (ctx) {
                        ctx.canvas.width = id.width;
                        ctx.canvas.height = id.height;
                        ctx.putImageData(id, 0, 0);
                        return canvas.toDataURL();
                    }else {
                        return "";
                    }
                }
            };
            // ピクセルXのカラー取得
            PixelData.getR = function (X) {
                return X & 0xff;
            };
            PixelData.getG = function (X) {
                return (X >> 8) & 0xff;
            };
            PixelData.getB = function (X) {
                return (X >> 16) & 0xff;
            };
            PixelData.getA = function (X) {
                return X >> 24;
            };
            // ピクセル色補完
            PixelData.Interpolate = function (A, B, C, D) {
                var A_a = A >> 24;
                var A_b = (A >> 16) & 0xff;
                var A_g = (A >> 8) & 0xff;
                var A_r = A & 0xff;
                var B_a = B >> 24;
                var B_b = (B >> 16) & 0xff;
                var B_g = (B >> 8) & 0xff;
                var B_r = B & 0xff;
                if (C !== undefined && D !== undefined) {
                    var C_a = C >> 24;
                    var C_b = (C >> 16) & 0xff;
                    var C_g = (C >> 8) & 0xff;
                    var C_r = C & 0xff;
                    var D_a = D >> 24;
                    var D_b = (D >> 16) & 0xff;
                    var D_g = (D >> 8) & 0xff;
                    var D_r = D & 0xff;
                    return ((A_a + B_a + C_a + D_a) >> 2) << 24
                        | ((A_b + B_b + C_b + D_b) >> 2) << 16
                        | ((A_g + B_g + C_g + D_g) >> 2) << 8
                        | ((A_r + B_r + C_r + D_r) >> 2);
                    //
                }
                else if (C !== undefined && D === undefined) {
                    var C_a = C >> 24;
                    var C_b = (C >> 16) & 0xff;
                    var C_g = (C >> 8) & 0xff;
                    var C_r = C & 0xff;
                    return Math.floor((A_a + B_a + C_a) / 3) << 24
                        | Math.floor((A_b + B_b + C_b) / 3) << 16
                        | Math.floor((A_g + B_g + C_g) / 3) << 8
                        | Math.floor((A_r + B_r + C_r) / 3);
                    //
                }
                else {
                    return ((A_a + B_a) >> 1) << 24
                        | ((A_b + B_b) >> 1) << 16
                        | ((A_g + B_g) >> 1) << 8
                        | ((A_r + B_r) >> 1);
                }
            };
            PixelData.InterpolateWeighted2 = function (A, B, f1, f2) {
                var total = (f1 + f2);
                var A_a = A >> 24;
                var A_b = (A >> 16) & 0xff;
                var A_g = (A >> 8) & 0xff;
                var A_r = A & 0xff;
                var B_a = B >> 24;
                var B_b = (B >> 16) & 0xff;
                var B_g = (B >> 8) & 0xff;
                var B_r = B & 0xff;
                return Math.floor((A_a * f1 + B_a * f2) / total) << 24
                    | Math.floor((A_b * f1 + B_b * f2) / total) << 16
                    | Math.floor((A_g * f1 + B_g * f2) / total) << 8
                    | Math.floor((A_r * f1 + B_r * f2) / total);
            };
            PixelData.InterpolateWeighted3 = function (A, B, C, f1, f2, f3) {
                var total = (f1 + f2 + f3);
                var A_a = A >> 24;
                var A_b = (A >> 16) & 0xff;
                var A_g = (A >> 8) & 0xff;
                var A_r = A & 0xff;
                var B_a = B >> 24;
                var B_b = (B >> 16) & 0xff;
                var B_g = (B >> 8) & 0xff;
                var B_r = B & 0xff;
                var C_a = C >> 24;
                var C_b = (C >> 16) & 0xff;
                var C_g = (C >> 8) & 0xff;
                var C_r = C & 0xff;
                return Math.floor((A_a * f1 + B_a * f2 + C_a * f3) / total) << 24
                    | Math.floor((A_b * f1 + B_b * f2 + C_b * f3) / total) << 16
                    | Math.floor((A_g * f1 + B_g * f2 + C_g * f3) / total) << 8
                    | Math.floor((A_r * f1 + B_r * f2 + C_r * f3) / total);
            };
            PixelData.InterpolateWeighted4 = function (A, B, C, D, w1, w2, w3, w4) {
                var total = (w1 + w2 + w3 + w4);
                var A_a = A >> 24;
                var A_b = (A >> 16) & 0xff;
                var A_g = (A >> 8) & 0xff;
                var A_r = A & 0xff;
                var B_a = B >> 24;
                var B_b = (B >> 16) & 0xff;
                var B_g = (B >> 8) & 0xff;
                var B_r = B & 0xff;
                var C_a = C >> 24;
                var C_b = (C >> 16) & 0xff;
                var C_g = (C >> 8) & 0xff;
                var C_r = C & 0xff;
                var D_a = D >> 24;
                var D_b = (D >> 16) & 0xff;
                var D_g = (D >> 8) & 0xff;
                var D_r = D & 0xff;
                return Math.floor((A_a * w1 + B_a * w2 + C_a * w3 + D_a * w4) / total) << 24
                    | Math.floor((A_b * w1 + B_b * w2 + C_b * w3 + D_b * w4) / total) << 16
                    | Math.floor((A_g * w1 + B_g * w2 + C_g * w3 + D_g * w4) / total) << 8
                    | Math.floor((A_r * w1 + B_r * w2 + C_r * w3 + D_r * w4) / total);
            };
            return PixelData;
        }());
        var EPX = (function () {
            function EPX() {
            }
            // Eric's Pixel Expansion / Scale Nx Algorithm
            EPX.EPX = function (imageData, scale) {
                var twiceScale = false;
                if (scale === 4) {
                    twiceScale = true;
                    scale = 2;
                }
                var p = new PixelData(imageData);
                p.setDistSize(scale);
                for (var j = 0; j < p.height; j++) {
                    for (var i = 0; i < p.width; i++) {
                        var l = j * p.width + i;
                        // A  B  C
                        // D  E  F
                        // G  H  I
                        var B = p.getSourcePoint(l, -1, 0);
                        var D = p.getSourcePoint(l, 0, -1);
                        var E = p.getSourcePoint(l, 0, 0);
                        var F = p.getSourcePoint(l, 0, 1);
                        var H = p.getSourcePoint(l, 1, 0);
                        var rl = j * p.width * Math.pow(scale, 2) + i * scale;
                        var e00 = void 0, e01 = void 0, e10 = void 0, e11 = void 0;
                        if (scale === 2) {
                            if (B !== H && D !== F) {
                                e00 = D === B ? D : E;
                                e01 = B === F ? F : E;
                                e10 = D === H ? D : E;
                                e11 = H === F ? F : E;
                            }
                            else {
                                e00 = e01 = e10 = e11 = E;
                            }
                            p.setDistPoint(rl, 0, 0, e00);
                            p.setDistPoint(rl, 0, 1, e01);
                            p.setDistPoint(rl, 1, 0, e10);
                            p.setDistPoint(rl, 1, 1, e11);
                        }
                        else if (scale === 3) {
                            var A = p.getSourcePoint(l, -1, -1);
                            var C = p.getSourcePoint(l, -1, 1);
                            var G = p.getSourcePoint(l, 1, -1);
                            var I = p.getSourcePoint(l, 1, 1);
                            // out
                            var e02 = void 0, e12 = void 0, e20 = void 0, e21 = void 0, e22 = void 0;
                            if (B !== H && D !== F) {
                                e00 = D === B ? D : E;
                                e01 = (D === B && E !== C) || (B === F && E !== A) ? B : E;
                                e02 = B === F ? F : E;
                                e10 = (D === B && E !== G) || (D === H && E !== A) ? D : E;
                                e11 = E;
                                e12 = (B === F && E !== I) || (H === F && E !== C) ? F : E;
                                e20 = D === H ? D : E;
                                e21 = (D === H && E !== I) || (H === F && E !== G) ? H : E;
                                e22 = H === F ? F : E;
                            }
                            else {
                                e00 = e01 = e02 = e10 = e11 = e12 = e20 = e21 = e22 = E;
                            }
                            p.setDistPoint(rl, 0, 0, e00);
                            p.setDistPoint(rl, 0, 1, e01);
                            p.setDistPoint(rl, 0, 2, e02);
                            p.setDistPoint(rl, 1, 0, e10);
                            p.setDistPoint(rl, 1, 1, e11);
                            p.setDistPoint(rl, 1, 2, e12);
                            p.setDistPoint(rl, 2, 0, e20);
                            p.setDistPoint(rl, 2, 1, e21);
                            p.setDistPoint(rl, 2, 2, e22);
                        }
                    }
                } // end of for
                if (twiceScale) {
                    return this.EPX(p.outImageData(), 2);
                }
                else {
                    return p.outImageData();
                }
            };
            return EPX;
        }());

        resolve(EPX.EPX(image_data, scale));
    });
};*/

function epx(image_data, scale, pool) {

    return new Promise(function(resolve, reject){

        if(Boolean(pool)) {

            pool.exec(epx_process_function, [
                image_data,
                scale,
            ]).catch((e) => {

                return epx_process_function(image_data, scale);
            }).then((result) => {

                resolve(result);
            }).timeout(40 * 1000);

        }else {

            epx_process_function(image_data, scale).then((result) => {

                resolve(result);
            });
        }
    });
};

module.exports = { epx };